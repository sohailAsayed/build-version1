var SF=Object.create;var C1=Object.defineProperty,AF=Object.defineProperties,kF=Object.getOwnPropertyDescriptor,RF=Object.getOwnPropertyDescriptors,PF=Object.getOwnPropertyNames,wI=Object.getOwnPropertySymbols,OF=Object.getPrototypeOf,CI=Object.prototype.hasOwnProperty,LF=Object.prototype.propertyIsEnumerable;var EI=(n,r,t)=>r in n?C1(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t,ht=(n,r)=>{for(var t in r||={})CI.call(r,t)&&EI(n,t,r[t]);if(wI)for(var t of wI(r))LF.call(r,t)&&EI(n,t,r[t]);return n},vn=(n,r)=>AF(n,RF(r));var DI=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var FF=(n,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of PF(r))!CI.call(n,h)&&h!==t&&C1(n,h,{get:()=>r[h],enumerable:!(a=kF(r,h))||a.enumerable});return n};var TI=(n,r,t)=>(t=n!=null?SF(OF(n)):{},FF(r||!n||!n.__esModule?C1(t,"default",{value:n,enumerable:!0}):t,n));var Mm=(n,r,t)=>new Promise((a,h)=>{var i=V=>{try{F(t.next(V))}catch(K){h(K)}},C=V=>{try{F(t.throw(V))}catch(K){h(K)}},F=V=>V.done?a(V.value):Promise.resolve(V.value).then(i,C);F((t=t.apply(n,r)).next())});var OO=DI((fT,pT)=>{"use strict";(function(n,r){typeof fT=="object"&&typeof pT<"u"?pT.exports=r():typeof define=="function"&&define.amd?define(r):(n=typeof globalThis<"u"?globalThis:n||self,n.mapboxgl=r())})(fT,function(){"use strict";var n,r,t;function a(i,C){if(!n)n=C;else if(!r)r=C;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",V={};n(V),t=C(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(t.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}a(["exports"],function(i){"use strict";var C=typeof self<"u"?self:{},F="2.15.0";let V,K={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(V==null){let o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{V=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):o}catch{V=o}}return V},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!K.API_URL)return null;try{let o=new URL(K.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},oe={supported:!1,testSupport:function(o){!Ne&&Ye&&(ct?bt(o):Ee=o)}},Ee,Ye,Ne=!1,ct=!1;function bt(o){let e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Ye),o.isContextLost())return;oe.supported=!0}catch{}o.deleteTexture(e),Ne=!0}C.document&&(Ye=C.document.createElement("img"),Ye.onload=function(){Ee&&bt(Ee),Ee=null,ct=!0},Ye.onerror=function(){Ne=!0,Ee=null},Ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Ut="01";function Qt(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var yi=Un;function Un(o,e,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=e,this.p2x=s,this.p2y=c}Un.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,e){if(e===void 0&&(e=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var f=this.sampleCurveX(s)-o;if(Math.abs(f)<e)return s;var g=this.sampleCurveDerivativeX(s);if(Math.abs(g)<1e-6)break;s-=f/g}var v=0,E=1;for(s=o,c=0;c<20&&(f=this.sampleCurveX(s),!(Math.abs(f-o)<e));c++)o>f?v=s:E=s,s=.5*(E-v)+v;return s},solve:function(o,e){return this.sampleCurveY(this.solveCurveX(o,e))}};var Io=Qt(yi),lt=mo;function mo(o,e){this.x=o,this.y=e}mo.prototype={clone:function(){return new mo(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,e){return this.clone()._rotateAround(o,e)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var e=o.x-this.x,s=o.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult:function(o){var e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var e=Math.cos(o),s=Math.sin(o),c=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,e){var s=Math.cos(o),c=Math.sin(o),f=e.y+c*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-c*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},mo.convert=function(o){return o instanceof mo?o:Array.isArray(o)?new mo(o[0],o[1]):o};var It=Qt(lt);let Bs=Math.PI/180,Wa=180/Math.PI;function An(o){return o*Bs}function Yi(o){return o*Wa}let Xl=[[0,0],[1,0],[1,1],[0,1]];function Vs(o){if(o<=0)return 0;if(o>=1)return 1;let e=o*o,s=e*o;return 4*(o<.5?s:3*(o-e)+s-.75)}function qa(o,e,s,c){let f=new Io(o,e,s,c);return function(g){return f.solve(g)}}let Yc=qa(.25,.1,.25,1);function Cn(o,e,s){return Math.min(s,Math.max(e,o))}function Wo(o,e,s){return(s=Cn((s-o)/(e-o),0,1))*s*(3-2*s)}function dr(o,e,s){let c=s-e,f=((o-e)%c+c)%c+e;return f===e?s:f}function vr(o,e,s){if(!o.length)return s(null,[]);let c=o.length,f=new Array(o.length),g=null;o.forEach((v,E)=>{e(v,(I,A)=>{I&&(g=I),f[E]=A,--c==0&&s(g,f)})})}function go(o){let e=[];for(let s in o)e.push(o[s]);return e}function Fi(o,...e){for(let s of e)for(let c in s)o[c]=s[c];return o}let hs=1;function Za(){return hs++}function js(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Us(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function fs(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function _a(o,e){o.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function Xa(o,e){return o.indexOf(e,o.length-e.length)!==-1}function Nn(o,e,s){let c={};for(let f in o)c[f]=e.call(s||this,o[f],f,o);return c}function Zt(o,e,s){let c={};for(let f in o)e.call(s||this,o[f],f,o)&&(c[f]=o[f]);return c}function yo(o){return Array.isArray(o)?o.map(yo):typeof o=="object"&&o?Nn(o,yo):o}let va={};function _i(o){va[o]||(typeof console<"u"&&console.warn(o),va[o]=!0)}function _o(o,e,s){return(s.y-o.y)*(e.x-o.x)>(e.y-o.y)*(s.x-o.x)}function Ya(o){let e=0;for(let s,c,f=0,g=o.length,v=g-1;f<g;v=f++)s=o[f],c=o[v],e+=(c.x-s.x)*(s.y+c.y);return e}function ps(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kr(o){let e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,g)=>{let v=f||g;return e[c]=!v||v.toLowerCase(),""}),e["max-age"]){let s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let $s=null;function Yl(o){if($s==null){let e=o.navigator?o.navigator.userAgent:null;$s=!!o.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return $s}function Kc(o){try{let e=C[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Qr(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}let Kl="mapbox-tiles",Di=500,hd=50,So,ba;function Ql(){try{return C.caches}catch{}}function Hs(){Ql()&&!So&&(So=C.caches.open(Kl))}function Jl(o){let e=o.indexOf("?");if(e<0)return o;let s=function(f){let g=f.indexOf("?");return g>0?f.slice(g+1).split("&"):[]}(o),c=s.filter(f=>{let g=f.split("=");return g[0]==="language"||g[0]==="worldview"});return c.length?`${o.slice(0,e)}?${c.join("&")}`:o.slice(0,e)}let Qc=1/0,Ka={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ka);class vo extends Error{constructor(e,s,c){s===401&&$e(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Gs=ps()?()=>self.worker&&self.worker.referrer:()=>(C.location.protocol==="blob:"?C.parent:C).location.href,Mr=function(o,e){if(!(/^file:/.test(s=o.url)||/^file:/.test(Gs())&&!/^\w+:/.test(s))){if(C.fetch&&C.Request&&C.AbortController&&C.Request.prototype.hasOwnProperty("signal"))return function(c,f){let g=new C.AbortController,v=new C.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Gs(),referrerPolicy:c.referrerPolicy,signal:g.signal}),E=!1,I=!1,A=(L=v.url).indexOf("sku=")>0&&$e(L);var L;c.type==="json"&&v.headers.set("Accept","application/json");let j=(W,q,ee)=>{if(I)return;if(W&&W.message!=="SecurityError"&&_i(W.toString()),q&&ee)return $(q);let ae=Date.now();C.fetch(v).then(me=>{if(me.ok){let we=A?me.clone():null;return $(me,we,ae)}return f(new vo(me.statusText,me.status,c.url))}).catch(me=>{me.name!=="AbortError"&&f(new Error(`${me.message} ${c.url}`))})},$=(W,q,ee)=>{(c.type==="arrayBuffer"?W.arrayBuffer():c.type==="json"?W.json():W.text()).then(ae=>{I||(q&&ee&&function(me,we,ge){if(Hs(),!So)return;let xe={status:we.status,statusText:we.statusText,headers:new C.Headers};we.headers.forEach((qe,We)=>xe.headers.set(We,qe));let Te=Kr(we.headers.get("Cache-Control")||"");if(Te["no-store"])return;Te["max-age"]&&xe.headers.set("Expires",new Date(ge+1e3*Te["max-age"]).toUTCString());let Ce=xe.headers.get("Expires");Ce&&(new Date(Ce).getTime()-ge<42e4||function(qe,We){if(ba===void 0)try{new Response(new ReadableStream),ba=!0}catch{ba=!1}ba?We(qe.body):qe.blob().then(We)}(we,qe=>{let We=new C.Response(qe,xe);Hs(),So&&So.then(et=>et.put(Jl(me.url),We)).catch(et=>_i(et.message))}))}(v,q,ee),E=!0,f(null,ae,W.headers.get("Cache-Control"),W.headers.get("Expires")))}).catch(ae=>{I||f(new Error(ae.message))})};return A?function(W,q){if(Hs(),!So)return q(null);let ee=Jl(W.url);So.then(ae=>{ae.match(ee).then(me=>{let we=function(ge){if(!ge)return!1;let xe=new Date(ge.headers.get("Expires")||0),Te=Kr(ge.headers.get("Cache-Control")||"");return xe>Date.now()&&!Te["no-cache"]}(me);ae.delete(ee),we&&ae.put(ee,me.clone()),q(null,me,we)}).catch(q)}).catch(q)}(v,j):j(null,null),{cancel:()=>{I=!0,E||g.abort()}}}(o,e);if(ps()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var s;return function(c,f){let g=new C.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(let v in c.headers)g.setRequestHeader(v,c.headers[v]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let v=g.response;if(c.type==="json")try{v=JSON.parse(g.response)}catch(E){return f(E)}f(null,v,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new vo(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,e)},Ws=function(o,e){return Mr(Fi(o,{type:"arrayBuffer"}),e)};function fd(o){let e=C.document.createElement("a");return e.href=o,e.protocol===C.document.location.protocol&&e.host===C.document.location.host}let be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",ie,re;ie=[],re=0;let ve=function(o,e){if(oe.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),re>=K.MAX_PARALLEL_IMAGE_REQUESTS){let g={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ie.push(g),g}re++;let s=!1,c=()=>{if(!s)for(s=!0,re--;ie.length&&re<K.MAX_PARALLEL_IMAGE_REQUESTS;){let g=ie.shift(),{requestParameters:v,callback:E,cancelled:I}=g;I||(g.cancel=ve(v,E).cancel)}},f=Ws(o,(g,v,E,I)=>{c(),g?e(g):v&&(C.createImageBitmap?function(A,L){let j=new C.Blob([new Uint8Array(A)],{type:"image/png"});C.createImageBitmap(j).then($=>{L(null,$)}).catch($=>{L(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(A,L)=>e(A,L,E,I)):function(A,L){let j=new C.Image,$=C.URL;j.onload=()=>{L(null,j),$.revokeObjectURL(j.src),j.onload=null,C.requestAnimationFrame(()=>{j.src=be})},j.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let W=new C.Blob([new Uint8Array(A)],{type:"image/png"});j.src=A.byteLength?$.createObjectURL(W):be}(v,(A,L)=>e(A,L,E,I)))});return{cancel:()=>{f.cancel(),c()}}},Me="NO_ACCESS_TOKEN";function Pe(o){return o.indexOf("mapbox:")===0}function $e(o){return K.API_URL_REGEX.test(o)}function je(o){return K.API_CDN_URL_REGEX.test(o)}function Oe(o){return K.API_STYLE_REGEX.test(o)&&!Xe(o)}function Xe(o){return K.API_SPRITE_REGEX.test(o)}let wt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mt(o){let e=o.match(wt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function yt(o){let e=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${e}`}let an="mapbox.eventData";function Dn(o){if(!o)return null;let e=o.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(C.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class cn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let s=Dn(K.ACCESS_TOKEN),c="";return c=s&&s.u?C.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(+("0x"+g)))):K.ACCESS_TOKEN||"",e?`${an}.${e}:${c}`:`${an}:${c}`}fetchEventData(){let e=Kc("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{let f=C.localStorage.getItem(s);f&&(this.eventData=JSON.parse(f));let g=C.localStorage.getItem(c);g&&(this.anonId=g)}catch{_i("Unable to read from LocalStorage")}}saveEventData(){let e=Kc("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{C.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&C.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{_i("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,c,f){if(!K.EVENTS_URL)return;let g=Mt(K.EVENTS_URL);g.params.push(`access_token=${f||K.ACCESS_TOKEN||""}`);let v={event:this.type,created:new Date(e).toISOString()},E=s?Fi(v,s):v,I={url:yt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=function(A,L){return Mr(Fi(A,{method:"POST"}),L)}(I,A=>{this.pendingRequest=null,c(A),this.saveEventData(),this.processRequests(f)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}let mn=new class extends cn{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,e){K.EVENTS_URL&&K.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Pe(s)||$e(s))&&this.queueRequest(Date.now(),e)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Dn(K.ACCESS_TOKEN),s=e?e.u:K.ACCESS_TOKEN,c=s!==this.eventData.tokenU;fs(this.anonId)||(this.anonId=js(),c=!0);let f=this.queue.shift();if(this.eventData.lastSuccess){let g=new Date(this.eventData.lastSuccess),v=new Date(f),E=(f-this.eventData.lastSuccess)/864e5;c=c||E>=1||E<-1||g.getDate()!==v.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:Ut,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=s)},o):this.processRequests()}},kn=mn.postTurnstileEvent.bind(mn),Rn=new class extends cn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,e,s,c){this.skuToken=e,this.errorCb=c,K.EVENTS_URL&&(s||K.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Me)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),fs(this.anonId)||(this.anonId=js()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:Ut,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},o))}},Ki=Rn.postMapLoadEvent.bind(Rn),Vr=new class extends cn{constructor(){super("gljs.performance")}postPerformanceEvent(o,e){K.EVENTS_URL&&(o||K.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:s}=this.queue.shift(),c=function(f){let g=C.performance.getEntriesByType("resource"),v=C.performance.getEntriesByType("mark"),E=function($){let W={};if($){for(let q in $)if(q!=="other")for(let ee of $[q]){let ae=`${q}ResolveRangeMin`,me=`${q}ResolveRangeMax`,we=`${q}RequestCount`,ge=`${q}RequestCachedCount`;W[ae]=Math.min(W[ae]||1/0,ee.startTime),W[me]=Math.max(W[me]||-1/0,ee.responseEnd);let xe=Te=>{W[Te]===void 0&&(W[Te]=0),++W[Te]};ee.transferSize!==void 0&&ee.transferSize===0&&xe(ge),xe(we)}}return W}(function($,W){let q={};if($)for(let ee of $){let ae=W(ee);q[ae]===void 0&&(q[ae]=[]),q[ae].push(ee)}return q}(g,Mh)),I=C.devicePixelRatio,A=C.navigator.connection||C.navigator.mozConnection||C.navigator.webkitConnection,L={counters:[],metadata:[],attributes:[]},j=($,W,q)=>{q!=null&&$.push({name:W,value:q.toString()})};for(let $ in E)j(L.counters,$,E[$]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(j(L.counters,"interactionRangeMin",f.interactionRange[0]),j(L.counters,"interactionRangeMax",f.interactionRange[1])),v)for(let $ of Object.keys(ec)){let W=ec[$],q=v.find(ee=>ee.name===W);q&&j(L.counters,W,q.startTime)}return j(L.counters,"visibilityHidden",f.visibilityHidden),j(L.attributes,"style",function($){if($)for(let W of $){let q=W.name.split("?")[0];if(Oe(q)){let ee=q.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(g)),j(L.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),j(L.attributes,"fogEnabled",f.fogEnabled?"true":"false"),j(L.attributes,"projection",f.projection),j(L.attributes,"zoom",f.zoom),j(L.metadata,"devicePixelRatio",I),j(L.metadata,"connectionEffectiveType",A?A.effectiveType:void 0),j(L.metadata,"navigatorUserAgent",C.navigator.userAgent),j(L.metadata,"screenWidth",C.screen.width),j(L.metadata,"screenHeight",C.screen.height),j(L.metadata,"windowWidth",C.innerWidth),j(L.metadata,"windowHeight",C.innerHeight),j(L.metadata,"mapWidth",f.width/I),j(L.metadata,"mapHeight",f.height/I),j(L.metadata,"webglRenderer",f.renderer),j(L.metadata,"webglVendor",f.vendor),j(L.metadata,"sdkVersion",F),j(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(s);for(let f of c.metadata);for(let f of c.counters);for(let f of c.attributes);this.postEvent(e,c,()=>{},o)}},hr=Vr.postPerformanceEvent.bind(Vr),ms=new class extends cn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,e,s,c){if(!K.API_URL||!K.SESSION_PATH)return;let f=Mt(K.API_URL+K.SESSION_PATH);f.params.push(`sku=${e||""}`),f.params.push(`access_token=${c||K.ACCESS_TOKEN||""}`);let g={url:yt(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(v,E){return Mr(Fi(v,{method:"GET"}),E)}(g,v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,e,s,c){this.skuToken=e,this.errorCb=c,K.SESSION_PATH&&K.API_URL&&(s||K.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Me)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},o)}},Ir=ms.getSessionAPI.bind(ms),jr=new Set,ec={create:"create",load:"load",fullLoad:"fullLoad"},gp={mark(o){C.performance.mark(o)},measure(o,e,s){C.performance.measure(o,e,s)}};function Mh(o){let e=o.name.split("?")[0];return je(e)&&e.includes("mapbox-gl.js")?"javascript":je(e)&&e.includes("mapbox-gl.css")?"css":function(s){return K.API_FONTS_REGEX.test(s)}(e)?"fontRange":Xe(e)?"sprite":Oe(e)?"style":function(s){return K.API_TILEJSON_REGEX.test(s)}(e)?"tilejson":"other"}let ei=C.performance;function Jc(o){let e=o?o.url.toString():void 0;return ei.getEntriesByName(e)}let xa,Ih,vi,qo,gs={now:()=>vi!==void 0?vi:C.performance.now(),setNow(o){vi=o},restoreNow(){vi=void 0},frame(o){let e=C.requestAnimationFrame(o);return{cancel:()=>C.cancelAnimationFrame(e)}},getImageData(o,e=0){let{width:s,height:c}=o;qo||(qo=C.document.createElement("canvas"));let f=qo.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(s>qo.width||c>qo.height)&&(qo.width=s,qo.height=c),f.clearRect(-e,-e,s+2*e,c+2*e),f.drawImage(o,0,0,s,c),f.getImageData(-e,-e,s+2*e,c+2*e)},resolveURL:o=>(xa||(xa=C.document.createElement("a")),xa.href=o,xa.href),get devicePixelRatio(){return C.devicePixelRatio},get prefersReducedMotion(){return!!C.matchMedia&&(Ih==null&&(Ih=C.matchMedia("(prefers-reduced-motion: reduce)")),Ih.matches)}};function Sh(o,e,s){s[o]&&s[o].indexOf(e)!==-1||(s[o]=s[o]||[],s[o].push(e))}function Ah(o,e,s){if(s&&s[o]){let c=s[o].indexOf(e);c!==-1&&s[o].splice(c,1)}}class Qa{constructor(e,s={}){Fi(this,s),this.type=e}}class qs extends Qa{constructor(e,s={}){super("error",Fi({error:e},s))}}class tc{on(e,s){return this._listeners=this._listeners||{},Sh(e,s,this._listeners),this}off(e,s){return Ah(e,s,this._listeners),Ah(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Sh(e,s,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,s){typeof e=="string"&&(e=new Qa(e,s||{}));let c=e.type;if(this.listens(c)){e.target=this;let f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(let E of f)E.call(this,e);let g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(let E of g)Ah(c,E,this._oneTimeListeners),E.call(this,e);let v=this._eventedParent;v&&(Fi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(e))}else e instanceof qs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Zs(o,...e){for(let s of e)for(let c in s)o[c]=s[c];return o}function sr(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Sr(o){if(Array.isArray(o))return o.map(Sr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){let e={};for(let s in o)e[s]=Sr(o[s]);return e}return sr(o)}class eu extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}var Zo=eu;class pd{constructor(e,s=[]){this.parent=e,this.bindings={};for(let[c,f]of s)this.bindings[c]=f}concat(e){return new pd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var tu=pd;let Ja={kind:"null"},Dt={kind:"number"},xn={kind:"string"},In={kind:"boolean"},bo={kind:"color"},Xo={kind:"object"},wn={kind:"value"},Ur={kind:"collator"},nu={kind:"formatted"},el={kind:"resolvedImage"};function xo(o,e){return{kind:"array",itemType:o,N:e}}function Ti(o){if(o.kind==="array"){let e=Ti(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}let tl=[Ja,Dt,xn,In,bo,nu,Xo,xo(wn),el];function Xs(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Xs(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(let s of tl)if(!Xs(s,e))return null}}return`Expected ${Ti(o)} but found ${Ti(e)} instead.`}function wa(o,e){return e.some(s=>s.kind===o.kind)}function iu(o,e){return e.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}var kh,yp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function nl(o){return(o=Math.round(o))<0?0:o>255?255:o}function ru(o){return nl(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function il(o){return(e=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:e>1?1:e;var e}function rl(o,e,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(e-o)*s*6:2*s<1?e:3*s<2?o+(e-o)*(2/3-s)*6:o}try{kh={}.parseCSSColor=function(o){var e,s=o.replace(/ /g,"").toLowerCase();if(s in yp)return yp[s].slice();if(s[0]==="#")return s.length===4?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:s.length===7&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var c=s.indexOf("("),f=s.indexOf(")");if(c!==-1&&f+1===s.length){var g=s.substr(0,c),v=s.substr(c+1,f-(c+1)).split(","),E=1;switch(g){case"rgba":if(v.length!==4)return null;E=il(v.pop());case"rgb":return v.length!==3?null:[ru(v[0]),ru(v[1]),ru(v[2]),E];case"hsla":if(v.length!==4)return null;E=il(v.pop());case"hsl":if(v.length!==3)return null;var I=(parseFloat(v[0])%360+360)%360/360,A=il(v[1]),L=il(v[2]),j=L<=.5?L*(A+1):L+A-L*A,$=2*L-j;return[nl(255*rl($,j,I+1/3)),nl(255*rl($,j,I)),nl(255*rl($,j,I-1/3)),E];default:return null}}return null}}catch{}class Vi{constructor(e,s,c,f=1){this.r=e,this.g=s,this.b=c,this.a=f}static parse(e){if(!e)return;if(e instanceof Vi)return e;if(typeof e!="string")return;let s=kh(e);return s?new Vi(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){let[e,s,c,f]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(c)},${f})`}toArray(){let{r:e,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*s/f,255*c/f,f]}toArray01(){let{r:e,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[e/f,s/f,c/f,f]}toArray01PremultipliedAlpha(){let{r:e,g:s,b:c,a:f}=this;return[e,s,c,f]}}Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1),Vi.blue=new Vi(0,0,1,1);var Qi=Vi;class ol{constructor(e,s,c){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ou{constructor(e,s,c,f,g){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=c,this.fontStack=f,this.textColor=g}}class $r{constructor(e){this.sections=e}static fromString(e){return new $r([new ou(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof $r?e:$r.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);let c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(c)}return e}}class wo{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new wo({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Rh(o,e,s,c){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,e,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,e,s,c]:[o,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function su(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Qi||o instanceof ol||o instanceof $r||o instanceof wo)return!0;if(Array.isArray(o)){for(let e of o)if(!su(e))return!1;return!0}if(typeof o=="object"){for(let e in o)if(!su(o[e]))return!1;return!0}return!1}function ji(o){if(o===null)return Ja;if(typeof o=="string")return xn;if(typeof o=="boolean")return In;if(typeof o=="number")return Dt;if(o instanceof Qi)return bo;if(o instanceof ol)return Ur;if(o instanceof $r)return nu;if(o instanceof wo)return el;if(Array.isArray(o)){let e=o.length,s;for(let c of o){let f=ji(c);if(s){if(s===f)continue;s=wn;break}s=f}return xo(s||wn,e)}return Xo}function nc(o){let e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof Qi||o instanceof $r||o instanceof wo?o.toString():JSON.stringify(o)}class au{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!su(e[1]))return s.error("invalid value");let c=e[1],f=ji(c),g=s.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new au(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qi?["rgba"].concat(this.value.toArray()):this.value instanceof $r?this.value.serialize():this.value}}var Ao=au,Mi=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};let ic={string:xn,number:Dt,boolean:In,object:Xo};class Ph{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c,f=1,g=e[0];if(g==="array"){let E,I;if(e.length>2){let A=e[1];if(typeof A!="string"||!(A in ic)||A==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);E=ic[A],f++}else E=wn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);I=e[2],f++}c=xo(E,I)}else c=ic[g];let v=[];for(;f<e.length;f++){let E=s.parse(e[f],f,wn);if(!E)return null;v.push(E)}return new Ph(c,v)}evaluate(e){for(let s=0;s<this.args.length;s++){let c=this.args[s].evaluate(e);if(!Xs(this.type,ji(c)))return c;if(s===this.args.length-1)throw new Mi(`Expected value to be of type ${Ti(this.type)}, but found ${Ti(ji(c))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,s=[e.kind];if(e.kind==="array"){let c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);let f=e.N;(typeof f=="number"||this.args.length>1)&&s.push(f)}}return s.concat(this.args.map(c=>c.serialize()))}}var Ys=Ph;class Ea{constructor(e){this.type=nu,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c=e[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");let f=[],g=!1;for(let v=1;v<=e.length-1;++v){let E=e[v];if(g&&typeof E=="object"&&!Array.isArray(E)){g=!1;let I=null;if(E["font-scale"]&&(I=s.parse(E["font-scale"],1,Dt),!I))return null;let A=null;if(E["text-font"]&&(A=s.parse(E["text-font"],1,xo(xn)),!A))return null;let L=null;if(E["text-color"]&&(L=s.parse(E["text-color"],1,bo),!L))return null;let j=f[f.length-1];j.scale=I,j.font=A,j.textColor=L}else{let I=s.parse(e[v],1,wn);if(!I)return null;let A=I.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:I,scale:null,font:null,textColor:null})}}return new Ea(f)}evaluate(e){return new $r(this.sections.map(s=>{let c=s.content.evaluate(e);return ji(c)===el?new ou("",c,null,null,null):new ou(nc(c),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(let s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let s of this.sections){e.push(s.content.serialize());let c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),e.push(c)}return e}}class lu{constructor(e){this.type=el,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");let c=s.parse(e[1],1,xn);return c?new lu(c):s.error("No image name provided.")}evaluate(e){let s=this.input.evaluate(e),c=wo.fromString(s);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(s)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let br={"to-boolean":In,"to-color":bo,"to-number":Dt,"to-string":xn};class ko{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c=e[0];if((c==="to-boolean"||c==="to-string")&&e.length!==2)return s.error("Expected one argument.");let f=br[c],g=[];for(let v=1;v<e.length;v++){let E=s.parse(e[v],v,wn);if(!E)return null;g.push(E)}return new ko(f,g)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,c;for(let f of this.args){if(s=f.evaluate(e),c=null,s instanceof Qi)return s;if(typeof s=="string"){let g=e.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Rh(s[0],s[1],s[2],s[3]),!c))return new Qi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Mi(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(let c of this.args){if(s=c.evaluate(e),s===null)return 0;let f=Number(s);if(!isNaN(f))return f}throw new Mi(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?$r.fromString(nc(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?wo.fromString(nc(this.args[0].evaluate(e))):nc(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ea([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new lu(this.args[0]).serialize();let e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}var sl=ko;let ys=["Unknown","Point","LineString","Polygon"];var md=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ys[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let o=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*e-o[0])+this.featureDistanceData.bearing[1]*(c*e-o[1])}return 0}parseColor(o){let e=this._parseColorCache[o];return e||(e=this._parseColorCache[o]=Qi.parse(o)),e}};class Yo{constructor(e,s,c,f){this.name=e,this.type=s,this._evaluate=c,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){let c=e[0],f=Yo.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let g=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,E=v.filter(([A])=>!Array.isArray(A)||A.length===e.length-1),I=null;for(let[A,L]of E){I=new xd(s.registry,s.path,null,s.scope);let j=[],$=!1;for(let W=1;W<e.length;W++){let q=e[W],ee=Array.isArray(A)?A[W-1]:A.type,ae=I.parse(q,1+j.length,ee);if(!ae){$=!0;break}j.push(ae)}if(!$)if(Array.isArray(A)&&A.length!==j.length)I.error(`Expected ${A.length} arguments, but found ${j.length} instead.`);else{for(let W=0;W<j.length;W++){let q=Array.isArray(A)?A[W]:A.type,ee=j[W];I.concat(W+1).checkSubtype(q,ee.type)}if(I.errors.length===0)return new Yo(c,g,L,j)}}if(E.length===1)s.errors.push(...I.errors);else{let A=(E.length?E:v).map(([j])=>{return $=j,Array.isArray($)?`(${$.map(Ti).join(", ")})`:`(${Ti($.type)}...)`;var $}).join(" | "),L=[];for(let j=1;j<e.length;j++){let $=s.parse(e[j],1+L.length);if(!$)return null;L.push(Ti($.type))}s.error(`Expected arguments of type ${A}, but found (${L.join(", ")}) instead.`)}return null}static register(e,s){Yo.definitions=s;for(let c in s)e[c]=Yo}}var Ks=Yo;class Ca{constructor(e,s,c){this.type=Ur,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");let c=e[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");let f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,In);if(!f)return null;let g=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,In);if(!g)return null;let v=null;return c.locale&&(v=s.parse(c.locale,1,xn),!v)?null:new Ca(f,g,v)}evaluate(e){return new ol(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}let _s=8192;function vs(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function al(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function cu(o,e){let s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(s*f*_s),Math.round(c*f*_s)]}function rc(o,e,s){let c=o[0]-e[0],f=o[1]-e[1],g=o[0]-s[0],v=o[1]-s[1];return c*v-g*f==0&&c*g<=0&&f*v<=0}function uu(o,e){let s=!1;for(let v=0,E=e.length;v<E;v++){let I=e[v];for(let A=0,L=I.length;A<L-1;A++){if(rc(o,I[A],I[A+1]))return!1;(f=I[A])[1]>(c=o)[1]!=(g=I[A+1])[1]>c[1]&&c[0]<(g[0]-f[0])*(c[1]-f[1])/(g[1]-f[1])+f[0]&&(s=!s)}}var c,f,g;return s}function gd(o,e){for(let s=0;s<e.length;s++)if(uu(o,e[s]))return!0;return!1}function du(o,e,s,c){let f=c[0]-s[0],g=c[1]-s[1],v=(o[0]-s[0])*g-f*(o[1]-s[1]),E=(e[0]-s[0])*g-f*(e[1]-s[1]);return v>0&&E<0||v<0&&E>0}function ll(o,e,s){for(let A of s)for(let L=0;L<A.length-1;++L)if((E=[(v=A[L+1])[0]-(g=A[L])[0],v[1]-g[1]])[0]*(I=[(f=e)[0]-(c=o)[0],f[1]-c[1]])[1]-E[1]*I[0]!=0&&du(c,f,g,v)&&du(g,v,c,f))return!0;var c,f,g,v,E,I;return!1}function Zn(o,e){for(let s=0;s<o.length;++s)if(!uu(o[s],e))return!1;for(let s=0;s<o.length-1;++s)if(ll(o[s],o[s+1],e))return!1;return!0}function Ug(o,e){for(let s=0;s<e.length;s++)if(Zn(o,e[s]))return!0;return!1}function yd(o,e,s){let c=[];for(let f=0;f<o.length;f++){let g=[];for(let v=0;v<o[f].length;v++){let E=cu(o[f][v],s);vs(e,E),g.push(E)}c.push(g)}return c}function _d(o,e,s){let c=[];for(let f=0;f<o.length;f++){let g=yd(o[f],e,s);c.push(g)}return c}function Oh(o,e,s,c){if(o[0]<s[0]||o[0]>s[2]){let f=.5*c,g=o[0]-s[0]>f?-c:s[0]-o[0]>f?c:0;g===0&&(g=o[0]-s[2]>f?-c:s[2]-o[0]>f?c:0),o[0]+=g}vs(e,o)}function _p(o,e,s,c){let f=Math.pow(2,c.z)*_s,g=[c.x*_s,c.y*_s],v=[];if(!o)return v;for(let E of o)for(let I of E){let A=[I.x+g[0],I.y+g[1]];Oh(A,e,s,f),v.push(A)}return v}function Lh(o,e,s,c){let f=Math.pow(2,c.z)*_s,g=[c.x*_s,c.y*_s],v=[];if(!o)return v;for(let I of o){let A=[];for(let L of I){let j=[L.x+g[0],L.y+g[1]];vs(e,j),A.push(j)}v.push(A)}if(e[2]-e[0]<=f/2){(E=e)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(let I of v)for(let A of I)Oh(A,e,s,f)}var E;return v}class oc{constructor(e,s){this.type=In,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(su(e[1])){let c=e[1];if(c.type==="FeatureCollection")for(let f=0;f<c.features.length;++f){let g=c.features[f].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new oc(c,c.features[f].geometry)}else if(c.type==="Feature"){let f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new oc(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new oc(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,c){let f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if(c.type==="Polygon"){let E=yd(c.coordinates,g,v),I=_p(s.geometry(),f,g,v);if(!al(f,g))return!1;for(let A of I)if(!uu(A,E))return!1}if(c.type==="MultiPolygon"){let E=_d(c.coordinates,g,v),I=_p(s.geometry(),f,g,v);if(!al(f,g))return!1;for(let A of I)if(!gd(A,E))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,c){let f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(!v)return!1;if(c.type==="Polygon"){let E=yd(c.coordinates,g,v),I=Lh(s.geometry(),f,g,v);if(!al(f,g))return!1;for(let A of I)if(!Zn(A,E))return!1}if(c.type==="MultiPolygon"){let E=_d(c.coordinates,g,v),I=Lh(s.geometry(),f,g,v);if(!al(f,g))return!1;for(let A of I)if(!Ug(A,E))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var vd=oc;function Da(o){if(o instanceof Ks&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof vd)return!1;let e=!0;return o.eachChild(s=>{e&&!Da(s)&&(e=!1)}),e}function Qs(o){if(o instanceof Ks&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(s=>{e&&!Qs(s)&&(e=!1)}),e}function cl(o,e){if(o instanceof Ks&&e.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!cl(c,e)&&(s=!1)}),s}class bd{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");let c=e[1];return s.scope.has(c)?new bd(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Fh=bd;class bs{constructor(e,s=[],c,f=new tu,g=[]){this.registry=e,this.path=s,this.key=s.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c}parse(e,s,c,f,g={}){return s?this.concat(s,c,f)._parse(e,g):this._parse(e,g)}_parse(e,s){function c(f,g,v){return v==="assert"?new Ys(g,[f]):v==="coerce"?new sl(g,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let g=this.registry[f];if(g){let v=g.parse(e,this);if(!v)return null;if(this.expectedType){let E=this.expectedType,I=v.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||I.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(E,I))return null}else v=c(v,E,s.typeAnnotation||"coerce");else v=c(v,E,s.typeAnnotation||"assert")}if(!(v instanceof Ao)&&v.type.kind!=="resolvedImage"&&wd(v)){let E=new md;try{v=new Ao(v.type,v.evaluate(E))}catch(I){return this.error(I.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,c){let f=typeof e=="number"?this.path.concat(e):this.path,g=c?this.scope.concat(c):this.scope;return new bs(this.registry,f,s||null,g,this.errors)}error(e,...s){let c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Zo(c,e))}checkSubtype(e,s){let c=Xs(e,s);return c&&this.error(c),c}}var xd=bs;function wd(o){if(o instanceof Fh)return wd(o.boundExpression);if(o instanceof Ks&&o.name==="error"||o instanceof Ca||o instanceof vd)return!1;let e=o instanceof sl||o instanceof Ys,s=!0;return o.eachChild(c=>{s=e?s&&wd(c):s&&c instanceof Ao}),!!s&&Da(o)&&cl(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ed(o,e){let s=o.length-1,c,f,g=0,v=s,E=0;for(;g<=v;)if(E=Math.floor((g+v)/2),c=o[E],f=o[E+1],c<=e){if(E===s||e<f)return E;g=E+1}else{if(!(c>e))throw new Mi("Input is not a number.");v=E-1}return 0}class Cd{constructor(e,s,c){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(let[f,g]of c)this.labels.push(f),this.outputs.push(g)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");let c=s.parse(e[1],1,Dt);if(!c)return null;let f=[],g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let v=1;v<e.length;v+=2){let E=v===1?-1/0:e[v],I=e[v+1],A=v,L=v+1;if(typeof E!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=E)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);let j=s.parse(I,L,g);if(!j)return null;g=g||j.type,f.push([E,j])}return new Cd(g,c,f)}evaluate(e){let s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);let f=this.input.evaluate(e);if(f<=s[0])return c[0].evaluate(e);let g=s.length;return f>=s[g-1]?c[g-1].evaluate(e):c[Ed(s,f)].evaluate(e)}eachChild(e){e(this.input);for(let s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}var Nh=Cd;function Pn(o,e,s){return o*(1-s)+e*s}var ul=Object.freeze({__proto__:null,array:function(o,e,s){return o.map((c,f)=>Pn(c,e[f],s))},color:function(o,e,s){return new Qi(Pn(o.r,e.r,s),Pn(o.g,e.g,s),Pn(o.b,e.b,s),Pn(o.a,e.a,s))},number:Pn});let hu=.95047,sc=1.08883,vp=4/29,Ta=6/29,ac=3*Ta*Ta,dl=Ta*Ta*Ta,$g=Math.PI/180,hl=180/Math.PI;function zh(o){return o>dl?Math.pow(o,1/3):o/ac+vp}function fl(o){return o>Ta?o*o*o:ac*(o-vp)}function pl(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Dd(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Td(o){let e=Dd(o.r),s=Dd(o.g),c=Dd(o.b),f=zh((.4124564*e+.3575761*s+.1804375*c)/hu),g=zh((.2126729*e+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-zh((.0193339*e+.119192*s+.9503041*c)/sc)),alpha:o.a}}function Md(o){let e=(o.l+16)/116,s=isNaN(o.a)?e:e+o.a/500,c=isNaN(o.b)?e:e-o.b/200;return e=1*fl(e),s=hu*fl(s),c=sc*fl(c),new Qi(pl(3.2404542*s-1.5371385*e-.4985314*c),pl(-.969266*s+1.8760108*e+.041556*c),pl(.0556434*s-.2040259*e+1.0572252*c),o.alpha)}function Hg(o,e,s){let c=e-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}let fu={forward:Td,reverse:Md,interpolate:function(o,e,s){return{l:Pn(o.l,e.l,s),a:Pn(o.a,e.a,s),b:Pn(o.b,e.b,s),alpha:Pn(o.alpha,e.alpha,s)}}},lc={forward:function(o){let{l:e,a:s,b:c}=Td(o),f=Math.atan2(c,s)*hl;return{h:f<0?f+360:f,c:Math.sqrt(s*s+c*c),l:e,alpha:o.a}},reverse:function(o){let e=o.h*$g,s=o.c;return Md({l:o.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:o.alpha})},interpolate:function(o,e,s){return{h:Hg(o.h,e.h,s),c:Pn(o.c,e.c,s),l:Pn(o.l,e.l,s),alpha:Pn(o.alpha,e.alpha,s)}}};var cc=Object.freeze({__proto__:null,hcl:lc,lab:fu});class pu{constructor(e,s,c,f,g){this.type=e,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(let[v,E]of g)this.labels.push(v),this.outputs.push(E)}static interpolationFactor(e,s,c,f){let g=0;if(e.name==="exponential")g=Bh(s,e.base,c,f);else if(e.name==="linear")g=Bh(s,1,c,f);else if(e.name==="cubic-bezier"){let v=e.controlPoints;g=new Io(v[0],v[1],v[2],v[3]).solve(Bh(s,1,c,f))}return g}static parse(e,s){let[c,f,g,...v]=e;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let A=f[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let A=f.slice(1);if(A.length!==4||A.some(L=>typeof L!="number"||L<0||L>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Dt),!g)return null;let E=[],I=null;c==="interpolate-hcl"||c==="interpolate-lab"?I=bo:s.expectedType&&s.expectedType.kind!=="value"&&(I=s.expectedType);for(let A=0;A<v.length;A+=2){let L=v[A],j=v[A+1],$=A+3,W=A+4;if(typeof L!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(E.length&&E[E.length-1][0]>=L)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);let q=s.parse(j,W,I);if(!q)return null;I=I||q.type,E.push([L,q])}return I.kind==="number"||I.kind==="color"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new pu(I,c,f,g,E):s.error(`Type ${Ti(I)} is not interpolatable.`)}evaluate(e){let s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);let f=this.input.evaluate(e);if(f<=s[0])return c[0].evaluate(e);let g=s.length;if(f>=s[g-1])return c[g-1].evaluate(e);let v=Ed(s,f),E=pu.interpolationFactor(this.interpolation,f,s[v],s[v+1]),I=c[v].evaluate(e),A=c[v+1].evaluate(e);return this.operator==="interpolate"?ul[this.type.kind.toLowerCase()](I,A,E):this.operator==="interpolate-hcl"?lc.reverse(lc.interpolate(lc.forward(I),lc.forward(A),E)):fu.reverse(fu.interpolate(fu.forward(I),fu.forward(A),E))}eachChild(e){e(this.input);for(let s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let s=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Bh(o,e,s,c){let f=c-s,g=o-s;return f===0?0:e===1?g/f:(Math.pow(e,g)-1)/(Math.pow(e,f)-1)}var Jr=pu;class Id{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let c=null,f=s.expectedType;f&&f.kind!=="value"&&(c=f);let g=[];for(let E of e.slice(1)){let I=s.parse(E,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!I)return null;c=c||I.type,g.push(I)}let v=f&&g.some(E=>Xs(f,E.type));return new Id(v?wn:c,g)}evaluate(e){let s,c=null,f=0;for(let g of this.args){if(f++,c=g.evaluate(e),c&&c instanceof wo&&!c.available&&(s||(s=c),c=null,f===this.args.length))return s;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}var Sd=Id;class Ad{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let c=[];for(let g=1;g<e.length-1;g+=2){let v=e[g];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,g);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);let E=s.parse(e[g+1],g+1);if(!E)return null;c.push([v,E])}let f=s.parse(e[e.length-1],e.length-1,s.expectedType,c);return f?new Ad(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[s,c]of this.bindings)e.push(s,c.serialize());return e.push(this.result.serialize()),e}}var bp=Ad;class Vh{constructor(e,s,c){this.type=e,this.index=s,this.input=c}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=s.parse(e[1],1,Dt),f=s.parse(e[2],2,xo(s.expectedType||wn));return c&&f?new Vh(f.type.itemType,c,f):null}evaluate(e){let s=this.index.evaluate(e),c=this.input.evaluate(e);if(s<0)throw new Mi(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Mi(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Mi(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gg=Vh;class jh{constructor(e,s){this.type=In,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=s.parse(e[1],1,wn),f=s.parse(e[2],2,wn);return c&&f?wa(c.type,[In,xn,Dt,Ja,wn])?new jh(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(c.type)} instead`):null}evaluate(e){let s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!iu(s,["boolean","string","number","null"]))throw new Mi(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(ji(s))} instead.`);if(!iu(c,["string","array"]))throw new Mi(`Expected second argument to be of type array or string, but found ${Ti(ji(c))} instead.`);return c.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var mu=jh;class gu{constructor(e,s,c){this.type=Dt,this.needle=e,this.haystack=s,this.fromIndex=c}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=s.parse(e[1],1,wn),f=s.parse(e[2],2,wn);if(!c||!f)return null;if(!wa(c.type,[In,xn,Dt,Ja,wn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(c.type)} instead`);if(e.length===4){let g=s.parse(e[3],3,Dt);return g?new gu(c,f,g):null}return new gu(c,f)}evaluate(e){let s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!iu(s,["boolean","string","number","null"]))throw new Mi(`Expected first argument to be of type boolean, string, number or null, but found ${Ti(ji(s))} instead.`);if(!iu(c,["string","array"]))throw new Mi(`Expected second argument to be of type array or string, but found ${Ti(ji(c))} instead.`);if(this.fromIndex){let f=this.fromIndex.evaluate(e);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var uc=gu;class Js{constructor(e,s,c,f,g,v){this.inputType=e,this.type=s,this.input=c,this.cases=f,this.outputs=g,this.otherwise=v}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);let g={},v=[];for(let A=2;A<e.length-1;A+=2){let L=e[A],j=e[A+1];Array.isArray(L)||(L=[L]);let $=s.concat(A);if(L.length===0)return $.error("Expected at least one branch label.");for(let q of L){if(typeof q!="number"&&typeof q!="string")return $.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,ji(q)))return null}else c=ji(q);if(g[String(q)]!==void 0)return $.error("Branch labels must be unique.");g[String(q)]=v.length}let W=s.parse(j,A,f);if(!W)return null;f=f||W.type,v.push(W)}let E=s.parse(e[1],1,wn);if(!E)return null;let I=s.parse(e[e.length-1],e.length-1,f);return I?E.type.kind!=="value"&&s.concat(1).checkSubtype(c,E.type)?null:new Js(c,f,E,g,v,I):null}evaluate(e){let s=this.input.evaluate(e);return(ji(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],f={};for(let v of s){let E=f[this.cases[v]];E===void 0?(f[this.cases[v]]=c.length,c.push([this.cases[v],[v]])):c[E][1].push(v)}let g=v=>this.inputType.kind==="number"?Number(v):v;for(let[v,E]of c)e.push(E.length===1?g(E[0]):E.map(g)),e.push(this.outputs[v].serialize());return e.push(this.otherwise.serialize()),e}}var Wg=Js;class Uh{constructor(e,s,c){this.type=e,this.branches=s,this.otherwise=c}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);let f=[];for(let v=1;v<e.length-1;v+=2){let E=s.parse(e[v],v,In);if(!E)return null;let I=s.parse(e[v+1],v+1,c);if(!I)return null;f.push([E,I]),c=c||I.type}let g=s.parse(e[e.length-1],e.length-1,c);return g?new Uh(c,f,g):null}evaluate(e){for(let[s,c]of this.branches)if(s.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[s,c]of this.branches)e(s),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}var xp=Uh;class yu{constructor(e,s,c,f){this.type=e,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=s.parse(e[1],1,wn),f=s.parse(e[2],2,Dt);if(!c||!f)return null;if(!wa(c.type,[xo(wn),xn,wn]))return s.error(`Expected first argument to be of type array or string, but found ${Ti(c.type)} instead`);if(e.length===4){let g=s.parse(e[3],3,Dt);return g?new yu(c.type,c,f,g):null}return new yu(c.type,c,f)}evaluate(e){let s=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!iu(s,["string","array"]))throw new Mi(`Expected first argument to be of type array or string, but found ${Ti(ji(s))} instead.`);if(this.endIndex){let f=this.endIndex.evaluate(e);return s.slice(c,f)}return s.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var wp=yu;function ml(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function kd(o,e,s,c){return c.compare(e,s)===0}function dc(o,e,s){let c=o!=="=="&&o!=="!=";return class PO{constructor(g,v,E){this.type=In,this.lhs=g,this.rhs=v,this.collator=E,this.hasUntypedArgument=g.type.kind==="value"||v.type.kind==="value"}static parse(g,v){if(g.length!==3&&g.length!==4)return v.error("Expected two or three arguments.");let E=g[0],I=v.parse(g[1],1,wn);if(!I)return null;if(!ml(E,I.type))return v.concat(1).error(`"${E}" comparisons are not supported for type '${Ti(I.type)}'.`);let A=v.parse(g[2],2,wn);if(!A)return null;if(!ml(E,A.type))return v.concat(2).error(`"${E}" comparisons are not supported for type '${Ti(A.type)}'.`);if(I.type.kind!==A.type.kind&&I.type.kind!=="value"&&A.type.kind!=="value")return v.error(`Cannot compare types '${Ti(I.type)}' and '${Ti(A.type)}'.`);c&&(I.type.kind==="value"&&A.type.kind!=="value"?I=new Ys(A.type,[I]):I.type.kind!=="value"&&A.type.kind==="value"&&(A=new Ys(I.type,[A])));let L=null;if(g.length===4){if(I.type.kind!=="string"&&A.type.kind!=="string"&&I.type.kind!=="value"&&A.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(L=v.parse(g[3],3,Ur),!L)return null}return new PO(I,A,L)}evaluate(g){let v=this.lhs.evaluate(g),E=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){let I=ji(v),A=ji(E);if(I.kind!==A.kind||I.kind!=="string"&&I.kind!=="number")throw new Mi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${I.kind}, ${A.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let I=ji(v),A=ji(E);if(I.kind!=="string"||A.kind!=="string")return e(g,v,E)}return this.collator?s(g,v,E,this.collator.evaluate(g)):e(g,v,E)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){let g=[o];return this.eachChild(v=>{g.push(v.serialize())}),g}}}let Rd=dc("==",function(o,e,s){return e===s},kd),$h=dc("!=",function(o,e,s){return e!==s},function(o,e,s,c){return!kd(0,e,s,c)}),qg=dc("<",function(o,e,s){return e<s},function(o,e,s,c){return c.compare(e,s)<0}),Ep=dc(">",function(o,e,s){return e>s},function(o,e,s,c){return c.compare(e,s)>0}),_u=dc("<=",function(o,e,s){return e<=s},function(o,e,s,c){return c.compare(e,s)<=0}),Cp=dc(">=",function(o,e,s){return e>=s},function(o,e,s,c){return c.compare(e,s)>=0});class gl{constructor(e,s,c,f,g,v){this.type=xn,this.number=e,this.locale=s,this.currency=c,this.unit=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");let c=s.parse(e[1],1,Dt);if(!c)return null;let f=e[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=s.parse(f.locale,1,xn),!g))return null;let v=null;if(f.currency&&(v=s.parse(f.currency,1,xn),!v))return null;let E=null;if(f.unit&&(E=s.parse(f.unit,1,xn),!E))return null;let I=null;if(f["min-fraction-digits"]&&(I=s.parse(f["min-fraction-digits"],1,Dt),!I))return null;let A=null;return f["max-fraction-digits"]&&(A=s.parse(f["max-fraction-digits"],1,Dt),!A)?null:new gl(c,g,v,E,I,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hc{constructor(e){this.type=Dt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);let c=s.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ti(c.type)} instead.`):new hc(c):null}evaluate(e){let s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Mi(`Expected value to be of type string or array, but found ${Ti(ji(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}let Dp={"==":Rd,"!=":$h,">":Ep,"<":qg,">=":Cp,"<=":_u,array:Ys,at:Gg,boolean:Ys,case:xp,coalesce:Sd,collator:Ca,format:Ea,image:lu,in:mu,"index-of":uc,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:hc,let:bp,literal:Ao,match:Wg,number:Ys,"number-format":gl,object:Ys,slice:wp,step:Nh,string:Ys,"to-boolean":sl,"to-color":sl,"to-number":sl,"to-string":sl,var:Fh,within:vd};function Ro(o,[e,s,c,f]){e=e.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);let g=f?f.evaluate(o):1,v=Rh(e,s,c,g);if(v)throw new Mi(v);return new Qi(e/255*g,s/255*g,c/255*g,g)}function ao(o,e){return o in e}function Pd(o,e){let s=e[o];return s===void 0?null:s}function Eo(o){return{type:o}}Ks.register(Dp,{error:[{kind:"error"},[xn],(o,[e])=>{throw new Mi(e.evaluate(o))}],typeof:[xn,[wn],(o,[e])=>Ti(ji(e.evaluate(o)))],"to-rgba":[xo(Dt,4),[bo],(o,[e])=>e.evaluate(o).toArray()],rgb:[bo,[Dt,Dt,Dt],Ro],rgba:[bo,[Dt,Dt,Dt,Dt],Ro],has:{type:In,overloads:[[[xn],(o,[e])=>ao(e.evaluate(o),o.properties())],[[xn,Xo],(o,[e,s])=>ao(e.evaluate(o),s.evaluate(o))]]},get:{type:wn,overloads:[[[xn],(o,[e])=>Pd(e.evaluate(o),o.properties())],[[xn,Xo],(o,[e,s])=>Pd(e.evaluate(o),s.evaluate(o))]]},"feature-state":[wn,[xn],(o,[e])=>Pd(e.evaluate(o),o.featureState||{})],properties:[Xo,[],o=>o.properties()],"geometry-type":[xn,[],o=>o.geometryType()],id:[wn,[],o=>o.id()],zoom:[Dt,[],o=>o.globals.zoom],pitch:[Dt,[],o=>o.globals.pitch||0],"distance-from-center":[Dt,[],o=>o.distanceFromCenter()],"heatmap-density":[Dt,[],o=>o.globals.heatmapDensity||0],"line-progress":[Dt,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Dt,[],o=>o.globals.skyRadialProgress||0],accumulated:[wn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Dt,Eo(Dt),(o,e)=>{let s=0;for(let c of e)s+=c.evaluate(o);return s}],"*":[Dt,Eo(Dt),(o,e)=>{let s=1;for(let c of e)s*=c.evaluate(o);return s}],"-":{type:Dt,overloads:[[[Dt,Dt],(o,[e,s])=>e.evaluate(o)-s.evaluate(o)],[[Dt],(o,[e])=>-e.evaluate(o)]]},"/":[Dt,[Dt,Dt],(o,[e,s])=>e.evaluate(o)/s.evaluate(o)],"%":[Dt,[Dt,Dt],(o,[e,s])=>e.evaluate(o)%s.evaluate(o)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(o,[e,s])=>Math.pow(e.evaluate(o),s.evaluate(o))],sqrt:[Dt,[Dt],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Dt,[Dt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Dt,[Dt],(o,[e])=>Math.log(e.evaluate(o))],log2:[Dt,[Dt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[Dt,[Dt],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Dt,[Dt],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Dt,[Dt],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Dt,[Dt],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Dt,[Dt],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Dt,[Dt],(o,[e])=>Math.atan(e.evaluate(o))],min:[Dt,Eo(Dt),(o,e)=>Math.min(...e.map(s=>s.evaluate(o)))],max:[Dt,Eo(Dt),(o,e)=>Math.max(...e.map(s=>s.evaluate(o)))],abs:[Dt,[Dt],(o,[e])=>Math.abs(e.evaluate(o))],round:[Dt,[Dt],(o,[e])=>{let s=e.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[Dt,[Dt],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Dt,[Dt],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[In,[xn,wn],(o,[e,s])=>o.properties()[e.value]===s.value],"filter-id-==":[In,[wn],(o,[e])=>o.id()===e.value],"filter-type-==":[In,[xn],(o,[e])=>o.geometryType()===e.value],"filter-<":[In,[xn,wn],(o,[e,s])=>{let c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[In,[wn],(o,[e])=>{let s=o.id(),c=e.value;return typeof s==typeof c&&s<c}],"filter->":[In,[xn,wn],(o,[e,s])=>{let c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[In,[wn],(o,[e])=>{let s=o.id(),c=e.value;return typeof s==typeof c&&s>c}],"filter-<=":[In,[xn,wn],(o,[e,s])=>{let c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[In,[wn],(o,[e])=>{let s=o.id(),c=e.value;return typeof s==typeof c&&s<=c}],"filter->=":[In,[xn,wn],(o,[e,s])=>{let c=o.properties()[e.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[In,[wn],(o,[e])=>{let s=o.id(),c=e.value;return typeof s==typeof c&&s>=c}],"filter-has":[In,[wn],(o,[e])=>e.value in o.properties()],"filter-has-id":[In,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[In,[xo(xn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[In,[xo(wn)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[In,[xn,xo(wn)],(o,[e,s])=>s.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[In,[xn,xo(wn)],(o,[e,s])=>function(c,f,g,v){for(;g<=v;){let E=g+v>>1;if(f[E]===c)return!0;f[E]>c?v=E-1:g=E+1}return!1}(o.properties()[e.value],s.value,0,s.value.length-1)],all:{type:In,overloads:[[[In,In],(o,[e,s])=>e.evaluate(o)&&s.evaluate(o)],[Eo(In),(o,e)=>{for(let s of e)if(!s.evaluate(o))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(o,[e,s])=>e.evaluate(o)||s.evaluate(o)],[Eo(In),(o,e)=>{for(let s of e)if(s.evaluate(o))return!0;return!1}]]},"!":[In,[In],(o,[e])=>!e.evaluate(o)],"is-supported-script":[In,[xn],(o,[e])=>{let s=o.globals&&o.globals.isSupportedScript;return!s||s(e.evaluate(o))}],upcase:[xn,[xn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[xn,[xn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[xn,Eo(wn),(o,e)=>e.map(s=>nc(s.evaluate(o))).join("")],"resolved-locale":[xn,[Ur],(o,[e])=>e.evaluate(o).resolvedLocale()]});var vu=Dp;function Od(o){return{result:"success",value:o}}function yl(o){return{result:"error",value:o}}function fc(o){return o["property-type"]==="data-driven"}function bu(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Ld(o){return!!o.expression&&o.expression.interpolated}function $n(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Or(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function mi(o){return o}function Fd(o,e){let s=e.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",f=c||!(c||o.property!==void 0),g=o.type||(Ld(e)?"exponential":"interval");if(s&&((o=Zs({},o)).stops&&(o.stops=o.stops.map(A=>[A[0],Qi.parse(A[1])])),o.default=Qi.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!cc[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let v,E,I;if(g==="exponential")v=si;else if(g==="interval")v=vl;else if(g==="categorical"){v=Nd,E=Object.create(null);for(let A of o.stops)E[A[0]]=A[1];I=typeof o.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=Hh}if(c){let A={},L=[];for(let W=0;W<o.stops.length;W++){let q=o.stops[W],ee=q[0].zoom;A[ee]===void 0&&(A[ee]={zoom:ee,type:o.type,property:o.property,default:o.default,stops:[]},L.push(ee)),A[ee].stops.push([q[0].value,q[1]])}let j=[];for(let W of L)j.push([A[W].zoom,Fd(A[W],e)]);let $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Jr.interpolationFactor.bind(void 0,$),zoomStops:j.map(W=>W[0]),evaluate:({zoom:W},q)=>si({stops:j,base:o.base},e,W).evaluate(W,q)}}if(f){let A=g==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Jr.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map(L=>L[0]),evaluate:({zoom:L})=>v(o,e,L,E,I)}}return{kind:"source",evaluate(A,L){let j=L&&L.properties?L.properties[o.property]:void 0;return j===void 0?_l(o.default,e.default):v(o,e,j,E,I)}}}function _l(o,e,s){return o!==void 0?o:e!==void 0?e:s!==void 0?s:void 0}function Nd(o,e,s,c,f){return _l(typeof s===f?c[s]:void 0,o.default,e.default)}function vl(o,e,s){if($n(s)!=="number")return _l(o.default,e.default);let c=o.stops.length;if(c===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];let f=Ed(o.stops.map(g=>g[0]),s);return o.stops[f][1]}function si(o,e,s){let c=o.base!==void 0?o.base:1;if($n(s)!=="number")return _l(o.default,e.default);let f=o.stops.length;if(f===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[f-1][0])return o.stops[f-1][1];let g=Ed(o.stops.map(L=>L[0]),s),v=function(L,j,$,W){let q=W-$,ee=L-$;return q===0?0:j===1?ee/q:(Math.pow(j,ee)-1)/(Math.pow(j,q)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),E=o.stops[g][1],I=o.stops[g+1][1],A=ul[e.type]||mi;if(o.colorSpace&&o.colorSpace!=="rgb"){let L=cc[o.colorSpace];A=(j,$)=>L.reverse(L.interpolate(L.forward(j),L.forward($),v))}return typeof E.evaluate=="function"?{evaluate(...L){let j=E.evaluate.apply(void 0,L),$=I.evaluate.apply(void 0,L);if(j!==void 0&&$!==void 0)return A(j,$,v)}}:A(E,I,v)}function Hh(o,e,s){return e.type==="color"?s=Qi.parse(s):e.type==="formatted"?s=$r.fromString(s.toString()):e.type==="resolvedImage"?s=wo.fromString(s.toString()):$n(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),_l(s,o.default,e.default)}class zd{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new md,this._defaultValue=s?function(c){return c.type==="color"&&(Or(c.default)||Array.isArray(c.default))?new Qi(0,0,0,0):c.type==="color"?Qi.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,c,f,g,v,E,I){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,c,f,g,v,E,I){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=I||null;try{let A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Mi(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function bl(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in vu}function Kt(o,e){let s=new xd(vu,[],e?function(f){let g={color:bo,string:xn,number:Dt,enum:xn,boolean:In,formatted:nu,resolvedImage:el};return f.type==="array"?xo(g[f.value]||wn,f.length):g[f.type]}(e):void 0),c=s.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Od(new zd(c,e)):yl(s.errors)}class Bd{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!Qs(s.expression)}evaluateWithoutErrorHandling(e,s,c,f,g,v){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,f,g,v)}evaluate(e,s,c,f,g,v){return this._styleExpression.evaluate(e,s,c,f,g,v)}}class Ma{constructor(e,s,c,f){this.kind=e,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!Qs(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,s,c,f,g,v){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,f,g,v)}evaluate(e,s,c,f,g,v){return this._styleExpression.evaluate(e,s,c,f,g,v)}interpolationFactor(e,s,c){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,e,s,c):0}}function xu(o,e){if((o=Kt(o,e)).result==="error")return o;let s=o.value.expression,c=Da(s);if(!c&&!fc(e))return yl([new Zo("","data expressions not supported")]);let f=cl(s,["zoom","pitch","distance-from-center"]);if(!f&&!bu(e))return yl([new Zo("","zoom expressions not supported")]);let g=gn(s);return g||f?g instanceof Zo?yl([g]):g instanceof Jr&&!Ld(e)?yl([new Zo("",'"interpolate" expressions cannot be used with this property')]):Od(g?new Ma(c?"camera":"composite",o.value,g.labels,g instanceof Jr?g.interpolation:void 0):new Bd(c?"constant":"source",o.value)):yl([new Zo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xl{constructor(e,s){this._parameters=e,this._specification=s,Zs(this,Fd(this._parameters,this._specification))}static deserialize(e){return new xl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function gn(o){let e=null;if(o instanceof bp)e=gn(o.result);else if(o instanceof Sd){for(let s of o.args)if(e=gn(s),e)break}else(o instanceof Nh||o instanceof Jr)&&o.input instanceof Ks&&o.input.name==="zoom"&&(e=o);return e instanceof Zo||o.eachChild(s=>{let c=gn(s);c instanceof Zo?e=c:!e&&c?e=new Zo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new Zo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Rt{constructor(e,s,c,f){this.message=(e?`${e}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function Ko(o){let e=o.key,s=o.value,c=o.valueSpec||{},f=o.objectElementValidators||{},g=o.style,v=o.styleSpec,E=[],I=$n(s);if(I!=="object")return[new Rt(e,s,`object expected, ${I} found`)];for(let A in s){let L=A.split(".")[0],j;f[L]?j=f[L]:c[L]?j=Hr:f["*"]?j=f["*"]:c["*"]&&(j=Hr),j?E=E.concat(j({key:(e&&`${e}.`)+A,value:s[A],valueSpec:c[L]||c["*"],style:g,styleSpec:v,object:s,objectKey:A},s)):E.push(new Rt(e,s[A],`unknown property "${A}"`))}for(let A in c)f[A]||c[A].required&&c[A].default===void 0&&s[A]===void 0&&E.push(new Rt(e,s,`missing required property "${A}"`));return E}function Tp(o){let e=o.value,s=o.valueSpec,c=o.style,f=o.styleSpec,g=o.key,v=o.arrayElementValidator||Hr;if($n(e)!=="array")return[new Rt(g,e,`array expected, ${$n(e)} found`)];if(s.length&&e.length!==s.length)return[new Rt(g,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Rt(g,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let E={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};f.$version<7&&(E.function=s.function),$n(s.value)==="object"&&(E=s.value);let I=[];for(let A=0;A<e.length;A++)I=I.concat(v({array:e,arrayIndex:A,value:e[A],valueSpec:E,style:c,styleSpec:f,key:`${g}[${A}]`}));return I}function wu(o){let e=o.key,s=o.value,c=o.valueSpec,f=$n(s);if(f==="number"&&s!=s&&(f="NaN"),f!=="number")return[new Rt(e,s,`number expected, ${f} found`)];if("minimum"in c){let g=c.minimum;if($n(c.minimum)==="array"&&(g=c.minimum[o.arrayIndex]),s<g)return[new Rt(e,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if($n(c.maximum)==="array"&&(g=c.maximum[o.arrayIndex]),s>g)return[new Rt(e,s,`${s} is greater than the maximum value ${g}`)]}return[]}function pc(o){let e=o.valueSpec,s=sr(o.value.type),c,f,g,v={},E=s!=="categorical"&&o.value.property===void 0,I=!E,A=$n(o.value.stops)==="array"&&$n(o.value.stops[0])==="array"&&$n(o.value.stops[0][0])==="object",L=Ko({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(W){if(s==="identity")return[new Rt(W.key,W.value,'identity function may not have a "stops" property')];let q=[],ee=W.value;return q=q.concat(Tp({key:W.key,value:ee,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:j})),$n(ee)==="array"&&ee.length===0&&q.push(new Rt(W.key,ee,"array must have at least one stop")),q},default:function(W){return Hr({key:W.key,value:W.value,valueSpec:e,style:W.style,styleSpec:W.styleSpec})}}});return s==="identity"&&E&&L.push(new Rt(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||L.push(new Rt(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!Ld(o.valueSpec)&&L.push(new Rt(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(I&&!fc(o.valueSpec)?L.push(new Rt(o.key,o.value,"property functions not supported")):E&&!bu(o.valueSpec)&&L.push(new Rt(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!A||o.value.property!==void 0||L.push(new Rt(o.key,o.value,'"property" property is required')),L;function j(W){let q=[],ee=W.value,ae=W.key;if($n(ee)!=="array")return[new Rt(ae,ee,`array expected, ${$n(ee)} found`)];if(ee.length!==2)return[new Rt(ae,ee,`array length 2 expected, length ${ee.length} found`)];if(A){if($n(ee[0])!=="object")return[new Rt(ae,ee,`object expected, ${$n(ee[0])} found`)];if(ee[0].zoom===void 0)return[new Rt(ae,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new Rt(ae,ee,"object stop key must have value")];let me=sr(ee[0].zoom);if(typeof me!="number")return[new Rt(ae,ee[0].zoom,"stop zoom values must be numbers")];if(g&&g>me)return[new Rt(ae,ee[0].zoom,"stop zoom values must appear in ascending order")];me!==g&&(g=me,f=void 0,v={}),q=q.concat(Ko({key:`${ae}[0]`,value:ee[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:wu,value:$}}))}else q=q.concat($({key:`${ae}[0]`,value:ee[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},ee));return bl(Sr(ee[1]))?q.concat([new Rt(`${ae}[1]`,ee[1],"expressions are not allowed in function stops.")]):q.concat(Hr({key:`${ae}[1]`,value:ee[1],valueSpec:e,style:W.style,styleSpec:W.styleSpec}))}function $(W,q){let ee=$n(W.value),ae=sr(W.value),me=W.value!==null?W.value:q;if(c){if(ee!==c)return[new Rt(W.key,me,`${ee} stop domain type must match previous stop domain type ${c}`)]}else c=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new Rt(W.key,me,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&s!=="categorical"){let we=`number expected, ${ee} found`;return fc(e)&&s===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Rt(W.key,me,we)]}return s!=="categorical"||ee!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?s!=="categorical"&&ee==="number"&&typeof ae=="number"&&typeof f=="number"&&f!==void 0&&ae<f?[new Rt(W.key,me,"stop domain values must appear in ascending order")]:(f=ae,s==="categorical"&&ae in v?[new Rt(W.key,me,"stop domain values must be unique")]:(v[ae]=!0,[])):[new Rt(W.key,me,`integer expected, found ${String(ae)}`)]}}function fr(o){let e=(o.expressionContext==="property"?xu:Kt)(Sr(o.value),o.valueSpec);if(e.result==="error")return e.value.map(c=>new Rt(`${o.key}${c.key}`,o.value,c.message));let s=e.value.expression||e.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new Rt(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Qs(s))return[new Rt(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return Eu(s,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!cl(s,["zoom","feature-state"]))return[new Rt(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Da(s))return[new Rt(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Eu(o,e){let s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let f of e.valueSpec.expression.parameters)s.delete(f);if(s.size===0)return[];let c=[];return o instanceof Ks&&s.has(o.name)?[new Rt(e.key,e.value,`["${o.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(o.eachChild(f=>{c.push(...Eu(f,e))}),c)}function Vd(o){let e=o.key,s=o.value,c=o.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(sr(s))===-1&&f.push(new Rt(e,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(sr(s))===-1&&f.push(new Rt(e,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Gh(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(let e of o.slice(1))if(!Gh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wl(o,e="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gh(o)||(o=gc(o));let s=o,c=!0;try{c=function(A){if(!mc(A))return A;let L=Sr(A);return Cu(L),L=Mp(L),L}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}let f=Je[`filter_${e}`],g=Kt(c,f),v=null;if(g.result==="error")throw new Error(g.value.map(A=>`${A.key}: ${A.message}`).join(", "));v=(A,L,j)=>g.value.evaluate(A,L,{},j);let E=null,I=null;if(c!==s){let A=Kt(s,f);if(A.result==="error")throw new Error(A.value.map(L=>`${L.key}: ${L.message}`).join(", "));E=(L,j,$,W,q)=>A.value.evaluate(L,j,{},$,void 0,void 0,W,q),I=!Da(A.value.expression)}return{filter:v,dynamicFilter:E||void 0,needGeometry:Ip(c),needFeature:!!I}}function Mp(o){if(!Array.isArray(o))return o;let e=function(s){if(Wh.has(s[0])){for(let c=1;c<s.length;c++)if(mc(s[c]))return!0}return s}(o);return e===!0?e:e.map(s=>Mp(s))}function Cu(o){let e=!1,s=[];if(o[0]==="case"){for(let c=1;c<o.length-1;c+=2)e=e||mc(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if(o[0]==="match"){e=e||mc(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if(o[0]==="step"){e=e||mc(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}e&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)Cu(o[c])}function mc(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<o.length;s++)if(mc(o[s]))return!0;return!1}let Wh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Zg(o,e){return o<e?-1:o>e?1:0}function Ip(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let e=1;e<o.length;e++)if(Ip(o[e]))return!0;return!1}function gc(o){if(!o)return!0;let e=o[0];return o.length<=1?e!=="any":e==="=="?jd(o[1],o[2],"=="):e==="!="?Du(jd(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?jd(o[1],o[2],e):e==="any"?(s=o.slice(1),["any"].concat(s.map(gc))):e==="all"?["all"].concat(o.slice(1).map(gc)):e==="none"?["all"].concat(o.slice(1).map(gc).map(Du)):e==="in"?qh(o[1],o.slice(2)):e==="!in"?Du(qh(o[1],o.slice(2))):e==="has"?Zh(o[1]):e==="!has"?Du(Zh(o[1])):e!=="within"||o;var s}function jd(o,e,s){switch(o){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,o,e]}}function qh(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",o,["literal",e.sort(Zg)]]:["filter-in-small",o,["literal",e]]}}function Zh(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Du(o){return["!",o]}function yc(o){return Gh(Sr(o.value))?fr(Zs({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):lo(o)}function lo(o){let e=o.value,s=o.key;if($n(e)!=="array")return[new Rt(s,e,`array expected, ${$n(e)} found`)];let c=o.styleSpec,f,g=[];if(e.length<1)return[new Rt(s,e,"filter array must have at least 1 element")];switch(g=g.concat(Vd({key:`${s}[0]`,value:e[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),sr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&sr(e[1])==="$type"&&g.push(new Rt(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Rt(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=$n(e[1]),f!=="string"&&g.push(new Rt(`${s}[1]`,e[1],`string expected, ${f} found`)));for(let v=2;v<e.length;v++)f=$n(e[v]),sr(e[1])==="$type"?g=g.concat(Vd({key:`${s}[${v}]`,value:e[v],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new Rt(`${s}[${v}]`,e[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<e.length;v++)g=g.concat(lo({key:`${s}[${v}]`,value:e[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":f=$n(e[1]),e.length!==2?g.push(new Rt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new Rt(`${s}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=$n(e[1]),e.length!==2?g.push(new Rt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="object"&&g.push(new Rt(`${s}[1]`,e[1],`object expected, ${f} found`))}return g}function Xh(o,e){let s=o.key,c=o.style,f=o.styleSpec,g=o.value,v=o.objectKey,E=f[`${e}_${o.layerType}`];if(!E)return[];let I=v.match(/^(.*)-transition$/);if(e==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return Hr({key:s,value:g,valueSpec:f.transition,style:c,styleSpec:f});let A=o.valueSpec||E[v];if(!A)return[new Rt(s,g,`unknown property "${v}"`)];let L;if($n(g)==="string"&&fc(A)&&!A.tokens&&(L=/^{([^}]+)}$/.exec(g))){let $=`\`{ "type": "identity", "property": ${L?JSON.stringify(L[1]):'"_"'} }\``;return[new Rt(s,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}let j=[];return o.layerType==="symbol"&&(v==="text-field"&&c&&!c.glyphs&&j.push(new Rt(s,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Or(Sr(g))&&sr(g.type)==="identity"&&j.push(new Rt(s,g,'"text-font" does not support identity functions'))),j.concat(Hr({key:o.key,value:g,valueSpec:A,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:v}))}function Sp(o){return Xh(o,"paint")}function Yh(o){return Xh(o,"layout")}function Kh(o){let e=[],s=o.value,c=o.key,f=o.style,g=o.styleSpec;s.type||s.ref||e.push(new Rt(c,s,'either "type" or "ref" is required'));let v=sr(s.type),E=sr(s.ref);if(s.id){let I=sr(s.id);for(let A=0;A<o.arrayIndex;A++){let L=f.layers[A];sr(L.id)===I&&e.push(new Rt(c,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let I;["type","source","source-layer","filter","layout"].forEach(A=>{A in s&&e.push(new Rt(c,s[A],`"${A}" is prohibited for ref layers`))}),f.layers.forEach(A=>{sr(A.id)===E&&(I=A)}),I?I.ref?e.push(new Rt(c,s.ref,"ref cannot reference another ref layer")):v=sr(I.type):typeof E=="string"&&e.push(new Rt(c,s.ref,`ref layer "${E}" not found`))}else if(v!=="background"&&v!=="sky")if(s.source){let I=f.sources&&f.sources[s.source],A=I&&sr(I.type);I?A==="vector"&&v==="raster"?e.push(new Rt(c,s.source,`layer "${s.id}" requires a raster source`)):A==="raster"&&v!=="raster"?e.push(new Rt(c,s.source,`layer "${s.id}" requires a vector source`)):A!=="vector"||s["source-layer"]?A==="raster-dem"&&v!=="hillshade"?e.push(new Rt(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||A==="geojson"&&I.lineMetrics||e.push(new Rt(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Rt(c,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Rt(c,s.source,`source "${s.source}" not found`))}else e.push(new Rt(c,s,'missing required property "source"'));return e=e.concat(Ko({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hr({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:I=>yc(Zs({layerType:v},I)),layout:I=>Ko({layer:s,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":A=>Yh(Zs({layerType:v},A))}}),paint:I=>Ko({layer:s,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":A=>Sp(Zs({layerType:v},A))}})}})),e}function Ia(o){let e=o.value,s=o.key,c=$n(e);return c!=="string"?[new Rt(s,e,`string expected, ${c} found`)]:[]}let Ap={promoteId:function({key:o,value:e}){if($n(e)==="string")return Ia({key:o,value:e});{let s=[];for(let c in e)s.push(...Ia({key:`${o}.${c}`,value:e[c]}));return s}}};function Tu(o){let e=o.value,s=o.key,c=o.styleSpec,f=o.style;if(!e.type)return[new Rt(s,e,'"type" is required')];let g=sr(e.type),v;switch(g){case"vector":case"raster":case"raster-dem":return v=Ko({key:s,value:e,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:Ap}),v;case"geojson":if(v=Ko({key:s,value:e,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Ap}),e.cluster)for(let E in e.clusterProperties){let[I,A]=e.clusterProperties[E],L=typeof I=="string"?[I,["accumulated"],["get",E]]:I;v.push(...fr({key:`${s}.${E}.map`,value:A,expressionContext:"cluster-map"})),v.push(...fr({key:`${s}.${E}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return Ko({key:s,value:e,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Ko({key:s,value:e,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new Rt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vd({key:`${s}.type`,value:e.type,valueSpec:{values:Xg(c)},style:f,styleSpec:c})}}function Xg(o){return o.source.reduce((e,s)=>{let c=o[s];return c.type.type==="enum"&&(e=e.concat(Object.keys(c.type.values))),e},[])}function Qh(o){let e=o.value,s=o.styleSpec,c=s.light,f=o.style,g=[],v=$n(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Rt("light",e,`object expected, ${v} found`)]),g;for(let E in e){let I=E.match(/^(.*)-transition$/);g=g.concat(I&&c[I[1]]&&c[I[1]].transition?Hr({key:E,value:e[E],valueSpec:s.transition,style:f,styleSpec:s}):c[E]?Hr({key:E,value:e[E],valueSpec:c[E],style:f,styleSpec:s}):[new Rt(E,e[E],`unknown property "${E}"`)])}return g}function Jh(o){let e=o.value,s=o.key,c=o.style,f=o.styleSpec,g=f.terrain,v=[],E=$n(e);if(e===void 0)return v;if(E!=="object")return v=v.concat([new Rt("terrain",e,`object expected, ${E} found`)]),v;for(let I in e){let A=I.match(/^(.*)-transition$/);v=v.concat(A&&g[A[1]]&&g[A[1]].transition?Hr({key:I,value:e[I],valueSpec:f.transition,style:c,styleSpec:f}):g[I]?Hr({key:I,value:e[I],valueSpec:g[I],style:c,styleSpec:f}):[new Rt(I,e[I],`unknown property "${I}"`)])}if(e.source){let I=c.sources&&c.sources[e.source],A=I&&sr(I.type);I?A!=="raster-dem"&&v.push(new Rt(s,e.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):v.push(new Rt(s,e.source,`source "${e.source}" not found`))}else v.push(new Rt(s,e,'terrain is missing required property "source"'));return v}function kp(o){let e=o.value,s=o.style,c=o.styleSpec,f=c.fog,g=[],v=$n(e);if(e===void 0)return g;if(v!=="object")return g=g.concat([new Rt("fog",e,`object expected, ${v} found`)]),g;for(let E in e){let I=E.match(/^(.*)-transition$/);g=g.concat(I&&f[I[1]]&&f[I[1]].transition?Hr({key:E,value:e[E],valueSpec:c.transition,style:s,styleSpec:c}):f[E]?Hr({key:E,value:e[E],valueSpec:f[E],style:s,styleSpec:c}):[new Rt(E,e[E],`unknown property "${E}"`)])}return g}let ef={"*":()=>[],array:Tp,boolean:function(o){let e=o.value,s=o.key,c=$n(e);return c!=="boolean"?[new Rt(s,e,`boolean expected, ${c} found`)]:[]},number:wu,color:function(o){let e=o.key,s=o.value,c=$n(s);return c!=="string"?[new Rt(e,s,`color expected, ${c} found`)]:kh(s)===null?[new Rt(e,s,`color expected, "${s}" found`)]:[]},enum:Vd,filter:yc,function:pc,layer:Kh,object:Ko,source:Tu,light:Qh,terrain:Jh,fog:kp,string:Ia,formatted:function(o){return Ia(o).length===0?[]:fr(o)},resolvedImage:function(o){return Ia(o).length===0?[]:fr(o)},projection:function(o){let e=o.value,s=o.styleSpec,c=s.projection,f=o.style,g=[],v=$n(e);if(v==="object")for(let E in e)g=g.concat(Hr({key:E,value:e[E],valueSpec:c[E],style:f,styleSpec:s}));else v!=="string"&&(g=g.concat([new Rt("projection",e,`object or string expected, ${v} found`)]));return g}};function Hr(o){let e=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Or(sr(e))?pc(o):s.expression&&bl(Sr(e))?fr(o):s.type&&ef[s.type]?ef[s.type](o):Ko(Zs({},o,{valueSpec:s.type?c[s.type]:s}))}function Yg(o){let e=o.value,s=o.key,c=Ia(o);return c.length||(e.indexOf("{fontstack}")===-1&&c.push(new Rt(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&c.push(new Rt(s,e,'"glyphs" url must include a "{range}" token'))),c}function Rp(o,e=Je){return Po(Hr({key:"",value:o,valueSpec:e.$root,styleSpec:e,style:o,objectElementValidators:{glyphs:Yg,"*":()=>[]}}))}let _c=o=>Po(Sp(o)),Pp=o=>Po(Yh(o));function Po(o){return o.slice().sort((e,s)=>e.line&&s.line?e.line-s.line:0)}function Op(o,e){let s=!1;if(e&&e.length)for(let c of e)o.fire(new qs(new Error(c.message))),s=!0;return s}var Lp=xs,Qo=3;function xs(o,e,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var f=new Int32Array(this.arrayBuffer);o=f[0],this.d=(e=f[1])+2*(s=f[2]);for(var g=0;g<this.d*this.d;g++){var v=f[Qo+g],E=f[Qo+g+1];c.push(v===E?null:f.subarray(v,E))}var I=f[Qo+c.length+1];this.keys=f.subarray(f[Qo+c.length],I),this.bboxes=f.subarray(I),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var A=0;A<this.d*this.d;A++)c.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=o,this.padding=s,this.scale=e/o,this.uid=0;var L=s/e*o;this.min=-L,this.max=o+L}xs.prototype.insert=function(o,e,s,c,f){this._forEachCell(e,s,c,f,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f)},xs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xs.prototype._insertCell=function(o,e,s,c,f,g){this.cells[f].push(g)},xs.prototype.query=function(o,e,s,c,f){var g=this.min,v=this.max;if(o<=g&&e<=g&&v<=s&&v<=c&&!f)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(o,e,s,c,this._queryCell,E,{},f),E},xs.prototype._queryCell=function(o,e,s,c,f,g,v,E){var I=this.cells[f];if(I!==null)for(var A=this.keys,L=this.bboxes,j=0;j<I.length;j++){var $=I[j];if(v[$]===void 0){var W=4*$;(E?E(L[W+0],L[W+1],L[W+2],L[W+3]):o<=L[W+2]&&e<=L[W+3]&&s>=L[W+0]&&c>=L[W+1])?(v[$]=!0,g.push(A[$])):v[$]=!1}}},xs.prototype._forEachCell=function(o,e,s,c,f,g,v,E){for(var I=this._convertToCellCoord(o),A=this._convertToCellCoord(e),L=this._convertToCellCoord(s),j=this._convertToCellCoord(c),$=I;$<=L;$++)for(var W=A;W<=j;W++){var q=this.d*W+$;if((!E||E(this._convertFromCellCoord($),this._convertFromCellCoord(W),this._convertFromCellCoord($+1),this._convertFromCellCoord(W+1)))&&f.call(this,o,e,s,c,q,g,v,E))return}},xs.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},xs.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},xs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,e=Qo+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var f=new Int32Array(e+s+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=e,v=0;v<o.length;v++){var E=o[v];f[Qo+v]=g,f.set(E,g),g+=E.length}return f[Qo+o.length]=g,f.set(this.keys,g),f[Qo+o.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};var El=Qt(Lp);let vc={};function Ot(o,e,s={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writeable:!1}),vc[e]={klass:o,omit:s.omit||[]}}Ot(Object,"Object"),El.serialize=function(o,e){let s=o.toArrayBuffer();return e&&e.push(s),{buffer:s}},El.deserialize=function(o){return new El(o.buffer)},Object.defineProperty(El,"name",{value:"Grid"}),Ot(El,"Grid"),Ot(Qi,"Color"),Ot(Error,"Error"),Ot(vo,"AJAXError"),Ot(wo,"ResolvedImage"),Ot(xl,"StylePropertyFunction"),Ot(zd,"StyleExpression",{omit:["_evaluator"]}),Ot(Ma,"ZoomDependentExpression"),Ot(Bd,"ZoomConstantExpression"),Ot(Ks,"CompoundExpression",{omit:["_evaluate"]});for(let o in vu)vc[vu[o]._classRegistryKey]||Ot(vu[o],`Expression${o}`);function Sa(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function tf(o){return C.ImageBitmap&&o instanceof C.ImageBitmap}function Aa(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Sa(o)||tf(o))return e&&e.push(o),o;if(ArrayBuffer.isView(o)){let s=o;return e&&e.push(s.buffer),s}if(o instanceof C.ImageData)return e&&e.push(o.data.buffer),o;if(Array.isArray(o)){let s=[];for(let c of o)s.push(Aa(c,e));return s}if(typeof o=="object"){let s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);let f=s.serialize?s.serialize(o,e):{};if(!s.serialize){for(let g in o)o.hasOwnProperty(g)&&(vc[c].omit.indexOf(g)>=0||(f[g]=Aa(o[g],e)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof o)}function Cl(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Sa(o)||tf(o)||ArrayBuffer.isView(o)||o instanceof C.ImageData)return o;if(Array.isArray(o))return o.map(Cl);if(typeof o=="object"){let e=o.$name||"Object",{klass:s}=vc[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(o);let c=Object.create(s.prototype);for(let f of Object.keys(o))f!=="$name"&&(c[f]=Cl(o[f]));return c}throw new Error("can't deserialize object of type "+typeof o)}let St={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Ud(o){for(let e of o)if(nf(e.charCodeAt(0)))return!0;return!1}function Kg(o){for(let e of o)if(!Fp(e.charCodeAt(0)))return!1;return!0}function Fp(o){return!(St.Arabic(o)||St["Arabic Supplement"](o)||St["Arabic Extended-A"](o)||St["Arabic Presentation Forms-A"](o)||St["Arabic Presentation Forms-B"](o))}function nf(o){return!(o!==746&&o!==747&&(o<4352||!(St["Bopomofo Extended"](o)||St.Bopomofo(o)||St["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||St["CJK Compatibility Ideographs"](o)||St["CJK Compatibility"](o)||St["CJK Radicals Supplement"](o)||St["CJK Strokes"](o)||!(!St["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||St["CJK Unified Ideographs Extension A"](o)||St["CJK Unified Ideographs"](o)||St["Enclosed CJK Letters and Months"](o)||St["Hangul Compatibility Jamo"](o)||St["Hangul Jamo Extended-A"](o)||St["Hangul Jamo Extended-B"](o)||St["Hangul Jamo"](o)||St["Hangul Syllables"](o)||St.Hiragana(o)||St["Ideographic Description Characters"](o)||St.Kanbun(o)||St["Kangxi Radicals"](o)||St["Katakana Phonetic Extensions"](o)||St.Katakana(o)&&o!==12540||!(!St["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!St["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||St["Unified Canadian Aboriginal Syllabics"](o)||St["Unified Canadian Aboriginal Syllabics Extended"](o)||St["Vertical Forms"](o)||St["Yijing Hexagram Symbols"](o)||St["Yi Syllables"](o)||St["Yi Radicals"](o))))}function Np(o){return!(nf(o)||function(e){return!!(St["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||St["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||St["Letterlike Symbols"](e)||St["Number Forms"](e)||St["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||St["Control Pictures"](e)&&e!==9251||St["Optical Character Recognition"](e)||St["Enclosed Alphanumerics"](e)||St["Geometric Shapes"](e)||St["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||St["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||St["CJK Symbols and Punctuation"](e)||St.Katakana(e)||St["Private Use Area"](e)||St["CJK Compatibility Forms"](e)||St["Small Form Variants"](e)||St["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function zp(o){return o>=1424&&o<=2303||St["Arabic Presentation Forms-A"](o)||St["Arabic Presentation Forms-B"](o)}function Qg(o,e){return!(!e&&zp(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||St.Khmer(o))}function $d(o){for(let e of o)if(zp(e.charCodeAt(0)))return!0;return!1}let Mu="deferred",rf="loading",of="loaded",bc=null,m="unavailable",l=null,d=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(m="error"),bc&&bc(o)};function _(){x.fire(new Qa("pluginStateChange",{pluginStatus:m,pluginURL:l}))}let x=new tc,D=function(){return m},k=function(){if(m!==Mu||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=rf,_(),l&&Ws({url:l},o=>{o?d(o):(m=of,_())})},R={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===of||R.applyArabicShaping!=null,isLoading:()=>m===rf,setState(o){m=o.pluginStatus,l=o.pluginURL},isParsed:()=>R.applyArabicShaping!=null&&R.processBidirectionalText!=null&&R.processStyledBidirectionalText!=null,getPluginURL:()=>l};class z{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,c){for(let f of s)if(!Qg(f.charCodeAt(0),c))return!1;return!0}(e,R.isLoaded())}}class G{constructor(e,s){this.property=e,this.value=s,this.expression=function(c,f){if(Or(c))return new xl(c,f);if(bl(c)){let g=xu(c,f);if(g.result==="error")throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));return g.value}{let g=c;return typeof c=="string"&&f.type==="color"&&(g=Qi.parse(c)),{kind:"constant",evaluate:()=>g}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,c){return this.property.possiblyEvaluate(this,e,s,c)}}class H{constructor(e){this.property=e,this.value=new G(e,void 0)}transitioned(e,s){return new se(this.property,this.value,s,Fi({},e.transition,this.transition),e.now)}untransitioned(){return new se(this.property,this.value,null,{},0)}}class Y{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return yo(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new H(this._values[e].property)),this._values[e].value=new G(this._values[e].property,s===null?void 0:yo(s))}getTransition(e){return yo(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new H(this._values[e].property)),this._values[e].transition=yo(s)||void 0}serialize(){let e={};for(let s of Object.keys(this._values)){let c=this.getValue(s);c!==void 0&&(e[s]=c);let f=this.getTransition(s);f!==void 0&&(e[`${s}-transition`]=f)}return e}transitioned(e,s){let c=new le(this._properties);for(let f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(e,s._values[f]);return c}untransitioned(){let e=new le(this._properties);for(let s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class se{constructor(e,s,c,f,g){let v=f.delay||0,E=f.duration||0;g=g||0,this.property=e,this.value=s,this.begin=g+v,this.end=this.begin+E,e.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(e,s,c){let f=e.now||0,g=this.value.possiblyEvaluate(e,s,c),v=this.prior;if(v){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return v.possiblyEvaluate(e,s,c);{let E=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(e,s,c),g,Vs(E))}}return g}}class le{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,c){let f=new pe(this._properties);for(let g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(e,s,c);return f}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return yo(this._values[e].value)}setValue(e,s){this._values[e]=new G(this._values[e].property,s===null?void 0:yo(s))}serialize(){let e={};for(let s of Object.keys(this._values)){let c=this.getValue(s);c!==void 0&&(e[s]=c)}return e}possiblyEvaluate(e,s,c){let f=new pe(this._properties);for(let g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(e,s,c);return f}}class he{constructor(e,s,c){this.property=e,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,c,f){return this.property.evaluate(this.value,this.parameters,e,s,c,f)}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Q{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,c){let f=ul[this.specification.type];return f?f(e,s,c):e}}class ue{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,c,f){return new he(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},c,f)}:e.expression,s)}interpolate(e,s,c){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new he(this,{kind:"constant",value:void 0},e.parameters);let f=ul[this.specification.type];return f?new he(this,{kind:"constant",value:f(e.value.value,s.value.value,c)},e.parameters):e}evaluate(e,s,c,f,g,v){return e.kind==="constant"?e.value:e.evaluate(s,c,f,g,v)}}class ye{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,f){return!!e.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class _e{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let s=new z(0,{});for(let c in e){let f=e[c];f.specification.overridable&&this.overridableProperties.push(c);let g=this.defaultPropertyValues[c]=new G(f,void 0),v=this.defaultTransitionablePropertyValues[c]=new H(f);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(s)}}}function Se(o,e){return 256*(o=Cn(Math.floor(o),0,255))+Cn(Math.floor(e),0,255)}Ot(ue,"DataDrivenProperty"),Ot(Q,"DataConstantProperty"),Ot(ye,"ColorRampProperty");let ke={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class De{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Be{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Fe(o,e=1){let s=0,c=0;return{members:o.map(f=>{let g=ke[f.type].BYTES_PER_ELEMENT,v=s=Ve(s,Math.max(e,g)),E=f.components||1;return c=Math.max(c,g),s+=g*E,{name:f.name,type:f.type,components:E,offset:v}}),size:Ve(s,Math.max(c,e)),alignment:e}}function Ve(o,e){return Math.ceil(o/e)*e}class mt extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){let c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){let f=2*e;return this.int16[f+0]=s,this.int16[f+1]=c,e}}mt.prototype.bytesPerElement=4,Ot(mt,"StructArrayLayout2i4");class He extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){let g=3*e;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=f,e}}He.prototype.bytesPerElement=6,Ot(He,"StructArrayLayout3i6");class it extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){let v=4*e;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=f,this.int16[v+3]=g,e}}it.prototype.bytesPerElement=8,Ot(it,"StructArrayLayout4i8");class Ze extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v,E){let I=this.length;return this.resize(I+1),this.emplace(I,e,s,c,f,g,v,E)}emplace(e,s,c,f,g,v,E,I){let A=6*e,L=12*e,j=3*e;return this.int16[A+0]=s,this.int16[A+1]=c,this.uint8[L+4]=f,this.uint8[L+5]=g,this.uint8[L+6]=v,this.uint8[L+7]=E,this.float32[j+2]=I,e}}Ze.prototype.bytesPerElement=12,Ot(Ze,"StructArrayLayout2i4ub1f12");class ut extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){let v=4*e;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,this.float32[v+3]=g,e}}ut.prototype.bytesPerElement=16,Ot(ut,"StructArrayLayout4f16");class Ge extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,c,f,g)}emplace(e,s,c,f,g,v){let E=6*e,I=3*e;return this.uint16[E+0]=s,this.uint16[E+1]=c,this.uint16[E+2]=f,this.uint16[E+3]=g,this.float32[I+2]=v,e}}Ge.prototype.bytesPerElement=12,Ot(Ge,"StructArrayLayout4ui1f12");class tt extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){let v=4*e;return this.uint16[v+0]=s,this.uint16[v+1]=c,this.uint16[v+2]=f,this.uint16[v+3]=g,e}}tt.prototype.bytesPerElement=8,Ot(tt,"StructArrayLayout4ui8");class gt extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v){let E=this.length;return this.resize(E+1),this.emplace(E,e,s,c,f,g,v)}emplace(e,s,c,f,g,v,E){let I=6*e;return this.int16[I+0]=s,this.int16[I+1]=c,this.int16[I+2]=f,this.int16[I+3]=g,this.int16[I+4]=v,this.int16[I+5]=E,e}}gt.prototype.bytesPerElement=12,Ot(gt,"StructArrayLayout6i12");class at extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v,E,I,A,L,j,$){let W=this.length;return this.resize(W+1),this.emplace(W,e,s,c,f,g,v,E,I,A,L,j,$)}emplace(e,s,c,f,g,v,E,I,A,L,j,$,W){let q=12*e;return this.int16[q+0]=s,this.int16[q+1]=c,this.int16[q+2]=f,this.int16[q+3]=g,this.uint16[q+4]=v,this.uint16[q+5]=E,this.uint16[q+6]=I,this.uint16[q+7]=A,this.int16[q+8]=L,this.int16[q+9]=j,this.int16[q+10]=$,this.int16[q+11]=W,e}}at.prototype.bytesPerElement=24,Ot(at,"StructArrayLayout4i4ui4i24");class _t extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v){let E=this.length;return this.resize(E+1),this.emplace(E,e,s,c,f,g,v)}emplace(e,s,c,f,g,v,E){let I=10*e,A=5*e;return this.int16[I+0]=s,this.int16[I+1]=c,this.int16[I+2]=f,this.float32[A+2]=g,this.float32[A+3]=v,this.float32[A+4]=E,e}}_t.prototype.bytesPerElement=20,Ot(_t,"StructArrayLayout3i3f20");class $t extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}$t.prototype.bytesPerElement=4,Ot($t,"StructArrayLayout1ul4");class on extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v,E,I,A,L,j,$,W){let q=this.length;return this.resize(q+1),this.emplace(q,e,s,c,f,g,v,E,I,A,L,j,$,W)}emplace(e,s,c,f,g,v,E,I,A,L,j,$,W,q){let ee=20*e,ae=10*e;return this.int16[ee+0]=s,this.int16[ee+1]=c,this.int16[ee+2]=f,this.int16[ee+3]=g,this.int16[ee+4]=v,this.float32[ae+3]=E,this.float32[ae+4]=I,this.float32[ae+5]=A,this.float32[ae+6]=L,this.int16[ee+14]=j,this.uint32[ae+8]=$,this.uint16[ee+18]=W,this.uint16[ee+19]=q,e}}on.prototype.bytesPerElement=40,Ot(on,"StructArrayLayout5i4f1i1ul2ui40");class Ft extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v,E){let I=this.length;return this.resize(I+1),this.emplace(I,e,s,c,f,g,v,E)}emplace(e,s,c,f,g,v,E,I){let A=8*e;return this.int16[A+0]=s,this.int16[A+1]=c,this.int16[A+2]=f,this.int16[A+4]=g,this.int16[A+5]=v,this.int16[A+6]=E,this.int16[A+7]=I,e}}Ft.prototype.bytesPerElement=16,Ot(Ft,"StructArrayLayout3i2i2i16");class Xt extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,c,f,g)}emplace(e,s,c,f,g,v){let E=4*e,I=8*e;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=f,this.int16[I+6]=g,this.int16[I+7]=v,e}}Xt.prototype.bytesPerElement=16,Ot(Xt,"StructArrayLayout2f1f2i16");class Ht extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){let v=12*e,E=3*e;return this.uint8[v+0]=s,this.uint8[v+1]=c,this.float32[E+1]=f,this.float32[E+2]=g,e}}Ht.prototype.bytesPerElement=12,Ot(Ht,"StructArrayLayout2ub2f12");class En extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){let g=3*e;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=f,e}}En.prototype.bytesPerElement=12,Ot(En,"StructArrayLayout3f12");class jt extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c){let f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){let g=3*e;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=f,e}}jt.prototype.bytesPerElement=6,Ot(jt,"StructArrayLayout3ui6");class Xn extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae,me,we,ge,xe,Te){let Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae,me,we,ge,xe,Te)}emplace(e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae,me,we,ge,xe,Te,Ce){let qe=30*e,We=15*e,et=60*e;return this.int16[qe+0]=s,this.int16[qe+1]=c,this.int16[qe+2]=f,this.float32[We+2]=g,this.float32[We+3]=v,this.uint16[qe+8]=E,this.uint16[qe+9]=I,this.uint32[We+5]=A,this.uint32[We+6]=L,this.uint32[We+7]=j,this.uint16[qe+16]=$,this.uint16[qe+17]=W,this.uint16[qe+18]=q,this.float32[We+10]=ee,this.float32[We+11]=ae,this.uint8[et+48]=me,this.uint8[et+49]=we,this.uint8[et+50]=ge,this.uint32[We+13]=xe,this.int16[qe+28]=Te,this.uint8[et+58]=Ce,e}}Xn.prototype.bytesPerElement=60,Ot(Xn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ui extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae,me,we,ge,xe,Te,Ce,qe,We,et,vt,Ke,ot,st,dt){let xt=this.length;return this.resize(xt+1),this.emplace(xt,e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae,me,we,ge,xe,Te,Ce,qe,We,et,vt,Ke,ot,st,dt)}emplace(e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae,me,we,ge,xe,Te,Ce,qe,We,et,vt,Ke,ot,st,dt,xt){let Qe=38*e,At=19*e;return this.int16[Qe+0]=s,this.int16[Qe+1]=c,this.int16[Qe+2]=f,this.float32[At+2]=g,this.float32[At+3]=v,this.int16[Qe+8]=E,this.int16[Qe+9]=I,this.int16[Qe+10]=A,this.int16[Qe+11]=L,this.int16[Qe+12]=j,this.int16[Qe+13]=$,this.uint16[Qe+14]=W,this.uint16[Qe+15]=q,this.uint16[Qe+16]=ee,this.uint16[Qe+17]=ae,this.uint16[Qe+18]=me,this.uint16[Qe+19]=we,this.uint16[Qe+20]=ge,this.uint16[Qe+21]=xe,this.uint16[Qe+22]=Te,this.uint16[Qe+23]=Ce,this.uint16[Qe+24]=qe,this.uint16[Qe+25]=We,this.uint16[Qe+26]=et,this.uint16[Qe+27]=vt,this.uint16[Qe+28]=Ke,this.uint32[At+15]=ot,this.float32[At+16]=st,this.float32[At+17]=dt,this.float32[At+18]=xt,e}}ui.prototype.bytesPerElement=76,Ot(ui,"StructArrayLayout3i2f6i15ui1ul3f76");class di extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}di.prototype.bytesPerElement=4,Ot(di,"StructArrayLayout1f4");class hi extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,c,f,g)}emplace(e,s,c,f,g,v){let E=5*e;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=f,this.float32[E+3]=g,this.float32[E+4]=v,e}}hi.prototype.bytesPerElement=20,Ot(hi,"StructArrayLayout5f20");class ar extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,c,f)}emplace(e,s,c,f,g){let v=6*e;return this.uint32[3*e+0]=s,this.uint16[v+2]=c,this.uint16[v+3]=f,this.uint16[v+4]=g,e}}ar.prototype.bytesPerElement=12,Ot(ar,"StructArrayLayout1ul3ui12");class pr extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){let c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){let f=2*e;return this.uint16[f+0]=s,this.uint16[f+1]=c,e}}pr.prototype.bytesPerElement=4,Ot(pr,"StructArrayLayout2ui4");class Co extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}Co.prototype.bytesPerElement=2,Ot(Co,"StructArrayLayout1ui2");class Jo extends Be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){let c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){let f=2*e;return this.float32[f+0]=s,this.float32[f+1]=c,e}}Jo.prototype.bytesPerElement=8,Ot(Jo,"StructArrayLayout2f8");class Ii extends De{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ii.prototype.size=40;class fi extends on{get(e){return new Ii(this,e)}}Ot(fi,"CollisionBoxArray");class rn extends De{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}rn.prototype.size=60;class lr extends Xn{get(e){return new rn(this,e)}}Ot(lr,"PlacedSymbolArray");class eo extends De{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}eo.prototype.size=76;class bi extends ui{get(e){return new eo(this,e)}}Ot(bi,"SymbolInstanceArray");class Lr extends di{getoffsetX(e){return this.float32[1*e+0]}}Ot(Lr,"GlyphOffsetArray");class ea extends mt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ot(ea,"SymbolLineVertexArray");class Dl extends De{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Dl.prototype.size=12;class gi extends ar{get(e){return new Dl(this,e)}}Ot(gi,"FeatureIndexArray");class ta extends pr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ot(ta,"FillExtrusionCentroidArray");let na=Fe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ka=Fe([{name:"a_dash",components:4,type:"Uint16"}]);var Iu={exports:{}},Ji={exports:{}};Ji.exports=function(o,e){var s,c,f,g,v,E,I,A;for(c=o.length-(s=3&o.length),f=e,v=3432918353,E=461845907,A=0;A<c;)I=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,f=27492+(65535&(g=5*(65535&(f=(f^=I=(65535&(I=(I=(65535&I)*v+(((I>>>16)*v&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(I=0,s){case 3:I^=(255&o.charCodeAt(A+2))<<16;case 2:I^=(255&o.charCodeAt(A+1))<<8;case 1:f^=I=(65535&(I=(I=(65535&(I^=255&o.charCodeAt(A)))*v+(((I>>>16)*v&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295}return f^=o.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var sf=Ji.exports,Su={exports:{}};Su.exports=function(o,e){for(var s,c=o.length,f=e^c,g=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:f^=(255&o.charCodeAt(g+2))<<16;case 2:f^=(255&o.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&o.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var Bp=sf,Ui=Su.exports;Iu.exports=Bp,Iu.exports.murmur3=Bp,Iu.exports.murmur2=Ui;var Jg=Qt(Iu.exports);class af{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,c,f){this.ids.push(Au(e)),this.positions.push(s,c,f)}getPositions(e){let s=Au(e),c=0,f=this.ids.length-1;for(;c<f;){let v=c+f>>1;this.ids[v]>=s?f=v:c=v+1}let g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(e,s){let c=new Float64Array(e.ids),f=new Uint32Array(e.positions);return Do(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(e){let s=new af;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function Au(o){let e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Jg(String(o))}function Do(o,e,s,c){for(;s<c;){let f=o[s+c>>1],g=s-1,v=c+1;for(;;){do g++;while(o[g]<f);do v--;while(o[v]>f);if(g>=v)break;Vp(o,g,v),Vp(e,3*g,3*v),Vp(e,3*g+1,3*v+1),Vp(e,3*g+2,3*v+2)}v-s<c-v?(Do(o,e,s,v),s=v+1):(Do(o,e,v+1,c),c=v)}}function Vp(o,e,s){let c=o[e];o[e]=o[s],o[s]=c}Ot(af,"FeaturePositionMap");class Tl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}}class lf extends Tl{constructor(e){super(e),this.current=0}set(e,s,c){this.fetchUniformLocation(e,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class mv extends Tl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,c){this.fetchUniformLocation(e,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class ey extends Tl{constructor(e){super(e),this.current=Qi.transparent}set(e,s,c){this.fetchUniformLocation(e,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}let dw=new Float32Array(16),hw=new Float32Array(9),jp=new Float32Array(4);function ty(o){return[Se(255*o.r,255*o.g),Se(255*o.b,255*o.a)]}class cf{constructor(e,s,c){this.value=e,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(e,s,c,f,g){s.set(e,g,f.constantOr(this.value))}getBinding(e,s){return this.type==="color"?new ey(e):new lf(e)}}class xc{constructor(e,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,s,c,f,g){let v=g==="u_pattern"||g==="u_dash"?this.pattern:g==="u_pixel_ratio"?this.pixelRatio:null;v&&s.set(e,g,v)}getBinding(e,s){return s==="u_pattern"||s==="u_dash"?new mv(e):new lf(e)}}class Ml{constructor(e,s,c,f){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,s,c,f,g,v){let E=this.paintVertexArray.length,I=this.expression.evaluate(new z(0),s,{},g,f,v);this.paintVertexArray.resize(e),this._setPaintValue(E,e,I)}updatePaintArray(e,s,c,f,g){let v=this.expression.evaluate({zoom:0},c,f,void 0,g);this._setPaintValue(e,s,v)}_setPaintValue(e,s,c){if(this.type==="color"){let f=ty(c);for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=e;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ia{constructor(e,s,c,f,g,v){this.expression=e,this.uniformNames=s.map(E=>`u_${E}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(E=>({name:`a_${E}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(e,s,c,f,g,v){let E=this.expression.evaluate(new z(this.zoom),s,{},g,f,v),I=this.expression.evaluate(new z(this.zoom+1),s,{},g,f,v),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,E,I)}updatePaintArray(e,s,c,f,g){let v=this.expression.evaluate({zoom:this.zoom},c,f,void 0,g),E=this.expression.evaluate({zoom:this.zoom+1},c,f,void 0,g);this._setPaintValue(e,s,v,E)}_setPaintValue(e,s,c,f){if(this.type==="color"){let g=ty(c),v=ty(f);for(let E=e;E<s;E++)this.paintVertexArray.emplace(E,g[0],g[1],v[0],v[1])}else{for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,c,f,g){let v=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,E=Cn(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);s.set(e,g,E)}getBinding(e,s){return new lf(e)}}class co{constructor(e,s,c,f,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(c==="array"?ka:na).members;for(let v=0;v<s.length;++v);this.paintVertexArray=new f}populatePaintArray(e,s,c){let f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(e,s,c,f,g,v){this._setPaintValues(e,s,c.patterns&&c.patterns[this.layerId],v)}_setPaintValues(e,s,c,f){if(!f||!c)return;let g=f[c];if(!g)return;let{tl:v,br:E,pixelRatio:I}=g;for(let A=e;A<s;A++)this.paintVertexArray.emplace(A,v[0],v[1],E[0],E[1],I)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Il{constructor(e,s,c=()=>!0){this.binders={},this._buffers=[];let f=[];for(let g in e.paint._values){if(!c(g))continue;let v=e.paint.get(g);if(!(v instanceof he&&fc(v.property.specification)))continue;let E=fw(g,e.type),I=v.value,A=v.property.specification.type,L=!!v.property.useIntegerZoom,j=g==="line-dasharray"||g.endsWith("pattern"),$=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(I.kind!=="constant"||$)if(I.kind==="source"||$||j){let W=gv(g,A,"source");this.binders[g]=j?new co(I,E,A,W,e.id):new Ml(I,E,A,W),f.push(`/a_${g}`)}else{let W=gv(g,A,"composite");this.binders[g]=new ia(I,E,A,L,s,W),f.push(`/z_${g}`)}else this.binders[g]=j?new xc(I.value,E):new cf(I.value,E,A),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(e){let s=this.binders[e];return s instanceof Ml||s instanceof ia?s.maxValue:0}populatePaintArrays(e,s,c,f,g,v){for(let E in this.binders){let I=this.binders[E];(I instanceof Ml||I instanceof ia||I instanceof co)&&I.populatePaintArray(e,s,c,f,g,v)}}setConstantPatternPositions(e){for(let s in this.binders){let c=this.binders[s];c instanceof xc&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,s,c,f,g,v){let E=!1;for(let I in e){let A=s.getPositions(I);for(let L of A){let j=c.feature(L.index);for(let $ in this.binders){let W=this.binders[$];if((W instanceof Ml||W instanceof ia||W instanceof co)&&W.expression.isStateDependent===!0){let q=f.paint.get($);W.expression=q.value,W.updatePaintArray(L.start,L.end,j,e[I],g,v),E=!0}}}}return E}defines(){let e=[];for(let s in this.binders){let c=this.binders[s];(c instanceof cf||c instanceof xc)&&e.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){let e=[];for(let s in this.binders){let c=this.binders[s];if(c instanceof Ml||c instanceof ia||c instanceof co)for(let f=0;f<c.paintVertexAttributes.length;f++)e.push(c.paintVertexAttributes[f].name)}return e}getBinderUniforms(){let e=[];for(let s in this.binders){let c=this.binders[s];if(c instanceof cf||c instanceof xc||c instanceof ia)for(let f of c.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let s=[];for(let c in this.binders){let f=this.binders[c];if(f instanceof cf||f instanceof xc||f instanceof ia)for(let g of f.uniformNames)s.push({name:g,property:c,binding:f.getBinding(e,g)})}return s}setUniforms(e,s,c,f,g){for(let{name:v,property:E,binding:I}of c)this.binders[E].setUniform(e,I,g,f.get(E),v)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let s=this.binders[e];(s instanceof Ml||s instanceof ia||s instanceof co)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(let s in this.binders){let c=this.binders[s];(c instanceof Ml||c instanceof ia||c instanceof co)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let s=this.binders[e];(s instanceof Ml||s instanceof ia||s instanceof co)&&s.destroy()}}}class es{constructor(e,s,c=()=>!0){this.programConfigurations={};for(let f of e)this.programConfigurations[f.id]=new Il(f,s,c);this.needsUpload=!1,this._featureMap=new af,this._bufferOffset=0}populatePaintArrays(e,s,c,f,g,v,E){for(let I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,s,f,g,v,E);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,c,f,g){for(let v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,s,v,f,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let ws={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function fw(o,e){return ws[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}let pw={"line-pattern":{source:Ge,composite:Ge},"fill-pattern":{source:Ge,composite:Ge},"fill-extrusion-pattern":{source:Ge,composite:Ge},"line-dasharray":{source:tt,composite:tt}},mw={color:{source:Jo,composite:ut},number:{source:di,composite:Jo}};function gv(o,e,s){let c=pw[o];return c&&c[s]||mw[e][s]}Ot(cf,"ConstantBinder"),Ot(xc,"PatternConstantBinder"),Ot(Ml,"SourceExpressionBinder"),Ot(co,"PatternCompositeBinder"),Ot(ia,"CompositeExpressionBinder"),Ot(Il,"ProgramConfiguration",{omit:["_buffers"]}),Ot(es,"ProgramConfigurationSet");let Up="-transition";class Es extends tc{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new fe(s.layout)),s.paint)){this._transitionablePaint=new Y(s.paint);for(let c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(let c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pe(s.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,c={}){s!=null&&this._validate(Pp,`layers.${this.id}.layout.${e}`,e,s,c)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return Xa(e,Up)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,c={}){if(s!=null&&this._validate(_c,`layers.${this.id}.paint.${e}`,e,s,c))return!1;if(Xa(e,Up))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{let f=this._transitionablePaint._values[e],g=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);let E=this._transitionablePaint._values[e].value,I=E.isDataDriven(),A=Xa(e,"pattern")||e==="line-dasharray";return I||g||A||this._handleOverridablePaintPropertyUpdate(e,v,E)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Zt(e,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(e,s,c,f,g={}){return(!g||g.validate!==!1)&&Op(this,e.call(Rp,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:Je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let s=this.paint.get(e);if(s instanceof he&&fc(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let ny=Fe([{name:"a_pos",components:2,type:"Int16"}],4),gw=Fe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $i{constructor(e=[]){this.segments=e}prepareSegment(e,s,c,f){let g=this.segments[this.segments.length-1];return e>$i.MAX_VERTEX_ARRAY_LENGTH&&_i(`Max vertices per segment is ${$i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>$i.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(let e of this.segments)for(let s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,c,f){return new $i([{vertexOffset:e,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}$i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot($i,"SegmentVector");var Gt=8192;class wc{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ii?new ii(e.lng,e.lat):ii.convert(e),this}setSouthWest(e){return this._sw=e instanceof ii?new ii(e.lng,e.lat):ii.convert(e),this}extend(e){let s=this._sw,c=this._ne,f,g;if(e instanceof ii)f=e,g=e;else{if(!(e instanceof wc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(wc.convert(e)):this.extend(ii.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ii.convert(e)):this;if(f=e._sw,g=e._ne,!f||!g)return this}return s||c?(s.lng=Math.min(f.lng,s.lng),s.lat=Math.min(f.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new ii(f.lng,f.lat),this._ne=new ii(g.lng,g.lat)),this}getCenter(){return new ii((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ii(this.getWest(),this.getNorth())}getSouthEast(){return new ii(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:s,lat:c}=ii.convert(e),f=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(e){return!e||e instanceof wc?e:new wc(e)}}var uf=1e-6,Ar=typeof Float32Array<"u"?Float32Array:Array;function Hd(){var o=new Ar(9);return Ar!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function iy(o,e,s){var c=e[0],f=e[1],g=e[2],v=e[3],E=e[4],I=e[5],A=e[6],L=e[7],j=e[8],$=s[0],W=s[1],q=s[2],ee=s[3],ae=s[4],me=s[5],we=s[6],ge=s[7],xe=s[8];return o[0]=$*c+W*v+q*A,o[1]=$*f+W*E+q*L,o[2]=$*g+W*I+q*j,o[3]=ee*c+ae*v+me*A,o[4]=ee*f+ae*E+me*L,o[5]=ee*g+ae*I+me*j,o[6]=we*c+ge*v+xe*A,o[7]=we*f+ge*E+xe*L,o[8]=we*g+ge*I+xe*j,o}function ra(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function $p(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],v=e[4],E=e[5],I=e[6],A=e[7],L=e[8],j=e[9],$=e[10],W=e[11],q=e[12],ee=e[13],ae=e[14],me=e[15],we=s*E-c*v,ge=s*I-f*v,xe=s*A-g*v,Te=c*I-f*E,Ce=c*A-g*E,qe=f*A-g*I,We=L*ee-j*q,et=L*ae-$*q,vt=L*me-W*q,Ke=j*ae-$*ee,ot=j*me-W*ee,st=$*me-W*ae,dt=we*st-ge*ot+xe*Ke+Te*vt-Ce*et+qe*We;return dt?(o[0]=(E*st-I*ot+A*Ke)*(dt=1/dt),o[1]=(f*ot-c*st-g*Ke)*dt,o[2]=(ee*qe-ae*Ce+me*Te)*dt,o[3]=($*Ce-j*qe-W*Te)*dt,o[4]=(I*vt-v*st-A*et)*dt,o[5]=(s*st-f*vt+g*et)*dt,o[6]=(ae*xe-q*qe-me*ge)*dt,o[7]=(L*qe-$*xe+W*ge)*dt,o[8]=(v*ot-E*vt+A*We)*dt,o[9]=(c*vt-s*ot-g*We)*dt,o[10]=(q*Ce-ee*xe+me*we)*dt,o[11]=(j*xe-L*Ce-W*we)*dt,o[12]=(E*et-v*Ke-I*We)*dt,o[13]=(s*Ke-c*et+f*We)*dt,o[14]=(ee*ge-q*Te-ae*we)*dt,o[15]=(L*Te-j*ge+$*we)*dt,o):null}function Sl(o,e,s){var c=e[0],f=e[1],g=e[2],v=e[3],E=e[4],I=e[5],A=e[6],L=e[7],j=e[8],$=e[9],W=e[10],q=e[11],ee=e[12],ae=e[13],me=e[14],we=e[15],ge=s[0],xe=s[1],Te=s[2],Ce=s[3];return o[0]=ge*c+xe*E+Te*j+Ce*ee,o[1]=ge*f+xe*I+Te*$+Ce*ae,o[2]=ge*g+xe*A+Te*W+Ce*me,o[3]=ge*v+xe*L+Te*q+Ce*we,o[4]=(ge=s[4])*c+(xe=s[5])*E+(Te=s[6])*j+(Ce=s[7])*ee,o[5]=ge*f+xe*I+Te*$+Ce*ae,o[6]=ge*g+xe*A+Te*W+Ce*me,o[7]=ge*v+xe*L+Te*q+Ce*we,o[8]=(ge=s[8])*c+(xe=s[9])*E+(Te=s[10])*j+(Ce=s[11])*ee,o[9]=ge*f+xe*I+Te*$+Ce*ae,o[10]=ge*g+xe*A+Te*W+Ce*me,o[11]=ge*v+xe*L+Te*q+Ce*we,o[12]=(ge=s[12])*c+(xe=s[13])*E+(Te=s[14])*j+(Ce=s[15])*ee,o[13]=ge*f+xe*I+Te*$+Ce*ae,o[14]=ge*g+xe*A+Te*W+Ce*me,o[15]=ge*v+xe*L+Te*q+Ce*we,o}function ku(o,e,s){var c,f,g,v,E,I,A,L,j,$,W,q,ee=s[0],ae=s[1],me=s[2];return e===o?(o[12]=e[0]*ee+e[4]*ae+e[8]*me+e[12],o[13]=e[1]*ee+e[5]*ae+e[9]*me+e[13],o[14]=e[2]*ee+e[6]*ae+e[10]*me+e[14],o[15]=e[3]*ee+e[7]*ae+e[11]*me+e[15]):(f=e[1],g=e[2],v=e[3],E=e[4],I=e[5],A=e[6],L=e[7],j=e[8],$=e[9],W=e[10],q=e[11],o[0]=c=e[0],o[1]=f,o[2]=g,o[3]=v,o[4]=E,o[5]=I,o[6]=A,o[7]=L,o[8]=j,o[9]=$,o[10]=W,o[11]=q,o[12]=c*ee+E*ae+j*me+e[12],o[13]=f*ee+I*ae+$*me+e[13],o[14]=g*ee+A*ae+W*me+e[14],o[15]=v*ee+L*ae+q*me+e[15]),o}function Ec(o,e,s){var c=s[0],f=s[1],g=s[2];return o[0]=e[0]*c,o[1]=e[1]*c,o[2]=e[2]*c,o[3]=e[3]*c,o[4]=e[4]*f,o[5]=e[5]*f,o[6]=e[6]*f,o[7]=e[7]*f,o[8]=e[8]*g,o[9]=e[9]*g,o[10]=e[10]*g,o[11]=e[11]*g,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function df(o,e,s){var c=Math.sin(s),f=Math.cos(s),g=e[4],v=e[5],E=e[6],I=e[7],A=e[8],L=e[9],j=e[10],$=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=g*f+A*c,o[5]=v*f+L*c,o[6]=E*f+j*c,o[7]=I*f+$*c,o[8]=A*f-g*c,o[9]=L*f-v*c,o[10]=j*f-E*c,o[11]=$*f-I*c,o}function Oo(o,e,s){var c=Math.sin(s),f=Math.cos(s),g=e[0],v=e[1],E=e[2],I=e[3],A=e[8],L=e[9],j=e[10],$=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=g*f-A*c,o[1]=v*f-L*c,o[2]=E*f-j*c,o[3]=I*f-$*c,o[8]=g*c+A*f,o[9]=v*c+L*f,o[10]=E*c+j*f,o[11]=I*c+$*f,o}function Al(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ry(o,e,s){var c,f,g,v=s[0],E=s[1],I=s[2],A=Math.hypot(v,E,I);return A<uf?null:(v*=A=1/A,E*=A,I*=A,c=Math.sin(e),f=Math.cos(e),o[0]=v*v*(g=1-f)+f,o[1]=E*v*g+I*c,o[2]=I*v*g-E*c,o[3]=0,o[4]=v*E*g-I*c,o[5]=E*E*g+f,o[6]=I*E*g+v*c,o[7]=0,o[8]=v*I*g+E*c,o[9]=E*I*g-v*c,o[10]=I*I*g+f,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)});var yw=Sl;function oy(){var o=new Ar(3);return Ar!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Hp(o){var e=new Ar(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function Cs(o){return Math.hypot(o[0],o[1],o[2])}function Cc(o,e,s){var c=new Ar(3);return c[0]=o,c[1]=e,c[2]=s,c}function On(o,e,s){return o[0]=e[0]+s[0],o[1]=e[1]+s[1],o[2]=e[2]+s[2],o}function sy(o,e,s){return o[0]=e[0]-s[0],o[1]=e[1]-s[1],o[2]=e[2]-s[2],o}function Gp(o,e,s){return o[0]=e[0]*s[0],o[1]=e[1]*s[1],o[2]=e[2]*s[2],o}function hf(o,e,s){return o[0]=Math.min(e[0],s[0]),o[1]=Math.min(e[1],s[1]),o[2]=Math.min(e[2],s[2]),o}function Ra(o,e,s){return o[0]=Math.max(e[0],s[0]),o[1]=Math.max(e[1],s[1]),o[2]=Math.max(e[2],s[2]),o}function ts(o,e,s){return o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o}function Dc(o,e,s,c){return o[0]=e[0]+s[0]*c,o[1]=e[1]+s[1]*c,o[2]=e[2]+s[2]*c,o}function er(o,e){var s=e[0],c=e[1],f=e[2],g=s*s+c*c+f*f;return g>0&&(g=1/Math.sqrt(g)),o[0]=e[0]*g,o[1]=e[1]*g,o[2]=e[2]*g,o}function Lo(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function Fr(o,e,s){var c=e[0],f=e[1],g=e[2],v=s[0],E=s[1],I=s[2];return o[0]=f*I-g*E,o[1]=g*v-c*I,o[2]=c*E-f*v,o}function tr(o,e,s){var c=e[0],f=e[1],g=e[2],v=s[3]*c+s[7]*f+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*f+s[8]*g+s[12])/(v=v||1),o[1]=(s[1]*c+s[5]*f+s[9]*g+s[13])/v,o[2]=(s[2]*c+s[6]*f+s[10]*g+s[14])/v,o}function ay(o,e,s){var c=s[0],f=s[1],g=s[2],v=e[0],E=e[1],I=e[2],A=f*I-g*E,L=g*v-c*I,j=c*E-f*v,$=f*j-g*L,W=g*A-c*j,q=c*L-f*A,ee=2*s[3];return L*=ee,j*=ee,W*=2,q*=2,o[0]=v+(A*=ee)+($*=2),o[1]=E+L+W,o[2]=I+j+q,o}var Gd,Fo=sy,_w=Gp,vw=Cs;function kl(o,e,s){return o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o[3]=e[3]*s,o}function yv(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],v=s*s+c*c+f*f+g*g;return v>0&&(v=1/Math.sqrt(v)),o[0]=s*v,o[1]=c*v,o[2]=f*v,o[3]=g*v,o}function Ru(o,e,s){var c=e[0],f=e[1],g=e[2],v=e[3];return o[0]=s[0]*c+s[4]*f+s[8]*g+s[12]*v,o[1]=s[1]*c+s[5]*f+s[9]*g+s[13]*v,o[2]=s[2]*c+s[6]*f+s[10]*g+s[14]*v,o[3]=s[3]*c+s[7]*f+s[11]*g+s[15]*v,o}function Rl(){var o=new Ar(4);return Ar!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function ff(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Wp(o,e,s){s*=.5;var c=e[0],f=e[1],g=e[2],v=e[3],E=Math.sin(s),I=Math.cos(s);return o[0]=c*I+v*E,o[1]=f*I+g*E,o[2]=g*I-f*E,o[3]=v*I-c*E,o}function qp(o,e,s){s*=.5;var c=e[0],f=e[1],g=e[2],v=e[3],E=Math.sin(s),I=Math.cos(s);return o[0]=c*I-g*E,o[1]=f*I+v*E,o[2]=g*I+c*E,o[3]=v*I-f*E,o}oy(),Gd=new Ar(4),Ar!=Float32Array&&(Gd[0]=0,Gd[1]=0,Gd[2]=0,Gd[3]=0);var bw=yv;oy(),Cc(1,0,0),Cc(0,1,0),Rl(),Rl(),Hd();let _v=Fe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ly}=_v,vv=Fe([{name:"a_pos_3",components:3,type:"Int16"}]);var Wd=Fe([{name:"a_pos",type:"Int16",components:2}]);class Zp{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,c){let f=Lo(s,this.dir);if(Math.abs(f)<1e-6)return!1;let g=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/f;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,s,c){if(function(W,q){var ee=W[0],ae=W[1],me=W[2],we=q[0],ge=q[1],xe=q[2];return Math.abs(ee-we)<=uf*Math.max(1,Math.abs(ee),Math.abs(we))&&Math.abs(ae-ge)<=uf*Math.max(1,Math.abs(ae),Math.abs(ge))&&Math.abs(me-xe)<=uf*Math.max(1,Math.abs(me),Math.abs(xe))}(this.pos,e)||s===0)return c[0]=c[1]=c[2]=0,!1;let[f,g,v]=this.dir,E=this.pos[0]-e[0],I=this.pos[1]-e[1],A=this.pos[2]-e[2],L=f*f+g*g+v*v,j=2*(E*f+I*g+A*v),$=j*j-4*L*(E*E+I*I+A*A-s*s);if($<0){let W=Math.max(-j/2,0),q=E+f*W,ee=I+g*W,ae=A+v*W,me=Math.hypot(q,ee,ae);return c[0]=q*s/me,c[1]=ee*s/me,c[2]=ae*s/me,!1}{let W=(-j-Math.sqrt($))/(2*L);if(W<0){let q=Math.hypot(E,I,A);return c[0]=E*s/q,c[1]=I*s/q,c[2]=A*s/q,!1}return c[0]=E+f*W,c[1]=I+g*W,c[2]=A+v*W,!0}}}class cy{constructor(e,s,c,f,g){this.TL=e,this.TR=s,this.BR=c,this.BL=f,this.horizon=g}static fromInvProjectionMatrix(e,s,c){let f=[-1,1,1],g=[1,1,1],v=[1,-1,1],E=[-1,-1,1],I=tr(f,f,e),A=tr(g,g,e),L=tr(v,v,e),j=tr(E,E,e);return new cy(I,A,L,j,s/c)}}class uy{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,c,f){let g=Math.pow(2,c),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{let A=Ru([],I,e),L=1/A[3]/s*g;return function(j,$,W){return j[0]=$[0]*W[0],j[1]=$[1]*W[1],j[2]=$[2]*W[2],j[3]=$[3]*W[3],j}(A,A,[L,L,f?1/A[3]:L,L])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{let A=er([],Fr([],Fo([],v[I[0]],v[I[1]]),Fo([],v[I[2]],v[I[1]]))),L=-Lo(A,v[I[1]]);return A.concat(L)});return new uy(v,E)}}class uo{static fromPoints(e){let s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let f of e)hf(s,s,f),Ra(c,c,f);return new uo(s,c)}static applyTransform(e,s){let c=e.getCorners();for(let f=0;f<c.length;++f)tr(c[f],c[f],s);return uo.fromPoints(c)}constructor(e,s){this.min=e,this.max=s,this.center=ts([],On([],this.min,this.max),.5)}quadrant(e){let s=[e%2==0,e<2],c=Hp(this.min),f=Hp(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],f[g]=s[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new uo(c,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){let s=this.getCorners(),c=!0;for(let f=0;f<e.planes.length;f++){let g=e.planes[f],v=0;for(let E=0;E<s.length;E++)v+=Lo(g,s[E])+g[3]>=0;if(v===0)return 0;v!==s.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let E=0;E<e.points.length;E++){let I=e.points[E][f]-this.min[f];g=Math.min(g,I),v=Math.max(v,I)}if(v<0||g>this.max[f]-this.min[f])return 0}return 1}}let Xp=5,Yp=6,Ds=Gt/Math.PI/2,pf=16383,Tc=64,mf=[Tc,32,16],Ts=-Ds,ns=Ds,gf=[new uo([Ts,Ts,Ts],[ns,ns,ns]),new uo([Ts,Ts,Ts],[0,0,ns]),new uo([0,Ts,Ts],[ns,0,ns]),new uo([Ts,0,Ts],[0,ns,ns]),new uo([0,0,Ts],[ns,ns,ns])];function yf(o){return o*Ds/Ou}function bv(o,e,s,c=!0){let f=ts([],o._camera.position,o.worldSize),g=[e,s,1,1];Ru(g,g,o.pixelMatrixInverse),kl(g,g,1/g[3]);let v=er([],Fo([],g,f)),E=o.globeMatrix,I=[E[12],E[13],E[14]],A=Fo([],I,f),L=Cs(A),j=er([],A),$=o.worldSize/(2*Math.PI),W=Lo(j,v),q=Math.asin($/L);if(q<Math.acos(W)){if(!c)return null;let vt=[],Ke=[];ts(vt,v,L/W),er(Ke,Fo(Ke,vt,A)),er(v,On(v,A,ts(v,Ke,Math.tan(q)*L)))}let ee=[];new Zp(f,v).closestPointOnSphere(I,$,ee);let ae=er([],Qr(E,0)),me=er([],Qr(E,1)),we=er([],Qr(E,2)),ge=Lo(ae,ee),xe=Lo(me,ee),Te=Lo(we,ee),Ce=Yi(Math.asin(-xe/$)),qe=Yi(Math.atan2(ge,Te));qe=o.center.lng+function(vt,Ke){let ot=(Ke-vt+180)%360-180;return ot<-180?ot+360:ot}(o.center.lng,qe);let We=oa(qe),et=Cn(Pa(Ce),0,1);return new Xd(We,et)}class xw{constructor(e,s,c){this.a=Fo([],e,c),this.b=Fo([],s,c),this.center=c;let f=er([],this.a),g=er([],this.b);this.angle=Math.acos(Lo(f,g))}}function _f(o,e){if(o.angle===0)return null;let s;return s=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,f,g,v){let E=Math.sin(g);return c*(Math.sin((1-v)*g)/E)+f*(Math.sin(v*g)/E)}(o.a[e],o.b[e],o.angle,Cn(s,0,1))+o.center[e]}function ho(o){if(o.z<=1)return gf[o.z+2*o.y+o.x];let e=dy(Kp(o));return uo.fromPoints(e)}function Pl(o,e,s){return ts(o,o,1-s),Dc(o,o,e,s)}function xv(o,e){let s=Pu(e.zoom);if(s===0)return ho(o);let c=Kp(o),f=dy(c),g=oa(c.getWest())*e.worldSize,v=oa(c.getEast())*e.worldSize,E=Pa(c.getNorth())*e.worldSize,I=Pa(c.getSouth())*e.worldSize,A=[g,E,0],L=[v,E,0],j=[g,I,0],$=[v,I,0],W=$p([],e.globeMatrix);return tr(A,A,W),tr(L,L,W),tr(j,j,W),tr($,$,W),f[0]=Pl(f[0],j,s),f[1]=Pl(f[1],$,s),f[2]=Pl(f[2],L,s),f[3]=Pl(f[3],A,s),uo.fromPoints(f)}function wv(o,e,s){for(let c of o)tr(c,c,e),ts(c,c,s)}function ww(o,e,s){let c=e/o.worldSize,f=o.globeMatrix;if(s.z<=1){let We=ho(s).getCorners();return wv(We,f,c),uo.fromPoints(We)}let g=Kp(s),v=dy(g);wv(v,f,c);let E=Number.MAX_VALUE,I=[-E,-E,-E],A=[E,E,E];if(g.contains(o.center)){for(let vt of v)hf(A,A,vt),Ra(I,I,vt);I[2]=0;let We=o.point,et=[We.x*c,We.y*c,0];return hf(A,A,et),Ra(I,I,et),new uo(A,I)}let L=[f[12]*c,f[13]*c,f[14]*c],j=g.getCenter(),$=Cn(o.center.lat,-Wr,Wr),W=Cn(j.lat,-Wr,Wr),q=oa(o.center.lng),ee=Pa($),ae=q-oa(j.lng),me=ee-Pa(W);ae>.5?ae-=1:ae<-.5&&(ae+=1);let we=0;Math.abs(ae)>Math.abs(me)?we=ae>=0?1:3:(we=me>=0?0:2,Dc(L,L,[f[4]*c,f[5]*c,f[6]*c],-Math.sin(An(me>=0?g.getSouth():g.getNorth()))*Ds));let ge=v[we],xe=v[(we+1)%4],Te=new xw(ge,xe,L),Ce=[_f(Te,0)||ge[0],_f(Te,1)||ge[1],_f(Te,2)||ge[2]],qe=Pu(o.zoom);if(qe>0){let We=function({x:vt,y:Ke,z:ot},st,dt,xt,Qe){let At=1/(1<<ot),Nt=vt*At,Pt=Nt+At,hn=Ke*At,Et=hn+At,qt=0,fn=(Nt+Pt)/2-xt;return fn>.5?qt=-1:fn<-.5&&(qt=1),Nt=((Nt+qt)*st-(xt*=st))*dt+xt,Pt=((Pt+qt)*st-xt)*dt+xt,hn=(hn*st-(Qe*=st))*dt+Qe,Et=(Et*st-Qe)*dt+Qe,[[Nt,Et,0],[Pt,Et,0],[Pt,hn,0],[Nt,hn,0]]}(s,e,o._pixelsPerMercatorPixel,q,ee);for(let vt=0;vt<v.length;vt++)Pl(v[vt],We[vt],qe);let et=On([],We[we],We[(we+1)%4]);ts(et,et,.5),Pl(Ce,et,qe)}for(let We of v)hf(A,A,We),Ra(I,I,We);return A[2]=Math.min(ge[2],xe[2]),hf(A,A,Ce),Ra(I,I,Ce),new uo(A,I)}function Kp({x:o,y:e,z:s}){let c=1/(1<<s),f=new ii(rs(o*c),Gr((e+1)*c)),g=new ii(rs((o+1)*c),Gr(e*c));return new wc(f,g)}function dy(o){let e=An(o.getNorth()),s=An(o.getSouth()),c=Math.cos(e),f=Math.cos(s),g=Math.sin(e),v=Math.sin(s),E=o.getWest(),I=o.getEast();return[qd(f,v,E),qd(f,v,I),qd(c,g,I),qd(c,g,E)]}function qd(o,e,s,c=Ds){return s=An(s),[o*Math.sin(s)*c,-e*c,o*Math.cos(s)*c]}function Zd(o,e,s){return qd(Math.cos(An(o)),Math.sin(An(o)),e,s)}function vf(o,e,s,c){let f=1<<s.z,g=(o/Gt+s.x)/f;return Zd(Gr((e/Gt+s.y)/f),rs(g),c)}function Qp({min:o,max:e}){return pf/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}let Ev=new Float64Array(16);function bf(o){let e=Qp(o),s=Al(Ev,[e,e,e]);return ku(s,s,((c=[])[0]=-(f=o.min)[0],c[1]=-f[1],c[2]=-f[2],c));var c,f}function Jp(o){let e=(c=o.min,(s=Ev)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;let f=1/Qp(o);return Ec(e,e,[f,f,f])}function Cv(o,e,s,c,f){let g=function(I){let A=Gt/(2*Math.PI);return I/(2*Math.PI)/A}(s),v=[o,e,-s/(2*Math.PI)],E=ra(new Float64Array(16));return ku(E,E,v),Ec(E,E,[g,g,g]),df(E,E,An(-f)),Oo(E,E,An(-c)),E}function Pu(o){return Wo(Xp,Yp,o)}function em(o,e){let s=Zd(e.lat,e.lng),c=function(q){let ee=Zd(q._center.lat,q._center.lng),ae=Fr([],Cc(0,1,0),ee),me=ry([],-q.angle,ee);ae=tr(ae,ae,me),ry(me,-q._pitch,ae);let we=er([],ee);return ts(we,we,yf(q.cameraToCenterDistance/q.pixelsPerMeter)),tr(we,we,me),On([],ee,we)}(o);return v=(f=sy([],c,s))[0],E=f[1],I=f[2],A=(g=s)[0],L=g[1],j=g[2],W=($=Math.sqrt(v*v+E*E+I*I)*Math.sqrt(A*A+L*L+j*j))&&Lo(f,g)/$,Math.acos(Math.min(Math.max(W,-1),1));var f,g,v,E,I,A,L,j,$,W}function hy(o,e){return em(o,e)>Math.PI/2*1.01}let Dv=An(85),Ew=Math.cos(Dv),tm=Math.sin(Dv),Ou=63710088e-1,fy=2*Math.PI*Ou;class Mc{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mc(dr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let s=Math.PI/180,c=this.lat*s,f=e.lat*s,g=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((e.lng-this.lng)*s);return Ou*Math.acos(Math.min(g,1))}toBounds(e=0){let s=360*e/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new wc(new Mc(this.lng-c,this.lat-s),new Mc(this.lng+c,this.lat+s))}toEcef(e){let s=yf(e);return Zd(this.lat,this.lng,Ds+s)}static convert(e){if(e instanceof Mc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Mc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Mc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ii=Mc;function xf(o){return fy*Math.cos(o*Math.PI/180)}function oa(o){return(180+o)/360}function Pa(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function is(o,e){return o/xf(e)}function rs(o){return 360*o-180}function Gr(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function nm(o,e){return o*xf(Gr(e))}let Wr=85.051129;function Tv(o){return 1/Math.cos(o*Math.PI/180)}class Xd{constructor(e,s,c=0){this.x=+e,this.y=+s,this.z=+c}static fromLngLat(e,s=0){let c=ii.convert(e);return new Xd(oa(c.lng),Pa(c.lat),is(s,c.lat))}toLngLat(){return new ii(rs(this.x),Gr(this.y))}toAltitude(){return nm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/fy*Tv(Gr(this.y))}}function Yd(o,e,s,c,f,g,v,E,I){let A=(e+c)/2,L=(s+f)/2,j=new It(A,L);E(j),function($,W,q,ee,ae,me){let we=q-ae,ge=ee-me;return Math.abs((ee-W)*we-(q-$)*ge)/Math.hypot(we,ge)}(j.x,j.y,g.x,g.y,v.x,v.y)>=I?(Yd(o,e,s,A,L,g,j,E,I),Yd(o,A,L,c,f,j,v,E,I)):o.push(v)}function wf(o,e,s){let c=o[0],f=c.x,g=c.y;e(c);let v=[c];for(let E=1;E<o.length;E++){let I=o[E],{x:A,y:L}=I;e(I),Yd(v,f,g,A,L,c,I,e,s),f=A,g=L,c=I}return v}function im(o,e,s,c){if(c(e,s)){let f=e.add(s)._mult(.5);im(o,e,f,c),im(o,f,s,c)}else o.push(s)}function Mv(o,e){let s=o[0],c=[s];for(let f=1;f<o.length;f++){let g=o[f];im(c,s,g,e),s=g}return c}let rm=Math.pow(2,14)-1,py=-rm-1;function om(o,e){let s=Math.round(o.x*e),c=Math.round(o.y*e);return o.x=Cn(s,py,rm),o.y=Cn(c,py,rm),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&_i("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function sa(o,e,s){let c=o.loadGeometry(),f=o.extent,g=Gt/f;if(e&&s&&s.projection.isReprojectedInTileSpace){let v=1<<e.z,{scale:E,x:I,y:A,projection:L}=s,j=$=>{let W=rs((e.x+$.x/f)/v),q=Gr((e.y+$.y/f)/v),ee=L.project(W,q);$.x=(ee.x*E-I)*f,$.y=(ee.y*E-A)*f};for(let $=0;$<c.length;$++)if(o.type!==1)c[$]=wf(c[$],j,1);else{let W=[];for(let q of c[$])q.x<0||q.x>=f||q.y<0||q.y>=f||(j(q),W.push(q));c[$]=W}}for(let v of c)for(let E of v)om(E,g);return c}function Ms(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?sa(o):[]}}function sm(o,e,s,c,f){o.emplaceBack(2*e+(c+1)/2,2*s+(f+1)/2)}function Lu(o,e,s){o.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Kd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new mt,this.indexArray=new jt,this.segments=new $i,this.programConfigurations=new es(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){let g=this.layers[0],v=[],E=null;g.type==="circle"&&(E=g.layout.get("circle-sort-key"));for(let{feature:A,id:L,index:j,sourceLayerIndex:$}of e){let W=this.layers[0]._featureFilter.needGeometry,q=Ms(A,W);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),q,c))continue;let ee=E?E.evaluate(q,{},c):void 0,ae={id:L,properties:A.properties,type:A.type,sourceLayerIndex:$,index:j,geometry:W?q.geometry:sa(A,c,f),patterns:{},sortKey:ee};v.push(ae)}E&&v.sort((A,L)=>A.sortKey-L.sortKey);let I=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new gt,I=f.projection);for(let A of v){let{geometry:L,index:j,sourceLayerIndex:$}=A,W=e[j].feature;this.addFeature(A,L,j,s.availableImages,c,I),s.featureIndex.insert(W,L,j,$,this.index)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ny.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,s,c,f,g,v){for(let E of s)for(let I of E){let A=I.x,L=I.y;if(A<0||A>=Gt||L<0||L>=Gt)continue;if(v){let W=v.projectTilePoint(A,L,g),q=v.upVector(g,A,L),ee=this.globeExtVertexArray;Lu(ee,W,q),Lu(ee,W,q),Lu(ee,W,q),Lu(ee,W,q)}let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),$=j.vertexLength;sm(this.layoutVertexArray,A,L,-1,-1),sm(this.layoutVertexArray,A,L,1,-1),sm(this.layoutVertexArray,A,L,1,1),sm(this.layoutVertexArray,A,L,-1,1),this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},f,g)}}function Iv(o,e){for(let s=0;s<o.length;s++)if(Fu(e,o[s]))return!0;for(let s=0;s<e.length;s++)if(Fu(o,e[s]))return!0;return!!Ef(o,e)}function Cw(o,e,s){return!!Fu(o,e)||!!Oa(e,o,s)}function Ic(o,e){if(o.length===1)return Qd(e,o[0]);for(let s=0;s<e.length;s++){let c=e[s];for(let f=0;f<c.length;f++)if(Fu(o,c[f]))return!0}for(let s=0;s<o.length;s++)if(Qd(e,o[s]))return!0;for(let s=0;s<e.length;s++)if(Ef(o,e[s]))return!0;return!1}function Sv(o,e,s){if(o.length>1){if(Ef(o,e))return!0;for(let c=0;c<e.length;c++)if(Oa(e[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Oa(o[c],e,s))return!0;return!1}function Ef(o,e){if(o.length===0||e.length===0)return!1;for(let s=0;s<o.length-1;s++){let c=o[s],f=o[s+1];for(let g=0;g<e.length-1;g++)if(Av(c,f,e[g],e[g+1]))return!0}return!1}function Av(o,e,s,c){return _o(o,s,c)!==_o(e,s,c)&&_o(o,e,s)!==_o(o,e,c)}function Oa(o,e,s){let c=s*s;if(e.length===1)return o.distSqr(e[0])<c;for(let f=1;f<e.length;f++)if(am(o,e[f-1],e[f])<c)return!0;return!1}function am(o,e,s){let c=e.distSqr(s);if(c===0)return o.distSqr(e);let f=((o.x-e.x)*(s.x-e.x)+(o.y-e.y)*(s.y-e.y))/c;return o.distSqr(f<0?e:f>1?s:s.sub(e)._mult(f)._add(e))}function Qd(o,e){let s,c,f,g=!1;for(let v=0;v<o.length;v++){s=o[v];for(let E=0,I=s.length-1;E<s.length;I=E++)c=s[E],f=s[I],c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(g=!g)}return g}function Fu(o,e){let s=!1;for(let c=0,f=o.length-1;c<o.length;f=c++){let g=o[c],v=o[f];g.y>e.y!=v.y>e.y&&e.x<(v.x-g.x)*(e.y-g.y)/(v.y-g.y)+g.x&&(s=!s)}return s}function Jd(o,e,s,c,f){for(let v of o)if(e<=v.x&&s<=v.y&&c>=v.x&&f>=v.y)return!0;let g=[new It(e,s),new It(e,f),new It(c,f),new It(c,s)];if(o.length>2){for(let v of g)if(Fu(o,v))return!0}for(let v=0;v<o.length-1;v++)if(Dw(o[v],o[v+1],g))return!0;return!1}function Dw(o,e,s){let c=s[0],f=s[2];if(o.x<c.x&&e.x<c.x||o.x>f.x&&e.x>f.x||o.y<c.y&&e.y<c.y||o.y>f.y&&e.y>f.y)return!1;let g=_o(o,e,s[0]);return g!==_o(o,e,s[1])||g!==_o(o,e,s[2])||g!==_o(o,e,s[3])}function Nu(o,e,s){let c=e.paint.get(o).value;return c.kind==="constant"?c.value:s.programConfigurations.get(e.id).getMaxValue(o)}function zu(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function kv(o,e,s,c,f){if(!e[0]&&!e[1])return o;let g=It.convert(e)._mult(f);s==="viewport"&&g._rotate(-c);let v=[];for(let E=0;E<o.length;E++)v.push(o[E].sub(g));return v}function my(o,e,s,c){let f=It.convert(o)._mult(c);return e==="viewport"&&f._rotate(-s),f}Ot(Kd,"CircleBucket",{omit:["layers"]});let Tw=new _e({"circle-sort-key":new ue(Je.layout_circle["circle-sort-key"])});var Cf={paint:new _e({"circle-radius":new ue(Je.paint_circle["circle-radius"]),"circle-color":new ue(Je.paint_circle["circle-color"]),"circle-blur":new ue(Je.paint_circle["circle-blur"]),"circle-opacity":new ue(Je.paint_circle["circle-opacity"]),"circle-translate":new Q(Je.paint_circle["circle-translate"]),"circle-translate-anchor":new Q(Je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Q(Je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Q(Je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ue(Je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ue(Je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ue(Je.paint_circle["circle-stroke-opacity"])}),layout:Tw};function Rv(o,e,s,c,f,g,v,E,I){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(I*=o.pixelToTileUnitsFactor);let A=o.tileID.canonical,L=s.projection.upVectorScale(A,s.center.lat,s.worldSize).metersToTile;for(let j of e)for(let $ of j){let W=$.add(E),q=f&&s.elevation?s.elevation.exaggeration()*f.getElevationAt(W.x,W.y,!0):0,ee=s.projection.projectTilePoint(W.x,W.y,A);if(q>0){let ge=s.projection.upVector(A,W.x,W.y);ee.x+=ge[0]*L*q,ee.y+=ge[1]*L*q,ee.z+=ge[2]*L*q}let ae=g?W:Mw(ee.x,ee.y,ee.z,c),me=g?o.tilespaceRays.map(ge=>gy(ge,q)):o.queryGeometry.screenGeometry,we=Ru([],[ee.x,ee.y,ee.z,1],c);if(!v&&g?I*=we[3]/s.cameraToCenterDistance:v&&!g&&(I*=s.cameraToCenterDistance/we[3]),g){let ge=Gr(($.y/Gt+A.y)/(1<<A.z));I/=s.projection.pixelsPerMeter(ge,1)/is(1,ge)}if(Cw(me,ae,I))return!0}return!1}function Mw(o,e,s,c){let f=Ru([],[o,e,s,1],c);return new It(f[0]/f[3],f[1]/f[3])}let Pv=Cc(0,0,0),Iw=Cc(0,0,1);function gy(o,e){let s=oy();return Pv[2]=e,o.intersectsPlane(Pv,Iw,s),new It(s[0],s[1])}class Ov extends Kd{}function yy(o,{width:e,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*s*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*s*c);return o.width=e,o.height=s,o.data=f,o}function Lv(o,e,s){let{width:c,height:f}=e;c===o.width&&f===o.height||(_y(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,f)},s),o.width=c,o.height=f,o.data=e.data)}function _y(o,e,s,c,f,g){if(f.width===0||f.height===0)return e;if(f.width>o.width||f.height>o.height||s.x>o.width-f.width||s.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||c.x>e.width-f.width||c.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let v=o.data,E=e.data;for(let I=0;I<f.height;I++){let A=((s.y+I)*o.width+s.x)*g,L=((c.y+I)*e.width+c.x)*g;for(let j=0;j<f.width*g;j++)E[L+j]=v[A+j]}return e}Ot(Ov,"HeatmapBucket",{omit:["layers"]});class Ol{constructor(e,s){yy(this,e,1,s)}resize(e){Lv(this,new Ol(e),1)}clone(){return new Ol({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,f,g){_y(e,s,c,f,g,1)}}class to{constructor(e,s){yy(this,e,4,s)}resize(e){Lv(this,new to(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new to({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,f,g){_y(e,s,c,f,g,4)}}Ot(Ol,"AlphaImage"),Ot(to,"RGBAImage");var Fv={paint:new _e({"heatmap-radius":new ue(Je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ue(Je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Q(Je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ye(Je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Q(Je.paint_heatmap["heatmap-opacity"])})};function vy(o){let e={},s=o.resolution||256,c=o.clips?o.clips.length:1,f=o.image||new to({width:s,height:c}),g=(v,E,I)=>{e[o.evaluationKey]=I;let A=o.expression.evaluate(e);f.data[v+E+0]=Math.floor(255*A.r/A.a),f.data[v+E+1]=Math.floor(255*A.g/A.a),f.data[v+E+2]=Math.floor(255*A.b/A.a),f.data[v+E+3]=Math.floor(255*A.a)};if(o.clips)for(let v=0,E=0;v<c;++v,E+=4*s)for(let I=0,A=0;I<s;I++,A+=4){let L=I/(s-1),{start:j,end:$}=o.clips[v];g(E,A,j*(1-L)+$*L)}else for(let v=0,E=0;v<s;v++,E+=4)g(0,E,v/(s-1));return f}var by={paint:new _e({"hillshade-illumination-direction":new Q(Je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Q(Je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Q(Je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Q(Je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Q(Je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Q(Je.paint_hillshade["hillshade-accent-color"])})};let lm=Fe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sw}=lm;var cm={exports:{}};function um(o,e,s){s=s||2;var c,f,g,v,E,I,A,L=e&&e.length,j=L?e[0]*s:o.length,$=xy(o,0,j,s,!0),W=[];if(!$||$.next===$.prev)return W;if(L&&($=function(ee,ae,me,we){var ge,xe,Te,Ce=[];for(ge=0,xe=ae.length;ge<xe;ge++)(Te=xy(ee,ae[ge]*we,ge<xe-1?ae[ge+1]*we:ee.length,we,!1))===Te.next&&(Te.steiner=!0),Ce.push(Bv(Te));for(Ce.sort(Pw),ge=0;ge<Ce.length;ge++)me=zv(Ce[ge],me);return me}(o,e,$,s)),o.length>80*s){c=g=o[0],f=v=o[1];for(var q=s;q<j;q+=s)(E=o[q])<c&&(c=E),(I=o[q+1])<f&&(f=I),E>g&&(g=E),I>v&&(v=I);A=(A=Math.max(g-c,v-f))!==0?32767/A:0}return Df($,W,s,c,f,A,0),W}function xy(o,e,s,c,f){var g,v;if(f===fm(o,e,s,c)>0)for(g=e;g<s;g+=c)v=Cy(g,o[g],o[g+1],v);else for(g=s-c;g>=e;g-=c)v=Cy(g,o[g],o[g+1],v);return v&&dm(v,v.next)&&(If(v),v=v.next),v}function Bu(o,e){if(!o)return o;e||(e=o);var s,c=o;do if(s=!1,c.steiner||!dm(c,c.next)&&Hi(c.prev,c,c.next)!==0)c=c.next;else{if(If(c),(c=e=c.prev)===c.next)break;s=!0}while(s||c!==e);return e}function Df(o,e,s,c,f,g,v){if(o){!v&&g&&function(L,j,$,W){var q=L;do q.z===0&&(q.z=wy(q.x,q.y,j,$,W)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==L);q.prevZ.nextZ=null,q.prevZ=null,function(ee){var ae,me,we,ge,xe,Te,Ce,qe,We=1;do{for(me=ee,ee=null,xe=null,Te=0;me;){for(Te++,we=me,Ce=0,ae=0;ae<We&&(Ce++,we=we.nextZ);ae++);for(qe=We;Ce>0||qe>0&&we;)Ce!==0&&(qe===0||!we||me.z<=we.z)?(ge=me,me=me.nextZ,Ce--):(ge=we,we=we.nextZ,qe--),xe?xe.nextZ=ge:ee=ge,ge.prevZ=xe,xe=ge;me=we}xe.nextZ=null,We*=2}while(Te>1)}(q)}(o,c,f,g);for(var E,I,A=o;o.prev!==o.next;)if(E=o.prev,I=o.next,g?kw(o,c,f,g):Aw(o))e.push(E.i/s|0),e.push(o.i/s|0),e.push(I.i/s|0),If(o),o=I.next,A=I.next;else if((o=I)===A){v?v===1?Df(o=Rw(Bu(o),e,s),e,s,c,f,g,2):v===2&&Nv(o,e,s,c,f,g):Df(Bu(o),e,s,c,f,g,1);break}}}function Aw(o){var e=o.prev,s=o,c=o.next;if(Hi(e,s,c)>=0)return!1;for(var f=e.x,g=s.x,v=c.x,E=e.y,I=s.y,A=c.y,L=f<g?f<v?f:v:g<v?g:v,j=E<I?E<A?E:A:I<A?I:A,$=f>g?f>v?f:v:g>v?g:v,W=E>I?E>A?E:A:I>A?I:A,q=c.next;q!==e;){if(q.x>=L&&q.x<=$&&q.y>=j&&q.y<=W&&Sc(f,E,g,I,v,A,q.x,q.y)&&Hi(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function kw(o,e,s,c){var f=o.prev,g=o,v=o.next;if(Hi(f,g,v)>=0)return!1;for(var E=f.x,I=g.x,A=v.x,L=f.y,j=g.y,$=v.y,W=E<I?E<A?E:A:I<A?I:A,q=L<j?L<$?L:$:j<$?j:$,ee=E>I?E>A?E:A:I>A?I:A,ae=L>j?L>$?L:$:j>$?j:$,me=wy(W,q,e,s,c),we=wy(ee,ae,e,s,c),ge=o.prevZ,xe=o.nextZ;ge&&ge.z>=me&&xe&&xe.z<=we;){if(ge.x>=W&&ge.x<=ee&&ge.y>=q&&ge.y<=ae&&ge!==f&&ge!==v&&Sc(E,L,I,j,A,$,ge.x,ge.y)&&Hi(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,xe.x>=W&&xe.x<=ee&&xe.y>=q&&xe.y<=ae&&xe!==f&&xe!==v&&Sc(E,L,I,j,A,$,xe.x,xe.y)&&Hi(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;ge&&ge.z>=me;){if(ge.x>=W&&ge.x<=ee&&ge.y>=q&&ge.y<=ae&&ge!==f&&ge!==v&&Sc(E,L,I,j,A,$,ge.x,ge.y)&&Hi(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;xe&&xe.z<=we;){if(xe.x>=W&&xe.x<=ee&&xe.y>=q&&xe.y<=ae&&xe!==f&&xe!==v&&Sc(E,L,I,j,A,$,xe.x,xe.y)&&Hi(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function Rw(o,e,s){var c=o;do{var f=c.prev,g=c.next.next;!dm(f,g)&&Vv(f,c,c.next,g)&&Mf(f,g)&&Mf(g,f)&&(e.push(f.i/s|0),e.push(c.i/s|0),e.push(g.i/s|0),If(c),If(c.next),c=o=g),c=c.next}while(c!==o);return Bu(c)}function Nv(o,e,s,c,f,g){var v=o;do{for(var E=v.next.next;E!==v.prev;){if(v.i!==E.i&&Lw(v,E)){var I=Ey(v,E);return v=Bu(v,v.next),I=Bu(I,I.next),Df(v,e,s,c,f,g,0),void Df(I,e,s,c,f,g,0)}E=E.next}v=v.next}while(v!==o)}function Pw(o,e){return o.x-e.x}function zv(o,e){var s=function(f,g){var v,E=g,I=f.x,A=f.y,L=-1/0;do{if(A<=E.y&&A>=E.next.y&&E.next.y!==E.y){var j=E.x+(A-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(j<=I&&j>L&&(L=j,v=E.x<E.next.x?E:E.next,j===I))return v}E=E.next}while(E!==g);if(!v)return null;var $,W=v,q=v.x,ee=v.y,ae=1/0;E=v;do I>=E.x&&E.x>=q&&I!==E.x&&Sc(A<ee?I:L,A,q,ee,A<ee?L:I,A,E.x,E.y)&&($=Math.abs(A-E.y)/(I-E.x),Mf(E,f)&&($<ae||$===ae&&(E.x>v.x||E.x===v.x&&Ow(v,E)))&&(v=E,ae=$)),E=E.next;while(E!==W);return v}(o,e);if(!s)return e;var c=Ey(s,o);return Bu(c,c.next),Bu(s,s.next)}function Ow(o,e){return Hi(o.prev,o,e.prev)<0&&Hi(e.next,o,o.next)<0}function wy(o,e,s,c,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bv(o){var e=o,s=o;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==o);return s}function Sc(o,e,s,c,f,g,v,E){return(f-v)*(e-E)>=(o-v)*(g-E)&&(o-v)*(c-E)>=(s-v)*(e-E)&&(s-v)*(g-E)>=(f-v)*(c-E)}function Lw(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&Vv(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(o,e)&&(Mf(o,e)&&Mf(e,o)&&function(s,c){var f=s,g=!1,v=(s.x+c.x)/2,E=(s.y+c.y)/2;do f.y>E!=f.next.y>E&&f.next.y!==f.y&&v<(f.next.x-f.x)*(E-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==s);return g}(o,e)&&(Hi(o.prev,o,e.prev)||Hi(o,e.prev,e))||dm(o,e)&&Hi(o.prev,o,o.next)>0&&Hi(e.prev,e,e.next)>0)}function Hi(o,e,s){return(e.y-o.y)*(s.x-e.x)-(e.x-o.x)*(s.y-e.y)}function dm(o,e){return o.x===e.x&&o.y===e.y}function Vv(o,e,s,c){var f=Tf(Hi(o,e,s)),g=Tf(Hi(o,e,c)),v=Tf(Hi(s,c,o)),E=Tf(Hi(s,c,e));return f!==g&&v!==E||!(f!==0||!hm(o,s,e))||!(g!==0||!hm(o,c,e))||!(v!==0||!hm(s,o,c))||!(E!==0||!hm(s,e,c))}function hm(o,e,s){return e.x<=Math.max(o.x,s.x)&&e.x>=Math.min(o.x,s.x)&&e.y<=Math.max(o.y,s.y)&&e.y>=Math.min(o.y,s.y)}function Tf(o){return o>0?1:o<0?-1:0}function Mf(o,e){return Hi(o.prev,o,o.next)<0?Hi(o,e,o.next)>=0&&Hi(o,o.prev,e)>=0:Hi(o,e,o.prev)<0||Hi(o,o.next,e)<0}function Ey(o,e){var s=new Dy(o.i,o.x,o.y),c=new Dy(e.i,e.x,e.y),f=o.next,g=e.prev;return o.next=e,e.prev=o,s.next=f,f.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function Cy(o,e,s,c){var f=new Dy(o,e,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function If(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Dy(o,e,s){this.i=o,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fm(o,e,s,c){for(var f=0,g=e,v=s-c;g<s;g+=c)f+=(o[v]-o[g])*(o[g+1]+o[v+1]),v=g;return f}cm.exports=um,cm.exports.default=um,um.deviation=function(o,e,s,c){var f=e&&e.length,g=Math.abs(fm(o,0,f?e[0]*s:o.length,s));if(f)for(var v=0,E=e.length;v<E;v++)g-=Math.abs(fm(o,e[v]*s,v<E-1?e[v+1]*s:o.length,s));var I=0;for(v=0;v<c.length;v+=3){var A=c[v]*s,L=c[v+1]*s,j=c[v+2]*s;I+=Math.abs((o[A]-o[j])*(o[L+1]-o[A+1])-(o[A]-o[L])*(o[j+1]-o[A+1]))}return g===0&&I===0?0:Math.abs((I-g)/g)},um.flatten=function(o){for(var e=o[0][0].length,s={vertices:[],holes:[],dimensions:e},c=0,f=0;f<o.length;f++){for(var g=0;g<o[f].length;g++)for(var v=0;v<e;v++)s.vertices.push(o[f][g][v]);f>0&&s.holes.push(c+=o[f-1].length)}return s};var Ty=Qt(cm.exports);function Fw(o,e,s,c,f){jv(o,e,s||0,c||o.length-1,f||Uv)}function jv(o,e,s,c,f){for(;c>s;){if(c-s>600){var g=c-s+1,v=e-s+1,E=Math.log(g),I=.5*Math.exp(2*E/3),A=.5*Math.sqrt(E*I*(g-I)/g)*(v-g/2<0?-1:1);jv(o,e,Math.max(s,Math.floor(e-v*I/g+A)),Math.min(c,Math.floor(e+(g-v)*I/g+A)),f)}var L=o[e],j=s,$=c;for(eh(o,s,e),f(o[c],L)>0&&eh(o,s,c);j<$;){for(eh(o,j,$),j++,$--;f(o[j],L)<0;)j++;for(;f(o[$],L)>0;)$--}f(o[s],L)===0?eh(o,s,$):eh(o,++$,c),$<=e&&(s=$+1),e<=$&&(c=$-1)}}function eh(o,e,s){var c=o[e];o[e]=o[s],o[s]=c}function Uv(o,e){return o<e?-1:o>e?1:0}function My(o,e){let s=o.length;if(s<=1)return[o];let c=[],f,g;for(let v=0;v<s;v++){let E=Ya(o[v]);E!==0&&(o[v].area=Math.abs(E),g===void 0&&(g=E<0),g===E<0?(f&&c.push(f),f=[o[v]]):f.push(o[v]))}if(f&&c.push(f),e>1)for(let v=0;v<c.length;v++)c[v].length<=e||(Fw(c[v],e,1,c[v].length-1,Nw),c[v]=c[v].slice(0,e));return c}function Nw(o,e){return e.area-o.area}function pm(o,e,s){let c=s.patternDependencies,f=!1;for(let g of e){let v=g.paint.get(`${o}-pattern`);v.isConstant()||(f=!0);let E=v.constantOr(null);E&&(f=!0,c[E]=!0)}return f}function Iy(o,e,s,c,f){let g=f.patternDependencies;for(let v of e){let E=v.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let I=E.evaluate({zoom:c},s,{},f.availableImages);I=I&&I.name?I.name:I,g[I]=!0,s.patterns[v.id]=I}}return s}class Sf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mt,this.indexArray=new jt,this.indexArray2=new pr,this.programConfigurations=new es(e.layers,e.zoom),this.segments=new $i,this.segments2=new $i,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection}populate(e,s,c,f){this.hasPattern=pm("fill",this.layers,s);let g=this.layers[0].layout.get("fill-sort-key"),v=[];for(let{feature:E,id:I,index:A,sourceLayerIndex:L}of e){let j=this.layers[0]._featureFilter.needGeometry,$=Ms(E,j);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),$,c))continue;let W=g?g.evaluate($,{},c,s.availableImages):void 0,q={id:I,properties:E.properties,type:E.type,sourceLayerIndex:L,index:A,geometry:j?$.geometry:sa(E,c,f),patterns:{},sortKey:W};v.push(q)}g&&v.sort((E,I)=>E.sortKey-I.sortKey);for(let E of v){let{geometry:I,index:A,sourceLayerIndex:L}=E;if(this.hasPattern){let j=Iy("fill",this.layers,E,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(E,I,A,c,{},s.availableImages);s.featureIndex.insert(e[A].feature,I,A,L,this.index)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}addFeatures(e,s,c,f,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,c,f,g,v=[]){for(let E of My(s,500)){let I=0;for(let q of E)I+=q.length;let A=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),L=A.vertexLength,j=[],$=[];for(let q of E){if(q.length===0)continue;q!==E[0]&&$.push(j.length/2);let ee=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),ae=ee.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(ae+q.length-1,ae),j.push(q[0].x),j.push(q[0].y);for(let me=1;me<q.length;me++)this.layoutVertexArray.emplaceBack(q[me].x,q[me].y),this.indexArray2.emplaceBack(ae+me-1,ae+me),j.push(q[me].x),j.push(q[me].y);ee.vertexLength+=q.length,ee.primitiveLength+=q.length}let W=Ty(j,$);for(let q=0;q<W.length;q+=3)this.indexArray.emplaceBack(L+W[q],L+W[q+1],L+W[q+2]);A.vertexLength+=I,A.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,v,f)}}Ot(Sf,"FillBucket",{omit:["layers","patternFeatures"]});let zw=new _e({"fill-sort-key":new ue(Je.layout_fill["fill-sort-key"])});var $v={paint:new _e({"fill-antialias":new Q(Je.paint_fill["fill-antialias"]),"fill-opacity":new ue(Je.paint_fill["fill-opacity"]),"fill-color":new ue(Je.paint_fill["fill-color"]),"fill-outline-color":new ue(Je.paint_fill["fill-outline-color"]),"fill-translate":new Q(Je.paint_fill["fill-translate"]),"fill-translate-anchor":new Q(Je.paint_fill["fill-translate-anchor"]),"fill-pattern":new ue(Je.paint_fill["fill-pattern"])}),layout:zw};let Hv=Fe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Bw=Fe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Gv=Fe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Vw}=Hv;var th={},jw=lt,Sy=Vu;function Vu(o,e,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=f,o.readFields(Uw,this,e)}function Uw(o,e,s){o==1?e.id=s.readVarint():o==2?function(c,f){for(var g=c.readVarint()+c.pos;c.pos<g;){var v=f._keys[c.readVarint()],E=f._values[c.readVarint()];f.properties[v]=E}}(s,e):o==3?e.type=s.readVarint():o==4&&(e._geometry=s.pos)}function $w(o){for(var e,s,c=0,f=0,g=o.length,v=g-1;f<g;v=f++)c+=((s=o[v]).x-(e=o[f]).x)*(e.y+s.y);return c}Vu.types=["Unknown","Point","LineString","Polygon"],Vu.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var e,s=o.readVarint()+o.pos,c=1,f=0,g=0,v=0,E=[];o.pos<s;){if(f<=0){var I=o.readVarint();c=7&I,f=I>>3}if(f--,c===1||c===2)g+=o.readSVarint(),v+=o.readSVarint(),c===1&&(e&&E.push(e),e=[]),e.push(new jw(g,v));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&E.push(e),E},Vu.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var e=o.readVarint()+o.pos,s=1,c=0,f=0,g=0,v=1/0,E=-1/0,I=1/0,A=-1/0;o.pos<e;){if(c<=0){var L=o.readVarint();s=7&L,c=L>>3}if(c--,s===1||s===2)(f+=o.readSVarint())<v&&(v=f),f>E&&(E=f),(g+=o.readSVarint())<I&&(I=g),g>A&&(A=g);else if(s!==7)throw new Error("unknown command "+s)}return[v,I,E,A]},Vu.prototype.toGeoJSON=function(o,e,s){var c,f,g=this.extent*Math.pow(2,s),v=this.extent*o,E=this.extent*e,I=this.loadGeometry(),A=Vu.types[this.type];function L(W){for(var q=0;q<W.length;q++){var ee=W[q];W[q]=[360*(ee.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+E)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(c=0;c<I.length;c++)j[c]=I[c][0];L(I=j);break;case 2:for(c=0;c<I.length;c++)L(I[c]);break;case 3:for(I=function(W){var q=W.length;if(q<=1)return[W];for(var ee,ae,me=[],we=0;we<q;we++){var ge=$w(W[we]);ge!==0&&(ae===void 0&&(ae=ge<0),ae===ge<0?(ee&&me.push(ee),ee=[W[we]]):ee.push(W[we]))}return ee&&me.push(ee),me}(I),c=0;c<I.length;c++)for(f=0;f<I[c].length;f++)L(I[c][f])}I.length===1?I=I[0]:A="Multi"+A;var $={type:"Feature",geometry:{type:A,coordinates:I},properties:this.properties};return"id"in this&&($.id=this.id),$};var Ay=Sy,Wv=qv;function qv(o,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Hw,this,e),this.length=this._features.length}function Hw(o,e,s){o===15?e.version=s.readVarint():o===1?e.name=s.readString():o===5?e.extent=s.readVarint():o===2?e._features.push(s.pos):o===3?e._keys.push(s.readString()):o===4&&e._values.push(function(c){for(var f=null,g=c.readVarint()+c.pos;c.pos<g;){var v=c.readVarint()>>3;f=v===1?c.readString():v===2?c.readFloat():v===3?c.readDouble():v===4?c.readVarint64():v===5?c.readVarint():v===6?c.readSVarint():v===7?c.readBoolean():null}return f}(s))}qv.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var e=this._pbf.readVarint()+this._pbf.pos;return new Ay(this._pbf,e,this.extent,this._keys,this._values)};var Gw=Wv;function Ww(o,e,s){if(o===3){var c=new Gw(s,s.readVarint()+s.pos);c.length&&(e[c.name]=c)}}var ky=th.VectorTile=function(o,e){this.layers=o.readFields(Ww,{},e)},ju=th.VectorTileFeature=Sy;function mm(o,e,s,c){let f=[],g=c===0?(v,E,I,A,L,j)=>{v.push(new It(j,I+(j-E)/(A-E)*(L-I)))}:(v,E,I,A,L,j)=>{v.push(new It(E+(j-I)/(L-I)*(A-E),j))};for(let v of o){let E=[];for(let I of v){if(I.length<=2)continue;let A=[];for(let $=0;$<I.length-1;$++){let W=I[$].x,q=I[$].y,ee=I[$+1].x,ae=I[$+1].y,me=c===0?W:q,we=c===0?ee:ae;me<e?we>e&&g(A,W,q,ee,ae,e):me>s?we<s&&g(A,W,q,ee,ae,s):A.push(I[$]),we<e&&me>=e&&g(A,W,q,ee,ae,e),we>s&&me<=s&&g(A,W,q,ee,ae,s)}let L=I[I.length-1],j=c===0?L.x:L.y;j>=e&&j<=s&&A.push(L),A.length&&(L=A[A.length-1],A[0].x===L.x&&A[0].y===L.y||A.push(A[0]),E.push(A))}E.length&&f.push(E)}return f}th.VectorTileLayer=Wv;let qw=ju.types,Zw=Math.pow(2,13);function P(o,e,s,c,f,g,v,E){o.emplaceBack((e<<1)+v,(s<<1)+g,(Math.floor(c*Zw)<<1)+f,Math.round(E))}function u(o,e,s){o.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class p{constructor(){this.acc=new It(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new It(e.x,e.y),this.max=new It(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);let c=this.min,f=this.max;e.x<c.x?c.x=e.x:e.x>f.x&&(f.x=e.x),e.y<c.y?c.y=e.y:e.y>f.y&&(f.y=e.y),((e.x===0||e.x===Gt)&&e.x===s.x)!=((e.y===0||e.y===Gt)&&e.y===s.y)&&this.processBorderOverlap(e,s),s.x<0!=e.x<0&&this.addBorderIntersection(0,Pn(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>Gt!=e.x>Gt&&this.addBorderIntersection(1,Pn(s.y,e.y,(Gt-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,Pn(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>Gt!=e.y>Gt&&this.addBorderIntersection(3,Pn(s.x,e.x,(Gt-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let c=this.borders[e];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;let c=e.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,e.y)}else{let c=e.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,e.x)}}centroid(){let e=this.polyCount.reduce((s,c)=>s+c.edges,0);return e!==0?this.acc.div(e)._round():new It(0,0)}span(){return new It(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class y{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new it,this.centroidVertexArray=new ta,this.indexArray=new jt,this.programConfigurations=new es(e.layers,e.zoom),this.segments=new $i,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,c,f){this.features=[],this.hasPattern=pm("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){let v=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*v/(v*v+1)/Gt/(1<<g.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:g,id:v,index:E,sourceLayerIndex:I}of e){let A=this.layers[0]._featureFilter.needGeometry,L=Ms(g,A);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),L,c))continue;let j={id:v,sourceLayerIndex:I,index:E,geometry:A?L.geometry:sa(g,c,f),properties:g.properties,type:g.type,patterns:{}},$=this.layoutVertexArray.length;this.hasPattern?this.features.push(Iy("fill-extrusion",this.layers,j,this.zoom,s)):this.addFeature(j,j.geometry,E,c,{},s.availableImages,f),s.featureIndex.insert(g,j.geometry,E,I,this.index,$)}this.sortBorders()}addFeatures(e,s,c,f,g){for(let v of this.features){let{geometry:E}=v;this.addFeature(v,E,v.index,s,c,f,g)}this.sortBorders()}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Gv.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Bw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,f,g,v,E){let I=[new It(0,0),new It(Gt,Gt)],A=E.projection,L=A.name==="globe",j=this.enableTerrain&&!L?new p:null,$=qw[e.type]==="Polygon";L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gt);let W=My(s,500);for(let me=W.length-1;me>=0;me--){let we=W[me];(we.length===0||(q=we[0]).every(ge=>ge.x<=0)||q.every(ge=>ge.x>=Gt)||q.every(ge=>ge.y<=0)||q.every(ge=>ge.y>=Gt))&&W.splice(me,1)}var q;let ee;if(L)ee=N(W,I,f);else{ee=[];for(let me of W)ee.push({polygon:me,bounds:I})}let ae=$?this.edgeRadius:0;for(let{polygon:me,bounds:we}of ee){let ge=0,xe=0;for(let Ce of me)$&&!Ce[0].equals(Ce[Ce.length-1])&&Ce.push(Ce[0]),xe+=$?Ce.length-1:Ce.length;let Te=this.segments.prepareSegment(($?5:4)*xe,this.layoutVertexArray,this.indexArray);if($){let Ce=[],qe=[];ge=Te.vertexLength;for(let et of me){let vt,Ke;et.length&&et!==me[0]&&qe.push(Ce.length/2),vt=et[1].sub(et[0])._perp()._unit();for(let ot=1;ot<et.length;ot++){let st=et[ot],dt=et[ot===et.length-1?1:ot+1],{x:xt,y:Qe}=st;if(ae){Ke=dt.sub(st)._perp()._unit();let At=vt.add(Ke)._unit(),Nt=ae*Math.min(4,1/(vt.x*At.x+vt.y*At.y));xt+=Nt*At.x,Qe+=Nt*At.y,vt=Ke}P(this.layoutVertexArray,xt,Qe,0,0,1,1,0),Te.vertexLength++,Ce.push(st.x,st.y),L&&u(this.layoutVertexExtArray,A.projectTilePoint(xt,Qe,f),A.upVector(f,xt,Qe))}}let We=Ty(Ce,qe);for(let et=0;et<We.length;et+=3)this.indexArray.emplaceBack(ge+We[et],ge+We[et+2],ge+We[et+1]),Te.primitiveLength++}for(let Ce of me){j&&Ce.length&&j.startRing(Ce[0]);let qe,We,et,vt=Ce.length>4&&S(Ce[Ce.length-2],Ce[0],Ce[1]),Ke=ae?w(Ce[Ce.length-2],Ce[0],Ce[1],ae):0;We=Ce[1].sub(Ce[0])._perp()._unit();let ot=!0;for(let st=1,dt=0;st<Ce.length;st++){let xt=Ce[st-1],Qe=Ce[st],At=Ce[st===Ce.length-1?1:st+1];if(j&&$&&j.currentPolyCount.top++,M(Qe,xt,we)){ae&&(We=At.sub(Qe)._perp()._unit(),ot=!ot);continue}j&&j.append(Qe,xt);let Nt=Qe.sub(xt)._perp(),Pt=Nt.x/(Math.abs(Nt.x)+Math.abs(Nt.y)),hn=Nt.y>0?1:0,Et=xt.dist(Qe);if(dt+Et>32768&&(dt=0),ae){et=At.sub(Qe)._perp()._unit();let pn=T(xt,Qe,At,b(We,et),ae);isNaN(pn)&&(pn=0);let Jt=Qe.sub(xt)._unit();xt=xt.add(Jt.mult(Ke))._round(),Qe=Qe.add(Jt.mult(-pn))._round(),Ke=pn,We=et}let qt=Te.vertexLength,fn=Ce.length>4&&S(xt,Qe,At),ti=O(dt,vt,ot);if(P(this.layoutVertexArray,xt.x,xt.y,Pt,hn,0,0,ti),P(this.layoutVertexArray,xt.x,xt.y,Pt,hn,0,1,ti),dt+=Et,ti=O(dt,fn,!ot),vt=fn,P(this.layoutVertexArray,Qe.x,Qe.y,Pt,hn,0,0,ti),P(this.layoutVertexArray,Qe.x,Qe.y,Pt,hn,0,1,ti),Te.vertexLength+=4,this.indexArray.emplaceBack(qt+0,qt+1,qt+2),this.indexArray.emplaceBack(qt+1,qt+3,qt+2),Te.primitiveLength+=2,ae){let pn=ge+(st===1?Ce.length-2:st-2),Jt=st===1?ge:pn+1;if(this.indexArray.emplaceBack(qt+1,pn,qt+3),this.indexArray.emplaceBack(pn,Jt,qt+3),Te.primitiveLength+=2,qe===void 0&&(qe=qt),!M(At,Ce[st],we)){let Oi=st===Ce.length-1?qe:Te.vertexLength;this.indexArray.emplaceBack(qt+2,qt+3,Oi),this.indexArray.emplaceBack(qt+3,Oi+1,Oi),this.indexArray.emplaceBack(qt+3,Jt,Oi+1),Te.primitiveLength+=3}ot=!ot}if(L){let pn=this.layoutVertexExtArray,Jt=A.projectTilePoint(xt.x,xt.y,f),Oi=A.projectTilePoint(Qe.x,Qe.y,f),yn=A.upVector(f,xt.x,xt.y),_n=A.upVector(f,Qe.x,Qe.y);u(pn,Jt,yn),u(pn,Jt,yn),u(pn,Oi,_n),u(pn,Oi,_n)}}$&&(ge+=Ce.length-1)}}if(j&&j.polyCount.length>0){if(j.borders){j.vertexArrayOffset=this.centroidVertexArray.length;let me=j.borders,we=this.featuresOnBorder.push(j)-1;for(let ge=0;ge<4;ge++)me[ge][0]!==Number.MAX_VALUE&&this.borders[ge].push(we)}this.encodeCentroid(j.borders?void 0:j.centroid(),j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,v,f)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,c)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}encodeCentroid(e,s,c=!0){let f,g;if(e)if(e.y!==0){let E=s.span()._mult(this.tileToMeter);f=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(E.x/10)),g=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(E.y/10))}else f=Math.ceil(7*(e.x+450)),g=0;else f=0,g=+c;let v=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(let E of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*E.edges+E.top);for(let I=0;I<E.top;I++)this.centroidVertexArray.emplace(v++,f,g);for(let I=0;I<2*E.edges;I++)this.centroidVertexArray.emplace(v++,0,g),this.centroidVertexArray.emplace(v++,f,g)}}}function b(o,e){let s=o.add(e)._unit();return o.x*s.x+o.y*s.y}function w(o,e,s,c){let f=e.sub(o)._perp()._unit(),g=s.sub(e)._perp()._unit();return T(o,e,s,b(f,g),c)}function T(o,e,s,c,f){let g=Math.sqrt(1-c*c);return Math.min(o.dist(e)/3,e.dist(s)/3,f*g/c)}function M(o,e,s){return o.x<s[0].x&&e.x<s[0].x||o.x>s[1].x&&e.x>s[1].x||o.y<s[0].y&&e.y<s[0].y||o.y>s[1].y&&e.y>s[1].y}function S(o,e,s){if(o.x<0||o.x>=Gt||e.x<0||e.x>=Gt||s.x<0||s.x>=Gt)return!1;let c=s.sub(e),f=c.perp(),g=o.sub(e);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&f.x*g.x+f.y*g.y<0}function O(o,e,s){let c=e?2|o:-3&o;return s?1|c:-2&c}function B(){let o=Math.PI/32,e=Math.tan(o),s=Ou;return s*Math.sqrt(1+2*e*e)-s}function N(o,e,s){let c=1<<s.z,f=rs(s.x/c),g=rs((s.x+1)/c),v=Gr(s.y/c),E=Gr((s.y+1)/c);return function(I,A,L,j,$=0,W){let q=[];if(!I.length||!L||!j)return q;let ee=(Ce,qe)=>{for(let We of Ce)q.push({polygon:We,bounds:qe})},ae=Math.ceil(Math.log2(L)),me=Math.ceil(Math.log2(j)),we=ae-me,ge=[];for(let Ce=0;Ce<Math.abs(we);Ce++)ge.push(we>0?0:1);for(let Ce=0;Ce<Math.min(ae,me);Ce++)ge.push(0),ge.push(1);let xe=I;if(xe=mm(xe,A[0].y-$,A[1].y+$,1),xe=mm(xe,A[0].x-$,A[1].x+$,0),!xe.length)return q;let Te=[];for(ge.length?Te.push({polygons:xe,bounds:A,depth:0}):ee(xe,A);Te.length;){let Ce=Te.pop(),qe=Ce.depth,We=ge[qe],et=Ce.bounds[0],vt=Ce.bounds[1],Ke=We===0?et.x:et.y,ot=We===0?vt.x:vt.y,st=W?W(We,Ke,ot):.5*(Ke+ot),dt=mm(Ce.polygons,Ke-$,st+$,We),xt=mm(Ce.polygons,st-$,ot+$,We);if(dt.length){let Qe=[et,new It(We===0?st:vt.x,We===1?st:vt.y)];ge.length>qe+1?Te.push({polygons:dt,bounds:Qe,depth:qe+1}):ee(dt,Qe)}if(xt.length){let Qe=[new It(We===0?st:et.x,We===1?st:et.y),vt];ge.length>qe+1?Te.push({polygons:xt,bounds:Qe,depth:qe+1}):ee(xt,Qe)}}return q}(o,e,Math.ceil((g-f)/11.25),Math.ceil((v-E)/11.25),1,(I,A,L)=>{if(I===0)return .5*(A+L);{let j=Gr((s.y+A/Gt)/c);return(Pa(.5*(Gr((s.y+L/Gt)/c)+j))*c-s.y)*Gt}})}Ot(y,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(p,"PartMetadata");let U=new _e({"fill-extrusion-edge-radius":new Q(Je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var X={paint:new _e({"fill-extrusion-opacity":new Q(Je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ue(Je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Q(Je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Q(Je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ue(Je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ue(Je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ue(Je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Q(Je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Q(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Q(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Q(Je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:U};function Z(o,e,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class te{constructor(e,s,c){this.z=e,this.x=s,this.y=c,this.key=ce(0,e,e,s,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){let c=function(g,v,E){var I=Z(256*g,256*(v=Math.pow(2,E)-v-1),E),A=Z(256*(g+1),256*(v+1),E);return I[0]+","+I[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),f=function(g,v,E){let I,A="";for(let L=g;L>0;L--)I=1<<L-1,A+=(v&I?1:0)+(E&I?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ne{constructor(e,s){this.wrap=e,this.canonical=s,this.key=ce(e,s.z,s.z,s.x,s.y)}}class J{constructor(e,s,c,f,g){this.overscaledZ=e,this.wrap=s,this.canonical=new te(c,+f,+g),this.key=s===0&&e===c?this.canonical.key:ce(s,e,c,f,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let s=this.canonical.z-e;return e>this.canonical.z?new J(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new J(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return ce(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{let c=this.canonical.z-e;return ce(this.wrap*+s,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new J(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new J(s,this.wrap,s,c,f),new J(s,this.wrap,s,c+1,f),new J(s,this.wrap,s,c,f+1),new J(s,this.wrap,s,c+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new J(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new J(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ne(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ce(o,e,s,c,f){let g=1<<Math.min(s,22),v=g*(f%g)+c%g;return o&&s<22&&(v+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*v+s)+(e-s)}Ot(te,"CanonicalTileID"),Ot(J,"OverscaledTileID",{omit:["projMatrix"]});class de extends It{constructor(e,s,c){super(e,s),this.z=c}}function Ae(o,e){return o.x*e.x+o.y*e.y}function Ue(o,e){if(o.length===1){let s=0,c=e[s++],f;for(;!f||c.equals(f);)if(f=e[s++],!f)return 1/0;for(;s<e.length;s++){let g=e[s],v=o[0],E=f.sub(c),I=g.sub(c),A=v.sub(c),L=Ae(E,E),j=Ae(E,I),$=Ae(I,I),W=Ae(A,E),q=Ae(A,I),ee=L*$-j*j,ae=($*W-j*q)/ee,me=(L*q-j*W)/ee,we=c.z*(1-ae-me)+f.z*ae+g.z*me;if(isFinite(we))return we}return 1/0}{let s=1/0;for(let c of e)s=Math.min(s,c.z);return s}}function Le(o,e,s,c,f,g,v,E){let I=v*f.getElevationAt(o,e,!0,!0),A=g[0]!==0,L=A?g[1]===0?v*(g[0]/7-450):v*function(j,$,W){let q=Math.floor($[0]/8),ee=Math.floor($[1]/8),ae=10*($[0]-8*q),me=10*($[1]-8*ee),we=j.getElevationAt(q,ee,!0,!0),ge=j.getMeterToDEM(W),xe=Math.floor(.5*(ae*ge-1)),Te=Math.floor(.5*(me*ge-1)),Ce=j.tileCoordToPixel(q,ee),qe=2*xe+1,We=2*Te+1,et=function(xt,Qe,At,Nt,Pt){return[xt.getElevationAtPixel(Qe,At,!0),xt.getElevationAtPixel(Qe+Pt,At,!0),xt.getElevationAtPixel(Qe,At+Pt,!0),xt.getElevationAtPixel(Qe+Nt,At+Pt,!0)]}(j,Ce.x-xe,Ce.y-Te,qe,We),vt=Math.abs(et[0]-et[1]),Ke=Math.abs(et[2]-et[3]),ot=Math.abs(et[0]-et[2])+Math.abs(et[1]-et[3]),st=Math.min(.25,.5*ge*(vt+Ke)/qe),dt=Math.min(.25,.5*ge*ot/We);return we+Math.max(st*ae,dt*me)}(f,g,E):I;return{base:I+(s===0)?-1:s,top:A?Math.max(L+c,I+s+2):I+c}}let Ie=Fe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ze}=Ie,nt=Fe([{name:"a_packed",components:4,type:"Float32"}]),{members:rt}=nt,ft=ju.types,Bt=Math.cos(Math.PI/180*37.5);class Lt{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Ze,this.layoutVertexArray2=new ut,this.indexArray=new jt,this.programConfigurations=new es(e.layers,e.zoom),this.segments=new $i,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){this.hasPattern=pm("line",this.layers,s);let g=this.layers[0].layout.get("line-sort-key"),v=[];for(let{feature:L,id:j,index:$,sourceLayerIndex:W}of e){let q=this.layers[0]._featureFilter.needGeometry,ee=Ms(L,q);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),ee,c))continue;let ae=g?g.evaluate(ee,{},c):void 0,me={id:j,properties:L.properties,type:L.type,sourceLayerIndex:W,index:$,geometry:q?ee.geometry:sa(L,c,f),patterns:{},sortKey:ae};v.push(me)}g&&v.sort((L,j)=>L.sortKey-j.sortKey);let{lineAtlas:E,featureIndex:I}=s,A=this.addConstantDashes(E);for(let L of v){let{geometry:j,index:$,sourceLayerIndex:W}=L;if(A&&this.addFeatureDashes(L,E),this.hasPattern){let q=Iy("line",this.layers,L,this.zoom,s);this.patternFeatures.push(q)}else this.addFeature(L,j,$,c,E.positions,s.availableImages);I.insert(e[$].feature,j,$,W,this.index)}}addConstantDashes(e){let s=!1;for(let c of this.layers){let f=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(f.kind!=="constant"||g.kind!=="constant")s=!0;else{let v=g.value,E=f.value;if(!E)continue;e.addDash(E,v)}}return s}addFeatureDashes(e,s){let c=this.zoom;for(let f of this.layers){let g=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if(g.kind==="constant"&&v.kind==="constant")continue;let E,I;if(g.kind==="constant"){if(E=g.value,!E)continue}else E=g.evaluate({zoom:c},e);I=v.kind==="constant"?v.value:v.evaluate({zoom:c},e),s.addDash(E,I),e.patterns[f.id]=s.getKey(E,I)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}addFeatures(e,s,c,f,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,rt)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ze),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,c,f,g,v){let E=this.layers[0].layout,I=E.get("line-join").evaluate(e,{}),A=E.get("line-cap").evaluate(e,{}),L=E.get("line-miter-limit"),j=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let $ of s)this.addLine($,e,I,A,L,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,g,v,f)}addLine(e,s,c,f,g,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<e.length-1;me++)this.totalDistance+=e[me].dist(e[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let E=ft[s.type]==="Polygon",I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let A=0;for(;A<I-1&&e[A].equals(e[A+1]);)A++;if(I<(E?3:2))return;c==="bevel"&&(g=1.05);let L=this.overscaling<=16?15*Gt/(512*this.overscaling):0,j=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),$,W,q,ee,ae;this.e1=this.e2=-1,E&&($=e[I-2],ae=e[A].sub($)._unit()._perp());for(let me=A;me<I;me++){if(q=me===I-1?E?e[A+1]:void 0:e[me+1],q&&e[me].equals(q))continue;ae&&(ee=ae),$&&(W=$),$=e[me],ae=q?q.sub($)._unit()._perp():ee,ee=ee||ae;let we=ee.add(ae);we.x===0&&we.y===0||we._unit();let ge=ee.x*ae.x+ee.y*ae.y,xe=we.x*ae.x+we.y*ae.y,Te=xe!==0?1/xe:1/0,Ce=2*Math.sqrt(2-2*xe),qe=xe<Bt&&W&&q,We=ee.x*ae.y-ee.y*ae.x>0;if(qe&&me>A){let Ke=$.dist(W);if(Ke>2*L){let ot=$.sub($.sub(W)._mult(L/Ke)._round());this.updateDistance(W,ot),this.addCurrentVertex(ot,ee,0,0,j),W=ot}}let et=W&&q,vt=et?c:E?"butt":f;if(et&&vt==="round"&&(Te<v?vt="miter":Te<=2&&(vt="fakeround")),vt==="miter"&&Te>g&&(vt="bevel"),vt==="bevel"&&(Te>2&&(vt="flipbevel"),Te<g&&(vt="miter")),W&&this.updateDistance(W,$),vt==="miter")we._mult(Te),this.addCurrentVertex($,we,0,0,j);else if(vt==="flipbevel"){if(Te>100)we=ae.mult(-1);else{let Ke=Te*ee.add(ae).mag()/ee.sub(ae).mag();we._perp()._mult(Ke*(We?-1:1))}this.addCurrentVertex($,we,0,0,j),this.addCurrentVertex($,we.mult(-1),0,0,j)}else if(vt==="bevel"||vt==="fakeround"){let Ke=-Math.sqrt(Te*Te-1),ot=We?Ke:0,st=We?0:Ke;if(W&&this.addCurrentVertex($,ee,ot,st,j),vt==="fakeround"){let dt=Math.round(180*Ce/Math.PI/20);for(let xt=1;xt<dt;xt++){let Qe=xt/dt;if(Qe!==.5){let Nt=Qe-.5;Qe+=Qe*Nt*(Qe-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Nt*Nt+(.848013+ge*(.215638*ge-1.06021)))}let At=ae.sub(ee)._mult(Qe)._add(ee)._unit()._mult(We?-1:1);this.addHalfVertex($,At.x,At.y,!1,We,0,j)}}q&&this.addCurrentVertex($,ae,-ot,-st,j)}else if(vt==="butt")this.addCurrentVertex($,we,0,0,j);else if(vt==="square"){let Ke=W?1:-1;W||this.addCurrentVertex($,we,Ke,Ke,j),this.addCurrentVertex($,we,0,0,j),W&&this.addCurrentVertex($,we,Ke,Ke,j)}else vt==="round"&&(W&&(this.addCurrentVertex($,ee,0,0,j),this.addCurrentVertex($,ee,1,1,j,!0)),q&&(this.addCurrentVertex($,ae,-1,-1,j,!0),this.addCurrentVertex($,ae,0,0,j)));if(qe&&me<I-1){let Ke=$.dist(q);if(Ke>2*L){let ot=$.add(q.sub($)._mult(L/Ke)._round());this.updateDistance($,ot),this.addCurrentVertex(ot,ae,0,0,j),$=ot}}}}addCurrentVertex(e,s,c,f,g,v=!1){let E=s.y*f-s.x,I=-s.y-s.x*f;this.addHalfVertex(e,s.x+s.y*c,s.y-s.x*c,v,!1,c,g),this.addHalfVertex(e,E,I,v,!0,-f,g)}addHalfVertex({x:e,y:s},c,f,g,v,E,I){this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(s<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(E===0?0:E<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let A=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),I.primitiveLength++),v?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Ot(Lt,"LineBucket",{omit:["layers","patternFeatures"]});let Vt=new _e({"line-cap":new ue(Je.layout_line["line-cap"]),"line-join":new ue(Je.layout_line["line-join"]),"line-miter-limit":new Q(Je.layout_line["line-miter-limit"]),"line-round-limit":new Q(Je.layout_line["line-round-limit"]),"line-sort-key":new ue(Je.layout_line["line-sort-key"])});var Yt={paint:new _e({"line-opacity":new ue(Je.paint_line["line-opacity"]),"line-color":new ue(Je.paint_line["line-color"]),"line-translate":new Q(Je.paint_line["line-translate"]),"line-translate-anchor":new Q(Je.paint_line["line-translate-anchor"]),"line-width":new ue(Je.paint_line["line-width"]),"line-gap-width":new ue(Je.paint_line["line-gap-width"]),"line-offset":new ue(Je.paint_line["line-offset"]),"line-blur":new ue(Je.paint_line["line-blur"]),"line-dasharray":new ue(Je.paint_line["line-dasharray"]),"line-pattern":new ue(Je.paint_line["line-pattern"]),"line-gradient":new ye(Je.paint_line["line-gradient"]),"line-trim-offset":new Q(Je.paint_line["line-trim-offset"])}),layout:Vt};let zt=new class extends ue{possiblyEvaluate(o,e){return e=new z(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(o,e)}evaluate(o,e,s,c){return e=Fi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(o,e,s,c)}}(Yt.paint.properties["line-width"].specification);function Tn(o,e){return e>0?e+2*o:o}zt.useIntegerZoom=!0;let un=Fe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dn=Fe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Hn=Fe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let sn=Fe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mr=Fe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Fe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Gi=Fe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Yn=Fe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Fe([{name:"triangle",components:3,type:"Uint16"}]),Fe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Fe([{type:"Float32",name:"offsetX"}]),Fe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Mn=24;let xi=128;function Ni(o,e){let{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new z(o+1))};if(s.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:f}=s,g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let v=g;for(;v<c.length&&c[v]<o+1;)v++;v=Math.min(c.length-1,v);let E=c[g],I=c[v];return s.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:I,interpolationType:f}:{kind:"camera",minZoom:E,maxZoom:I,minSize:s.evaluate(new z(E)),maxSize:s.evaluate(new z(I)),interpolationType:f}}}function kr(o,{uSize:e,uSizeT:s},{lowerSize:c,upperSize:f}){return o.kind==="source"?c/xi:o.kind==="composite"?Pn(c/xi,f/xi,s):e}function Wi(o,e){let s=0,c=0;if(o.kind==="constant")c=o.layoutSize;else if(o.kind!=="source"){let{interpolationType:f,minZoom:g,maxZoom:v}=o,E=f?Cn(Jr.interpolationFactor(f,e,g,v),0,1):0;o.kind==="camera"?c=Pn(o.minSize,o.maxSize,E):s=E}return{uSizeT:s,uSize:c}}var To=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xi,evaluateSizeForFeature:kr,evaluateSizeForZoom:Wi,getSizeData:Ni});function La(o,e,s){return o.sections.forEach(c=>{c.text=function(f,g,v){let E=g.layout.get("text-transform").evaluate(v,{});return E==="uppercase"?f=f.toLocaleUpperCase():E==="lowercase"&&(f=f.toLocaleLowerCase()),R.applyArabicShaping&&(f=R.applyArabicShaping(f)),f}(c.text,e,s)}),o}let Is={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Af(o){return o==="\uFE36"||o==="\uFE48"||o==="\uFE38"||o==="\uFE44"||o==="\uFE42"||o==="\uFE3E"||o==="\uFE3C"||o==="\uFE3A"||o==="\uFE18"||o==="\uFE40"||o==="\uFE10"||o==="\uFE13"||o==="\uFE14"||o==="\uFF40"||o==="\uFFE3"||o==="\uFE11"||o==="\uFE12"}function gm(o){return o==="\uFE35"||o==="\uFE47"||o==="\uFE37"||o==="\uFE43"||o==="\uFE41"||o==="\uFE3D"||o==="\uFE3B"||o==="\uFE39"||o==="\uFE17"||o==="\uFE3F"}var Uu=Si,Ry=function(o,e,s,c,f){var g,v,E=8*f-c-1,I=(1<<E)-1,A=I>>1,L=-7,j=s?f-1:0,$=s?-1:1,W=o[e+j];for(j+=$,g=W&(1<<-L)-1,W>>=-L,L+=E;L>0;g=256*g+o[e+j],j+=$,L-=8);for(v=g&(1<<-L)-1,g>>=-L,L+=c;L>0;v=256*v+o[e+j],j+=$,L-=8);if(g===0)g=1-A;else{if(g===I)return v?NaN:1/0*(W?-1:1);v+=Math.pow(2,c),g-=A}return(W?-1:1)*v*Math.pow(2,g-c)},Py=function(o,e,s,c,f,g){var v,E,I,A=8*g-f-1,L=(1<<A)-1,j=L>>1,$=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=c?0:g-1,q=c?1:-1,ee=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(E=isNaN(e)?1:0,v=L):(v=Math.floor(Math.log(e)/Math.LN2),e*(I=Math.pow(2,-v))<1&&(v--,I*=2),(e+=v+j>=1?$/I:$*Math.pow(2,1-j))*I>=2&&(v++,I/=2),v+j>=L?(E=0,v=L):v+j>=1?(E=(e*I-1)*Math.pow(2,f),v+=j):(E=e*Math.pow(2,j-1)*Math.pow(2,f),v=0));f>=8;o[s+W]=255&E,W+=q,E/=256,f-=8);for(v=v<<f|E,A+=f;A>0;o[s+W]=255&v,W+=q,v/=256,A-=8);o[s+W-q]|=128*ee};function Si(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Si.Varint=0,Si.Fixed64=1,Si.Bytes=2,Si.Fixed32=5;var Xw=4294967296,hM=1/Xw,fM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function $u(o){return o.type===Si.Bytes?o.readVarint()+o.pos:o.pos+1}function ym(o,e,s){return s?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function pM(o,e,s){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=o;f--)s.buf[f+c]=s.buf[f]}function AL(o,e){for(var s=0;s<o.length;s++)e.writeVarint(o[s])}function kL(o,e){for(var s=0;s<o.length;s++)e.writeSVarint(o[s])}function RL(o,e){for(var s=0;s<o.length;s++)e.writeFloat(o[s])}function PL(o,e){for(var s=0;s<o.length;s++)e.writeDouble(o[s])}function OL(o,e){for(var s=0;s<o.length;s++)e.writeBoolean(o[s])}function LL(o,e){for(var s=0;s<o.length;s++)e.writeFixed32(o[s])}function FL(o,e){for(var s=0;s<o.length;s++)e.writeSFixed32(o[s])}function NL(o,e){for(var s=0;s<o.length;s++)e.writeFixed64(o[s])}function zL(o,e){for(var s=0;s<o.length;s++)e.writeSFixed64(o[s])}function Zv(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16)+16777216*o[e+3]}function _m(o,e,s){o[s]=e,o[s+1]=e>>>8,o[s+2]=e>>>16,o[s+3]=e>>>24}function mM(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16)+(o[e+3]<<24)}Si.prototype={destroy:function(){this.buf=null},readFields:function(o,e,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,g=this.pos;this.type=7&c,o(f,e,this),this.pos===g&&this.skip(c)}return e},readMessage:function(o,e){return this.readFields(o,e,this.readVarint()+this.pos)},readFixed32:function(){var o=Zv(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=mM(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Zv(this.buf,this.pos)+Zv(this.buf,this.pos+4)*Xw;return this.pos+=8,o},readSFixed64:function(){var o=Zv(this.buf,this.pos)+mM(this.buf,this.pos+4)*Xw;return this.pos+=8,o},readFloat:function(){var o=Ry(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Ry(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var e,s,c=this.buf;return e=127&(s=c[this.pos++]),s<128?e:(e|=(127&(s=c[this.pos++]))<<7,s<128?e:(e|=(127&(s=c[this.pos++]))<<14,s<128?e:(e|=(127&(s=c[this.pos++]))<<21,s<128?e:function(f,g,v){var E,I,A=v.buf;if(E=(112&(I=A[v.pos++]))>>4,I<128||(E|=(127&(I=A[v.pos++]))<<3,I<128)||(E|=(127&(I=A[v.pos++]))<<10,I<128)||(E|=(127&(I=A[v.pos++]))<<17,I<128)||(E|=(127&(I=A[v.pos++]))<<24,I<128)||(E|=(1&(I=A[v.pos++]))<<31,I<128))return ym(f,E,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&fM?function(s,c,f){return fM.decode(s.subarray(c,f))}(this.buf,e,o):function(s,c,f){for(var g="",v=c;v<f;){var E,I,A,L=s[v],j=null,$=L>239?4:L>223?3:L>191?2:1;if(v+$>f)break;$===1?L<128&&(j=L):$===2?(192&(E=s[v+1]))==128&&(j=(31&L)<<6|63&E)<=127&&(j=null):$===3?(I=s[v+2],(192&(E=s[v+1]))==128&&(192&I)==128&&((j=(15&L)<<12|(63&E)<<6|63&I)<=2047||j>=55296&&j<=57343)&&(j=null)):$===4&&(I=s[v+2],A=s[v+3],(192&(E=s[v+1]))==128&&(192&I)==128&&(192&A)==128&&((j=(15&L)<<18|(63&E)<<12|(63&I)<<6|63&A)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,$=1):j>65535&&(j-=65536,g+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),g+=String.fromCharCode(j),v+=$}return g}(this.buf,e,o)},readBytes:function(){var o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e},readPackedVarint:function(o,e){if(this.type!==Si.Bytes)return o.push(this.readVarint(e));var s=$u(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(e));return o},readPackedSVarint:function(o){if(this.type!==Si.Bytes)return o.push(this.readSVarint());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Si.Bytes)return o.push(this.readBoolean());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Si.Bytes)return o.push(this.readFloat());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Si.Bytes)return o.push(this.readDouble());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Si.Bytes)return o.push(this.readFixed32());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Si.Bytes)return o.push(this.readSFixed32());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Si.Bytes)return o.push(this.readFixed64());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Si.Bytes)return o.push(this.readSFixed64());var e=$u(this);for(o=o||[];this.pos<e;)o.push(this.readSFixed64());return o},skip:function(o){var e=7&o;if(e===Si.Varint)for(;this.buf[this.pos++]>127;);else if(e===Si.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Si.Fixed32)this.pos+=4;else{if(e!==Si.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(o,e){this.writeVarint(o<<3|e)},realloc:function(o){for(var e=this.length||16;e<this.pos+o;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),_m(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),_m(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),_m(this.buf,-1&o,this.pos),_m(this.buf,Math.floor(o*hM),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),_m(this.buf,-1&o,this.pos),_m(this.buf,Math.floor(o*hM),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(e,s){var c,f;if(e>=0?(c=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,f=f+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,v,E){E.buf[E.pos++]=127&g|128,g>>>=7,E.buf[E.pos++]=127&g|128,g>>>=7,E.buf[E.pos++]=127&g|128,g>>>=7,E.buf[E.pos++]=127&g|128,E.buf[E.pos]=127&(g>>>=7)}(c,0,s),function(g,v){var E=(7&g)<<4;v.buf[v.pos++]|=E|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(f,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var e=this.pos;this.pos=function(c,f,g){for(var v,E,I=0;I<f.length;I++){if((v=f.charCodeAt(I))>55295&&v<57344){if(!E){v>56319||I+1===f.length?(c[g++]=239,c[g++]=191,c[g++]=189):E=v;continue}if(v<56320){c[g++]=239,c[g++]=191,c[g++]=189,E=v;continue}v=E-55296<<10|v-56320|65536,E=null}else E&&(c[g++]=239,c[g++]=191,c[g++]=189,E=null);v<128?c[g++]=v:(v<2048?c[g++]=v>>6|192:(v<65536?c[g++]=v>>12|224:(c[g++]=v>>18|240,c[g++]=v>>12&63|128),c[g++]=v>>6&63|128),c[g++]=63&v|128)}return g}(this.buf,o,this.pos);var s=this.pos-e;s>=128&&pM(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Py(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Py(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var e=o.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,e){this.pos++;var s=this.pos;o(e,this);var c=this.pos-s;c>=128&&pM(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,e,s){this.writeTag(o,Si.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(o,e){e.length&&this.writeMessage(o,AL,e)},writePackedSVarint:function(o,e){e.length&&this.writeMessage(o,kL,e)},writePackedBoolean:function(o,e){e.length&&this.writeMessage(o,OL,e)},writePackedFloat:function(o,e){e.length&&this.writeMessage(o,RL,e)},writePackedDouble:function(o,e){e.length&&this.writeMessage(o,PL,e)},writePackedFixed32:function(o,e){e.length&&this.writeMessage(o,LL,e)},writePackedSFixed32:function(o,e){e.length&&this.writeMessage(o,FL,e)},writePackedFixed64:function(o,e){e.length&&this.writeMessage(o,NL,e)},writePackedSFixed64:function(o,e){e.length&&this.writeMessage(o,zL,e)},writeBytesField:function(o,e){this.writeTag(o,Si.Bytes),this.writeBytes(e)},writeFixed32Field:function(o,e){this.writeTag(o,Si.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(o,e){this.writeTag(o,Si.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(o,e){this.writeTag(o,Si.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(o,e){this.writeTag(o,Si.Fixed64),this.writeSFixed64(e)},writeVarintField:function(o,e){this.writeTag(o,Si.Varint),this.writeVarint(e)},writeSVarintField:function(o,e){this.writeTag(o,Si.Varint),this.writeSVarint(e)},writeStringField:function(o,e){this.writeTag(o,Si.Bytes),this.writeString(e)},writeFloatField:function(o,e){this.writeTag(o,Si.Fixed32),this.writeFloat(e)},writeDoubleField:function(o,e){this.writeTag(o,Si.Fixed64),this.writeDouble(e)},writeBooleanField:function(o,e){this.writeVarintField(o,!!e)}};var Xv=Qt(Uu);let Yw=3;function BL(o,e,s){e.glyphs=[],o===1&&s.readMessage(VL,e)}function VL(o,e,s){if(o===3){let{id:c,bitmap:f,width:g,height:v,left:E,top:I,advance:A}=s.readMessage(jL,{});e.glyphs.push({id:c,bitmap:new Ol({width:g+2*Yw,height:v+2*Yw},f),metrics:{width:g,height:v,left:E,top:I,advance:A}})}else o===4?e.ascender=s.readSVarint():o===5&&(e.descender=s.readSVarint())}function jL(o,e,s){o===1?e.id=s.readVarint():o===2?e.bitmap=s.readBytes():o===3?e.width=s.readVarint():o===4?e.height=s.readVarint():o===5?e.left=s.readSVarint():o===6?e.top=s.readSVarint():o===7&&(e.advance=s.readVarint())}let gM=Yw;function Kw(o){let e=0,s=0;for(let v of o)e+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,E)=>E.h-v.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}],f=0,g=0;for(let v of o)for(let E=c.length-1;E>=0;E--){let I=c[E];if(!(v.w>I.w||v.h>I.h)){if(v.x=I.x,v.y=I.y,g=Math.max(g,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===I.w&&v.h===I.h){let A=c.pop();E<c.length&&(c[E]=A)}else v.h===I.h?(I.x+=v.w,I.w-=v.w):v.w===I.w?(I.y+=v.h,I.h-=v.h):(c.push({x:I.x+v.w,y:I.y,w:I.w-v.w,h:v.h}),I.y+=v.h,I.h-=v.h);break}}return{w:f,h:g,fill:e/(f*g)||0}}let os=1;class Qw{constructor(e,{pixelRatio:s,version:c,stretchX:f,stretchY:g,content:v}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=f,this.stretchY=g,this.content=v,this.version=c}get tl(){return[this.paddedRect.x+os,this.paddedRect.y+os]}get br(){return[this.paddedRect.x+this.paddedRect.w-os,this.paddedRect.y+this.paddedRect.h-os]}get displaySize(){return[(this.paddedRect.w-2*os)/this.pixelRatio,(this.paddedRect.h-2*os)/this.pixelRatio]}}class yM{constructor(e,s){let c={},f={};this.haveRenderCallbacks=[];let g=[];this.addImages(e,c,g),this.addImages(s,f,g);let{w:v,h:E}=Kw(g),I=new to({width:v||1,height:E||1});for(let A in e){let L=e[A],j=c[A].paddedRect;to.copy(L.data,I,{x:0,y:0},{x:j.x+os,y:j.y+os},L.data)}for(let A in s){let L=s[A],j=f[A].paddedRect,$=j.x+os,W=j.y+os,q=L.data.width,ee=L.data.height;to.copy(L.data,I,{x:0,y:0},{x:$,y:W},L.data),to.copy(L.data,I,{x:0,y:ee-1},{x:$,y:W-1},{width:q,height:1}),to.copy(L.data,I,{x:0,y:0},{x:$,y:W+ee},{width:q,height:1}),to.copy(L.data,I,{x:q-1,y:0},{x:$-1,y:W},{width:1,height:ee}),to.copy(L.data,I,{x:0,y:0},{x:$+q,y:W},{width:1,height:ee})}this.image=I,this.iconPositions=c,this.patternPositions=f}addImages(e,s,c){for(let f in e){let g=e[f],v={x:0,y:0,w:g.data.width+2*os,h:g.data.height+2*os};c.push(v),s[f]=new Qw(v,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),s)}patchUpdatedImage(e,s,c){if(!e||!s||e.version===s.version)return;e.version=s.version;let[f,g]=e.tl;c.update(s.data,void 0,{x:f,y:g})}}Ot(Qw,"ImagePosition"),Ot(yM,"ImageAtlas");let aa={horizontal:1,vertical:2,horizontalOnly:3},_M=-17;class Oy{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){let c=new Oy;return c.scale=e||1,c.fontStack=s,c}static forImage(e){let s=new Oy;return s.imageName=e,s}}class vm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){let c=new vm;for(let f=0;f<e.sections.length;f++){let g=e.sections[f];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,c){let f="";for(let g=0;g<s.length;g++){let v=s.charCodeAt(g+1)||null,E=s.charCodeAt(g-1)||null;f+=!c&&(v&&Np(v)&&!Is[s[g+1]]||E&&Np(E)&&!Is[s[g-1]])||!Is[s[g]]?s[g]:Is[s[g]]}return f}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&Yv[this.text.charCodeAt(c)];c++)e++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&Yv[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){let c=new vm;return c.text=this.text.substring(e,s),c.sectionIndex=this.sectionIndex.slice(e,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Oy.forText(e.scale,e.fontStack||s));let c=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(c)}addImageSection(e){let s=e.image?e.image.name:"";if(s.length===0)return void _i("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Oy.forImage(s)),this.sectionIndex.push(this.sections.length-1)):_i("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jw(o,e,s,c,f,g,v,E,I,A,L,j,$,W,q){let ee=vm.fromFeature(o,f);j===aa.vertical&&ee.verticalizePunctuation($);let ae=[],me=function(Ce,qe,We,et,vt,Ke){if(!Ce)return[];let ot=[],st=function(At,Nt,Pt,hn,Et,qt){let fn=0;for(let ti=0;ti<At.length();ti++){let pn=At.getSection(ti);fn+=vM(At.getCharCode(ti),pn,hn,Et,Nt,qt)}return fn/Math.max(1,Math.ceil(fn/Pt))}(Ce,qe,We,et,vt,Ke),dt=Ce.text.indexOf("\u200B")>=0,xt=0;for(let At=0;At<Ce.length();At++){let Nt=Ce.getSection(At),Pt=Ce.getCharCode(At);if(Yv[Pt]||(xt+=vM(Pt,Nt,et,vt,qe,Ke)),At<Ce.length()-1){let hn=!((Qe=Pt)<11904||!(St["Bopomofo Extended"](Qe)||St.Bopomofo(Qe)||St["CJK Compatibility Forms"](Qe)||St["CJK Compatibility Ideographs"](Qe)||St["CJK Compatibility"](Qe)||St["CJK Radicals Supplement"](Qe)||St["CJK Strokes"](Qe)||St["CJK Symbols and Punctuation"](Qe)||St["CJK Unified Ideographs Extension A"](Qe)||St["CJK Unified Ideographs"](Qe)||St["Enclosed CJK Letters and Months"](Qe)||St["Halfwidth and Fullwidth Forms"](Qe)||St.Hiragana(Qe)||St["Ideographic Description Characters"](Qe)||St["Kangxi Radicals"](Qe)||St["Katakana Phonetic Extensions"](Qe)||St.Katakana(Qe)||St["Vertical Forms"](Qe)||St["Yi Radicals"](Qe)||St["Yi Syllables"](Qe)));(UL[Pt]||hn||Nt.imageName)&&ot.push(xM(At+1,xt,st,ot,$L(Pt,Ce.getCharCode(At+1),hn&&dt),!1))}}var Qe;return wM(xM(Ce.length(),xt,st,ot,0,!0))}(ee,A,g,e,c,W),{processBidirectionalText:we,processStyledBidirectionalText:ge}=R;if(we&&ee.sections.length===1){let Ce=we(ee.toString(),me);for(let qe of Ce){let We=new vm;We.text=qe,We.sections=ee.sections;for(let et=0;et<qe.length;et++)We.sectionIndex.push(0);ae.push(We)}}else if(ge){let Ce=ge(ee.text,ee.sectionIndex,me);for(let qe of Ce){let We=new vm;We.text=qe[0],We.sectionIndex=qe[1],We.sections=ee.sections,ae.push(We)}}else ae=function(Ce,qe){let We=[],et=Ce.text,vt=0;for(let Ke of qe)We.push(Ce.substring(vt,Ke)),vt=Ke;return vt<et.length&&We.push(Ce.substring(vt,et.length)),We}(ee,me);let xe=[],Te={positionedLines:xe,text:ee.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:j,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ce,qe,We,et,vt,Ke,ot,st,dt,xt,Qe,At){let Nt=0,Pt=0,hn=0,Et=st==="right"?1:st==="left"?0:.5,qt=!1;for(let yn of vt){let _n=yn.getSections();for(let wi of _n){if(wi.imageName)continue;let Ai=qe[wi.fontStack];if(Ai&&(qt=Ai.ascender!==void 0&&Ai.descender!==void 0,!qt))break}if(!qt)break}let fn=0;for(let yn of vt){yn.trim();let _n=yn.getMaxScale(),wi=(_n-1)*Mn,Ai={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[fn]=Ai;let ki=Ai.positionedGlyphs,Ei=0;if(!yn.length()){Pt+=Ke,++fn;continue}let qi=0,cr=0;for(let Ci=0;Ci<yn.length();Ci++){let Rr=yn.getSection(Ci),wr=yn.getSectionIndex(Ci),nr=yn.getCharCode(Ci),ri=Rr.scale,Er=null,Ri=null,No=null,Cr=Mn,no=0,qr=!(dt===aa.horizontal||!Qe&&!nf(nr)||Qe&&(Yv[nr]||(ti=nr,St.Arabic(ti)||St["Arabic Supplement"](ti)||St["Arabic Extended-A"](ti)||St["Arabic Presentation Forms-A"](ti)||St["Arabic Presentation Forms-B"](ti))));if(Rr.imageName){let zo=et[Rr.imageName];if(!zo)continue;No=Rr.imageName,Ce.iconsInText=Ce.iconsInText||!0,Ri=zo.paddedRect;let Zr=zo.displaySize;ri=ri*Mn/At,Er={width:Zr[0],height:Zr[1],left:os,top:-gM,advance:qr?Zr[1]:Zr[0],localGlyph:!1},no=qt?-Er.height*ri:_M+_n*Mn-Zr[1]*ri,Cr=Er.advance;let Nl=(qr?Zr[0]:Zr[1])*ri-Mn*_n;Nl>0&&Nl>Ei&&(Ei=Nl)}else{let zo=We[Rr.fontStack];if(!zo)continue;zo[nr]&&(Ri=zo[nr]);let Zr=qe[Rr.fontStack];if(!Zr)continue;let Nl=Zr.glyphs[nr];if(!Nl)continue;if(Er=Nl.metrics,Cr=nr!==8203?Mn:0,qt){let Tm=Zr.ascender!==void 0?Math.abs(Zr.ascender):0,Hy=Zr.descender!==void 0?Math.abs(Zr.descender):0,Gy=(Tm+Hy)*ri;qi<Gy&&(qi=Gy,cr=(Tm-Hy)/2*ri),no=-Tm*ri}else no=_M+(_n-ri)*Mn}qr?(Ce.verticalizable=!0,ki.push({glyph:nr,imageName:No,x:Nt,y:Pt+no,vertical:qr,scale:ri,localGlyph:Er.localGlyph,fontStack:Rr.fontStack,sectionIndex:wr,metrics:Er,rect:Ri}),Nt+=Cr*ri+xt):(ki.push({glyph:nr,imageName:No,x:Nt,y:Pt+no,vertical:qr,scale:ri,localGlyph:Er.localGlyph,fontStack:Rr.fontStack,sectionIndex:wr,metrics:Er,rect:Ri}),Nt+=Er.advance*ri+xt)}ki.length!==0&&(hn=Math.max(Nt-xt,hn),qt?EM(ki,Et,Ei,cr,Ke*_n/2):EM(ki,Et,Ei,0,Ke/2)),Nt=0;let xr=Ke*_n+Ei;Ai.lineOffset=Math.max(Ei,wi),Pt+=xr,++fn}var ti;let pn=Pt,{horizontalAlign:Jt,verticalAlign:Oi}=e1(ot);(function(yn,_n,wi,Ai,ki,Ei){let qi=(_n-wi)*ki,cr=-Ei*Ai;for(let xr of yn)for(let Ci of xr.positionedGlyphs)Ci.x+=qi,Ci.y+=cr})(Ce.positionedLines,Et,Jt,Oi,hn,pn),Ce.top+=-Oi*pn,Ce.bottom=Ce.top+pn,Ce.left+=-Jt*hn,Ce.right=Ce.left+hn,Ce.hasBaseline=qt}(Te,e,s,c,ae,v,E,I,j,A,$,q),!function(Ce){for(let qe of Ce)if(qe.positionedGlyphs.length!==0)return!1;return!0}(xe)&&Te}let Yv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},UL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vM(o,e,s,c,f,g){if(e.imageName){let v=c[e.imageName];return v?v.displaySize[0]*e.scale*Mn/g+f:0}{let v=s[e.fontStack],E=v&&v.glyphs[o];return E?E.metrics.advance*e.scale+f:0}}function bM(o,e,s,c){let f=Math.pow(o-e,2);return c?o<e?f/2:2*f:f+Math.abs(s)*s}function $L(o,e,s){let c=0;return o===10&&(c-=1e4),s&&(c+=150),o!==40&&o!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function xM(o,e,s,c,f,g){let v=null,E=bM(e,s,f,g);for(let I of c){let A=bM(e-I.x,s,f,g)+I.badness;A<=E&&(v=I,E=A)}return{index:o,x:e,priorBreak:v,badness:E}}function wM(o){return o?wM(o.priorBreak).concat(o.index):[]}function e1(o){let e=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function EM(o,e,s,c,f){if(!(e||s||c||f))return;let g=o.length-1,v=o[g],E=(v.x+v.metrics.advance*v.scale)*e;for(let I=0;I<=g;I++)o[I].x-=E,o[I].y+=s+c+f}function HL(o,e,s){let{horizontalAlign:c,verticalAlign:f}=e1(s),g=e[0]-o.displaySize[0]*c,v=e[1]-o.displaySize[1]*f;return{image:o,top:v,bottom:v+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function CM(o,e,s,c,f,g){let v=o.image,E;if(v.content){let ae=v.content,me=v.pixelRatio||1;E=[ae[0]/me,ae[1]/me,v.displaySize[0]-ae[2]/me,v.displaySize[1]-ae[3]/me]}let I=e.left*g,A=e.right*g,L,j,$,W;s==="width"||s==="both"?(W=f[0]+I-c[3],j=f[0]+A+c[1]):(W=f[0]+(I+A-v.displaySize[0])/2,j=W+v.displaySize[0]);let q=e.top*g,ee=e.bottom*g;return s==="height"||s==="both"?(L=f[1]+q-c[0],$=f[1]+ee+c[2]):(L=f[1]+(q+ee-v.displaySize[1])/2,$=L+v.displaySize[1]),{image:v,top:L,right:j,bottom:$,left:W,collisionPadding:E}}class Hu extends It{constructor(e,s,c,f,g){super(e,s),this.angle=f,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new Hu(this.x,this.y,this.z,this.angle,this.segment)}}function DM(o,e,s,c,f){if(e.segment===void 0)return!0;let g=e,v=e.segment+1,E=0;for(;E>-s/2;){if(v--,v<0)return!1;E-=o[v].dist(g),g=o[v]}E+=o[v].dist(o[v+1]),v++;let I=[],A=0;for(;E<s/2;){let L=o[v],j=o[v+1];if(!j)return!1;let $=o[v-1].angleTo(L)-L.angleTo(j);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:E,angleDelta:$}),A+=$;E-I[0].distance>c;)A-=I.shift().angleDelta;if(A>f)return!1;v++,E+=L.dist(j)}return!0}function TM(o){let e=0;for(let s=0;s<o.length-1;s++)e+=o[s].dist(o[s+1]);return e}function MM(o,e,s){return o?.6*e*s:0}function IM(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function GL(o,e,s,c,f,g){let v=MM(s,f,g),E=IM(s,c)*g,I=0,A=TM(o)/2;for(let L=0;L<o.length-1;L++){let j=o[L],$=o[L+1],W=j.dist($);if(I+W>A){let q=(A-I)/W,ee=Pn(j.x,$.x,q),ae=Pn(j.y,$.y,q),me=new Hu(ee,ae,0,$.angleTo(j),L);return!v||DM(o,me,E,v,e)?me:void 0}I+=W}}function WL(o,e,s,c,f,g,v,E,I){let A=MM(c,g,v),L=IM(c,f),j=L*v,$=o[0].x===0||o[0].x===I||o[0].y===0||o[0].y===I;return e-j<e/4&&(e=j+e/4),SM(o,$?e/2*E%e:(L/2+2*g)*v*E%e,e,A,s,j,$,!1,I)}function SM(o,e,s,c,f,g,v,E,I){let A=g/2,L=TM(o),j=0,$=e-s,W=[];for(let q=0;q<o.length-1;q++){let ee=o[q],ae=o[q+1],me=ee.dist(ae),we=ae.angleTo(ee);for(;$+s<j+me;){$+=s;let ge=($-j)/me,xe=Pn(ee.x,ae.x,ge),Te=Pn(ee.y,ae.y,ge);if(xe>=0&&xe<I&&Te>=0&&Te<I&&$-A>=0&&$+A<=L){let Ce=new Hu(xe,Te,0,we,q);Ce._round(),c&&!DM(o,Ce,g,c,f)||W.push(Ce)}}j+=me}return E||W.length||v||(W=SM(o,j/2,s,c,f,g,v,!0,I)),W}function AM(o,e,s,c,f){let g=[];for(let v=0;v<o.length;v++){let E=o[v],I;for(let A=0;A<E.length-1;A++){let L=E[A],j=E[A+1];L.x<e&&j.x<e||(L.x<e?L=new It(e,L.y+(e-L.x)/(j.x-L.x)*(j.y-L.y))._round():j.x<e&&(j=new It(e,L.y+(e-L.x)/(j.x-L.x)*(j.y-L.y))._round()),L.y<s&&j.y<s||(L.y<s?L=new It(L.x+(s-L.y)/(j.y-L.y)*(j.x-L.x),s)._round():j.y<s&&(j=new It(L.x+(s-L.y)/(j.y-L.y)*(j.x-L.x),s)._round()),L.x>=c&&j.x>=c||(L.x>=c?L=new It(c,L.y+(c-L.x)/(j.x-L.x)*(j.y-L.y))._round():j.x>=c&&(j=new It(c,L.y+(c-L.x)/(j.x-L.x)*(j.y-L.y))._round()),L.y>=f&&j.y>=f||(L.y>=f?L=new It(L.x+(f-L.y)/(j.y-L.y)*(j.x-L.x),f)._round():j.y>=f&&(j=new It(L.x+(f-L.y)/(j.y-L.y)*(j.x-L.x),f)._round()),I&&L.equals(I[I.length-1])||(I=[L],g.push(I)),I.push(j)))))}}return g}Ot(Hu,"Anchor");let Ly=1e20;function kM(o,e,s,c,f,g,v,E,I){for(let A=e;A<e+c;A++)RM(o,s*g+A,g,f,v,E,I);for(let A=s;A<s+f;A++)RM(o,A*g+e,1,c,v,E,I)}function RM(o,e,s,c,f,g,v){g[0]=0,v[0]=-Ly,v[1]=Ly,f[0]=o[e];for(let E=1,I=0,A=0;E<c;E++){f[E]=o[e+E*s];let L=E*E;do{let j=g[I];A=(f[E]-f[j]+L-j*j)/(E-j)/2}while(A<=v[I]&&--I>-1);I++,g[I]=E,v[I]=A,v[I+1]=Ly}for(let E=0,I=0;E<c;E++){for(;v[I+1]<E;)I++;let A=g[I],L=E-A;o[e+E*s]=f[A]+L*L}}let Ll=2,t1={none:0,ideographs:1,all:2};class bm{constructor(e,s,c){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){let c=[];for(let f in e)for(let g of e[f])c.push({stack:f,id:g});vr(c,({stack:f,id:g},v)=>{let E=this.entries[f];E||(E=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=E.glyphs[g];if(I!==void 0)return void v(null,{stack:f,id:g,glyph:I});if(I=this._tinySDF(E,f,g),I)return E.glyphs[g]=I,void v(null,{stack:f,id:g,glyph:I});let A=Math.floor(g/256);if(256*A>65535)return void v(new Error("glyphs > 65535 not supported"));if(E.ranges[A])return void v(null,{stack:f,id:g,glyph:I});let L=E.requests[A];L||(L=E.requests[A]=[],bm.loadGlyphRange(f,A,this.url,this.requestManager,(j,$)=>{if($){E.ascender=$.ascender,E.descender=$.descender;for(let W in $.glyphs)this._doesCharSupportLocalGlyph(+W)||(E.glyphs[+W]=$.glyphs[+W]);E.ranges[A]=!0}for(let W of L)W(j,$);delete E.requests[A]})),L.push((j,$)=>{j?v(j):$&&v(null,{stack:f,id:g,glyph:$.glyphs[g]||null})})},(f,g)=>{if(f)s(f);else if(g){let v={};for(let{stack:E,id:I,glyph:A}of g)v[E]===void 0&&(v[E]={}),v[E].glyphs===void 0&&(v[E].glyphs={}),v[E].glyphs[I]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},v[E].ascender=this.entries[E].ascender,v[E].descender=this.entries[E].descender;s(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==t1.none&&(this.localGlyphMode===t1.all?!!this.localFontFamily:!!this.localFontFamily&&(St["CJK Unified Ideographs"](e)||St["Hangul Syllables"](e)||St.Hiragana(e)||St.Katakana(e)||St["CJK Symbols and Punctuation"](e)))}_tinySDF(e,s,c){let f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let g=e.tinySDF;if(!g){let ee="400";/bold/i.test(s)?ee="900":/medium/i.test(s)?ee="500":/light/i.test(s)&&(ee="200"),g=e.tinySDF=new bm.TinySDF({fontFamily:f,fontWeight:ee,fontSize:24*Ll,buffer:3*Ll,radius:8*Ll}),g.fontWeight=ee}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];let v=String.fromCharCode(c),{data:E,width:I,height:A,glyphWidth:L,glyphHeight:j,glyphLeft:$,glyphTop:W,glyphAdvance:q}=g.draw(v);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Ol({width:I,height:A},E),metrics:{width:L/Ll,height:j/Ll,left:$/Ll,top:W/Ll-27,advance:q/Ll,localGlyph:!0}}}}bm.loadGlyphRange=function(o,e,s,c,f){let g=256*e,v=g+255,E=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${v}`),Ka.Glyphs);Ws(E,(I,A)=>{if(I)f(I);else if(A){let L={},j=function($){return new Xv($).readFields(BL,{})}(A);for(let $ of j.glyphs)L[$.id]=$;f(null,{glyphs:L,ascender:j.ascender,descender:j.descender})}})},bm.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:s=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=s;let E=this.size=o+4*e,I=this._createCanvas(E),A=this.ctx=I.getContext("2d",{willReadFrequently:!0});A.font=`${v} ${g} ${o}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(o){let e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){let{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(o),v=Math.ceil(s),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),I=Math.min(this.size-this.buffer,v+Math.ceil(c)),A=E+2*this.buffer,L=I+2*this.buffer,j=Math.max(A*L,0),$=new Uint8ClampedArray(j),W={data:$,width:A,height:L,glyphWidth:E,glyphHeight:I,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(E===0||I===0)return W;let{ctx:q,buffer:ee,gridInner:ae,gridOuter:me}=this;q.clearRect(ee,ee,E,I),q.fillText(o,ee,ee+v);let we=q.getImageData(ee,ee,E,I);me.fill(Ly,0,j),ae.fill(0,0,j);for(let ge=0;ge<I;ge++)for(let xe=0;xe<E;xe++){let Te=we.data[4*(ge*E+xe)+3]/255;if(Te===0)continue;let Ce=(ge+ee)*A+xe+ee;if(Te===1)me[Ce]=0,ae[Ce]=Ly;else{let qe=.5-Te;me[Ce]=qe>0?qe*qe:0,ae[Ce]=qe<0?qe*qe:0}}kM(me,0,0,A,L,A,this.f,this.v,this.z),kM(ae,ee,ee,E,I,A,this.f,this.v,this.z);for(let ge=0;ge<j;ge++){let xe=Math.sqrt(me[ge])-Math.sqrt(ae[ge]);$[ge]=Math.round(255-255*(xe/this.radius+this.cutoff))}return W}};let xm=os;function PM(o,e,s,c){let f=[],g=o.image,v=g.pixelRatio,E=g.paddedRect.w-2*xm,I=g.paddedRect.h-2*xm,A=o.right-o.left,L=o.bottom-o.top,j=g.stretchX||[[0,E]],$=g.stretchY||[[0,I]],W=(Ke,ot)=>Ke+ot[1]-ot[0],q=j.reduce(W,0),ee=$.reduce(W,0),ae=E-q,me=I-ee,we=0,ge=q,xe=0,Te=ee,Ce=0,qe=ae,We=0,et=me;if(g.content&&c){let Ke=g.content;we=Kv(j,0,Ke[0]),xe=Kv($,0,Ke[1]),ge=Kv(j,Ke[0],Ke[2]),Te=Kv($,Ke[1],Ke[3]),Ce=Ke[0]-we,We=Ke[1]-xe,qe=Ke[2]-Ke[0]-ge,et=Ke[3]-Ke[1]-Te}let vt=(Ke,ot,st,dt)=>{let xt=Qv(Ke.stretch-we,ge,A,o.left),Qe=Jv(Ke.fixed-Ce,qe,Ke.stretch,q),At=Qv(ot.stretch-xe,Te,L,o.top),Nt=Jv(ot.fixed-We,et,ot.stretch,ee),Pt=Qv(st.stretch-we,ge,A,o.left),hn=Jv(st.fixed-Ce,qe,st.stretch,q),Et=Qv(dt.stretch-xe,Te,L,o.top),qt=Jv(dt.fixed-We,et,dt.stretch,ee),fn=new It(xt,At),ti=new It(Pt,At),pn=new It(Pt,Et),Jt=new It(xt,Et),Oi=new It(Qe/v,Nt/v),yn=new It(hn/v,qt/v),_n=e*Math.PI/180;if(_n){let ki=Math.sin(_n),Ei=Math.cos(_n),qi=[Ei,-ki,ki,Ei];fn._matMult(qi),ti._matMult(qi),Jt._matMult(qi),pn._matMult(qi)}let wi=Ke.stretch+Ke.fixed,Ai=ot.stretch+ot.fixed;return{tl:fn,tr:ti,bl:Jt,br:pn,tex:{x:g.paddedRect.x+xm+wi,y:g.paddedRect.y+xm+Ai,w:st.stretch+st.fixed-wi,h:dt.stretch+dt.fixed-Ai},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oi,pixelOffsetBR:yn,minFontScaleX:qe/v/A,minFontScaleY:et/v/L,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){let Ke=OM(j,ae,q),ot=OM($,me,ee);for(let st=0;st<Ke.length-1;st++){let dt=Ke[st],xt=Ke[st+1];for(let Qe=0;Qe<ot.length-1;Qe++)f.push(vt(dt,ot[Qe],xt,ot[Qe+1]))}}else f.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return f}function Kv(o,e,s){let c=0;for(let f of o)c+=Math.max(e,Math.min(s,f[1]))-Math.max(e,Math.min(s,f[0]));return c}function OM(o,e,s){let c=[{fixed:-xm,stretch:0}];for(let[f,g]of o){let v=c[c.length-1];c.push({fixed:f-v.stretch,stretch:v.stretch}),c.push({fixed:f-v.stretch,stretch:v.stretch+(g-f)})}return c.push({fixed:e+xm,stretch:s}),c}function Qv(o,e,s,c){return o/e*s+c}function Jv(o,e,s,c){return o-e*s/c}function qL(o,e,s,c){let f=e+o.positionedLines[c].lineOffset;return c===0?s+f/2:s+(f+(e+o.positionedLines[c-1].lineOffset))/2}class ZL{constructor(e=[],s=XL){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:s,compare:c}=this,f=s[e];for(;e>0;){let g=e-1>>1,v=s[g];if(c(f,v)>=0)break;s[e]=v,e=g}s[e]=f}_down(e){let{data:s,compare:c}=this,f=this.length>>1,g=s[e];for(;e<f;){let v=1+(e<<1),E=s[v],I=v+1;if(I<this.length&&c(s[I],E)<0&&(v=I,E=s[I]),c(E,g)>=0)break;s[e]=E,e=v}s[e]=g}}function XL(o,e){return o<e?-1:o>e?1:0}function YL(o,e=1,s=!1){let c=1/0,f=1/0,g=-1/0,v=-1/0,E=o[0];for(let W=0;W<E.length;W++){let q=E[W];(!W||q.x<c)&&(c=q.x),(!W||q.y<f)&&(f=q.y),(!W||q.x>g)&&(g=q.x),(!W||q.y>v)&&(v=q.y)}let I=Math.min(g-c,v-f),A=I/2,L=new ZL([],KL);if(I===0)return new It(c,f);for(let W=c;W<g;W+=I)for(let q=f;q<v;q+=I)L.push(new wm(W+A,q+A,A,o));let j=function(W){let q=0,ee=0,ae=0,me=W[0];for(let we=0,ge=me.length,xe=ge-1;we<ge;xe=we++){let Te=me[we],Ce=me[xe],qe=Te.x*Ce.y-Ce.x*Te.y;ee+=(Te.x+Ce.x)*qe,ae+=(Te.y+Ce.y)*qe,q+=3*qe}return new wm(ee/q,ae/q,0,W)}(o),$=L.length;for(;L.length;){let W=L.pop();(W.d>j.d||!j.d)&&(j=W,s&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,$)),W.max-j.d<=e||(A=W.h/2,L.push(new wm(W.p.x-A,W.p.y-A,A,o)),L.push(new wm(W.p.x+A,W.p.y-A,A,o)),L.push(new wm(W.p.x-A,W.p.y+A,A,o)),L.push(new wm(W.p.x+A,W.p.y+A,A,o)),$+=4)}return s&&(console.log(`num probes: ${$}`),console.log(`best distance: ${j.d}`)),j.p}function KL(o,e){return e.max-o.max}class wm{constructor(e,s,c,f){this.p=new It(e,s),this.h=c,this.d=function(g,v){let E=!1,I=1/0;for(let A=0;A<v.length;A++){let L=v[A];for(let j=0,$=L.length,W=$-1;j<$;W=j++){let q=L[j],ee=L[W];q.y>g.y!=ee.y>g.y&&g.x<(ee.x-q.x)*(g.y-q.y)/(ee.y-q.y)+q.x&&(E=!E),I=Math.min(I,am(g,q,ee))}}return(E?1:-1)*Math.sqrt(I)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}let Em=7,n1=Number.POSITIVE_INFINITY,QL=Math.sqrt(2);function LM(o,[e,s]){let c=0,f=0;if(s===n1){e<0&&(e=0);let g=e/QL;switch(o){case"top-right":case"top-left":f=g-Em;break;case"bottom-right":case"bottom-left":f=-g+Em;break;case"bottom":f=-e+Em;break;case"top":f=e-Em}switch(o){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),o){case"top-right":case"top-left":case"top":f=s-Em;break;case"bottom-right":case"bottom-left":case"bottom":f=-s+Em}switch(o){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,f]}function JL(o,e,s,c,f,g,v,E,I,A){o.createArrays(),o.tilePixelRatio=Gt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;let L=o.layers[0].layout,j=o.layers[0]._unevaluatedLayout._values,$={};if(o.textSizeData.kind==="composite"){let{minZoom:ee,maxZoom:ae}=o.textSizeData;$.compositeTextSizes=[j["text-size"].possiblyEvaluate(new z(ee),E),j["text-size"].possiblyEvaluate(new z(ae),E)]}if(o.iconSizeData.kind==="composite"){let{minZoom:ee,maxZoom:ae}=o.iconSizeData;$.compositeIconSizes=[j["icon-size"].possiblyEvaluate(new z(ee),E),j["icon-size"].possiblyEvaluate(new z(ae),E)]}$.layoutTextSize=j["text-size"].possiblyEvaluate(new z(I+1),E),$.layoutIconSize=j["icon-size"].possiblyEvaluate(new z(I+1),E),$.textMaxSize=j["text-size"].possiblyEvaluate(new z(18),E);let W=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",q=L.get("text-size");for(let ee of o.features){let ae=L.get("text-font").evaluate(ee,{},E).join(","),me=q.evaluate(ee,{},E),we=$.layoutTextSize.evaluate(ee,{},E),ge=($.layoutIconSize.evaluate(ee,{},E),{horizontal:{},vertical:void 0}),xe=ee.text,Te,Ce=[0,0];if(xe){let et=xe.toString(),vt=L.get("text-letter-spacing").evaluate(ee,{},E)*Mn,Ke=L.get("text-line-height").evaluate(ee,{},E)*Mn,ot=Kg(et)?vt:0,st=L.get("text-anchor").evaluate(ee,{},E),dt=L.get("text-variable-anchor");if(!dt){let Pt=L.get("text-radial-offset").evaluate(ee,{},E);Ce=Pt?LM(st,[Pt*Mn,n1]):L.get("text-offset").evaluate(ee,{},E).map(hn=>hn*Mn)}let xt=W?"center":L.get("text-justify").evaluate(ee,{},E),Qe=L.get("symbol-placement")==="point",At=Qe?L.get("text-max-width").evaluate(ee,{},E)*Mn:1/0,Nt=Pt=>{o.allowVerticalPlacement&&Ud(et)&&(ge.vertical=Jw(xe,e,s,f,ae,At,Ke,st,Pt,ot,Ce,aa.vertical,!0,we,me))};if(!W&&dt){let Pt=xt==="auto"?dt.map(Et=>i1(Et)):[xt],hn=!1;for(let Et=0;Et<Pt.length;Et++){let qt=Pt[Et];if(!ge.horizontal[qt])if(hn)ge.horizontal[qt]=ge.horizontal[0];else{let fn=Jw(xe,e,s,f,ae,At,Ke,"center",qt,ot,Ce,aa.horizontal,!1,we,me);fn&&(ge.horizontal[qt]=fn,hn=fn.positionedLines.length===1)}}Nt("left")}else{if(xt==="auto"&&(xt=i1(st)),Qe||L.get("text-writing-mode").indexOf("horizontal")>=0||!Ud(et)){let Pt=Jw(xe,e,s,f,ae,At,Ke,st,xt,ot,Ce,aa.horizontal,!1,we,me);Pt&&(ge.horizontal[xt]=Pt)}Nt(Qe?"left":xt)}}let qe=!1;if(ee.icon&&ee.icon.name){let et=c[ee.icon.name];et&&(Te=HL(f[ee.icon.name],L.get("icon-offset").evaluate(ee,{},E),L.get("icon-anchor").evaluate(ee,{},E)),qe=et.sdf,o.sdfIcons===void 0?o.sdfIcons=et.sdf:o.sdfIcons!==et.sdf&&_i("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==o.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}let We=NM(ge.horizontal)||ge.vertical;o.iconsInText||(o.iconsInText=!!We&&We.iconsInText),(We||Te)&&eF(o,ee,ge,Te,c,$,we,0,Ce,qe,v,E,A)}g&&o.generateCollisionDebugBuffers(I,o.collisionBoxArray)}function i1(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function eF(o,e,s,c,f,g,v,E,I,A,L,j,$){let W=g.textMaxSize.evaluate(e,{},j);W===void 0&&(W=v);let q=o.layers[0].layout,ee=q.get("icon-offset").evaluate(e,{},j),ae=NM(s.horizontal)||s.vertical,me=$.name==="globe",we=Mn,ge=v/we,xe=o.tilePixelRatio*W/we,Te=(st=o.overscaling,o.zoom>18&&st>2&&(st>>=1),Math.max(Gt/(512*st),1)*q.get("symbol-spacing")),Ce=q.get("text-padding")*o.tilePixelRatio,qe=q.get("icon-padding")*o.tilePixelRatio,We=An(q.get("text-max-angle")),et=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",vt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Ke=q.get("symbol-placement"),ot=Te/2;var st;let dt=q.get("icon-text-fit"),xt;c&&dt!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(xt=CM(c,s.vertical,dt,q.get("icon-text-fit-padding"),ee,ge)),ae&&(c=CM(c,ae,dt,q.get("icon-text-fit-padding"),ee,ge)));let Qe=(At,Nt,Pt)=>{if(Nt.x<0||Nt.x>=Gt||Nt.y<0||Nt.y>=Gt)return;let hn=null;if(me){let{x:Et,y:qt,z:fn}=$.projectTilePoint(Nt.x,Nt.y,Pt);hn={anchor:new Hu(Et,qt,fn,0,void 0),up:$.upVector(Pt,Nt.x,Nt.y)}}(function(Et,qt,fn,ti,pn,Jt,Oi,yn,_n,wi,Ai,ki,Ei,qi,cr,xr,Ci,Rr,wr,nr,ri,Er,Ri,No,Cr){let no=Et.addToLineVertexArray(qt,ti),qr,zo,Zr,Nl,Tm,Hy,Gy,gI=0,yI=0,_I=0,vI=0,_1=-1,v1=-1,Pc={},bI=Jg(""),Pf=fn?fn.anchor:qt,b1=0,x1=0;if(_n._unevaluatedLayout.getValue("text-radial-offset")===void 0?[b1,x1]=_n.layout.get("text-offset").evaluate(ri,{},Cr).map(Ss=>Ss*Mn):(b1=_n.layout.get("text-radial-offset").evaluate(ri,{},Cr)*Mn,x1=n1),Et.allowVerticalPlacement&&pn.vertical){let Ss=pn.vertical;if(cr)Hy=r1(Ss),yn&&(Gy=r1(yn));else{let As=_n.layout.get("text-rotate").evaluate(ri,{},Cr)+90;Zr=eb(wi,Pf,qt,Ai,ki,Ei,Ss,qi,As,xr),yn&&(Nl=eb(wi,Pf,qt,Ai,ki,Ei,yn,Rr,As))}}if(Jt){let Ss=_n.layout.get("icon-rotate").evaluate(ri,{},Cr),As=_n.layout.get("icon-text-fit")!=="none",Wy=PM(Jt,Ss,Ri,As),E1=yn?PM(yn,Ss,Ri,As):void 0;zo=eb(wi,Pf,qt,Ai,ki,Ei,Jt,Rr,Ss),gI=4*Wy.length;let xI=Et.iconSizeData,Of=null;xI.kind==="source"?(Of=[xi*_n.layout.get("icon-size").evaluate(ri,{},Cr)],Of[0]>nh&&_i(`${Et.layerIds[0]}: Value for "icon-size" is >= ${Fy}. Reduce your "icon-size".`)):xI.kind==="composite"&&(Of=[xi*Er.compositeIconSizes[0].evaluate(ri,{},Cr),xi*Er.compositeIconSizes[1].evaluate(ri,{},Cr)],(Of[0]>nh||Of[1]>nh)&&_i(`${Et.layerIds[0]}: Value for "icon-size" is >= ${Fy}. Reduce your "icon-size".`)),Et.addSymbols(Et.icon,Wy,Of,nr,wr,ri,!1,fn,qt,no.lineStartIndex,no.lineLength,-1,No,Cr),_1=Et.icon.placedSymbolArray.length-1,E1&&(yI=4*E1.length,Et.addSymbols(Et.icon,E1,Of,nr,wr,ri,aa.vertical,fn,qt,no.lineStartIndex,no.lineLength,-1,No,Cr),v1=Et.icon.placedSymbolArray.length-1)}for(let Ss in pn.horizontal){let As=pn.horizontal[Ss];qr||(bI=Jg(As.text),cr?Tm=r1(As):qr=eb(wi,Pf,qt,Ai,ki,Ei,As,qi,_n.layout.get("text-rotate").evaluate(ri,{},Cr),xr));let Wy=As.positionedLines.length===1;if(_I+=FM(Et,fn,qt,As,Oi,_n,cr,ri,xr,no,pn.vertical?aa.horizontal:aa.horizontalOnly,Wy?Object.keys(pn.horizontal):[Ss],Pc,_1,Er,No,Cr),Wy)break}pn.vertical&&(vI+=FM(Et,fn,qt,pn.vertical,Oi,_n,cr,ri,xr,no,aa.vertical,["vertical"],Pc,v1,Er,No,Cr));let lh=-1,w1=(Ss,As)=>Ss?Math.max(Ss,As):As;lh=w1(Tm,lh),lh=w1(Hy,lh),lh=w1(Gy,lh);let IF=lh>-1?1:0;Et.glyphOffsetArray.length>=rh.MAX_GLYPHS&&_i("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ri.sortKey!==void 0&&Et.addToSortKeyRanges(Et.symbolInstances.length,ri.sortKey),Et.symbolInstances.emplaceBack(Pf.x,Pf.y,Pf.z,qt.x,qt.y,Pc.right>=0?Pc.right:-1,Pc.center>=0?Pc.center:-1,Pc.left>=0?Pc.left:-1,Pc.vertical>=0?Pc.vertical:-1,_1,v1,bI,qr!==void 0?qr:Et.collisionBoxArray.length,qr!==void 0?qr+1:Et.collisionBoxArray.length,Zr!==void 0?Zr:Et.collisionBoxArray.length,Zr!==void 0?Zr+1:Et.collisionBoxArray.length,zo!==void 0?zo:Et.collisionBoxArray.length,zo!==void 0?zo+1:Et.collisionBoxArray.length,Nl||Et.collisionBoxArray.length,Nl?Nl+1:Et.collisionBoxArray.length,Ai,_I,vI,gI,yI,IF,0,b1,x1,lh)})(o,Nt,hn,At,s,c,f,xt,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Ce,et,I,0,qe,vt,ee,e,g,A,L,j)};if(Ke==="line")for(let At of AM(e.geometry,0,0,Gt,Gt)){let Nt=WL(At,Te,We,s.vertical||ae,c,we,xe,o.overscaling,Gt);for(let Pt of Nt)ae&&tF(o,ae.text,ot,Pt)||Qe(At,Pt,j)}else if(Ke==="line-center"){for(let At of e.geometry)if(At.length>1){let Nt=GL(At,We,s.vertical||ae,c,we,xe);Nt&&Qe(At,Nt,j)}}else if(e.type==="Polygon")for(let At of My(e.geometry,0)){let Nt=YL(At,16);Qe(At[0],new Hu(Nt.x,Nt.y,0,0,void 0),j)}else if(e.type==="LineString")for(let At of e.geometry)Qe(At,new Hu(At[0].x,At[0].y,0,0,void 0),j);else if(e.type==="Point")for(let At of e.geometry)for(let Nt of At)Qe([Nt],new Hu(Nt.x,Nt.y,0,0,void 0),j)}let Fy=255,nh=Fy*xi;function FM(o,e,s,c,f,g,v,E,I,A,L,j,$,W,q,ee,ae){let me=function(xe,Te,Ce,qe,We,et,vt,Ke){let ot=[];if(Te.positionedLines.length===0)return ot;let st=qe.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,dt=function(Pt){let hn=Pt[0],Et=Pt[1],qt=hn*Et;return qt>0?[hn,-Et]:qt<0?[-hn,Et]:hn===0?[Et,hn]:[Et,-hn]}(Ce),xt=Math.abs(Te.top-Te.bottom);for(let Pt of Te.positionedLines)xt-=Pt.lineOffset;let Qe=Te.positionedLines.length,At=xt/Qe,Nt=Te.top-Ce[1];for(let Pt=0;Pt<Qe;++Pt){let hn=Te.positionedLines[Pt];Nt=qL(Te,At,Nt,Pt);for(let Et of hn.positionedGlyphs){if(!Et.rect)continue;let qt=Et.rect||{},fn=gM+1,ti=!0,pn=1,Jt=0;if(Et.imageName){let Ri=vt[Et.imageName];if(!Ri)continue;if(Ri.sdf){_i("SDF images are not supported in formatted text and will be ignored.");continue}ti=!1,pn=Ri.pixelRatio,fn=os/pn}let Oi=(We||Ke)&&Et.vertical,yn=Et.metrics.advance*Et.scale/2,_n=Et.metrics,wi=Et.rect;if(wi===null)continue;Ke&&Te.verticalizable&&(Jt=Et.imageName?yn-Et.metrics.width*Et.scale/2:0);let Ai=We?[Et.x+yn,Et.y]:[0,0],ki=[0,0],Ei=[0,0],qi=!1;We||(Oi?(Ei=[Et.x+yn+dt[0],Et.y+dt[1]-Jt],qi=!0):ki=[Et.x+yn+Ce[0],Et.y+Ce[1]-Jt]);let cr=wi.w*Et.scale/(pn*(Et.localGlyph?Ll:1)),xr=wi.h*Et.scale/(pn*(Et.localGlyph?Ll:1)),Ci,Rr,wr,nr;if(Oi){let Ri=Et.y-Nt,No=new It(-yn,yn-Ri),Cr=-Math.PI/2,no=new It(...Ei);Ci=new It(-yn+ki[0],ki[1]),Ci._rotateAround(Cr,No)._add(no),Ci.x+=-Ri+yn,Ci.y-=(_n.left-fn)*Et.scale;let qr=Et.imageName?_n.advance*Et.scale:Mn*Et.scale,zo=String.fromCharCode(Et.glyph);Af(zo)?Ci.x+=(1-fn)*Et.scale:gm(zo)?Ci.x+=qr-_n.height*Et.scale+(-fn-1)*Et.scale:Ci.x+=Et.imageName||_n.width+2*fn===wi.w&&_n.height+2*fn===wi.h?(qr-xr)/2:(qr-(_n.height+2*fn)*Et.scale)/2,Rr=new It(Ci.x,Ci.y-cr),wr=new It(Ci.x+xr,Ci.y),nr=new It(Ci.x+xr,Ci.y-cr)}else{let Ri=(_n.left-fn)*Et.scale-yn+ki[0],No=(-_n.top-fn)*Et.scale+ki[1],Cr=Ri+cr,no=No+xr;Ci=new It(Ri,No),Rr=new It(Cr,No),wr=new It(Ri,no),nr=new It(Cr,no)}if(st){let Ri;Ri=We?new It(0,0):qi?new It(dt[0],dt[1]):new It(Ce[0],Ce[1]),Ci._rotateAround(st,Ri),Rr._rotateAround(st,Ri),wr._rotateAround(st,Ri),nr._rotateAround(st,Ri)}let ri=new It(0,0),Er=new It(0,0);ot.push({tl:Ci,tr:Rr,bl:wr,br:nr,tex:qt,writingMode:Te.writingMode,glyphOffset:Ai,sectionIndex:Et.sectionIndex,isSDF:ti,pixelOffsetTL:ri,pixelOffsetBR:Er,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,c,I,g,v,E,f,o.allowVerticalPlacement),we=o.textSizeData,ge=null;we.kind==="source"?(ge=[xi*g.layout.get("text-size").evaluate(E,{},ae)],ge[0]>nh&&_i(`${o.layerIds[0]}: Value for "text-size" is >= ${Fy}. Reduce your "text-size".`)):we.kind==="composite"&&(ge=[xi*q.compositeTextSizes[0].evaluate(E,{},ae),xi*q.compositeTextSizes[1].evaluate(E,{},ae)],(ge[0]>nh||ge[1]>nh)&&_i(`${o.layerIds[0]}: Value for "text-size" is >= ${Fy}. Reduce your "text-size".`)),o.addSymbols(o.text,me,ge,I,v,E,L,e,s,A.lineStartIndex,A.lineLength,W,ee,ae);for(let xe of j)$[xe]=o.text.placedSymbolArray.length-1;return 4*me.length}function NM(o){for(let e in o)return o[e];return null}function eb(o,e,s,c,f,g,v,E,I,A){let L=v.top,j=v.bottom,$=v.left,W=v.right,q=v.collisionPadding;if(q&&($-=q[0],L-=q[1],W+=q[2],j+=q[3]),I){let ee=new It($,L),ae=new It(W,L),me=new It($,j),we=new It(W,j),ge=An(I),xe=new It(0,0);A&&(xe=new It(A[0],A[1])),ee._rotateAround(ge,xe),ae._rotateAround(ge,xe),me._rotateAround(ge,xe),we._rotateAround(ge,xe),$=Math.min(ee.x,ae.x,me.x,we.x),W=Math.max(ee.x,ae.x,me.x,we.x),L=Math.min(ee.y,ae.y,me.y,we.y),j=Math.max(ee.y,ae.y,me.y,we.y)}return o.emplaceBack(e.x,e.y,e.z,s.x,s.y,$,L,W,j,E,c,f,g),o.length-1}function r1(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);let e=o.bottom-o.top;return e>0?Math.max(10,e):null}function tF(o,e,s,c){let f=o.compareText;if(e in f){let g=f[e];for(let v=g.length-1;v>=0;v--)if(c.dist(g[v])<s)return!0}else f[e]=[];return f[e].push(c),!1}function zM(o,e){let s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,f=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),g=Math.sin(s)*f/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),v=Math.sin(o._pitch)*g+f;return Math.min(1.01*v,f*(1/o._horizonShift))}function kf(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};let s=Math.pow(2,-o.z),c=o.x*s,f=(o.x+1)*s,g=o.y*s,v=(o.y+1)*s,E=rs(c),I=rs(f),A=Gr(g),L=Gr(v),j=e.project(E,A),$=e.project(I,A),W=e.project(I,L),q=e.project(E,L),ee=Math.min(j.x,$.x,W.x,q.x),ae=Math.min(j.y,$.y,W.y,q.y),me=Math.max(j.x,$.x,W.x,q.x),we=Math.max(j.y,$.y,W.y,q.y),ge=s/16;function xe(Ce,qe,We,et,vt,Ke){let ot=(We+vt)/2,st=(et+Ke)/2,dt=e.project(rs(ot),Gr(st)),xt=Math.max(0,ee-dt.x,ae-dt.y,dt.x-me,dt.y-we);ee=Math.min(ee,dt.x),me=Math.max(me,dt.x),ae=Math.min(ae,dt.y),we=Math.max(we,dt.y),xt>ge&&(xe(Ce,dt,We,et,ot,st),xe(dt,qe,ot,st,vt,Ke))}xe(j,$,c,g,f,g),xe($,W,f,g,f,v),xe(W,q,f,v,c,v),xe(q,j,c,v,c,g),ee-=ge,ae-=ge,me+=ge,we+=ge;let Te=1/Math.max(me-ee,we-ae);return{scale:Te,x:ee*Te,y:ae*Te,x2:me*Te,y2:we*Te,projection:e}}let nF=ra(new Float32Array(16));class ih{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new ii(0,0)}projectTilePoint(e,s,c){return{x:e,y:s,z:0}}locationPoint(e,s,c=!0){return e._coordinatePoint(e.locationCoordinate(s),c)}pixelsPerMeter(e,s){return is(1,e)*s}pixelSpaceConversion(e,s,c){return 1}farthestPixelDistance(e){return zM(e,e.pixelsPerMeter)}pointCoordinate(e,s,c,f){let g=e.horizonLineFromTop(!1),v=new It(s,Math.max(g,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(v,f))}pointCoordinate3D(e,s,c){let f=new It(s,c);if(e.elevation)return e.elevation.pointCoordinate(f);{let g=this.pointCoordinate(e,f.x,f.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,s){if(e.elevation)return!this.pointCoordinate3D(e,s.x,s.y);let c=e.horizonLineFromTop();return s.y<c}createInversionMatrix(e,s){return nF}createTileMatrix(e,s,c){let f,g,v,E=c.canonical,I=ra(new Float64Array(16));if(this.isReprojectedInTileSpace){let A=kf(E,this);f=1,g=A.x+c.wrap*A.scale,v=A.y,Ec(I,I,[f/A.scale,f/A.scale,e.pixelsPerMeter/s])}else f=s/e.zoomScale(E.z),g=(E.x+Math.pow(2,E.z)*c.wrap)*f,v=E.y*f;return ku(I,I,[g,v,0]),Ec(I,I,[f/Gt,f/Gt,1]),I}upVector(e,s,c){return[0,0,1]}upVectorScale(e,s,c){return{metersToTile:1}}}class iF extends ih{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[s,c]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(An(s));this.n=(f+Math.sin(An(c)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,s){let{n:c,c:f,r0:g}=this,v=An(e-this.center[0]),E=An(s),I=Math.sqrt(f-2*c*Math.sin(E))/c;return{x:I*Math.sin(v*c),y:I*Math.cos(v*c)-g,z:0}}unproject(e,s){let{n:c,c:f,r0:g}=this,v=g+s,E=Math.atan2(e,Math.abs(v))*Math.sign(v);v*c<0&&(E-=Math.PI*Math.sign(e)*Math.sign(v));let I=An(this.center[0])*c;E=dr(E,-Math.PI-I,Math.PI-I);let A=Cn(Yi(E/c)+this.center[0],-180,180),L=Math.asin(Cn((f-(e*e+v*v)*c*c)/(2*c),-1,1)),j=Cn(Yi(L),-Wr,Wr);return new ii(A,j)}}let Ny=1.340264,zy=-.081106,By=893e-6,Vy=.003796,tb=Math.sqrt(3)/2;class rF extends ih{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;let c=Math.asin(tb*Math.sin(s)),f=c*c,g=f*f*f;return{x:.5*(e*Math.cos(c)/(tb*(Ny+3*zy*f+g*(7*By+9*Vy*f)))/Math.PI+.5),y:1-.5*(c*(Ny+zy*f+g*(By+Vy*f))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=c*c,g=f*f*f;for(let L,j,$,W=0;W<12&&(j=c*(Ny+zy*f+g*(By+Vy*f))-s,$=Ny+3*zy*f+g*(7*By+9*Vy*f),L=j/$,c=Cn(c-L,-Math.PI/3,Math.PI/3),f=c*c,g=f*f*f,!(Math.abs(L)<1e-12));++W);let v=tb*e*(Ny+3*zy*f+g*(7*By+9*Vy*f))/Math.cos(c),E=Math.asin(Math.sin(c)/tb),I=Cn(180*v/Math.PI,-180,180),A=Cn(180*E/Math.PI,-Wr,Wr);return new ii(I,A)}}class oF extends ih{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){let c=360*(e-.5),f=Cn(360*(.5-s),-Wr,Wr);return new ii(c,f)}}let Cm=Math.PI/2;function nb(o){return Math.tan((Cm+o)/2)}class sF extends ih{constructor(e){super(e),this.center=e.center||[0,30];let[s,c]=this.parallels=e.parallels||[30,30],f=An(s),g=An(c);this.southernCenter=f+g<0,this.southernCenter&&(f=-f,g=-g);let v=Math.cos(f),E=nb(f);this.n=f===g?Math.sin(f):Math.log(v/Math.cos(g))/Math.log(nb(g)/E),this.f=v*Math.pow(nb(f),this.n)/this.n}project(e,s){s=An(s),this.southernCenter&&(s=-s),e=An(e-this.center[0]);let c=1e-6,{n:f,f:g}=this;g>0?s<-Cm+c&&(s=-Cm+c):s>Cm-c&&(s=Cm-c);let v=g/Math.pow(nb(s),f),E=v*Math.sin(f*e),I=g-v*Math.cos(f*e);return E=.5*(E/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:E,y:this.southernCenter?I:1-I,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;let{n:c,f}=this,g=f-s,v=Math.sign(g),E=Math.sign(c)*Math.sqrt(e*e+g*g),I=Math.atan2(e,Math.abs(g))*v;g*c<0&&(I-=Math.PI*Math.sign(e)*v);let A=Cn(Yi(I/c)+this.center[0],-180,180),L=Cn(Yi(2*Math.atan(Math.pow(f/E,1/c))-Cm),-Wr,Wr);return new ii(A,this.southernCenter?-L:L)}}class BM extends ih{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:oa(e),y:Pa(s),z:0}}unproject(e,s){let c=rs(e),f=Gr(s);return new ii(c,f)}}let VM=An(Wr);class aF extends ih{project(e,s){let c=(s=An(s))*s,f=c*c;return{x:.5*((e=An(e))*(.8707-.131979*c+f*(f*(.003971*c-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+f*(.028874*c-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=25,g=0,v=c*c;do{v=c*c;let A=v*v;g=(c*(1.007226+v*(.015085+A*(.028874*v-.044475-.005916*A)))-s)/(1.007226+v*(.045255+A*(.259866*v-.311325-.005916*11*A))),c=Cn(c-g,-VM,VM)}while(Math.abs(g)>1e-6&&--f>0);v=c*c;let E=Cn(Yi(e/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),I=Yi(c);return new ii(E,I)}}let jM=An(Wr);class lF extends ih{project(e,s){s=An(s),e=An(e);let c=Math.cos(s),f=2/Math.PI,g=Math.acos(c*Math.cos(e/2)),v=Math.sin(g)/g,E=.5*(e*f+2*c*Math.sin(e/2)/v)||0,I=.5*(s+Math.sin(s)/v)||0;return{x:.5*(E/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(e,s){let c=e=(2*e-.5)*Math.PI,f=s=(2*(1-s)-1)*Math.PI,g=25,v=1e-6,E=0,I=0;do{let A=Math.cos(f),L=Math.sin(f),j=2*L*A,$=L*L,W=A*A,q=Math.cos(c/2),ee=Math.sin(c/2),ae=2*q*ee,me=ee*ee,we=1-W*q*q,ge=we?1/we:0,xe=we?Math.acos(A*q)*Math.sqrt(1/we):0,Te=.5*(2*xe*A*ee+2*c/Math.PI)-e,Ce=.5*(xe*L+f)-s,qe=.5*ge*(W*me+xe*A*q*$)+1/Math.PI,We=ge*(ae*j/4-xe*L*ee),et=.125*ge*(j*ee-xe*L*W*ae),vt=.5*ge*($*q+xe*me*A)+.5,Ke=We*et-vt*qe;E=(Ce*We-Te*vt)/Ke,I=(Te*et-Ce*qe)/Ke,c=Cn(c-E,-Math.PI,Math.PI),f=Cn(f-I,-jM,jM)}while((Math.abs(E)>v||Math.abs(I)>v)&&--g>0);return new ii(Yi(c),Yi(f))}}class UM extends ih{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(An(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){let{scale:c,cosPhi:f}=this;return{x:An(e)*f*c+.5,y:-Math.sin(An(s))/f*c+.5,z:0}}unproject(e,s){let{scale:c,cosPhi:f}=this,g=-(s-.5)/c,v=Cn(Yi((e-.5)/c)/f,-180,180),E=Math.asin(Cn(g*f,-1,1)),I=Cn(Yi(E),-Wr,Wr);return new ii(v,I)}}class cF extends BM{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,c){let f=vf(e,s,c);return tr(f,f,bf(ho(c))),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,s){let c=Zd(s.lat,s.lng),f=er([],c),g=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude;Dc(c,c,f,is(1,0)*Gt*g);let v=ra(new Float64Array(16));return Sl(v,e.pixelMatrix,e.globeMatrix),tr(c,c,v),new It(c[0],c[1])}pixelsPerMeter(e,s){return is(1,0)*s}pixelSpaceConversion(e,s,c){let f=is(1,e)*s,g=Pn(is(1,45)*s,f,c);return this.pixelsPerMeter(e,s)/g}createTileMatrix(e,s,c){let f=Jp(ho(c.canonical));return Sl(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,s){let{center:c}=e,f=bf(ho(s));return Oo(f,f,An(c.lng)),df(f,f,An(c.lat)),Ec(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,s,c,f){return bv(e,s,c,!0)||new Xd(0,0)}pointCoordinate3D(e,s,c){let f=this.pointCoordinate(e,s,c,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,s){return!bv(e,s.x,s.y,!1)}farthestPixelDistance(e){let s=function(f,g){let v=f.cameraToCenterDistance,E=f._centerAltitude*g,I=f._camera,A=f._camera.forward(),L=On([],ts([],A,-v),[0,0,E]),j=f.worldSize/(2*Math.PI),$=[0,0,-j],W=f.width/f.height,q=Math.tan(f.fovAboveCenter),ee=ts([],I.up(),q),ae=ts([],I.right(),q*W),me=er([],On([],On([],A,ee),ae)),we=[],ge;if(new Zp(L,me).closestPointOnSphere($,j,we)){let xe=On([],we,$),Te=Fo([],xe,L);ge=Math.cos(f.fovAboveCenter)*Cs(Te)}else{let xe=Fo([],L,$),Te=Fo([],$,L);er(Te,Te);let Ce=Cs(xe)-j;ge=Math.sqrt(Ce*(Ce+2*j));let qe=Math.acos(ge/(j+Ce))-Math.acos(Lo(A,Te));ge*=Math.cos(qe)}return 1.01*ge}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=Pu(e.zoom);if(c>0){let f=zM(e,is(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),v=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Pn(s,f+g*(1-Math.cos(v)),Math.pow(c,10))}return s}upVector(e,s,c){return vf(s,c,e,1)}upVectorScale(e){return{metersToTile:yf(Qp(ho(e)))}}}function $M(o){let e=o.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new BM(o);case"equirectangular":return new oF(o);case"naturalEarth":return new aF(o);case"equalEarth":return new rF(o);case"winkelTripel":return new lF(o);case"albers":return s?new UM(o):new iF(o);case"lambertConformalConic":return s?new UM(o):new sF(o);case"globe":return new cF(o)}throw new Error(`Invalid projection name: ${o.name}`)}let uF=ju.types,dF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ib(o,e,s,c,f,g,v,E,I,A,L,j,$){let W=E?Math.min(nh,Math.round(E[0])):0,q=E?Math.min(nh,Math.round(E[1])):0;o.emplaceBack(e,s,Math.round(32*c),Math.round(32*f),g,v,(W<<1)+(I?1:0),q,16*A,16*L,256*j,256*$)}function rb(o,e,s,c,f,g,v){o.emplaceBack(e,s,c,f,g,v)}function ob(o,e,s,c,f){o.emplaceBack(e,s,c,f),o.emplaceBack(e,s,c,f),o.emplaceBack(e,s,c,f),o.emplaceBack(e,s,c,f)}function hF(o){for(let e of o.sections)if($d(e.text))return!0;return!1}class o1{constructor(e){this.layoutVertexArray=new at,this.indexArray=new jt,this.programConfigurations=e,this.segments=new $i,this.dynamicLayoutVertexArray=new ut,this.opacityVertexArray=new $t,this.placedSymbolArray=new lr,this.globeExtVertexArray=new _t}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,un.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Hn.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dF,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,dn.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ot(o1,"SymbolBuffers");class s1{constructor(e,s,c){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new c,this.segments=new $i,this.collisionVertexArray=new Ht,this.collisionVertexArrayExt=new En}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,sn.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,mr.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot(s1,"CollisionBuffers");class rh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(v=>v.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ra([]),this.placementViewportMatrix=ra([]);let s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ni(this.zoom,s["text-size"]),this.iconSizeData=Ni(this.zoom,s["icon-size"]);let c=this.layers[0].layout,f=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(v=>aa[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new o1(new es(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new o1(new es(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Lr,this.lineVertexArray=new ea,this.symbolInstances=new bi}calculateGlyphDependencies(e,s,c,f,g){for(let v=0;v<e.length;v++)if(s[e.charCodeAt(v)]=!0,f&&g){let E=Is[e.charAt(v)];E&&(s[E.charCodeAt(0)]=!0)}}populate(e,s,c,f){let g=this.layers[0],v=g.layout,E=this.projection.name==="globe",I=v.get("text-font"),A=v.get("text-field"),L=v.get("icon-image"),j=(A.value.kind!=="constant"||A.value.value instanceof $r&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),$=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],!j&&!$)return;let q=s.iconDependencies,ee=s.glyphDependencies,ae=s.availableImages,me=new z(this.zoom);for(let{feature:we,id:ge,index:xe,sourceLayerIndex:Te}of e){let Ce=g._featureFilter.needGeometry,qe=Ms(we,Ce);if(!g._featureFilter.filter(me,qe,c))continue;if(Ce||(qe.geometry=sa(we,c,f)),E&&we.type!==1&&c.z<=5){let Ke=qe.geometry,ot=.98078528056,st=(dt,xt)=>Lo(vf(dt.x,dt.y,c,1),vf(xt.x,xt.y,c,1))<ot;for(let dt=0;dt<Ke.length;dt++)Ke[dt]=Mv(Ke[dt],st)}let We,et;if(j){let Ke=g.getValueAndResolveTokens("text-field",qe,c,ae),ot=$r.factory(Ke);hF(ot)&&(this.hasRTLText=!0),(!this.hasRTLText||D()==="unavailable"||this.hasRTLText&&R.isParsed())&&(We=La(ot,g,qe))}if($){let Ke=g.getValueAndResolveTokens("icon-image",qe,c,ae);et=Ke instanceof wo?Ke:wo.fromString(Ke)}if(!We&&!et)continue;let vt=this.sortFeaturesByKey?W.evaluate(qe,{},c):void 0;if(this.features.push({id:ge,text:We,icon:et,index:xe,sourceLayerIndex:Te,geometry:qe.geometry,properties:we.properties,type:uF[we.type],sortKey:vt}),et&&(q[et.name]=!0),We){let Ke=I.evaluate(qe,{},c).join(","),ot=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(aa.vertical)>=0;for(let st of We.sections)if(st.image)q[st.image.name]=!0;else{let dt=Ud(We.toString()),xt=st.fontStack||Ke,Qe=ee[xt]=ee[xt]||{};this.calculateGlyphDependencies(st.text,Qe,ot,this.allowVerticalPlacement,dt)}}}v.get("symbol-placement")==="line"&&(this.features=function(we){let ge={},xe={},Te=[],Ce=0;function qe(Ke){Te.push(we[Ke]),Ce++}function We(Ke,ot,st){let dt=xe[Ke];return delete xe[Ke],xe[ot]=dt,Te[dt].geometry[0].pop(),Te[dt].geometry[0]=Te[dt].geometry[0].concat(st[0]),dt}function et(Ke,ot,st){let dt=ge[ot];return delete ge[ot],ge[Ke]=dt,Te[dt].geometry[0].shift(),Te[dt].geometry[0]=st[0].concat(Te[dt].geometry[0]),dt}function vt(Ke,ot,st){let dt=st?ot[0][ot[0].length-1]:ot[0][0];return`${Ke}:${dt.x}:${dt.y}`}for(let Ke=0;Ke<we.length;Ke++){let ot=we[Ke],st=ot.geometry,dt=ot.text?ot.text.toString():null;if(!dt){qe(Ke);continue}let xt=vt(dt,st),Qe=vt(dt,st,!0);if(xt in xe&&Qe in ge&&xe[xt]!==ge[Qe]){let At=et(xt,Qe,st),Nt=We(xt,Qe,Te[At].geometry);delete ge[xt],delete xe[Qe],xe[vt(dt,Te[Nt].geometry,!0)]=Nt,Te[At].geometry=null}else xt in xe?We(xt,Qe,st):Qe in ge?et(xt,Qe,st):(qe(Ke),ge[xt]=Ce-1,xe[Qe]=Ce-1)}return Te.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((we,ge)=>we.sortKey-ge.sortKey)}update(e,s,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,c,f),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,c,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$M(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){let c=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:f,y:g}of s)this.lineVertexArray.emplaceBack(f,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,s,c,f,g,v,E,I,A,L,j,$,W,q){let ee=e.indexArray,ae=e.layoutVertexArray,me=e.globeExtVertexArray,we=e.segments.prepareSegment(4*s.length,ae,ee,this.canOverlap?v.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=we.vertexLength,Te=this.allowVerticalPlacement&&E===aa.vertical?Math.PI/2:0,Ce=v.text&&v.text.sections;for(let We=0;We<s.length;We++){let{tl:et,tr:vt,bl:Ke,br:ot,tex:st,pixelOffsetTL:dt,pixelOffsetBR:xt,minFontScaleX:Qe,minFontScaleY:At,glyphOffset:Nt,isSDF:Pt,sectionIndex:hn}=s[We],Et=we.vertexLength,qt=Nt[1];if(ib(ae,A.x,A.y,et.x,qt+et.y,st.x,st.y,c,Pt,dt.x,dt.y,Qe,At),ib(ae,A.x,A.y,vt.x,qt+vt.y,st.x+st.w,st.y,c,Pt,xt.x,dt.y,Qe,At),ib(ae,A.x,A.y,Ke.x,qt+Ke.y,st.x,st.y+st.h,c,Pt,dt.x,xt.y,Qe,At),ib(ae,A.x,A.y,ot.x,qt+ot.y,st.x+st.w,st.y+st.h,c,Pt,xt.x,xt.y,Qe,At),I){let{x:fn,y:ti,z:pn}=I.anchor,[Jt,Oi,yn]=I.up;rb(me,fn,ti,pn,Jt,Oi,yn),rb(me,fn,ti,pn,Jt,Oi,yn),rb(me,fn,ti,pn,Jt,Oi,yn),rb(me,fn,ti,pn,Jt,Oi,yn),ob(e.dynamicLayoutVertexArray,fn,ti,pn,Te)}else ob(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Te);ee.emplaceBack(Et,Et+1,Et+2),ee.emplaceBack(Et+1,Et+2,Et+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),We!==s.length-1&&hn===s[We+1].sectionIndex||e.programConfigurations.populatePaintArrays(ae.length,v,v.index,{},W,q,Ce&&Ce[hn])}let qe=I?I.anchor:A;e.placedSymbolArray.emplaceBack(qe.x,qe.y,qe.z,A.x,A.y,ge,this.glyphOffsetArray.length-ge,xe,L,j,A.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],E,0,!1,0,$,0)}_commitLayoutVertex(e,s,c,f,g,v,E){e.emplaceBack(s,c,f,g,v,Math.round(E.x),Math.round(E.y))}_addCollisionDebugVertices(e,s,c,f,g,v,E){let I=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),A=I.vertexLength,L=E.tileAnchorX,j=E.tileAnchorY;for(let W=0;W<4;W++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),c.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(c.layoutVertexArray,f,g,v,L,j,new It(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,v,L,j,new It(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,v,L,j,new It(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,g,v,L,j,new It(e.x1,e.y2)),I.vertexLength+=4;let $=c.indexArray;$.emplaceBack(A,A+1),$.emplaceBack(A+1,A+2),$.emplaceBack(A+2,A+3),$.emplaceBack(A+3,A),I.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,c,f,g,v){for(let E=f;E<g;E++){let I=c.get(E),A=this.getSymbolInstanceTextSize(e,v,s,E);this._addCollisionDebugVertices(I,A,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(e,s,c,f,g,v){for(let E=f;E<g;E++){let I=c.get(E),A=this.getSymbolInstanceIconSize(e,s,v.placedIconSymbolIndex);this._addCollisionDebugVertices(I,A,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,v)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new s1(Ft,Gi.members,pr),this.iconCollisionBox=new s1(Ft,Gi.members,pr);let c=Wi(this.iconSizeData,e),f=Wi(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){let v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,e,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,e,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,e,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,e,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,s,c,f){let g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:f),v=kr(this.textSizeData,e,g)/Mn;return this.tilePixelRatio*v}getSymbolInstanceIconSize(e,s,c){let f=this.icon.placedSymbolArray.get(c),g=kr(this.iconSizeData,e,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,s,c){e.emplaceBack(s,-c,-c),e.emplaceBack(s,c,-c),e.emplaceBack(s,c,c),e.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(e,s,c,f,g,v){for(let E=f;E<g;E++){let I=c.get(E),A=this.getSymbolInstanceTextSize(e,v,s,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,I.padding)}}_updateIconDebugCollisionBoxes(e,s,c,f,g,v){for(let E=f;E<g;E++){let I=c.get(E),A=this.getSymbolInstanceIconSize(e,s,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,I.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let c=Wi(this.iconSizeData,e),f=Wi(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){let v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,e,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(f,e,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(c,e,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,e,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,c,f,g,v,E,I,A){let L={};if(s<c){let{x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe,featureIndex:Te}=e.get(s);L.textBox={x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe},L.textFeatureIndex=Te}if(f<g){let{x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe,featureIndex:Te}=e.get(f);L.verticalTextBox={x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe},L.verticalTextFeatureIndex=Te}if(v<E){let{x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe,featureIndex:Te}=e.get(v);L.iconBox={x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe},L.iconFeatureIndex=Te}if(I<A){let{x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe,featureIndex:Te}=e.get(I);L.verticalIconBox={x1:j,y1:$,x2:W,y2:q,padding:ee,projectedAnchorX:ae,projectedAnchorY:me,projectedAnchorZ:we,tileAnchorX:ge,tileAnchorY:xe},L.verticalIconFeatureIndex=Te}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){let c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){let c=e.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<f;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let s=Math.sin(e),c=Math.cos(e),f=[],g=[],v=[];for(let E=0;E<this.symbolInstances.length;++E){v.push(E);let I=this.symbolInstances.get(E);f.push(0|Math.round(s*I.tileAnchorX+c*I.tileAnchorY)),g.push(I.featureIndex)}return v.sort((E,I)=>f[E]-f[I]||g[I]-g[E]),v}addToSortKeyRanges(e,s){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let s of this.symbolInstanceIndexes){let c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);let{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:E,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:A}=c;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&v!==g&&v!==f&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.text,E),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ot(rh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),rh.MAX_GLYPHS=65535,rh.addDynamicAttributes=ob;let fF=new _e({"symbol-placement":new Q(Je.layout_symbol["symbol-placement"]),"symbol-spacing":new Q(Je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Q(Je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ue(Je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Q(Je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Q(Je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Q(Je.layout_symbol["icon-ignore-placement"]),"icon-optional":new Q(Je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Q(Je.layout_symbol["icon-rotation-alignment"]),"icon-size":new ue(Je.layout_symbol["icon-size"]),"icon-text-fit":new Q(Je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Q(Je.layout_symbol["icon-text-fit-padding"]),"icon-image":new ue(Je.layout_symbol["icon-image"]),"icon-rotate":new ue(Je.layout_symbol["icon-rotate"]),"icon-padding":new Q(Je.layout_symbol["icon-padding"]),"icon-keep-upright":new Q(Je.layout_symbol["icon-keep-upright"]),"icon-offset":new ue(Je.layout_symbol["icon-offset"]),"icon-anchor":new ue(Je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Q(Je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Q(Je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Q(Je.layout_symbol["text-rotation-alignment"]),"text-field":new ue(Je.layout_symbol["text-field"]),"text-font":new ue(Je.layout_symbol["text-font"]),"text-size":new ue(Je.layout_symbol["text-size"]),"text-max-width":new ue(Je.layout_symbol["text-max-width"]),"text-line-height":new ue(Je.layout_symbol["text-line-height"]),"text-letter-spacing":new ue(Je.layout_symbol["text-letter-spacing"]),"text-justify":new ue(Je.layout_symbol["text-justify"]),"text-radial-offset":new ue(Je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Q(Je.layout_symbol["text-variable-anchor"]),"text-anchor":new ue(Je.layout_symbol["text-anchor"]),"text-max-angle":new Q(Je.layout_symbol["text-max-angle"]),"text-writing-mode":new Q(Je.layout_symbol["text-writing-mode"]),"text-rotate":new ue(Je.layout_symbol["text-rotate"]),"text-padding":new Q(Je.layout_symbol["text-padding"]),"text-keep-upright":new Q(Je.layout_symbol["text-keep-upright"]),"text-transform":new ue(Je.layout_symbol["text-transform"]),"text-offset":new ue(Je.layout_symbol["text-offset"]),"text-allow-overlap":new Q(Je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Q(Je.layout_symbol["text-ignore-placement"]),"text-optional":new Q(Je.layout_symbol["text-optional"])});var a1={paint:new _e({"icon-opacity":new ue(Je.paint_symbol["icon-opacity"]),"icon-color":new ue(Je.paint_symbol["icon-color"]),"icon-halo-color":new ue(Je.paint_symbol["icon-halo-color"]),"icon-halo-width":new ue(Je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ue(Je.paint_symbol["icon-halo-blur"]),"icon-translate":new Q(Je.paint_symbol["icon-translate"]),"icon-translate-anchor":new Q(Je.paint_symbol["icon-translate-anchor"]),"text-opacity":new ue(Je.paint_symbol["text-opacity"]),"text-color":new ue(Je.paint_symbol["text-color"],{runtimeType:bo,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ue(Je.paint_symbol["text-halo-color"]),"text-halo-width":new ue(Je.paint_symbol["text-halo-width"]),"text-halo-blur":new ue(Je.paint_symbol["text-halo-blur"]),"text-translate":new Q(Je.paint_symbol["text-translate"]),"text-translate-anchor":new Q(Je.paint_symbol["text-translate-anchor"])}),layout:fF};class HM{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ja,this.defaultValue=e}evaluate(e){if(e.formattedSection){let s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(HM,"FormatSectionOverride",{omit:["defaultValue"]});class sb extends Es{constructor(e){super(e,a1)}recalculate(e,s){super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let c=this.layout.get("text-writing-mode");if(c){let f=[];for(let g of c)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,c,f){let g=this.layout.get(e).evaluate(s,{},c,f),v=this._unevaluatedLayout._values[e];return v.isDataDriven()||bl(v.value)||!g?g:function(E,I){return I.replace(/{([^{}]+)}/g,(A,L)=>L in E?String(E[L]):"")}(s.properties,g)}createBucket(e){return new rh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of a1.paint.overridableProperties){if(!sb.hasPaintOverride(this.layout,e))continue;let s=this.paint.get(e),c=new HM(s),f=new zd(c,s.property.specification),g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new Bd("source",f):new Ma("composite",f,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new he(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&sb.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){let c=e.get("text-field"),f=a1.paint.properties[s],g=!1,v=E=>{for(let I of E)if(f.overrides&&f.overrides.hasOverride(I))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof $r)v(c.value.value.sections);else if(c.value.kind==="source"){let E=A=>{g||(A instanceof Ao&&ji(A.value)===nu?v(A.value.sections):A instanceof Ea?v(A.sections):A.eachChild(E))},I=c.value;I._styleExpression&&E(I._styleExpression.expression)}return g}getProgramConfiguration(e){return new Il(this,e)}}var pF={paint:new _e({"background-color":new Q(Je.paint_background["background-color"]),"background-pattern":new Q(Je.paint_background["background-pattern"]),"background-opacity":new Q(Je.paint_background["background-opacity"])})},mF={paint:new _e({"raster-opacity":new Q(Je.paint_raster["raster-opacity"]),"raster-hue-rotate":new Q(Je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Q(Je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Q(Je.paint_raster["raster-brightness-max"]),"raster-saturation":new Q(Je.paint_raster["raster-saturation"]),"raster-contrast":new Q(Je.paint_raster["raster-contrast"]),"raster-resampling":new Q(Je.paint_raster["raster-resampling"]),"raster-fade-duration":new Q(Je.paint_raster["raster-fade-duration"])})};class gF extends Es{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var yF={paint:new _e({"sky-type":new Q(Je.paint_sky["sky-type"]),"sky-atmosphere-sun":new Q(Je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Q(Je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Q(Je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Q(Je.paint_sky["sky-gradient-radius"]),"sky-gradient":new ye(Je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Q(Je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Q(Je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Q(Je.paint_sky["sky-opacity"])})};function l1(o,e,s){let c=[0,0,1],f=ff([]);return qp(f,f,s?-An(o)+Math.PI:An(o)),Wp(f,f,-An(e)),ay(c,c,f),er(c,c)}let _F={circle:class extends Es{constructor(o){super(o,Cf)}createBucket(o){return new Kd(o)}queryRadius(o){let e=o;return Nu("circle-radius",this,e)+Nu("circle-stroke-width",this,e)+zu(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,s,c,f,g,v,E){let I=my(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Rv(o,c,g,v,E,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",I,A)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Il(this,o)}},heatmap:class extends Es{createBucket(o){return new Ov(o)}constructor(o){super(o,Fv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Nu("heatmap-radius",this,o)}queryIntersectsFeature(o,e,s,c,f,g,v,E){let I=this.paint.get("heatmap-radius").evaluate(e,s);return Rv(o,c,g,v,E,!0,!0,new It(0,0),I)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Il(this,o)}},hillshade:class extends Es{constructor(o){super(o,by)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Es{constructor(o){super(o,$v)}getProgramIds(){let o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Il(this,o)}recalculate(o,e){super.recalculate(o,e);let s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Sf(o)}queryRadius(){return zu(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,s,c,f,g){return!o.queryGeometry.isAboveHorizon&&Ic(kv(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Es{constructor(o){super(o,X)}createBucket(o){return new y(o)}queryRadius(){return zu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Il(this,o)}queryIntersectsFeature(o,e,s,c,f,g,v,E,I){let A=my(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(e,s),j=this.paint.get("fill-extrusion-base").evaluate(e,s),$=[0,0],W=E&&g.elevation,q=g.elevation?g.elevation.exaggeration():1,ee=o.tile.getBucket(this);if(W&&ee instanceof y){let xe=ee.centroidVertexArray,Te=I+1;Te<xe.length&&($[0]=xe.geta_centroid_pos0(Te),$[1]=xe.geta_centroid_pos1(Te))}if($[0]===0&&$[1]===1)return!1;g.projection.name==="globe"&&(c=N([c],[new It(0,0),new It(Gt,Gt)],o.tileID.canonical).map(xe=>xe.polygon).flat());let ae=W?E:null,[me,we]=function(xe,Te,Ce,qe,We,et,vt,Ke,ot,st,dt){return xe.projection.name==="globe"?function(xt,Qe,At,Nt,Pt,hn,Et,qt,fn,ti,pn){let Jt=[],Oi=[],yn=xt.projection.upVectorScale(pn,xt.center.lat,xt.worldSize).metersToTile,_n=[0,0,0,1],wi=[0,0,0,1],Ai=(Ei,qi,cr,xr)=>{Ei[0]=qi,Ei[1]=cr,Ei[2]=xr,Ei[3]=1},ki=B();At>0&&(At+=ki),Nt+=ki;for(let Ei of Qe){let qi=[],cr=[];for(let xr of Ei){let Ci=xr.x+Pt.x,Rr=xr.y+Pt.y,wr=xt.projection.projectTilePoint(Ci,Rr,pn),nr=xt.projection.upVector(pn,xr.x,xr.y),ri=At,Er=Nt;if(Et){let Ri=Le(Ci,Rr,At,Nt,Et,qt,fn,ti);ri+=Ri.base,Er+=Ri.top}At!==0?Ai(_n,wr.x+nr[0]*yn*ri,wr.y+nr[1]*yn*ri,wr.z+nr[2]*yn*ri):Ai(_n,wr.x,wr.y,wr.z),Ai(wi,wr.x+nr[0]*yn*Er,wr.y+nr[1]*yn*Er,wr.z+nr[2]*yn*Er),tr(_n,_n,hn),tr(wi,wi,hn),qi.push(new de(_n[0],_n[1],_n[2])),cr.push(new de(wi[0],wi[1],wi[2]))}Jt.push(qi),Oi.push(cr)}return[Jt,Oi]}(xe,Te,Ce,qe,We,et,vt,Ke,ot,st,dt):vt?function(xt,Qe,At,Nt,Pt,hn,Et,qt,fn){let ti=[],pn=[],Jt=[0,0,0,1];for(let Oi of xt){let yn=[],_n=[];for(let wi of Oi){let Ai=wi.x+Nt.x,ki=wi.y+Nt.y,Ei=Le(Ai,ki,Qe,At,hn,Et,qt,fn);Jt[0]=Ai,Jt[1]=ki,Jt[2]=Ei.base,Jt[3]=1,Ru(Jt,Jt,Pt),Jt[3]=Math.max(Jt[3],1e-5);let qi=new de(Jt[0]/Jt[3],Jt[1]/Jt[3],Jt[2]/Jt[3]);Jt[0]=Ai,Jt[1]=ki,Jt[2]=Ei.top,Jt[3]=1,Ru(Jt,Jt,Pt),Jt[3]=Math.max(Jt[3],1e-5);let cr=new de(Jt[0]/Jt[3],Jt[1]/Jt[3],Jt[2]/Jt[3]);yn.push(qi),_n.push(cr)}ti.push(yn),pn.push(_n)}return[ti,pn]}(Te,Ce,qe,We,et,vt,Ke,ot,st):function(xt,Qe,At,Nt,Pt){let hn=[],Et=[],qt=Pt[8]*Qe,fn=Pt[9]*Qe,ti=Pt[10]*Qe,pn=Pt[11]*Qe,Jt=Pt[8]*At,Oi=Pt[9]*At,yn=Pt[10]*At,_n=Pt[11]*At;for(let wi of xt){let Ai=[],ki=[];for(let Ei of wi){let qi=Ei.x+Nt.x,cr=Ei.y+Nt.y,xr=Pt[0]*qi+Pt[4]*cr+Pt[12],Ci=Pt[1]*qi+Pt[5]*cr+Pt[13],Rr=Pt[2]*qi+Pt[6]*cr+Pt[14],wr=Pt[3]*qi+Pt[7]*cr+Pt[15],nr=xr+qt,ri=Ci+fn,Er=Rr+ti,Ri=Math.max(wr+pn,1e-5),No=xr+Jt,Cr=Ci+Oi,no=Rr+yn,qr=Math.max(wr+_n,1e-5);Ai.push(new de(nr/Ri,ri/Ri,Er/Ri)),ki.push(new de(No/qr,Cr/qr,no/qr))}hn.push(Ai),Et.push(ki)}return[hn,Et]}(Te,Ce,qe,We,et)}(g,c,j,L,A,v,ae,$,q,g.center.lat,o.tileID.canonical),ge=o.queryGeometry;return function(xe,Te,Ce){let qe=1/0;Ic(Ce,Te)&&(qe=Ue(Ce,Te[0]));for(let We=0;We<Te.length;We++){let et=Te[We],vt=xe[We];for(let Ke=0;Ke<et.length-1;Ke++){let ot=et[Ke],st=[ot,et[Ke+1],vt[Ke+1],vt[Ke],ot];Iv(Ce,st)&&(qe=Math.min(qe,Ue(Ce,st)))}}return qe!==1/0&&qe}(me,we,ge.isPointQuery()?ge.screenBounds:ge.screenGeometry)}},line:class extends Es{constructor(o){super(o,Yt),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Nh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=zt.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Lt(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Il(this,o)}queryRadius(o){let e=o,s=Tn(Nu("line-width",this,e),Nu("line-gap-width",this,e)),c=Nu("line-offset",this,e);return s/2+Math.abs(c)+zu(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,s,c,f,g){if(o.queryGeometry.isAboveHorizon)return!1;let v=kv(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),E=o.pixelToTileUnitsFactor/2*Tn(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),I=this.paint.get("line-offset").evaluate(e,s);return I&&(c=function(A,L){let j=[],$=new It(0,0);for(let W=0;W<A.length;W++){let q=A[W],ee=[];for(let ae=0;ae<q.length;ae++){let me=q[ae],we=q[ae+1],ge=ae===0?$:me.sub(q[ae-1])._unit()._perp(),xe=ae===q.length-1?$:we.sub(me)._unit()._perp(),Te=ge._add(xe)._unit();Te._mult(1/(Te.x*xe.x+Te.y*xe.y)),ee.push(Te._mult(L)._add(me))}j.push(ee)}return j}(c,I*o.pixelToTileUnitsFactor)),function(A,L,j){for(let $=0;$<L.length;$++){let W=L[$];if(A.length>=3){for(let q=0;q<W.length;q++)if(Fu(A,W[q]))return!0}if(Sv(A,W,j))return!0}return!1}(v,c,E)}isTileClipped(){return!0}},symbol:sb,background:class extends Es{constructor(o){super(o,pF)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Es{constructor(o){super(o,mF)}getProgramIds(){return["raster"]}},sky:class extends Es{constructor(o){super(o,yF),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){let c=this.paint.get("sky-atmosphere-sun"),f=!c,g=o.style.light,v=g.properties.get("position");return f&&g.properties.get("anchor")==="viewport"&&_i("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?l1(v.azimuthal,90-v.polar,e):l1(c[0],90-c[1],e)}let s=this.paint.get("sky-gradient-center");return l1(s[0],90-s[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class jy{constructor(e,s,c,f){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(s,f)}update(e,s,c){let{width:f,height:g}=e,{context:v}=this,{gl:E}=v,{HTMLImageElement:I,HTMLCanvasElement:A,HTMLVideoElement:L,ImageData:j,ImageBitmap:$}=C;if(E.bindTexture(E.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),c||this.size&&this.size[0]===f&&this.size[1]===g){let{x:W,y:q}=c||{x:0,y:0};e instanceof I||e instanceof A||e instanceof L||e instanceof j||$&&e instanceof $?E.texSubImage2D(E.TEXTURE_2D,0,W,q,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,W,q,f,g,E.RGBA,E.UNSIGNED_BYTE,e.data)}else this.size=[f,g],e instanceof I||e instanceof A||e instanceof L||e instanceof j||$&&e instanceof $?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,f,g,0,this.format,E.UNSIGNED_BYTE,e.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&E.generateMipmap(E.TEXTURE_2D)}bind(e,s){let{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class vF{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class bF{constructor(){this.tasks={},this.taskQueue=[],_a(["process"],this),this.invoker=new vF(this.process),this.nextId=0}add(e,s){let c=this.nextId++,f=function({type:g,isSymbolTile:v,zoom:E}){return E=E||0,g==="message"?0:g!=="maybePrepare"||v?g!=="parseTile"||v?g==="parseTile"&&v?300-E:g==="maybePrepare"&&v?400-E:500:200-E:100-E}(s);if(f===0){ps();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:e,metadata:s,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){ps();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let f=0;f<this.taskQueue.length;f++){let g=this.tasks[this.taskQueue[f]];g.priority<s&&(s=g.priority,e=f)}if(e===null)return null;let c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class GM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){let c=e[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let xF=["tile","layer","source","sourceLayer","state"];class WM{constructor(e,s,c,f,g){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=c,this._y=f,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let s of xF)this[s]!==void 0&&(e[s]=this[s]);return e}}let Fa=32,Ac=33,oh=new Uint16Array(8184);for(let o=0;o<2046;o++){let e=o+2,s=0,c=0,f=0,g=0,v=0,E=0;for(1&e?f=g=v=Fa:s=c=E=Fa;(e>>=1)>1;){let A=s+f>>1,L=c+g>>1;1&e?(f=s,g=c,s=v,c=E):(s=f,c=g,f=v,g=E),v=A,E=L}let I=4*o;oh[I+0]=s,oh[I+1]=c,oh[I+2]=f,oh[I+3]=g}let kc=new Uint16Array(2178),sh=new Uint8Array(1089),ab=new Uint16Array(1089);function qM(o){return o===0?-.03125:o===32?.03125:0}var ZM=Fe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let XM={type:2,extent:Gt,loadGeometry:()=>[[new It(0,0),new It(Gt+1,0),new It(Gt+1,Gt+1),new It(0,Gt+1),new It(0,0)]]};class c1{constructor(e,s,c,f,g){this.tileID=e,this.uid=Za(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(e){let s=e+this.timeAdded;s<gs.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=kf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,c){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,g){let v={};if(!g)return v;for(let E of f){let I=E.layerIds.map(A=>g.getLayer(A)).filter(Boolean);if(I.length!==0){E.layers=I,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(A=>I.filter(L=>L.id===A)[0]));for(let A of I)v[A.id]=E}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(let f in this.buckets){let g=this.buckets[f];if(g instanceof rh){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let f in this.buckets){let g=this.buckets[f];if(g instanceof rh&&g.hasRTLText){this.hasRTLText=!0,R.isLoading()||R.isLoaded()||D()!=="deferred"||k();break}}this.queryPadding=0;for(let f in this.buckets){let g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(f).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new fi}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(let c in this.buckets){let f=this.buckets[c];f.uploadPending()&&f.upload(e)}let s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new jy(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new jy(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new jy(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,c,f,g,v,E,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:E,transform:v,params:g,tileTransform:this.tileTransform},e,s,c):{}}querySourceFeatures(e,s){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let f=c.loadVTLayers(),g=s?s.sourceLayer:"",v=f._geojsonTileLayer||f[g];if(!v)return;let E=wl(s&&s.filter),{z:I,x:A,y:L}=this.tileID.canonical,j={z:I,x:A,y:L};for(let $=0;$<v.length;$++){let W=v.feature($);if(E.needGeometry){let ae=Ms(W,!0);if(!E.filter(new z(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!E.filter(new z(this.tileID.overscaledZ),W))continue;let q=c.getId(W,g),ee=new WM(W,I,A,L,q);ee.tile=j,e.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let s=this.expirationTime;if(e.cacheControl){let c=Kr(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let c=Date.now(),f=!1;if(this.expirationTime>c)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{let g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!s)return;let c=this.latestFeatureIndex.loadVTLayers(),f=s.style.listImages();for(let g in this.buckets){if(!s.style.hasLayer(g))continue;let v=this.buckets[g],E=v.layers[0].sourceLayer||"_geojsonTileLayer",I=c[E],A=e[E];if(!I||!A||Object.keys(A).length===0)continue;if(v.update(A,I,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof Lt||v instanceof Sf){let j=s.style._getSourceCache(v.layers[0].source);s._terrain&&s._terrain.enabled&&j&&v.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(j.id,this.tileID)}let L=s&&s.style&&s.style.getLayer(g);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<gs.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=gs.now()+e}setTexture(e,s){let c=s.context,f=c.gl;this.texture=this.texture||s.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new jy(c,e,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(e,s){let c={};for(let f of s)c[f]=!0;this.dependencies[e]=c}hasDependency(e,s){for(let c of e){let f=this.dependencies[c];if(f){for(let g of s)if(f[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;let c=sa(XM,this.tileID.canonical,this.tileTransform)[0],f=new mt,g=new Co;for(let v=0;v<c.length;v++){let{x:E,y:I}=c[v];f.emplaceBack(E,I),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(f,Wd.members),this._tileDebugSegments=$i.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;let c=sa(XM,this.tileID.canonical,this.tileTransform)[0],f,g;if(this.isRaster){let v=function(E,I){let A=kf(E,I),L=Math.pow(2,E.z);for(let ae=0;ae<Ac;ae++)for(let me=0;me<Ac;me++){let we=rs((E.x+(me+qM(me))/Fa)/L),ge=Gr((E.y+(ae+qM(ae))/Fa)/L),xe=I.project(we,ge),Te=ae*Ac+me;kc[2*Te+0]=Math.round((xe.x*A.scale-A.x)*Gt),kc[2*Te+1]=Math.round((xe.y*A.scale-A.y)*Gt)}sh.fill(0),ab.fill(0);for(let ae=2045;ae>=0;ae--){let me=4*ae,we=oh[me+0],ge=oh[me+1],xe=oh[me+2],Te=oh[me+3],Ce=we+xe>>1,qe=ge+Te>>1,We=Ce+qe-ge,et=qe+we-Ce,vt=ge*Ac+we,Ke=Te*Ac+xe,ot=qe*Ac+Ce,st=Math.hypot((kc[2*vt+0]+kc[2*Ke+0])/2-kc[2*ot+0],(kc[2*vt+1]+kc[2*Ke+1])/2-kc[2*ot+1])>=16;sh[ot]=sh[ot]||(st?1:0),ae<1022&&(sh[ot]=sh[ot]||sh[(ge+et>>1)*Ac+(we+We>>1)]||sh[(Te+et>>1)*Ac+(xe+We>>1)])}let j=new it,$=new jt,W=0;function q(ae,me){let we=me*Ac+ae;return ab[we]===0&&(j.emplaceBack(kc[2*we+0],kc[2*we+1],ae*Gt/Fa,me*Gt/Fa),ab[we]=++W),ab[we]-1}function ee(ae,me,we,ge,xe,Te){let Ce=ae+we>>1,qe=me+ge>>1;if(Math.abs(ae-xe)+Math.abs(me-Te)>1&&sh[qe*Ac+Ce])ee(xe,Te,ae,me,Ce,qe),ee(we,ge,xe,Te,Ce,qe);else{let We=q(ae,me),et=q(we,ge),vt=q(xe,Te);$.emplaceBack(We,et,vt)}}return ee(0,0,Fa,Fa,Fa,0),ee(Fa,Fa,0,0,0,Fa),{vertices:j,indices:$}}(this.tileID.canonical,s);f=v.vertices,g=v.indices}else{f=new it,g=new jt;for(let{x:E,y:I}of c)f.emplaceBack(E,I,0,0);let v=Ty(f.int16,void 0,4);for(let E=0;E<v.length;E+=3)g.emplaceBack(v[E],v[E+1],v[E+2])}this._tileBoundsBuffer=e.createVertexBuffer(f,ZM.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(g),this._tileBoundsSegments=$i.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(e,s){let c=s.projection;if(!c||c.name!=="globe"||s.freezeTileCoverage)return;let f=this.tileID.canonical,g=bf(xv(f,s)),v=Pu(s.zoom),E;v>0&&(E=$p(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,f,s,g,E,v),this._makeGlobeTileDebugTextBuffer(e,f,s,g,E,v)}_globePoint(e,s,c,f,g,v,E){let I=vf(e,s,c);if(v){let A=1<<c.z,L=oa(f.center.lng),j=Pa(f.center.lat),$=(c.x+.5)/A-L,W=0;$>.5?W=-1:$<-.5&&(W=1);let q=(e/Gt+c.x)/A+W,ee=(s/Gt+c.y)/A;q=(q-L)*f._pixelsPerMercatorPixel+L,ee=(ee-j)*f._pixelsPerMercatorPixel+j;let ae=[q*f.worldSize,ee*f.worldSize,0];tr(ae,ae,v),I=Pl(I,ae,E)}return tr(I,I,g)}_makeGlobeTileDebugBorderBuffer(e,s,c,f,g,v){let E=new mt,I=new Co,A=new He,L=($,W,q,ee,ae)=>{let me=(q-$)/(ae-1),we=(ee-W)/(ae-1),ge=E.length;for(let xe=0;xe<ae;xe++){let Te=$+xe*me,Ce=W+xe*we;E.emplaceBack(Te,Ce);let qe=this._globePoint(Te,Ce,s,c,f,g,v);A.emplaceBack(qe[0],qe[1],qe[2]),I.emplaceBack(ge+xe)}},j=Gt;L(0,0,j,0,16),L(j,0,j,j,16),L(j,j,0,j,16),L(0,j,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(I),this._tileDebugBuffer=e.createVertexBuffer(E,Wd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(A,vv.members),this._tileDebugSegments=$i.simpleSegment(0,0,E.length,I.length)}_makeGlobeTileDebugTextBuffer(e,s,c,f,g,v){let E=Gt/4,I=new mt,A=new jt,L=new He,j=25;A.reserve(32),I.reserve(j),L.reserve(j);let $=(W,q)=>j*W+q;for(let W=0;W<j;W++){let q=W*E;for(let ee=0;ee<j;ee++){let ae=ee*E;I.emplaceBack(ae,q);let me=this._globePoint(ae,q,s,c,f,g,v);L.emplaceBack(me[0],me[1],me[2])}}for(let W=0;W<4;W++)for(let q=0;q<4;q++){let ee=$(W,q),ae=$(W,q+1),me=$(W+1,q),we=$(W+1,q+1);A.emplaceBack(ee,ae,me),A.emplaceBack(me,ae,we)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(A),this._tileDebugTextBuffer=e.createVertexBuffer(I,Wd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(L,vv.members),this._tileDebugTextSegments=$i.simpleSegment(0,0,j,32)}}class wF{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,c){let f=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Fi(this.stateChanges[e][f],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(let g in this.state[e])g!==f&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(let g in this.state[e][f])c[g]||(this.deletedStates[e][f][g]=null)}else for(let g in c)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][g]===null&&delete this.deletedStates[e][f][g]}removeFeatureState(e,s,c){if(this.deletedStates[e]===null)return;let f=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&s!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][c]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(c in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][c]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,s){let c=String(s),f=Fi({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let g=this.deletedStates[e][s];if(g===null)return{};for(let v in g)delete f[v]}return f}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){let c={};for(let f in this.stateChanges){this.state[f]=this.state[f]||{};let g={};for(let v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),Fi(this.state[f][v],this.stateChanges[f][v]),g[v]=this.state[f][v];c[f]=g}for(let f in this.deletedStates){this.state[f]=this.state[f]||{};let g={};if(this.deletedStates[f]===null)for(let v in this.state[f])g[v]={},this.state[f][v]={};else for(let v in this.deletedStates[f]){if(this.deletedStates[f][v]===null)this.state[f][v]={};else if(this.state[f][v])for(let E of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][E];g[v]=this.state[f][v]}c[f]=c[f]||{},Fi(c[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let f in e)e[f].setFeatureState(c,s)}}class YM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){let c=this.toIdx(e,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function KM(o,e,s,c){let f=0,g=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(c[v])<1e-15){if(s[v]<o[v]||s[v]>e[v])return null}else{let E=1/c[v],I=(o[v]-s[v])*E,A=(e[v]-s[v])*E;if(I>A){let L=I;I=A,A=L}if(I>f&&(f=I),A<g&&(g=A),f>g)return null}return f}function QM(o,e,s,c,f,g,v,E,I,A,L){let j=c-o,$=f-e,W=g-s,q=v-o,ee=E-e,ae=I-s,me=L[1]*ae-L[2]*ee,we=L[2]*q-L[0]*ae,ge=L[0]*ee-L[1]*q,xe=j*me+$*we+W*ge;if(Math.abs(xe)<1e-15)return null;let Te=1/xe,Ce=A[0]-o,qe=A[1]-e,We=A[2]-s,et=(Ce*me+qe*we+We*ge)*Te;if(et<0||et>1)return null;let vt=qe*W-We*$,Ke=We*j-Ce*W,ot=Ce*$-qe*j,st=(L[0]*vt+L[1]*Ke+L[2]*ot)*Te;return st<0||et+st>1?null:(q*vt+ee*Ke+ae*ot)*Te}function JM(o,e,s){return(o-e)/(s-e)}function eI(o,e,s,c,f,g,v,E,I){let A=1<<s,L=g-c,j=v-f,$=(o+1)/A*L+c,W=(e+0)/A*j+f,q=(e+1)/A*j+f;E[0]=(o+0)/A*L+c,E[1]=W,I[0]=$,I[1]=q}class tI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let s=function(g){let v=Math.ceil(Math.log2(g.dim/8)),E=[],I=Math.ceil(Math.pow(2,v)),A=1/I,L=(W,q,ee,ae,me)=>{let we=ae?1:0,ge=(W+1)*ee-we,xe=q*ee,Te=(q+1)*ee-we;me[0]=W*ee,me[1]=xe,me[2]=ge,me[3]=Te},j=new YM(I),$=[];for(let W=0;W<I*I;W++){L(W%I,Math.floor(W/I),A,!1,$);let q=ah($[0],$[1],g),ee=ah($[2],$[1],g),ae=ah($[2],$[3],g),me=ah($[0],$[3],g);j.minimums.push(Math.min(q,ee,ae,me)),j.maximums.push(Math.max(q,ee,ae,me)),j.leaves.push(1)}for(E.push(j),I/=2;I>=1;I/=2){let W=E[E.length-1];j=new YM(I);for(let q=0;q<I*I;q++){L(q%I,Math.floor(q/I),2,!0,$);let ee=W.getElevation($[0],$[1]),ae=W.getElevation($[2],$[1]),me=W.getElevation($[2],$[3]),we=W.getElevation($[0],$[3]),ge=W.isLeaf($[0],$[1]),xe=W.isLeaf($[2],$[1]),Te=W.isLeaf($[2],$[3]),Ce=W.isLeaf($[0],$[3]),qe=Math.min(ee.min,ae.min,me.min,we.min),We=Math.max(ee.max,ae.max,me.max,we.max),et=ge&&xe&&Te&&Ce;j.maximums.push(We),j.minimums.push(qe),j.leaves.push(We-qe<=5&&et?1:0)}E.push(j)}return E}(this.dem),c=s.length-1,f=s[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(e,s,c,f,g,v,E=1){return KM([e,s,-100],[c,f,this.maximums[0]*E],g,v)}raycast(e,s,c,f,g,v,E=1){if(!this.nodeCount)return null;let I=this.raycastRoot(e,s,c,f,g,v,E);if(I==null)return null;let A=[],L=[],j=[],$=[],W=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;W.length>0;){let{idx:q,t:ee,nodex:ae,nodey:me,depth:we}=W.pop();if(this.leaves[q]){eI(ae,me,we,e,s,c,f,j,$);let xe=1<<we,Te=(ae+0)/xe,Ce=(ae+1)/xe,qe=(me+0)/xe,We=(me+1)/xe,et=ah(Te,qe,this.dem)*E,vt=ah(Ce,qe,this.dem)*E,Ke=ah(Ce,We,this.dem)*E,ot=ah(Te,We,this.dem)*E,st=QM(j[0],j[1],et,$[0],j[1],vt,$[0],$[1],Ke,g,v),dt=QM($[0],$[1],Ke,j[0],$[1],ot,j[0],j[1],et,g,v),xt=Math.min(st!==null?st:Number.MAX_VALUE,dt!==null?dt:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{let Qe=Dc([],g,v,ee);if(nI(et,vt,ot,Ke,JM(Qe[0],j[0],$[0]),JM(Qe[1],j[1],$[1]))>=Qe[2])return ee}continue}let ge=0;for(let xe=0;xe<this._siblingOffset.length;xe++){eI((ae<<1)+this._siblingOffset[xe][0],(me<<1)+this._siblingOffset[xe][1],we+1,e,s,c,f,j,$),j[2]=-100,$[2]=this.maximums[this.childOffsets[q]+xe]*E;let Te=KM(j,$,g,v);if(Te!=null){let Ce=Te;A[xe]=Ce;let qe=!1;for(let We=0;We<ge&&!qe;We++)Ce>=A[L[We]]&&(L.splice(We,0,xe),qe=!0);qe||(L[ge]=xe),ge++}}for(let xe=0;xe<ge;xe++){let Te=L[xe];W.push({idx:this.childOffsets[q]+Te,t:A[Te],nodex:(ae<<1)+this._siblingOffset[Te][0],nodey:(me<<1)+this._siblingOffset[Te][1],depth:we+1})}}return null}_addNode(e,s,c){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,c,f,g){if(e[f].isLeaf(s,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);let v=f-1,E=e[v],I=0,A=0;for(let L=0;L<this._siblingOffset.length;L++){let j=2*s+this._siblingOffset[L][0],$=2*c+this._siblingOffset[L][1],W=E.getElevation(j,$),q=E.isLeaf(j,$),ee=this._addNode(W.min,W.max,q);q&&(I|=1<<L),A||(A=ee)}for(let L=0;L<this._siblingOffset.length;L++)I&1<<L||this._construct(e,2*s+this._siblingOffset[L][0],2*c+this._siblingOffset[L][1],v,A+L)}}function nI(o,e,s,c,f,g){return Pn(Pn(o,s,g),Pn(e,c,g),f)}function ah(o,e,s){let c=s.dim,f=Cn(o*c-.5,0,c-1),g=Cn(e*c-.5,0,c-1),v=Math.floor(f),E=Math.floor(g),I=Math.min(v+1,c-1),A=Math.min(E+1,c-1);return nI(s.get(v,E),s.get(I,E),s.get(v,A),s.get(I,A),f-v,g-E)}let iI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function EF(o,e,s){return(256*o*256+256*e+s)/10-1e4}function CF(o,e,s){return 256*o+e+s/256-32768}class lb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,c,f=!1,g=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return _i(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;let v=this.dim=s.height-2,E=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let I=0;I<v;I++)E[this._idx(-1,I)]=E[this._idx(0,I)],E[this._idx(v,I)]=E[this._idx(v-1,I)],E[this._idx(I,-1)]=E[this._idx(I,0)],E[this._idx(I,v)]=E[this._idx(I,v-1)];E[this._idx(-1,-1)]=E[this._idx(0,0)],E[this._idx(v,-1)]=E[this._idx(v-1,0)],E[this._idx(-1,v)]=E[this._idx(0,v-1)],E[this._idx(v,v)]=E[this._idx(v-1,v-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new tI(this)}get(e,s,c=!1){c&&(e=Cn(e,-1,this.dim),s=Cn(s,-1,this.dim));let f=4*this._idx(e,s);return(this.encoding==="terrarium"?CF:EF)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(e){return iI[e]}get unpackVector(){return iI[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){let c=[0,0,0,0],f=lb.getUnpackVector(s),g=Math.floor((e+f[3])/f[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new to({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,g=s*this.dim+this.dim,v=c*this.dim,E=c*this.dim+this.dim;switch(s){case-1:f=g-1;break;case 1:g=f+1}switch(c){case-1:v=E-1;break;case 1:E=v+1}let I=-s*this.dim,A=-c*this.dim;for(let L=v;L<E;L++)for(let j=f;j<g;j++){let $=4*this._idx(j,L),W=4*this._idx(j+I,L+A);this.pixels[$+0]=e.pixels[W+0],this.pixels[$+1]=e.pixels[W+1],this.pixels[$+2]=e.pixels[W+2],this.pixels[$+3]=e.pixels[W+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ot(lb,"DEMData"),Ot(tI,"DemMinMaxQuadTree",{omit:["dem"]});class DF{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(let e in this.data)for(let s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,c){let f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);let g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},c)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){let s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;let c=e.wrapped().key,f=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][f];return this.data[c].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){let s=[];for(let c in this.data)for(let f of this.data[c])e(f.value)||s.push(f);for(let c of s)this.remove(c.value.tileID,c)}}class Dm{constructor(e,s,c){this.func=e,this.mask=s,this.range=c}}Dm.ReadOnly=!1,Dm.ReadWrite=!0,Dm.disabled=new Dm(519,Dm.ReadOnly,[0,1]);let u1=7680;class d1{constructor(e,s,c,f,g,v){this.test=e,this.ref=s,this.mask=c,this.fail=f,this.depthFail=g,this.pass=v}}d1.disabled=new d1({func:519,mask:0},0,0,u1,u1,u1);class Rc{constructor(e,s,c){this.blendFunction=e,this.blendColor=s,this.mask=c}}Rc.Replace=[1,0],Rc.disabled=new Rc(Rc.Replace,Qi.transparent,[!1,!1,!1,!1]),Rc.unblended=new Rc(Rc.Replace,Qi.transparent,[!0,!0,!0,!0]),Rc.alphaBlended=new Rc([1,771],Qi.transparent,[!0,!0,!0,!0]);let h1=1029,f1=2305;class Fl{constructor(e,s,c){this.enable=e,this.mode=s,this.frontFace=c}}Fl.disabled=new Fl(!1,h1,f1),Fl.backCCW=new Fl(!0,h1,f1),Fl.backCW=new Fl(!0,h1,2304),Fl.frontCW=new Fl(!0,1028,2304),Fl.frontCCW=new Fl(!0,1028,f1);class Rf extends tc{constructor(e,s,c){super(),this.id=e,this._onlySymbols=c,s.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new DF(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new wF,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let s in this._tiles){let c=this._tiles[s];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return go(this._tiles).map(e=>e.tileID).sort(rI).map(e=>e.key)}getRenderableIds(e){let s=[];for(let c in this._tiles)this._isIdRenderable(+c,e)&&s.push(this._tiles[c]);return e?s.sort((c,f)=>{let g=c.tileID,v=f.tileID,E=new It(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),I=new It(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||I.y-E.y||I.x-E.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(rI).map(c=>c.key)}hasRenderableParent(e){let s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){let c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,e,s)))}_tileLoaded(e,s,c,f){if(f)if(e.state="errored",f.status!==404)this._source.fire(new qs(f,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=gs.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Qa("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let s=this.getRenderableIds();for(let f=0;f<s.length;f++){let g=s[f];if(e.neighboringTiles&&e.neighboringTiles[g]){let v=this.getTileByID(g);c(e,v),c(v,e)}}function c(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-f.tileID.canonical.x,E=g.tileID.canonical.y-f.tileID.canonical.y,I=Math.pow(2,f.tileID.canonical.z),A=g.tileID.key;v===0&&E===0||Math.abs(E)>1||(Math.abs(v)>1&&(Math.abs(v+I)===1?v+=I:Math.abs(v-I)===1&&(v-=I)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,v,E),f.neighboringTiles&&f.neighboringTiles[A]&&(f.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,c,f){for(let g in this._tiles){let v=this._tiles[g];if(f[g]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>c)continue;let E=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){let A=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[A.key],v&&v.hasData()&&(E=A)}let I=E;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){f[E.key]=E;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){let c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=e.overscaledZ-1;c>=s;c--){let f=e.scaledTo(c),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(e){let s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;let c=Math.ceil(e.width/s)+1,f=Math.ceil(e.height/s)+1,g=Math.floor(c*f*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(E)}handleWrapJump(e){let s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){let c={};for(let f in this._tiles){let g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(let f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(let f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(e,s,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(e,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new J(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(f=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(E=>this._source.hasTile(E)))):f=[];let g=this._updateRetainedTiles(f);if(oI(this._source.type)&&f.length!==0){let E={},I={},A=Object.keys(g);for(let j of A){let $=g[j],W=this._tiles[j];if(!W||W.fadeEndTime&&W.fadeEndTime<=gs.now())continue;let q=this.findLoadedParent($,Math.max($.overscaledZ-Rf.maxOverzooming,this._source.minzoom));q&&(this._addTile(q.tileID),E[q.tileID.key]=q.tileID),I[j]=$}let L=f[f.length-1].overscaledZ;for(let j in this._tiles){let $=this._tiles[j];if(g[j]||!$.hasData())continue;let W=$.tileID;for(;W.overscaledZ>L;){W=W.scaledTo(W.overscaledZ-1);let q=this._tiles[W.key];if(q&&q.hasData()&&I[W.key]){g[j]=$.tileID;break}}}for(let j in E)g[j]||(this._coveredTiles[j]=!0,g[j]=E[j])}for(let E in g)this._tiles[E].clearFadeHold();let v=function(E,I){let A=[];for(let L in E)L in I||A.push(L);return A}(this._tiles,g);for(let E of v){let I=this._tiles[E];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let s={};if(e.length===0)return s;let c={},f=e.reduce((A,L)=>Math.min(A,L.overscaledZ),1/0),g=e[0].overscaledZ,v=Math.max(g-Rf.maxOverzooming,this._source.minzoom),E=Math.max(g+Rf.maxUnderzooming,this._source.minzoom),I={};for(let A of e){let L=this._addTile(A);s[A.key]=A,L.hasData()||f<this._source.maxzoom&&(I[A.key]=A)}this._retainLoadedChildren(I,f,E,s);for(let A of e){let L=this._tiles[A.key];if(L.hasData())continue;if(A.canonical.z>=this._source.maxzoom){let $=A.children(this._source.maxzoom)[0],W=this.getTile($);if(W&&W.hasData()){s[$.key]=$;continue}}else{let $=A.children(this._source.maxzoom);if(s[$[0].key]&&s[$[1].key]&&s[$[2].key]&&s[$[3].key])continue}let j=L.wasRequested();for(let $=A.overscaledZ-1;$>=v;--$){let W=A.scaledTo($);if(c[W.key]||(c[W.key]=!0,L=this.getTile(W),!L&&j&&(L=this._addTile(W)),L&&(s[W.key]=W,j=L.wasRequested(),L.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let s=[],c,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}s.push(f.key);let g=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;f=g}for(let g of s)this._loadedParentTiles[g]=c}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));let c=!!s;if(!c){let f=this.map?this.map.painter:null;s=new c1(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,c||this._source.fire(new Qa("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let c=s.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){let s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,s,c){let f=[],g=this.transform;if(!g)return f;let v=g.projection.name==="globe",E=oa(g.center.lng);for(let I in this._tiles){let A=this._tiles[I];if(c&&A.clearQueryDebugViz(),A.holdingForFade())continue;let L;if(v){let j=A.tileID.canonical;if(j.z===0){let $=[Math.abs(Cn(E,...Uy(j,-1))-E),Math.abs(Cn(E,...Uy(j,1))-E)];L=[0,2*$.indexOf(Math.min(...$))-1]}else{let $=[Math.abs(Cn(E,...Uy(j,-1))-E),Math.abs(Cn(E,...Uy(j,0))-E),Math.abs(Cn(E,...Uy(j,1))-E)];L=[$.indexOf(Math.min(...$))-1]}}else L=[0];for(let j of L){let $=e.containsTile(A,g,s,j);$&&f.push($)}}return f}getVisibleCoordinates(e){let s=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(let c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(oI(this._source.type))for(let e in this._tiles){let s=this._tiles[e];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=gs.now())return!0}return!1}setFeatureState(e,s,c){this._state.updateState(e=e||"_geojsonTileLayer",s,c)}removeFeatureState(e,s,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,c)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,c){let f=this._tiles[e];f&&f.setDependencies(s,c)}reloadTilesForDependencies(e,s){for(let c in this._tiles)this._tiles[c].hasDependency(e,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(e,s))}_preloadTiles(e,s){if(!this._sourceLoaded){let E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(e,s))};return void this._source.on("data",E)}let c=new Map,f=Array.isArray(e)?e:[e],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(let E of f){let I=E.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let A of I)c.set(A.key,A);this.usedForTerrain&&E.updateElevation(!1)}vr(Array.from(c.values()),(E,I)=>{let A=new c1(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,L=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),I(L,A)})},s)}}function rI(o,e){let s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return o.overscaledZ-e.overscaledZ||c-s||e.canonical.y-o.canonical.y||e.canonical.x-o.canonical.x}function oI(o){return o==="raster"||o==="image"||o==="video"||o==="custom"}function Uy(o,e){let s=1<<o.z;return[o.x/s+e,(o.x+1)/s+e]}Rf.maxOverzooming=10,Rf.maxUnderzooming=3;class cb{constructor(e,s,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(e,s,c){let f=c||e.findDEMTileFor(s);if(!f||!f.dem)return;let g=f.dem,v=f.tileID,E=1<<s.canonical.z-v.canonical.z;return new cb(f,f.tileSize/Gt/E,[(s.canonical.x/E-v.canonical.x)*g.dim,(s.canonical.y/E-v.canonical.y)*g.dim])}tileCoordToPixel(e,s){let c=s*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(c);return new It(f,g)}getElevationAt(e,s,c,f){let g=e*this._scale+this._offset[0],v=s*this._scale+this._offset[1],E=Math.floor(g),I=Math.floor(v),A=this._dem;return f=!!f,c?Pn(Pn(A.get(E,I,f),A.get(E,I+1,f),v-I),Pn(A.get(E+1,I,f),A.get(E+1,I+1,f),v-I),g-E):A.get(E,I,f)}getElevationAtPixel(e,s,c){return this._dem.get(e,s,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*is(1,e)*this._dem.stride}}class sI{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new El(Gt,16,0),this.featureIndexArray=new gi,this.promoteId=s}insert(e,s,c,f,g,v=0){let E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,g,v);let I=this.grid;for(let A=0;A<s.length;A++){let L=s[A],j=[1/0,1/0,-1/0,-1/0];for(let $=0;$<L.length;$++){let W=L[$];j[0]=Math.min(j[0],W.x),j[1]=Math.min(j[1],W.y),j[2]=Math.max(j[2],W.x),j[3]=Math.max(j[3],W.y)}j[0]<Gt&&j[1]<Gt&&j[2]>=0&&j[3]>=0&&I.insert(E,j[0],j[1],j[2],j[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ky(new Xv(this.rawTileData)).layers,this.sourceLayerCoder=new GM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,c,f){this.loadVTLayers();let g=e.params||{},v=wl(g.filter),E=e.tileResult,I=e.transform,A=E.bufferedTilespaceBounds,L=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(q,ee,ae,me)=>Jd(E.bufferedTilespaceGeometry,q,ee,ae,me));L.sort(TF);let j=null;I.elevation&&L.length>0&&(j=cb.create(I.elevation,this.tileID));let $={},W;for(let q=0;q<L.length;q++){let ee=L[q];if(ee===W)continue;W=ee;let ae=this.featureIndexArray.get(ee),me=null;this.loadMatchingFeature($,ae,v,g.layers,g.availableImages,s,c,f,(we,ge,xe,Te=0)=>(me||(me=sa(we,this.tileID.canonical,e.tileTransform)),ge.queryIntersectsFeature(E,we,xe,me,this.z,e.transform,e.pixelPosMatrix,j,Te)))}return $}loadMatchingFeature(e,s,c,f,g,v,E,I,A){let{featureIndex:L,bucketIndex:j,sourceLayerIndex:$,layoutVertexArrayOffset:W}=s,q=this.bucketLayerIDs[j];if(f&&!function(we,ge){for(let xe=0;xe<we.length;xe++)if(ge.indexOf(we[xe])>=0)return!0;return!1}(f,q))return;let ee=this.sourceLayerCoder.decode($),ae=this.vtLayers[ee].feature(L);if(c.needGeometry){let we=Ms(ae,!0);if(!c.filter(new z(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!c.filter(new z(this.tileID.overscaledZ),ae))return;let me=this.getId(ae,ee);for(let we=0;we<q.length;we++){let ge=q[we];if(f&&f.indexOf(ge)<0)continue;let xe=v[ge];if(!xe)continue;let Te={};me!==void 0&&I&&(Te=I.getState(xe.sourceLayer||"_geojsonTileLayer",me));let Ce=Fi({},E[ge]);Ce.paint=aI(Ce.paint,xe.paint,ae,Te,g),Ce.layout=aI(Ce.layout,xe.layout,ae,Te,g);let qe=!A||A(ae,xe,Te,W);if(!qe)continue;let We=new WM(ae,this.z,this.x,this.y,me);We.layer=Ce;let et=e[ge];et===void 0&&(et=e[ge]=[]),et.push({featureIndex:L,feature:We,intersectionZ:qe})}}lookupSymbolFeatures(e,s,c,f,g,v,E,I){let A={};this.loadVTLayers();let L=wl(g);for(let j of e)this.loadMatchingFeature(A,{bucketIndex:c,sourceLayerIndex:f,featureIndex:j,layoutVertexArrayOffset:0},L,v,E,I,s);return A}loadFeature(e){let{featureIndex:s,sourceLayerIndex:c}=e;this.loadVTLayers();let f=this.sourceLayerCoder.decode(c),g=this.vtFeatures[f];if(g[s])return g[s];let v=this.vtLayers[f].feature(s);return g[s]=v,v}hasLayer(e){for(let s of this.bucketLayerIDs)for(let c of s)if(e===c)return!0;return!1}getId(e,s){let c=e.id;if(this.promoteId){let f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];f!=null&&(c=e.properties[f]),typeof c=="boolean"&&(c=Number(c))}return c}}function aI(o,e,s,c,f){return Nn(o,(g,v)=>{let E=e instanceof pe?e.get(v):null;return E&&E.evaluate?E.evaluate(s,c,f):E})}function TF(o,e){return e-o}Ot(sI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class lI{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Ol({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){let c=this.getKey(e,s);return this.positions[c]}trim(){let e=this.width,s=this.height=Us(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,c){let f=[],g=e.length%2==1?-e[e.length-1]*c:0,v=e[0]*c,E=!0;f.push({left:g,right:v,isDash:E,zeroLength:e[0]===0});let I=e[0];for(let A=1;A<e.length;A++){E=!E;let L=e[A];g=I*c,I+=L,v=I*c,f.push({left:g,right:v,isDash:E,zeroLength:L===0})}return f}addRoundDash(e,s,c){let f=s/2;for(let g=-c;g<=c;g++){let v=this.width*(this.nextRow+c+g),E=0,I=e[E];for(let A=0;A<this.width;A++){A/I.right>1&&(I=e[++E]);let L=Math.abs(A-I.left),j=Math.abs(A-I.right),$=Math.min(L,j),W,q=g/c*(f+1);if(I.isDash){let ee=f-Math.abs(q);W=Math.sqrt($*$+ee*ee)}else W=f-Math.sqrt($*$+q*q);this.image.data[v+A]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(e,s){for(let I=e.length-1;I>=0;--I){let A=e[I],L=e[I+1];A.zeroLength?e.splice(I,1):L&&L.isDash===A.isDash&&(L.left=A.left,e.splice(I,1))}let c=e[0],f=e[e.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);let g=this.width*this.nextRow,v=0,E=e[v];for(let I=0;I<this.width;I++){I/E.right>1&&(E=e[++v]);let A=Math.abs(I-E.left),L=Math.abs(I-E.right),j=Math.min(A,L);this.image.data[g+I]=Math.max(0,Math.min(255,(E.isDash?j:-j)+s+128))}}addDash(e,s){let c=this.getKey(e,s);if(this.positions[c])return this.positions[c];let f=s==="round",g=f?7:0,v=2*g+1;if(this.nextRow+v>this.height)return _i("LineAtlas out of space"),null;e.length===0&&e.push(1);let E=0;for(let L=0;L<e.length;L++)e[L]<0&&(_i("Negative value is found in line dasharray, replacing values with 0"),e[L]=0),E+=e[L];if(E!==0){let L=this.width/E,j=this.getDashRanges(e,this.width,L);f?this.addRoundDash(j,L,g):this.addRegularDash(j,s==="square"?.5*L:0)}let I=this.nextRow+g;this.nextRow+=v;let A={tl:[I,g],br:[E,0]};return this.positions[c]=A,A}}Ot(lI,"LineAtlas");let cI=1*Ll;class uI{constructor(e){let s={},c=[];for(let E in e){let I=e[E],A=s[E]={};for(let L in I.glyphs){let j=I.glyphs[+L];if(!j||j.bitmap.width===0||j.bitmap.height===0)continue;let $=j.metrics.localGlyph?cI:1,W={x:0,y:0,w:j.bitmap.width+2*$,h:j.bitmap.height+2*$};c.push(W),A[L]=W}}let{w:f,h:g}=Kw(c),v=new Ol({width:f||1,height:g||1});for(let E in e){let I=e[E];for(let A in I.glyphs){let L=I.glyphs[+A];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;let j=s[E][A],$=L.metrics.localGlyph?cI:1;Ol.copy(L.bitmap,v,{x:0,y:0},{x:j.x+$,y:j.y+$},L.bitmap)}}this.image=v,this.positions=s}}Ot(uI,"GlyphAtlas");class MF{constructor(e){this.tileID=new J(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=kf(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,s,c,f,g){this.status="parsing",this.data=e,this.collisionBoxArray=new fi;let v=new GM(Object.keys(e.layers).sort()),E=new sI(this.tileID,this.promoteId);E.bucketLayerIDs=[];let I={},A=new lI(256,256),L={featureIndex:E,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:c},j=s.familiesBySource[this.source];for(let Te in j){let Ce=e.layers[Te];if(!Ce)continue;let qe=!1,We=!1;for(let Ke of j[Te])Ke[0].type==="symbol"?qe=!0:We=!0;if(this.isSymbolTile===!0&&!qe||this.isSymbolTile===!1&&!We)continue;Ce.version===1&&_i(`Vector tile source "${this.source}" layer "${Te}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let et=v.encode(Te),vt=[];for(let Ke=0;Ke<Ce.length;Ke++){let ot=Ce.feature(Ke),st=E.getId(ot,Te);vt.push({feature:ot,id:st,index:Ke,sourceLayerIndex:et})}for(let Ke of j[Te]){let ot=Ke[0];this.isSymbolTile!==void 0&&ot.type==="symbol"!==this.isSymbolTile||ot.minzoom&&this.zoom<Math.floor(ot.minzoom)||ot.maxzoom&&this.zoom>=ot.maxzoom||ot.visibility!=="none"&&(p1(Ke,this.zoom,c),(I[ot.id]=ot.createBucket({index:E.bucketLayerIDs.length,layers:Ke,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:et,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(vt,L,this.tileID.canonical,this.tileTransform),E.bucketLayerIDs.push(Ke.map(st=>st.id)))}}let $,W,q,ee;A.trim();let ae={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},me=()=>{if($)return g($);if(W&&q&&ee){let Te=new uI(W),Ce=new yM(q,ee);for(let qe in I){let We=I[qe];We instanceof rh?(p1(We.layers,this.zoom,c),JL(We,W,Te.positions,q,Ce.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):We.hasPattern&&(We instanceof Lt||We instanceof Sf||We instanceof y)&&(p1(We.layers,this.zoom,c),We.addFeatures(L,this.tileID.canonical,Ce.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:go(I).filter(qe=>!qe.isEmpty()),featureIndex:E,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Te.image,lineAtlas:A,imageAtlas:Ce,glyphMap:this.returnDependencies?W:null,iconMap:this.returnDependencies?q:null,glyphPositions:this.returnDependencies?Te.positions:null})}},we=Nn(L.glyphDependencies,Te=>Object.keys(Te).map(Number));Object.keys(we).length?f.send("getGlyphs",{uid:this.uid,stacks:we},(Te,Ce)=>{$||($=Te,W=Ce,me())},void 0,!1,ae):W={};let ge=Object.keys(L.iconDependencies);ge.length?f.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"icons"},(Te,Ce)=>{$||($=Te,q=Ce,me())},void 0,!1,ae):q={};let xe=Object.keys(L.patternDependencies);xe.length?f.send("getImages",{icons:xe,source:this.source,tileID:this.tileID,type:"patterns"},(Te,Ce)=>{$||($=Te,ee=Ce,me())},void 0,!1,ae):ee={},me()}}function p1(o,e,s){let c=new z(e);for(let f of o)f.recalculate(c,s)}class dI{constructor(e){this.entries={},this.scheduler=e}request(e,s,c,f){let g=this.entries[e]=this.entries[e]||{callbacks:[]};if(g.result){let[v,E]=g.result;return this.scheduler?this.scheduler.add(()=>{f(v,E)},s):f(v,E),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=c((v,E)=>{g.result=[v,E];for(let I of g.callbacks)this.scheduler?this.scheduler.add(()=>{I(v,E)},s):I(v,E);setTimeout(()=>delete this.entries[e],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(v=>v!==f),g.callbacks.length||(g.cancel(),delete this.entries[e]))}}}function hI(o,e,s){let c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{let g=Ws(o.request,(v,E,I,A)=>{v?f(v):E&&f(null,{vectorTile:s?void 0:new ky(new Xv(E)),rawData:E,cacheControl:I,expires:A})});return()=>{g.cancel(),f()}},e)}let fI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class m1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[s,c]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");let f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);let g=fI[15&c];if(!g)throw new Error("Unrecognized array type.");let[v]=new Uint16Array(e,2,1),[E]=new Uint32Array(e,4,1);return new m1(E,v,g,e)}constructor(e,s=64,c=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let g=fI.indexOf(this.ArrayType),v=2*e*this.ArrayType.BYTES_PER_ELEMENT,E=e*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-E%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+E+I,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+v+E+I),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+E+I,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=s,c}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return g1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:g,coords:v,nodeSize:E}=this,I=[0,g.length-1,0],A=[];for(;I.length;){let L=I.pop()||0,j=I.pop()||0,$=I.pop()||0;if(j-$<=E){for(let ae=$;ae<=j;ae++){let me=v[2*ae],we=v[2*ae+1];me>=e&&me<=c&&we>=s&&we<=f&&A.push(g[ae])}continue}let W=$+j>>1,q=v[2*W],ee=v[2*W+1];q>=e&&q<=c&&ee>=s&&ee<=f&&A.push(g[W]),(L===0?e<=q:s<=ee)&&(I.push($),I.push(W-1),I.push(1-L)),(L===0?c>=q:f>=ee)&&(I.push(W+1),I.push(j),I.push(1-L))}return A}within(e,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:f,coords:g,nodeSize:v}=this,E=[0,f.length-1,0],I=[],A=c*c;for(;E.length;){let L=E.pop()||0,j=E.pop()||0,$=E.pop()||0;if(j-$<=v){for(let ae=$;ae<=j;ae++)mI(g[2*ae],g[2*ae+1],e,s)<=A&&I.push(f[ae]);continue}let W=$+j>>1,q=g[2*W],ee=g[2*W+1];mI(q,ee,e,s)<=A&&I.push(f[W]),(L===0?e-c<=q:s-c<=ee)&&(E.push($),E.push(W-1),E.push(1-L)),(L===0?e+c>=q:s+c>=ee)&&(E.push(W+1),E.push(j),E.push(1-L))}return I}}function g1(o,e,s,c,f,g){if(f-c<=s)return;let v=c+f>>1;pI(o,e,v,c,f,g),g1(o,e,s,c,v-1,1-g),g1(o,e,s,v+1,f,1-g)}function pI(o,e,s,c,f,g){for(;f>c;){if(f-c>600){let A=f-c+1,L=s-c+1,j=Math.log(A),$=.5*Math.exp(2*j/3),W=.5*Math.sqrt(j*$*(A-$)/A)*(L-A/2<0?-1:1);pI(o,e,s,Math.max(c,Math.floor(s-L*$/A+W)),Math.min(f,Math.floor(s+(A-L)*$/A+W)),g)}let v=e[2*s+g],E=c,I=f;for($y(o,e,c,s),e[2*f+g]>v&&$y(o,e,c,f);E<I;){for($y(o,e,E,I),E++,I--;e[2*E+g]<v;)E++;for(;e[2*I+g]>v;)I--}e[2*c+g]===v?$y(o,e,c,I):(I++,$y(o,e,I,f)),I<=s&&(c=I+1),s<=I&&(f=I-1)}}function $y(o,e,s,c){y1(o,s,c),y1(e,2*s,2*c),y1(e,2*s+1,2*c+1)}function y1(o,e,s){let c=o[e];o[e]=o[s],o[s]=c}function mI(o,e,s,c){let f=o-s,g=e-c;return f*f+g*g}i.ARRAY_TYPE=Ar,i.AUTH_ERR_MSG=Me,i.Aabb=uo,i.Actor=class{constructor(o,e,s){this.target=o,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},_a(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ps()?o:C,this.scheduler=new bF}send(o,e,s,c,f=!1,g){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[v]=s);let E=Yl(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:o,hasCallback:!!s,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:Aa(e,E)},E),{cancel:()=>{s&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){let e=o.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){let c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(e.mustQueue||ps()){let c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),c&&c.metadata||{type:"message"})}else this.processTask(s,e)}processTask(o,e){if(e.type==="<response>"){let s=this.callbacks[o];delete this.callbacks[o],s&&(e.error?s(Cl(e.error)):s(null,Cl(e.data)))}else{let s=Yl(this.globalScope)?void 0:[],c=e.hasCallback?(g,v)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?Aa(g):null,data:Aa(v,s)},s)}:g=>{},f=Cl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,f,c);else if(this.parent.getWorkerSource){let g=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,g[0],f.source)[g[1]](f,c)}else c(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.CanonicalTileID=te,i.Color=Qi,i.ColorMode=Rc,i.CullFaceMode=Fl,i.DEMData=lb,i.DataConstantProperty=Q,i.DedupedRequest=dI,i.DepthMode=Dm,i.EXTENT=Gt,i.Elevation=class{isDataAvailableAtPoint(o){let e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;let s=e.getSource().maxzoom,c=1<<s,f=Math.floor(o.x),g=Math.floor((o.x-f)*c),v=Math.floor(o.y*c),E=this.findDEMTileFor(new J(s,f,s,g,v));return!(!E||!E.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,s=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let c=this._source();if(!c||o.y<0||o.y>1)return e;let f=c.getSource().maxzoom,g=1<<f,v=Math.floor(o.x),E=o.x-v,I=new J(f,v,f,Math.floor(E*g),Math.floor(o.y*g)),A=this.findDEMTileFor(I);if(!A||!A.dem)return e;let L=A.dem,j=1<<A.tileID.canonical.z,$=(E*j-A.tileID.canonical.x)*L.dim,W=(o.y*j-A.tileID.canonical.y)*L.dim,q=Math.floor($),ee=Math.floor(W);return(s?this.exaggeration():1)*Pn(Pn(L.get(q,ee),L.get(q,ee+1),W-ee),Pn(L.get(q+1,ee),L.get(q+1,ee+1),W-ee),$-q)}getAtTileOffset(o,e,s){let c=1<<o.canonical.z;return this.getAtPointOrZero(new Xd(o.wrap+(o.canonical.x+e/Gt)/c,(o.canonical.y+s/Gt)/c))}getAtTileOffsetFunc(o,e,s,c){return f=>{let g=this.getAtTileOffset(o,f.x,f.y),v=c.upVector(o.canonical,f.x,f.y);return ts(v,v,g*c.upVectorScale(o.canonical,e,s).metersToTile),v}}getForTilePoints(o,e,s,c){if(this.isUsingMockSource())return!1;let f=cb.create(this,o,c);return!!f&&(e.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(o);if(!e||!e.dem)return null;let s=e.dem.tree,c=e.tileID,f=1<<o.canonical.z-c.canonical.z,g=o.canonical.x/f-c.canonical.x,v=o.canonical.y/f-c.canonical.y,E=0;for(let I=0;I<o.canonical.z-c.canonical.z&&!s.leaves[E];I++){g*=2,v*=2;let A=2*Math.floor(v)+Math.floor(g);E=s.childOffsets[E]+A,g%=1,v%=1}return{min:this.exaggeration()*s.minimums[E],max:this.exaggeration()*s.maximums[E]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},i.ErrorEvent=qs,i.EvaluationParameters=z,i.Event=Qa,i.Evented=tc,i.FillExtrusionBucket=y,i.Frustum=uy,i.FrustumCorners=cy,i.GLOBE_RADIUS=Ds,i.GLOBE_SCALE_MATCH_LATITUDE=45,i.GLOBE_ZOOM_THRESHOLD_MAX=Yp,i.GLOBE_ZOOM_THRESHOLD_MIN=Xp,i.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let o of this._poleSegments)o.destroy();for(let o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(let o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,e){let s=new mt,c=new jt,f=[],g=o+1+2,v=e[0]+1,E=e[0]+1+(1+e.length),I=(A,L,j)=>{let $=A===g-1?A-2:A===0?A:A-1;return $+=j?24575:0,[$,L]};for(let A=0;A<g;++A)s.emplaceBack(...I(A,0,!0));for(let A=0;A<v;++A)for(let L=0;L<g;++L)s.emplaceBack(...I(L,A,(L===0||L===g-1)&&!0));for(let A=0;A<e.length;++A){let L=e[A];for(let j=0;j<g;++j)s.emplaceBack(...I(j,L,!0))}for(let A=0;A<e.length;++A){let L=c.length,j=e[A]+1+2,$=new jt;for(let ee=0;ee<j-1;ee++){let ae=ee===j-2,me=ae?g*(E-e.length+A-ee):g;for(let we=0;we<g-1;we++){let ge=ee*g+we;ee===0||ae||we===0||we===g-2?($.emplaceBack(ge+1,ge,ge+me),$.emplaceBack(ge+me,ge+me+1,ge+1)):(c.emplaceBack(ge+1,ge,ge+me),c.emplaceBack(ge+me,ge+me+1,ge+1))}}let W=$i.simpleSegment(0,L,s.length,c.length-L);for(let ee=0;ee<$.uint16.length;ee+=3)c.emplaceBack($.uint16[ee],$.uint16[ee+1],$.uint16[ee+2]);let q=$i.simpleSegment(0,L,s.length,c.length-L);f.push({withoutSkirts:W,withSkirts:q})}return{vertices:s,indices:c,segments:f}}_createGrid(o){let e=this._fillGridMeshWithLods(Tc,mf);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,Wd.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){let e=new jt;for(let f=0;f<=Tc;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);let s=new hi,c=new hi;this._poleSegments=[];for(let f=0,g=0;f<Xp;f++){let v=360/(1<<f);s.emplaceBack(0,-Ds,0,.5,0),c.emplaceBack(0,-Ds,0,.5,1);for(let E=0;E<=Tc;E++){let I=E/Tc,A=Pn(0,v,I),[L,j,$]=qd(Ew,tm,A,Ds);s.emplaceBack(L,j,$,I,0),c.emplaceBack(L,j,$,I,1)}this._poleSegments.push($i.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,ly,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,ly,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,e){if(!this._wireframeSegments){let s=new pr,c=Tc,f=c+1+2,g=1;this._wireframeSegments=[];for(let v=0,E=0;v<mf.length;v++){let I=mf[v];for(let L=g;L<I+g;L++)for(let j=g;j<c+g;j++){let $=L*f+j;s.emplaceBack($,$+1),s.emplaceBack($,$+f),s.emplaceBack($,$+f+1)}let A=I*c*3;this._wireframeSegments.push($i.simpleSegment(0,E,(I+1)*f,A)),E+=A}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},i.GlyphManager=bm,i.ImagePosition=Qw,i.KDBush=m1,i.LivePerformanceUtils=gp,i.LngLat=ii,i.LngLatBounds=wc,i.LocalGlyphMode=t1,i.MAX_MERCATOR_LATITUDE=Wr,i.MercatorCoordinate=Xd,i.ONE_EM=Mn,i.OverscaledTileID=J,i.PerformanceMarkers=ec,i.Point=It,i.Properties=_e,i.RGBAImage=to,i.Ray=Zp,i.RequestManager=class{constructor(o,e,s){this._transformRequestFn=o,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){let o=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ut,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,e){return this._transformRequestFn&&this._transformRequestFn(o,e)||{url:o}}normalizeStyleURL(o,e){if(!Pe(o))return o;let s=Mt(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(o,e){if(!Pe(o))return o;let s=Mt(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(o,e,s,c){if(!Pe(o))return o;let f=Mt(o);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),s&&f.params.push(`language=${s}`),c&&f.params.push(`worldview=${c}`),this._makeAPIURL(f,this._customAccessToken||e)}normalizeSpriteURL(o,e,s,c){let f=Mt(o);return Pe(o)?(f.path=`/styles/v1${f.path}/sprite${e}${s}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${e}${s}`,yt(f))}normalizeTileURL(o,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Pe(o))return o;let c=Mt(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&c.authority!=="raster"&&s===512?"@2x":""}${oe.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${K.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${K.TILE_URL_VERSION}${c.path}`);let f=this._customAccessToken||function(g){for(let v of g){let E=v.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(c.params)||K.ACCESS_TOKEN;return K.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(o,e){let s=Mt(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${K.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${K.TILE_URL_VERSION}/`,"")}`;let f=s.params;return e&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(o,e){let s=!!e&&Pe(e),c=[];for(let f of o.tiles||[])$e(f)?c.push(this.canonicalizeTileURL(f,s)):c.push(f);return c}_makeAPIURL(o,e){let s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=Mt(K.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,o.protocol==="http"){let f=o.params.indexOf("secure");f>=0&&o.params.splice(f,1)}if(c.path!=="/"&&(o.path=`${c.path}${o.path}`),!K.REQUIRE_ACCESS_TOKEN)return yt(o);if(e=e||K.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(f=>f.indexOf("access_token")===-1),o.params.push(`access_token=${e||""}`),yt(o)}},i.ResourceType=Ka,i.SegmentVector=$i,i.SourceCache=Rf,i.StencilMode=d1,i.StructArrayLayout1ui2=Co,i.StructArrayLayout2f1f2i16=Xt,i.StructArrayLayout2i4=mt,i.StructArrayLayout2ui4=pr,i.StructArrayLayout3f12=En,i.StructArrayLayout3ui6=jt,i.StructArrayLayout4i8=it,i.StructArrayLayout5f20=hi,i.Texture=jy,i.Tile=c1,i.Transitionable=Y,i.Uniform1f=lf,i.Uniform1i=class extends Tl{constructor(o){super(o),this.current=0}set(o,e,s){this.fetchUniformLocation(o,e)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},i.Uniform2f=class extends Tl{constructor(o){super(o),this.current=[0,0]}set(o,e,s){this.fetchUniformLocation(o,e)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},i.Uniform3f=class extends Tl{constructor(o){super(o),this.current=[0,0,0]}set(o,e,s){this.fetchUniformLocation(o,e)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},i.Uniform4f=mv,i.UniformColor=ey,i.UniformMatrix2f=class extends Tl{constructor(o){super(o),this.current=jp}set(o,e,s){if(this.fetchUniformLocation(o,e)){for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}},i.UniformMatrix3f=class extends Tl{constructor(o){super(o),this.current=hw}set(o,e,s){if(this.fetchUniformLocation(o,e)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},i.UniformMatrix4f=class extends Tl{constructor(o){super(o),this.current=dw}set(o,e,s){if(this.fetchUniformLocation(o,e)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},i.UnwrappedTileID=ne,i.ValidationError=Rt,i.VectorTileFeature=ju,i.VectorTileWorkerSource=class extends tc{constructor(o,e,s,c,f){super(),this.actor=o,this.layerIndex=e,this.availableImages=s,this.loadVectorData=f||hI,this.loading={},this.loaded={},this.deduped=new dI(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,e){let s=o.uid,c=o&&o.request,f=c&&c.collectResourceTiming,g=this.loading[s]=new MF(o);g.abort=this.loadVectorData(o,(v,E)=>{let I=!this.loading[s];if(delete this.loading[s],I||v||!E)return g.status="done",I||(this.loaded[s]=g),e(v);let A=E.rawData,L={};E.expires&&(L.expires=E.expires),E.cacheControl&&(L.cacheControl=E.cacheControl),g.vectorTile=E.vectorTile||new ky(new Xv(A));let j=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,($,W)=>{if($||!W)return e($);let q={};if(f){let ee=Jc(c);ee.length>0&&(q.resourceTiming=JSON.parse(JSON.stringify(ee)))}e(null,Fi({rawTileData:A.slice(0)},W,L,q))})};this.isSpriteLoaded?j():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(j,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):j()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,e){let s=this.loaded,c=o.uid,f=this;if(s&&s[c]){let g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=kf(o.tileID.canonical,o.projection);let v=(E,I)=>{let A=g.reloadCallback;A&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,A)),e(E,I)};g.status==="parsing"?g.reloadCallback=v:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(o,e){let s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),e()}removeTile(o,e){let s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],e()}},i.WritingMode=aa,i.ZoomDependentExpression=Ma,i.add=On,i.addDynamicAttributes=ob,i.adjoint=function(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],v=e[4],E=e[5],I=e[6],A=e[7],L=e[8];return o[0]=v*L-E*A,o[1]=f*A-c*L,o[2]=c*E-f*v,o[3]=E*I-g*L,o[4]=s*L-f*I,o[5]=f*g-s*E,o[6]=g*A-v*I,o[7]=c*I-s*A,o[8]=s*v-c*g,o},i.asyncAll=vr,i.bezier=qa,i.bindAll=_a,i.boundsAttributes=ZM,i.bufferConvexPolygon=function(o,e){let s=[];for(let c=0;c<o.length;c++){let f=dr(c-1,-1,o.length-1),g=dr(c+1,-1,o.length-1),v=o[c],E=o[g],I=o[f].sub(v).unit(),A=E.sub(v).unit(),L=A.angleWithSep(I.x,I.y),j=I.add(A).unit().mult(-1*e/Math.sin(L/2));s.push(v.add(j))}return s},i.cacheEntryPossiblyAdded=function(o){Qc++,Qc>hd&&(o.getActor().send("enforceCacheSizeLimit",Di),Qc=0)},i.calculateGlobeLabelMatrix=function(o,e){let{x:s,y:c}=o.point,f=Cv(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Sl(f,f,Jp(ho(e)))},i.calculateGlobeMatrix=function(o){let{x:e,y:s}=o.point,{lng:c,lat:f}=o._center;return Cv(e,s,o.worldSize,c,f)},i.calculateGlobeMercatorMatrix=function(o){let e=o.pixelsPerMeter,s=e/is(1,o.center.lat),c=ra(new Float64Array(16));return ku(c,c,[o.point.x,o.point.y,0]),Ec(c,c,[s,s,e]),Float32Array.from(c)},i.circumferenceAtLatitude=xf,i.clamp=Cn,i.clearTileCache=function(o){if(!Ql())return;let e=C.caches.delete(Kl);o&&e.catch(o).then(()=>o())},i.clipLine=AM,i.clone=function(o){var e=new Ar(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},i.clone$1=yo,i.collisionCircleLayout=Yn,i.config=K,i.conjugate=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},i.create=function(){var o=new Ar(16);return Ar!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},i.create$1=Hd,i.createExpression=Kt,i.createLayout=Fe,i.createStyleLayer=function(o){return o.type==="custom"?new gF(o):new _F[o.type](o)},i.cross=Fr,i.degToRad=An,i.distance=function(o,e){return Math.hypot(e[0]-o[0],e[1]-o[1],e[2]-o[2])},i.div=function(o,e,s){return o[0]=e[0]/s[0],o[1]=e[1]/s[1],o[2]=e[2]/s[2],o},i.dot=Lo,i.earthRadius=Ou,i.ease=Yc,i.easeCubicInOut=Vs,i.ecefToLatLng=function([o,e,s]){let c=Math.hypot(o,e,s),f=Math.atan2(o,s),g=.5*Math.PI-Math.acos(-e/c);return new ii(Yi(f),Yi(g))},i.emitValidationErrors=Op,i.endsWith=Xa,i.enforceCacheSizeLimit=function(o){Hs(),So&&So.then(e=>{e.keys().then(s=>{for(let c=0;c<s.length-o;c++)e.delete(s[c])})})},i.evaluateSizeForFeature=kr,i.evaluateSizeForZoom=Wi,i.evaluateVariableOffset=LM,i.evented=x,i.exactEquals=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},i.exactEquals$1=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]},i.exported=gs,i.exported$1=oe,i.extend=Fi,i.extend$1=Zs,i.fillExtrusionHeightLift=B,i.filterObject=Zt,i.fromMat4=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},i.fromQuat=function(o,e){var s=e[0],c=e[1],f=e[2],g=e[3],v=s+s,E=c+c,I=f+f,A=s*v,L=c*v,j=c*E,$=f*v,W=f*E,q=f*I,ee=g*v,ae=g*E,me=g*I;return o[0]=1-j-q,o[1]=L+me,o[2]=$-ae,o[3]=0,o[4]=L-me,o[5]=1-A-q,o[6]=W+ee,o[7]=0,o[8]=$+ae,o[9]=W-ee,o[10]=1-A-j,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromRotation=function(o,e){var s=Math.sin(e),c=Math.cos(e);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},i.fromScaling=Al,i.furthestTileCorner=function(o){let e=Math.round((o+45+360)%360/90)%4;return Xl[e]},i.getAABBPointSquareDist=function(o,e,s){let c=0;for(let f=0;f<2;++f){let g=s?s[f]:0;o[f]>g&&(c+=(o[f]-g)*(o[f]-g)),e[f]<g&&(c+=(g-e[f])*(g-e[f]))}return c},i.getAnchorAlignment=e1,i.getAnchorJustification=i1,i.getBounds=function(o){let e=1/0,s=1/0,c=-1/0,f=-1/0;for(let g of o)e=Math.min(e,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),f=Math.max(f,g.y);return{min:new It(e,s),max:new It(c,f)}},i.getColumn=Qr,i.getDefaultExportFromCjs=Qt,i.getGridMatrix=function(o,e,s,c){let f=e.getNorth(),g=e.getSouth(),v=e.getWest(),E=e.getEast(),I=1<<o.z,A=E-v,L=f-g,j=A/Tc,$=-L/mf[s],W=[0,j,0,$,0,0,f,v,0];if(o.z>0){let q=180/c;iy(W,W,[q/A+1,0,0,0,q/L+1,0,-.5*q/j,.5*q/$,1])}return W[2]=I,W[5]=o.x,W[8]=o.y,W},i.getImage=ve,i.getJSON=function(o,e){return Mr(Fi(o,{type:"json"}),e)},i.getLatitudinalLod=function(o){let e=Wr-5;o=Cn(o,-e,e)/e*90;let s=Math.pow(Math.abs(Math.sin(An(o))),3);return Math.round(s*(mf.length-1))},i.getMapSessionAPI=Ir,i.getPerformanceMeasurement=Jc,i.getProjection=$M,i.getRTLTextPluginStatus=D,i.getReferrer=Gs,i.getTilePoint=function(o,{x:e,y:s},c=0){return new It(((e-c)*o.scale-o.x)*Gt,(s*o.scale-o.y)*Gt)},i.getTileVec3=function(o,e,s=0){return Cc(((e.x-s)*o.scale-o.x)*Gt,(e.y*o.scale-o.y)*Gt,nm(e.z,e.y))},i.getVideo=function(o,e){let s=C.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let c=0;c<o.length;c++){let f=C.document.createElement("source");fd(o[c])||(s.crossOrigin="Anonymous"),f.src=o[c],s.appendChild(f)}return{cancel:()=>{}}},i.globeCenterToScreenPoint=function(o){let e=[0,0,0],s=ra(new Float64Array(16));return Sl(s,o.pixelMatrix,o.globeMatrix),tr(e,e,s),new It(e[0],e[1])},i.globeDenormalizeECEF=Jp,i.globeECEFOrigin=function(o,e){let s=[0,0,0];return tr(s,s,bf(ho(e.canonical))),tr(s,s,o),s},i.globeMetersToEcef=yf,i.globeNormalizeECEF=bf,i.globePixelsToTileUnits=function(o,e){return Gt/(512*Math.pow(2,o))*Qp(ho(e))},i.globePoleMatrixForTile=function(o,e,s){let c=ra(new Float64Array(16)),f=(e/(1<<o)-.5)*Math.PI*2;return Oo(c,s.globeMatrix,f),Float32Array.from(c)},i.globeTileBounds=ho,i.globeTiltAtLngLat=em,i.globeToMercatorTransition=Pu,i.globeUseCustomAntiAliasing=function(o,e,s){let c=Pu(s.zoom),f=o.style.map._antialias,g=!!e.extStandardDerivatives,v=e.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return c===0&&!f&&!v&&g},i.identity=ra,i.identity$1=ff,i.invert=$p,i.isFullscreen=function(){return!!C.document.fullscreenElement||!!C.document.webkitFullscreenElement},i.isLngLatBehindGlobe=hy,i.isMapAuthenticated=function(o){return jr.has(o)},i.isMapboxURL=Pe,i.isSafariWithAntialiasingBug=function(o){let e=o.navigator?o.navigator.userAgent:null;return!!Yl(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.latFromMercatorY=Gr,i.latLngToECEF=Zd,i.len=vw,i.length=Cs,i.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},i.lngFromMercatorX=rs,i.loadVectorTile=hI,i.makeRequest=Mr,i.mapValue=function(o,e,s,c,f){return Cn((o-e)/(s-e)*(f-c)+c,c,f)},i.mercatorScale=Tv,i.mercatorXfromLng=oa,i.mercatorYfromLat=Pa,i.mercatorZfromAltitude=is,i.mul=yw,i.mul$1=_w,i.multiply=Sl,i.multiply$1=iy,i.multiply$2=Gp,i.nextPowerOfTwo=Us,i.normalize=er,i.normalize$1=bw,i.normalize$2=yv,i.number=Pn,i.ortho=function(o,e,s,c,f,g,v){var E=1/(e-s),I=1/(c-f),A=1/(g-v);return o[0]=-2*E,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*I,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*A,o[11]=0,o[12]=(e+s)*E,o[13]=(f+c)*I,o[14]=(v+g)*A,o[15]=1,o},i.pbf=Uu,i.perspective=function(o,e,s,c,f){var g,v=1/Math.tan(e/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,f!=null&&f!==1/0?(o[10]=(f+c)*(g=1/(c-f)),o[14]=2*f*c*g):(o[10]=-1,o[14]=-2*c),o},i.pick=function(o,e){let s={};for(let c=0;c<e.length;c++){let f=e[c];f in o&&(s[f]=o[f])}return s},i.plugin=R,i.pointGeometry=lt,i.polesInViewport=function(o){let e=ra(new Float64Array(16));Sl(e,o.pixelMatrix,o.globeMatrix);let s=[0,Ts,0],c=[0,ns,0];return tr(s,s,e),tr(c,c,e),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!hy(o,new ii(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!hy(o,new ii(o.center.lat,-90))]},i.polygonContainsPoint=Fu,i.polygonIntersectsBox=Jd,i.polygonIntersectsPolygon=Iv,i.polygonizeBounds=function(o,e,s=0,c=!0){let f=new It(s,s),g=o.sub(f),v=e.add(f),E=[g,new It(v.x,g.y),v,new It(g.x,v.y)];return c&&E.push(g.clone()),E},i.posAttributes=Wd,i.postMapLoadEvent=Ki,i.postPerformanceEvent=hr,i.postTurnstileEvent=kn,i.potpack=Kw,i.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},i.radToDeg=Yi,i.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:l}),x.on("pluginStateChange",o),o},i.removeAuthState=function(o){jr.delete(o)},i.renderColorRamp=vy,i.resample=wf,i.rotateX=df,i.rotateX$1=Wp,i.rotateY=Oo,i.rotateY$1=qp,i.rotateZ=function(o,e,s){var c=Math.sin(s),f=Math.cos(s),g=e[0],v=e[1],E=e[2],I=e[3],A=e[4],L=e[5],j=e[6],$=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=g*f+A*c,o[1]=v*f+L*c,o[2]=E*f+j*c,o[3]=I*f+$*c,o[4]=A*f-g*c,o[5]=L*f-v*c,o[6]=j*f-E*c,o[7]=$*f-I*c,o},i.rotateZ$1=function(o,e,s){s*=.5;var c=e[0],f=e[1],g=e[2],v=e[3],E=Math.sin(s),I=Math.cos(s);return o[0]=c*I+f*E,o[1]=f*I-c*E,o[2]=g*I+v*E,o[3]=v*I-g*E,o},i.scale=Ec,i.scale$1=kl,i.scale$2=ts,i.scaleAndAdd=Dc,i.set=function(o,e,s,c){return o[0]=e,o[1]=s,o[2]=c,o},i.setCacheLimits=function(o,e){Di=o,hd=e},i.setColumn=function(o,e,s){o[4*e+0]=s[0],o[4*e+1]=s[1],o[4*e+2]=s[2],o[4*e+3]=s[3]},i.setRTLTextPlugin=function(o,e,s=!1){if(m===Mu||m===rf||m===of)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=gs.resolveURL(o),m=Mu,bc=e,_(),s||k()},i.smoothstep=Wo,i.spec=Je,i.squaredLength=function(o){var e=o[0],s=o[1],c=o[2];return e*e+s*s+c*c},i.storeAuthState=function(o,e){e?jr.add(o):jr.delete(o)},i.sub=Fo,i.subtract=sy,i.symbolSize=To,i.tileAABB=function(o,e,s,c,f,g,v,E,I){if(I.name==="globe")return ww(o,e,new te(s,c,f));let A=kf({z:s,x:c,y:f},I);return new uo([(g+A.x/A.scale)*e,e*(A.y/A.scale),v],[(g+A.x2/A.scale)*e,e*(A.y2/A.scale),E])},i.tileCornersToBounds=Kp,i.tileTransform=kf,i.transformMat3=function(o,e,s){var c=e[0],f=e[1],g=e[2];return o[0]=c*s[0]+f*s[3]+g*s[6],o[1]=c*s[1]+f*s[4]+g*s[7],o[2]=c*s[2]+f*s[5]+g*s[8],o},i.transformMat4=tr,i.transformMat4$1=Ru,i.transformQuat=ay,i.transitionTileAABBinECEF=xv,i.translate=ku,i.transpose=function(o,e){if(o===e){var s=e[1],c=e[2],f=e[5];o[1]=e[3],o[2]=e[6],o[3]=s,o[5]=e[7],o[6]=c,o[7]=f}else o[0]=e[0],o[1]=e[3],o[2]=e[6],o[3]=e[1],o[4]=e[4],o[5]=e[7],o[6]=e[2],o[7]=e[5],o[8]=e[8];return o},i.triggerPluginCompletionEvent=d,i.uniqueId=Za,i.updateGlobeVertexNormal=function(o,e,s,c,f){let g=5*e+2;o.float32[g+0]=s,o.float32[g+1]=c,o.float32[g+2]=f},i.validateCustomStyleLayer=function(o){let e=[],s=o.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},i.validateFilter=o=>Po(yc(o)),i.validateFog=o=>Po(kp(o)),i.validateLayer=o=>Po(Kh(o)),i.validateLight=o=>Po(Qh(o)),i.validateSource=o=>Po(Tu(o)),i.validateStyle=Rp,i.validateTerrain=o=>Po(Jh(o)),i.values=go,i.vectorTile=th,i.version=F,i.warnOnce=_i,i.window=C,i.wrap=dr}),a(["./shared"],function(i){"use strict";function C(be){if(typeof be=="number"||typeof be=="boolean"||typeof be=="string"||be==null)return JSON.stringify(be);if(Array.isArray(be)){let re="[";for(let ve of be)re+=`${C(ve)},`;return`${re}]`}let ie="{";for(let re of Object.keys(be).sort())ie+=`${re}:${C(be[re])},`;return`${ie}}`}function F(be){let ie="";for(let re of i.refProperties)ie+=`/${C(be[re])}`;return ie}class V{constructor(ie){this.keyCache={},ie&&this.replace(ie)}replace(ie){this._layerConfigs={},this._layers={},this.update(ie,[])}update(ie,re){for(let Me of ie)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=i.createStyleLayer(Me)).compileFilter(),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(let Me of re)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};let ve=function(Me,Pe){let $e={};for(let Oe=0;Oe<Me.length;Oe++){let Xe=Pe&&Pe[Me[Oe].id]||F(Me[Oe]);Pe&&(Pe[Me[Oe].id]=Xe);let wt=$e[Xe];wt||(wt=$e[Xe]=[]),wt.push(Me[Oe])}let je=[];for(let Oe in $e)je.push($e[Oe]);return je}(i.values(this._layerConfigs),this.keyCache);for(let Me of ve){let Pe=Me.map(Mt=>this._layers[Mt.id]),$e=Pe[0];if($e.visibility==="none")continue;let je=$e.source||"",Oe=this.familiesBySource[je];Oe||(Oe=this.familiesBySource[je]={});let Xe=$e.sourceLayer||"_geojsonTileLayer",wt=Oe[Xe];wt||(wt=Oe[Xe]=[]),wt.push(Pe)}}}class K{loadTile(ie,re){let{uid:ve,encoding:Me,rawImageData:Pe,padding:$e,buildQuadTree:je}=ie,Oe=i.window.ImageBitmap&&Pe instanceof i.window.ImageBitmap?this.getImageData(Pe,$e):Pe;re(null,new i.DEMData(ve,Oe,Me,$e<1,je))}getImageData(ie,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);let ve=this.offscreenCanvasContext.getImageData(-re,-re,ie.width+2*re,ie.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}function oe(be,ie){if(be.length!==0){Ee(be[0],ie);for(var re=1;re<be.length;re++)Ee(be[re],!ie)}}function Ee(be,ie){for(var re=0,ve=0,Me=0,Pe=be.length,$e=Pe-1;Me<Pe;$e=Me++){var je=(be[Me][0]-be[$e][0])*(be[$e][1]+be[Me][1]),Oe=re+je;ve+=Math.abs(re)>=Math.abs(je)?re-Oe+je:je-Oe+re,re=Oe}re+ve>=0!=!!ie&&be.reverse()}var Ye=i.getDefaultExportFromCjs(function be(ie,re){var ve,Me=ie&&ie.type;if(Me==="FeatureCollection")for(ve=0;ve<ie.features.length;ve++)be(ie.features[ve],re);else if(Me==="GeometryCollection")for(ve=0;ve<ie.geometries.length;ve++)be(ie.geometries[ve],re);else if(Me==="Feature")be(ie.geometry,re);else if(Me==="Polygon")oe(ie.coordinates,re);else if(Me==="MultiPolygon")for(ve=0;ve<ie.coordinates.length;ve++)oe(ie.coordinates[ve],re);return ie});let Ne=i.VectorTileFeature.prototype.toGeoJSON;var ct={exports:{}},bt=i.pointGeometry,Ut=i.vectorTile.VectorTileFeature,Qt=yi;function yi(be,ie){this.options=ie||{},this.features=be,this.length=be.length}function Un(be,ie){this.id=typeof be.id=="number"?be.id:void 0,this.type=be.type,this.rawGeometry=be.type===1?[be.geometry]:be.geometry,this.properties=be.tags,this.extent=ie||4096}yi.prototype.feature=function(be){return new Un(this.features[be],this.options.extent)},Un.prototype.loadGeometry=function(){var be=this.rawGeometry;this.geometry=[];for(var ie=0;ie<be.length;ie++){for(var re=be[ie],ve=[],Me=0;Me<re.length;Me++)ve.push(new bt(re[Me][0],re[Me][1]));this.geometry.push(ve)}return this.geometry},Un.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var be=this.geometry,ie=1/0,re=-1/0,ve=1/0,Me=-1/0,Pe=0;Pe<be.length;Pe++)for(var $e=be[Pe],je=0;je<$e.length;je++){var Oe=$e[je];ie=Math.min(ie,Oe.x),re=Math.max(re,Oe.x),ve=Math.min(ve,Oe.y),Me=Math.max(Me,Oe.y)}return[ie,ve,re,Me]},Un.prototype.toGeoJSON=Ut.prototype.toGeoJSON;var Io=i.pbf,lt=Qt;function mo(be){var ie=new Io;return function(re,ve){for(var Me in re.layers)ve.writeMessage(3,It,re.layers[Me])}(be,ie),ie.finish()}function It(be,ie){var re;ie.writeVarintField(15,be.version||1),ie.writeStringField(1,be.name||""),ie.writeVarintField(5,be.extent||4096);var ve={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<be.length;re++)ve.feature=be.feature(re),ie.writeMessage(2,Bs,ve);var Me=ve.keys;for(re=0;re<Me.length;re++)ie.writeStringField(3,Me[re]);var Pe=ve.values;for(re=0;re<Pe.length;re++)ie.writeMessage(4,Vs,Pe[re])}function Bs(be,ie){var re=be.feature;re.id!==void 0&&ie.writeVarintField(1,re.id),ie.writeMessage(2,Wa,be),ie.writeVarintField(3,re.type),ie.writeMessage(4,Xl,re)}function Wa(be,ie){var re=be.feature,ve=be.keys,Me=be.values,Pe=be.keycache,$e=be.valuecache;for(var je in re.properties){var Oe=re.properties[je],Xe=Pe[je];if(Oe!==null){Xe===void 0&&(ve.push(je),Pe[je]=Xe=ve.length-1),ie.writeVarint(Xe);var wt=typeof Oe;wt!=="string"&&wt!=="boolean"&&wt!=="number"&&(Oe=JSON.stringify(Oe));var Mt=wt+":"+Oe,yt=$e[Mt];yt===void 0&&(Me.push(Oe),$e[Mt]=yt=Me.length-1),ie.writeVarint(yt)}}}function An(be,ie){return(ie<<3)+(7&be)}function Yi(be){return be<<1^be>>31}function Xl(be,ie){for(var re=be.loadGeometry(),ve=be.type,Me=0,Pe=0,$e=re.length,je=0;je<$e;je++){var Oe=re[je],Xe=1;ve===1&&(Xe=Oe.length),ie.writeVarint(An(1,Xe));for(var wt=ve===3?Oe.length-1:Oe.length,Mt=0;Mt<wt;Mt++){Mt===1&&ve!==1&&ie.writeVarint(An(2,wt-1));var yt=Oe[Mt].x-Me,an=Oe[Mt].y-Pe;ie.writeVarint(Yi(yt)),ie.writeVarint(Yi(an)),Me+=yt,Pe+=an}ve===3&&ie.writeVarint(An(7,1))}}function Vs(be,ie){var re=typeof be;re==="string"?ie.writeStringField(1,be):re==="boolean"?ie.writeBooleanField(7,be):re==="number"&&(be%1!=0?ie.writeDoubleField(3,be):be<0?ie.writeSVarintField(6,be):ie.writeVarintField(5,be))}ct.exports=mo,ct.exports.fromVectorTileJs=mo,ct.exports.fromGeojsonVt=function(be,ie){ie=ie||{};var re={};for(var ve in be)re[ve]=new lt(be[ve].features,ie),re[ve].name=ve,re[ve].version=ie.version,re[ve].extent=ie.extent;return mo({layers:re})},ct.exports.GeoJSONWrapper=lt;var qa=i.getDefaultExportFromCjs(ct.exports);let Yc={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:be=>be},Cn=Math.fround||(Wo=new Float32Array(1),be=>(Wo[0]=+be,Wo[0]));var Wo;let dr=3,vr=5,go=6;class Fi{constructor(ie){this.options=Object.assign(Object.create(Yc),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){let{log:re,minZoom:ve,maxZoom:Me}=this.options;re&&console.time("total time");let Pe=`prepare ${ie.length} points`;re&&console.time(Pe),this.points=ie;let $e=[];for(let Oe=0;Oe<ie.length;Oe++){let Xe=ie[Oe];if(!Xe.geometry)continue;let[wt,Mt]=Xe.geometry.coordinates,yt=Cn(js(wt)),an=Cn(Us(Mt));$e.push(yt,an,1/0,Oe,-1,1),this.options.reduce&&$e.push(0)}let je=this.trees[Me+1]=this._createTree($e);re&&console.timeEnd(Pe);for(let Oe=Me;Oe>=ve;Oe--){let Xe=+Date.now();je=this.trees[Oe]=this._createTree(this._cluster(je,Oe)),re&&console.log("z%d: %d clusters in %dms",Oe,je.numItems,+Date.now()-Xe)}return re&&console.timeEnd("total time"),this}getClusters(ie,re){let ve=((ie[0]+180)%360+360)%360-180,Me=Math.max(-90,Math.min(90,ie[1])),Pe=ie[2]===180?180:((ie[2]+180)%360+360)%360-180,$e=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)ve=-180,Pe=180;else if(ve>Pe){let Mt=this.getClusters([ve,Me,180,$e],re),yt=this.getClusters([-180,Me,Pe,$e],re);return Mt.concat(yt)}let je=this.trees[this._limitZoom(re)],Oe=je.range(js(ve),Us($e),js(Pe),Us(Me)),Xe=je.data,wt=[];for(let Mt of Oe){let yt=this.stride*Mt;wt.push(Xe[yt+vr]>1?hs(Xe,yt,this.clusterProps):this.points[Xe[yt+dr]])}return wt}getChildren(ie){let re=this._getOriginId(ie),ve=this._getOriginZoom(ie),Me="No cluster with the specified id.",Pe=this.trees[ve];if(!Pe)throw new Error(Me);let $e=Pe.data;if(re*this.stride>=$e.length)throw new Error(Me);let je=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),Oe=Pe.within($e[re*this.stride],$e[re*this.stride+1],je),Xe=[];for(let wt of Oe){let Mt=wt*this.stride;$e[Mt+4]===ie&&Xe.push($e[Mt+vr]>1?hs($e,Mt,this.clusterProps):this.points[$e[Mt+dr]])}if(Xe.length===0)throw new Error(Me);return Xe}getLeaves(ie,re,ve){let Me=[];return this._appendLeaves(Me,ie,re=re||10,ve=ve||0,0),Me}getTile(ie,re,ve){let Me=this.trees[this._limitZoom(ie)],Pe=Math.pow(2,ie),{extent:$e,radius:je}=this.options,Oe=je/$e,Xe=(ve-Oe)/Pe,wt=(ve+1+Oe)/Pe,Mt={features:[]};return this._addTileFeatures(Me.range((re-Oe)/Pe,Xe,(re+1+Oe)/Pe,wt),Me.data,re,ve,Pe,Mt),re===0&&this._addTileFeatures(Me.range(1-Oe/Pe,Xe,1,wt),Me.data,Pe,ve,Pe,Mt),re===Pe-1&&this._addTileFeatures(Me.range(0,Xe,Oe/Pe,wt),Me.data,-1,ve,Pe,Mt),Mt.features.length?Mt:null}getClusterExpansionZoom(ie){let re=this._getOriginZoom(ie)-1;for(;re<=this.options.maxZoom;){let ve=this.getChildren(ie);if(re++,ve.length!==1)break;ie=ve[0].properties.cluster_id}return re}_appendLeaves(ie,re,ve,Me,Pe){let $e=this.getChildren(re);for(let je of $e){let Oe=je.properties;if(Oe&&Oe.cluster?Pe+Oe.point_count<=Me?Pe+=Oe.point_count:Pe=this._appendLeaves(ie,Oe.cluster_id,ve,Me,Pe):Pe<Me?Pe++:ie.push(je),ie.length===ve)break}return Pe}_createTree(ie){let re=new i.KDBush(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<ie.length;ve+=this.stride)re.add(ie[ve],ie[ve+1]);return re.finish(),re.data=ie,re}_addTileFeatures(ie,re,ve,Me,Pe,$e){for(let je of ie){let Oe=je*this.stride,Xe=re[Oe+vr]>1,wt,Mt,yt;if(Xe)wt=Za(re,Oe,this.clusterProps),Mt=re[Oe],yt=re[Oe+1];else{let cn=this.points[re[Oe+dr]];wt=cn.properties;let[mn,kn]=cn.geometry.coordinates;Mt=js(mn),yt=Us(kn)}let an={type:1,geometry:[[Math.round(this.options.extent*(Mt*Pe-ve)),Math.round(this.options.extent*(yt*Pe-Me))]],tags:wt},Dn;Dn=Xe||this.options.generateId?re[Oe+dr]:this.points[re[Oe+dr]].id,Dn!==void 0&&(an.id=Dn),$e.features.push(an)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,re){let{radius:ve,extent:Me,reduce:Pe,minPoints:$e}=this.options,je=ve/(Me*Math.pow(2,re)),Oe=ie.data,Xe=[],wt=this.stride;for(let Mt=0;Mt<Oe.length;Mt+=wt){if(Oe[Mt+2]<=re)continue;Oe[Mt+2]=re;let yt=Oe[Mt],an=Oe[Mt+1],Dn=ie.within(Oe[Mt],Oe[Mt+1],je),cn=Oe[Mt+vr],mn=cn;for(let kn of Dn){let Rn=kn*wt;Oe[Rn+2]>re&&(mn+=Oe[Rn+vr])}if(mn>cn&&mn>=$e){let kn,Rn=yt*cn,Ki=an*cn,Vr=-1,hr=((Mt/wt|0)<<5)+(re+1)+this.points.length;for(let ms of Dn){let Ir=ms*wt;if(Oe[Ir+2]<=re)continue;Oe[Ir+2]=re;let jr=Oe[Ir+vr];Rn+=Oe[Ir]*jr,Ki+=Oe[Ir+1]*jr,Oe[Ir+4]=hr,Pe&&(kn||(kn=this._map(Oe,Mt,!0),Vr=this.clusterProps.length,this.clusterProps.push(kn)),Pe(kn,this._map(Oe,Ir)))}Oe[Mt+4]=hr,Xe.push(Rn/mn,Ki/mn,1/0,hr,-1,mn),Pe&&Xe.push(Vr)}else{for(let kn=0;kn<wt;kn++)Xe.push(Oe[Mt+kn]);if(mn>1)for(let kn of Dn){let Rn=kn*wt;if(!(Oe[Rn+2]<=re)){Oe[Rn+2]=re;for(let Ki=0;Ki<wt;Ki++)Xe.push(Oe[Rn+Ki])}}}}return Xe}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,re,ve){if(ie[re+vr]>1){let $e=this.clusterProps[ie[re+go]];return ve?Object.assign({},$e):$e}let Me=this.points[ie[re+dr]].properties,Pe=this.options.map(Me);return ve&&Pe===Me?Object.assign({},Pe):Pe}}function hs(be,ie,re){return{type:"Feature",id:be[ie+dr],properties:Za(be,ie,re),geometry:{type:"Point",coordinates:[(ve=be[ie],360*(ve-.5)),fs(be[ie+1])]}};var ve}function Za(be,ie,re){let ve=be[ie+vr],Me=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Pe=be[ie+go],$e=Pe===-1?{}:Object.assign({},re[Pe]);return Object.assign($e,{cluster:!0,cluster_id:be[ie+dr],point_count:ve,point_count_abbreviated:Me})}function js(be){return be/360+.5}function Us(be){let ie=Math.sin(be*Math.PI/180),re=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return re<0?0:re>1?1:re}function fs(be){let ie=(180-360*be)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function _a(be,ie,re,ve){for(var Me,Pe=ve,$e=re-ie>>1,je=re-ie,Oe=be[ie],Xe=be[ie+1],wt=be[re],Mt=be[re+1],yt=ie+3;yt<re;yt+=3){var an=Xa(be[yt],be[yt+1],Oe,Xe,wt,Mt);if(an>Pe)Me=yt,Pe=an;else if(an===Pe){var Dn=Math.abs(yt-$e);Dn<je&&(Me=yt,je=Dn)}}Pe>ve&&(Me-ie>3&&_a(be,ie,Me,ve),be[Me+2]=Pe,re-Me>3&&_a(be,Me,re,ve))}function Xa(be,ie,re,ve,Me,Pe){var $e=Me-re,je=Pe-ve;if($e!==0||je!==0){var Oe=((be-re)*$e+(ie-ve)*je)/($e*$e+je*je);Oe>1?(re=Me,ve=Pe):Oe>0&&(re+=$e*Oe,ve+=je*Oe)}return($e=be-re)*$e+(je=ie-ve)*je}function Nn(be,ie,re,ve){var Me={id:be===void 0?null:be,type:ie,geometry:re,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var $e=Pe.geometry,je=Pe.type;if(je==="Point"||je==="MultiPoint"||je==="LineString")Zt(Pe,$e);else if(je==="Polygon"||je==="MultiLineString")for(var Oe=0;Oe<$e.length;Oe++)Zt(Pe,$e[Oe]);else if(je==="MultiPolygon")for(Oe=0;Oe<$e.length;Oe++)for(var Xe=0;Xe<$e[Oe].length;Xe++)Zt(Pe,$e[Oe][Xe])}(Me),Me}function Zt(be,ie){for(var re=0;re<ie.length;re+=3)be.minX=Math.min(be.minX,ie[re]),be.minY=Math.min(be.minY,ie[re+1]),be.maxX=Math.max(be.maxX,ie[re]),be.maxY=Math.max(be.maxY,ie[re+1])}function yo(be,ie,re,ve){if(ie.geometry){var Me=ie.geometry.coordinates,Pe=ie.geometry.type,$e=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),je=[],Oe=ie.id;if(re.promoteId?Oe=ie.properties[re.promoteId]:re.generateId&&(Oe=ve||0),Pe==="Point")va(Me,je);else if(Pe==="MultiPoint")for(var Xe=0;Xe<Me.length;Xe++)va(Me[Xe],je);else if(Pe==="LineString")_i(Me,je,$e,!1);else if(Pe==="MultiLineString"){if(re.lineMetrics){for(Xe=0;Xe<Me.length;Xe++)_i(Me[Xe],je=[],$e,!1),be.push(Nn(Oe,"LineString",je,ie.properties));return}_o(Me,je,$e,!1)}else if(Pe==="Polygon")_o(Me,je,$e,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(Xe=0;Xe<ie.geometry.geometries.length;Xe++)yo(be,{id:Oe,geometry:ie.geometry.geometries[Xe],properties:ie.properties},re,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Xe=0;Xe<Me.length;Xe++){var wt=[];_o(Me[Xe],wt,$e,!0),je.push(wt)}}be.push(Nn(Oe,Pe,je,ie.properties))}}function va(be,ie){ie.push(Ya(be[0])),ie.push(ps(be[1])),ie.push(0)}function _i(be,ie,re,ve){for(var Me,Pe,$e=0,je=0;je<be.length;je++){var Oe=Ya(be[je][0]),Xe=ps(be[je][1]);ie.push(Oe),ie.push(Xe),ie.push(0),je>0&&($e+=ve?(Me*Xe-Oe*Pe)/2:Math.sqrt(Math.pow(Oe-Me,2)+Math.pow(Xe-Pe,2))),Me=Oe,Pe=Xe}var wt=ie.length-3;ie[2]=1,_a(ie,0,wt,re),ie[wt+2]=1,ie.size=Math.abs($e),ie.start=0,ie.end=ie.size}function _o(be,ie,re,ve){for(var Me=0;Me<be.length;Me++){var Pe=[];_i(be[Me],Pe,re,ve),ie.push(Pe)}}function Ya(be){return be/360+.5}function ps(be){var ie=Math.sin(be*Math.PI/180),re=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return re<0?0:re>1?1:re}function Kr(be,ie,re,ve,Me,Pe,$e,je){if(ve/=ie,Pe>=(re/=ie)&&$e<ve)return be;if($e<re||Pe>=ve)return null;for(var Oe=[],Xe=0;Xe<be.length;Xe++){var wt=be[Xe],Mt=wt.geometry,yt=wt.type,an=Me===0?wt.minX:wt.minY,Dn=Me===0?wt.maxX:wt.maxY;if(an>=re&&Dn<ve)Oe.push(wt);else if(!(Dn<re||an>=ve)){var cn=[];if(yt==="Point"||yt==="MultiPoint")$s(Mt,cn,re,ve,Me);else if(yt==="LineString")Yl(Mt,cn,re,ve,Me,!1,je.lineMetrics);else if(yt==="MultiLineString")Qr(Mt,cn,re,ve,Me,!1);else if(yt==="Polygon")Qr(Mt,cn,re,ve,Me,!0);else if(yt==="MultiPolygon")for(var mn=0;mn<Mt.length;mn++){var kn=[];Qr(Mt[mn],kn,re,ve,Me,!0),kn.length&&cn.push(kn)}if(cn.length){if(je.lineMetrics&&yt==="LineString"){for(mn=0;mn<cn.length;mn++)Oe.push(Nn(wt.id,yt,cn[mn],wt.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(cn.length===1?(yt="LineString",cn=cn[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=cn.length===3?"Point":"MultiPoint"),Oe.push(Nn(wt.id,yt,cn,wt.tags))}}}return Oe.length?Oe:null}function $s(be,ie,re,ve,Me){for(var Pe=0;Pe<be.length;Pe+=3){var $e=be[Pe+Me];$e>=re&&$e<=ve&&(ie.push(be[Pe]),ie.push(be[Pe+1]),ie.push(be[Pe+2]))}}function Yl(be,ie,re,ve,Me,Pe,$e){for(var je,Oe,Xe=Kc(be),wt=Me===0?Di:hd,Mt=be.start,yt=0;yt<be.length-3;yt+=3){var an=be[yt],Dn=be[yt+1],cn=be[yt+2],mn=be[yt+3],kn=be[yt+4],Rn=Me===0?an:Dn,Ki=Me===0?mn:kn,Vr=!1;$e&&(je=Math.sqrt(Math.pow(an-mn,2)+Math.pow(Dn-kn,2))),Rn<re?Ki>re&&(Oe=wt(Xe,an,Dn,mn,kn,re),$e&&(Xe.start=Mt+je*Oe)):Rn>ve?Ki<ve&&(Oe=wt(Xe,an,Dn,mn,kn,ve),$e&&(Xe.start=Mt+je*Oe)):Kl(Xe,an,Dn,cn),Ki<re&&Rn>=re&&(Oe=wt(Xe,an,Dn,mn,kn,re),Vr=!0),Ki>ve&&Rn<=ve&&(Oe=wt(Xe,an,Dn,mn,kn,ve),Vr=!0),!Pe&&Vr&&($e&&(Xe.end=Mt+je*Oe),ie.push(Xe),Xe=Kc(be)),$e&&(Mt+=je)}var hr=be.length-3;an=be[hr],Dn=be[hr+1],cn=be[hr+2],(Rn=Me===0?an:Dn)>=re&&Rn<=ve&&Kl(Xe,an,Dn,cn),hr=Xe.length-3,Pe&&hr>=3&&(Xe[hr]!==Xe[0]||Xe[hr+1]!==Xe[1])&&Kl(Xe,Xe[0],Xe[1],Xe[2]),Xe.length&&ie.push(Xe)}function Kc(be){var ie=[];return ie.size=be.size,ie.start=be.start,ie.end=be.end,ie}function Qr(be,ie,re,ve,Me,Pe){for(var $e=0;$e<be.length;$e++)Yl(be[$e],ie,re,ve,Me,Pe,!1)}function Kl(be,ie,re,ve){be.push(ie),be.push(re),be.push(ve)}function Di(be,ie,re,ve,Me,Pe){var $e=(Pe-ie)/(ve-ie);return be.push(Pe),be.push(re+(Me-re)*$e),be.push(1),$e}function hd(be,ie,re,ve,Me,Pe){var $e=(Pe-re)/(Me-re);return be.push(ie+(ve-ie)*$e),be.push(Pe),be.push(1),$e}function So(be,ie){for(var re=[],ve=0;ve<be.length;ve++){var Me,Pe=be[ve],$e=Pe.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")Me=ba(Pe.geometry,ie);else if($e==="MultiLineString"||$e==="Polygon"){Me=[];for(var je=0;je<Pe.geometry.length;je++)Me.push(ba(Pe.geometry[je],ie))}else if($e==="MultiPolygon")for(Me=[],je=0;je<Pe.geometry.length;je++){for(var Oe=[],Xe=0;Xe<Pe.geometry[je].length;Xe++)Oe.push(ba(Pe.geometry[je][Xe],ie));Me.push(Oe)}re.push(Nn(Pe.id,$e,Me,Pe.tags))}return re}function ba(be,ie){var re=[];re.size=be.size,be.start!==void 0&&(re.start=be.start,re.end=be.end);for(var ve=0;ve<be.length;ve+=3)re.push(be[ve]+ie,be[ve+1],be[ve+2]);return re}function Ql(be,ie){if(be.transformed)return be;var re,ve,Me,Pe=1<<be.z,$e=be.x,je=be.y;for(re=0;re<be.features.length;re++){var Oe=be.features[re],Xe=Oe.geometry,wt=Oe.type;if(Oe.geometry=[],wt===1)for(ve=0;ve<Xe.length;ve+=2)Oe.geometry.push(Hs(Xe[ve],Xe[ve+1],ie,Pe,$e,je));else for(ve=0;ve<Xe.length;ve++){var Mt=[];for(Me=0;Me<Xe[ve].length;Me+=2)Mt.push(Hs(Xe[ve][Me],Xe[ve][Me+1],ie,Pe,$e,je));Oe.geometry.push(Mt)}}return be.transformed=!0,be}function Hs(be,ie,re,ve,Me,Pe){return[Math.round(re*(be*ve-Me)),Math.round(re*(ie*ve-Pe))]}function Jl(be,ie,re,ve,Me){for(var Pe=ie===Me.maxZoom?0:Me.tolerance/((1<<ie)*Me.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:ve,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<be.length;je++){$e.numFeatures++,Qc($e,be[je],Pe,Me);var Oe=be[je].minX,Xe=be[je].minY,wt=be[je].maxX,Mt=be[je].maxY;Oe<$e.minX&&($e.minX=Oe),Xe<$e.minY&&($e.minY=Xe),wt>$e.maxX&&($e.maxX=wt),Mt>$e.maxY&&($e.maxY=Mt)}return $e}function Qc(be,ie,re,ve){var Me=ie.geometry,Pe=ie.type,$e=[];if(Pe==="Point"||Pe==="MultiPoint")for(var je=0;je<Me.length;je+=3)$e.push(Me[je]),$e.push(Me[je+1]),be.numPoints++,be.numSimplified++;else if(Pe==="LineString")Ka($e,Me,be,re,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(je=0;je<Me.length;je++)Ka($e,Me[je],be,re,Pe==="Polygon",je===0);else if(Pe==="MultiPolygon")for(var Oe=0;Oe<Me.length;Oe++){var Xe=Me[Oe];for(je=0;je<Xe.length;je++)Ka($e,Xe[je],be,re,!0,je===0)}if($e.length){var wt=ie.tags||null;if(Pe==="LineString"&&ve.lineMetrics){for(var Mt in wt={},ie.tags)wt[Mt]=ie.tags[Mt];wt.mapbox_clip_start=Me.start/Me.size,wt.mapbox_clip_end=Me.end/Me.size}var yt={geometry:$e,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:wt};ie.id!==null&&(yt.id=ie.id),be.features.push(yt)}}function Ka(be,ie,re,ve,Me,Pe){var $e=ve*ve;if(ve>0&&ie.size<(Me?$e:ve))re.numPoints+=ie.length/3;else{for(var je=[],Oe=0;Oe<ie.length;Oe+=3)(ve===0||ie[Oe+2]>$e)&&(re.numSimplified++,je.push(ie[Oe]),je.push(ie[Oe+1])),re.numPoints++;Me&&function(Xe,wt){for(var Mt=0,yt=0,an=Xe.length,Dn=an-2;yt<an;Dn=yt,yt+=2)Mt+=(Xe[yt]-Xe[Dn])*(Xe[yt+1]+Xe[Dn+1]);if(Mt>0===wt)for(yt=0,an=Xe.length;yt<an/2;yt+=2){var cn=Xe[yt],mn=Xe[yt+1];Xe[yt]=Xe[an-2-yt],Xe[yt+1]=Xe[an-1-yt],Xe[an-2-yt]=cn,Xe[an-1-yt]=mn}}(je,Pe),be.push(je)}}function vo(be,ie){var re=(ie=this.options=function(Me,Pe){for(var $e in Pe)Me[$e]=Pe[$e];return Me}(Object.create(this.options),ie)).debug;if(re&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var ve=function(Me,Pe){var $e=[];if(Me.type==="FeatureCollection")for(var je=0;je<Me.features.length;je++)yo($e,Me.features[je],Pe,je);else yo($e,Me.type==="Feature"?Me:{geometry:Me},Pe);return $e}(be,ie);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=function(Me,Pe){var $e=Pe.buffer/Pe.extent,je=Me,Oe=Kr(Me,1,-1-$e,$e,0,-1,2,Pe),Xe=Kr(Me,1,1-$e,2+$e,0,-1,2,Pe);return(Oe||Xe)&&(je=Kr(Me,1,-$e,1+$e,0,-1,2,Pe)||[],Oe&&(je=So(Oe,1).concat(je)),Xe&&(je=je.concat(So(Xe,-1)))),je}(ve,ie),ve.length&&this.splitTile(ve,0,0,0),re&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gs(be,ie,re){return 32*((1<<be)*re+ie)+be}function Mr(be,ie){let re=be.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);let ve=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ve)return ie(null,null);let Me=new class{constructor($e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.EXTENT,this.length=$e.length,this._features=$e}feature($e){return new class{constructor(je){this._feature=je,this.extent=i.EXTENT,this.type=je.type,this.properties=je.tags,"id"in je&&!isNaN(je.id)&&(this.id=parseInt(je.id,10))}loadGeometry(){if(this._feature.type===1){let je=[];for(let Oe of this._feature.geometry)je.push([new i.Point(Oe[0],Oe[1])]);return je}{let je=[];for(let Oe of this._feature.geometry){let Xe=[];for(let wt of Oe)Xe.push(new i.Point(wt[0],wt[1]));je.push(Xe)}return je}}toGeoJSON(je,Oe,Xe){return Ne.call(this,je,Oe,Xe)}}(this._features[$e])}}(ve.features),Pe=qa(Me);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),ie(null,{vectorTile:Me,rawData:Pe.buffer})}vo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vo.prototype.splitTile=function(be,ie,re,ve,Me,Pe,$e){for(var je=[be,ie,re,ve],Oe=this.options,Xe=Oe.debug;je.length;){ve=je.pop(),re=je.pop(),ie=je.pop(),be=je.pop();var wt=1<<ie,Mt=Gs(ie,re,ve),yt=this.tiles[Mt];if(!yt&&(Xe>1&&console.time("creation"),yt=this.tiles[Mt]=Jl(be,ie,re,ve,Oe),this.tileCoords.push({z:ie,x:re,y:ve}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,re,ve,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));var an="z"+ie;this.stats[an]=(this.stats[an]||0)+1,this.total++}if(yt.source=be,Me){if(ie===Oe.maxZoom||ie===Me)continue;var Dn=1<<Me-ie;if(re!==Math.floor(Pe/Dn)||ve!==Math.floor($e/Dn))continue}else if(ie===Oe.indexMaxZoom||yt.numPoints<=Oe.indexMaxPoints)continue;if(yt.source=null,be.length!==0){Xe>1&&console.time("clipping");var cn,mn,kn,Rn,Ki,Vr,hr=.5*Oe.buffer/Oe.extent,ms=.5-hr,Ir=.5+hr,jr=1+hr;cn=mn=kn=Rn=null,Ki=Kr(be,wt,re-hr,re+Ir,0,yt.minX,yt.maxX,Oe),Vr=Kr(be,wt,re+ms,re+jr,0,yt.minX,yt.maxX,Oe),be=null,Ki&&(cn=Kr(Ki,wt,ve-hr,ve+Ir,1,yt.minY,yt.maxY,Oe),mn=Kr(Ki,wt,ve+ms,ve+jr,1,yt.minY,yt.maxY,Oe),Ki=null),Vr&&(kn=Kr(Vr,wt,ve-hr,ve+Ir,1,yt.minY,yt.maxY,Oe),Rn=Kr(Vr,wt,ve+ms,ve+jr,1,yt.minY,yt.maxY,Oe),Vr=null),Xe>1&&console.timeEnd("clipping"),je.push(cn||[],ie+1,2*re,2*ve),je.push(mn||[],ie+1,2*re,2*ve+1),je.push(kn||[],ie+1,2*re+1,2*ve),je.push(Rn||[],ie+1,2*re+1,2*ve+1)}}},vo.prototype.getTile=function(be,ie,re){var ve=this.options,Me=ve.extent,Pe=ve.debug;if(be<0||be>24)return null;var $e=1<<be,je=Gs(be,ie=(ie%$e+$e)%$e,re);if(this.tiles[je])return Ql(this.tiles[je],Me);Pe>1&&console.log("drilling down to z%d-%d-%d",be,ie,re);for(var Oe,Xe=be,wt=ie,Mt=re;!Oe&&Xe>0;)Xe--,wt=Math.floor(wt/2),Mt=Math.floor(Mt/2),Oe=this.tiles[Gs(Xe,wt,Mt)];return Oe&&Oe.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",Xe,wt,Mt),Pe>1&&console.time("drilling down"),this.splitTile(Oe.source,Xe,wt,Mt,be,ie,re),Pe>1&&console.timeEnd("drilling down"),this.tiles[je]?Ql(this.tiles[je],Me):null):null};class Ws extends i.VectorTileWorkerSource{constructor(ie,re,ve,Me,Pe){super(ie,re,ve,Me,Mr),Pe&&(this.loadGeoJSON=Pe)}loadData(ie,re){let ve=ie&&ie.request,Me=ve&&ve.collectResourceTiming;this.loadGeoJSON(ie,(Pe,$e)=>{if(Pe||!$e)return re(Pe);if(typeof $e!="object")return re(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{Ye($e,!0);try{if(ie.filter){let Oe=i.createExpression(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(wt=>`${wt.key}: ${wt.message}`).join(", "));$e={type:"FeatureCollection",features:$e.features.filter(wt=>Oe.value.evaluate({zoom:0},wt))}}this._geoJSONIndex=ie.cluster?new Fi(function({superclusterOptions:Oe,clusterProperties:Xe}){if(!Xe||!Oe)return Oe;let wt={},Mt={},yt={accumulated:null,zoom:0},an={properties:null},Dn=Object.keys(Xe);for(let cn of Dn){let[mn,kn]=Xe[cn],Rn=i.createExpression(kn),Ki=i.createExpression(typeof mn=="string"?[mn,["accumulated"],["get",cn]]:mn);wt[cn]=Rn.value,Mt[cn]=Ki.value}return Oe.map=cn=>{an.properties=cn;let mn={};for(let kn of Dn)mn[kn]=wt[kn].evaluate(yt,an);return mn},Oe.reduce=(cn,mn)=>{an.properties=mn;for(let kn of Dn)yt.accumulated=cn[kn],cn[kn]=Mt[kn].evaluate(yt,an)},Oe}(ie)).load($e.features):function(Oe,Xe){return new vo(Oe,Xe)}($e,ie.geojsonVtOptions)}catch(Oe){return re(Oe)}this.loaded={};let je={};if(Me){let Oe=i.getPerformanceMeasurement(ve);Oe&&(je.resourceTiming={},je.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Oe)))}re(null,je)}})}reloadTile(ie,re){let ve=this.loaded;return ve&&ve[ie.uid]?super.reloadTile(ie,re):this.loadTile(ie,re)}loadGeoJSON(ie,re){if(ie.request)i.getJSON(ie.request,re);else{if(typeof ie.data!="string")return re(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(ie.data))}catch{return re(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ie,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(ve){re(ve)}}getClusterChildren(ie,re){try{re(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(ve){re(ve)}}getClusterLeaves(ie,re){try{re(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(ve){re(ve)}}}class fd{constructor(ie){this.self=ie,this.actor=new i.Actor(ie,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.getProjection({name:"mercator"}),this.workerSourceTypes={vector:i.VectorTileWorkerSource,geojson:Ws},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,ve)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=ve},this.self.registerRTLTextPlugin=re=>{if(i.plugin.isParsed())throw new Error("RTL text plugin already registered.");i.plugin.applyArabicShaping=re.applyArabicShaping,i.plugin.processBidirectionalText=re.processBidirectionalText,i.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(ie,re,ve){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie],ve()}checkIfReady(ie,re,ve){ve()}setReferrer(ie,re){this.referrer=re}spriteLoaded(ie,re){this.isSpriteLoaded[ie]=re;for(let ve in this.workerSources[ie]){let Me=this.workerSources[ie][ve];for(let Pe in Me)Me[Pe]instanceof i.VectorTileWorkerSource&&(Me[Pe].isSpriteLoaded=re,Me[Pe].fire(new i.Event("isSpriteLoaded")))}}setImages(ie,re,ve){this.availableImages[ie]=re;for(let Me in this.workerSources[ie]){let Pe=this.workerSources[ie][Me];for(let $e in Pe)Pe[$e].availableImages=re}ve()}enableTerrain(ie,re,ve){this.terrain=re,ve()}setProjection(ie,re){this.projections[ie]=i.getProjection(re)}setLayers(ie,re,ve){this.getLayerIndex(ie).replace(re),ve()}updateLayers(ie,re,ve){this.getLayerIndex(ie).update(re.layers,re.removedIds),ve()}loadTile(ie,re,ve){let Me=this.enableTerrain?i.extend({enableTerrain:this.terrain},re):re;Me.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,re.type,re.source).loadTile(Me,ve)}loadDEMTile(ie,re,ve){let Me=this.enableTerrain?i.extend({buildQuadTree:this.terrain},re):re;this.getDEMWorkerSource(ie,re.source).loadTile(Me,ve)}reloadTile(ie,re,ve){let Me=this.enableTerrain?i.extend({enableTerrain:this.terrain},re):re;Me.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,re.type,re.source).reloadTile(Me,ve)}abortTile(ie,re,ve){this.getWorkerSource(ie,re.type,re.source).abortTile(re,ve)}removeTile(ie,re,ve){this.getWorkerSource(ie,re.type,re.source).removeTile(re,ve)}removeSource(ie,re,ve){if(!this.workerSources[ie]||!this.workerSources[ie][re.type]||!this.workerSources[ie][re.type][re.source])return;let Me=this.workerSources[ie][re.type][re.source];delete this.workerSources[ie][re.type][re.source],Me.removeSource!==void 0?Me.removeSource(re,ve):ve()}loadWorkerSource(ie,re,ve){try{this.self.importScripts(re.url),ve()}catch(Me){ve(Me.toString())}}syncRTLPluginState(ie,re,ve){try{i.plugin.setState(re);let Me=i.plugin.getPluginURL();if(i.plugin.isLoaded()&&!i.plugin.isParsed()&&Me!=null){this.self.importScripts(Me);let Pe=i.plugin.isParsed();ve(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Me}`),Pe)}}catch(Me){ve(Me.toString())}}getAvailableImages(ie){let re=this.availableImages[ie];return re||(re=[]),re}getLayerIndex(ie){let re=this.layerIndexes[ie];return re||(re=this.layerIndexes[ie]=new V),re}getWorkerSource(ie,re,ve){if(this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][re]||(this.workerSources[ie][re]={}),!this.workerSources[ie][re][ve]){let Me={send:(Pe,$e,je,Oe,Xe,wt)=>{this.actor.send(Pe,$e,je,ie,Xe,wt)},scheduler:this.actor.scheduler};this.workerSources[ie][re][ve]=new this.workerSourceTypes[re](Me,this.getLayerIndex(ie),this.getAvailableImages(ie),this.isSpriteLoaded[ie])}return this.workerSources[ie][re][ve]}getDEMWorkerSource(ie,re){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][re]||(this.demWorkerSources[ie][re]=new K),this.demWorkerSources[ie][re]}enforceCacheSizeLimit(ie,re){i.enforceCacheSizeLimit(re)}getWorkerPerformanceMetrics(ie,re,ve){ve(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new fd(self)),fd}),a(["./shared"],function(i){"use strict";function C(m,l){if(Array.isArray(m)){if(!Array.isArray(l)||m.length!==l.length)return!1;for(let d=0;d<m.length;d++)if(!C(m[d],l[d]))return!1;return!0}if(typeof m=="object"&&m!==null&&l!==null){if(typeof l!="object"||Object.keys(m).length!==Object.keys(l).length)return!1;for(let d in m)if(!C(m[d],l[d]))return!1;return!0}return m===l}var F=V;function V(m){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,D=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(D);try{x=new Worker(k),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(k),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var D=x.getImageData(0,0,1,1);return D&&D.width===_.width}()?(K[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(K[d]=function(_){var x,D=function(k){var R=document.createElement("canvas"),z=Object.create(V.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=k,R.getContext("webgl",z)||R.getContext("experimental-webgl",z)}(_);if(!D)return!1;try{x=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!x||D.isContextLost())&&(D.shaderSource(x,"void main() {}"),D.compileShader(x),D.getShaderParameter(x,D.COMPILE_STATUS)===!0)}(d)),K[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(m)}var K={};function oe(m,l,d){let _=i.window.document.createElement(m);return l!==void 0&&(_.className=l),d&&d.appendChild(_),_}function Ee(m,l,d){let _=i.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(let x of Object.keys(l))_.setAttributeNS(null,x,l[x]);return d&&d.appendChild(_),_}V.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Ye=i.window.document&&i.window.document.documentElement.style,Ne=Ye&&Ye.userSelect!==void 0?"userSelect":"WebkitUserSelect",ct;function bt(){Ye&&Ne&&(ct=Ye[Ne],Ye[Ne]="none")}function Ut(){Ye&&Ne&&(Ye[Ne]=ct)}function Qt(m){m.preventDefault(),m.stopPropagation(),i.window.removeEventListener("click",Qt,!0)}function yi(){i.window.addEventListener("click",Qt,!0),i.window.setTimeout(()=>{i.window.removeEventListener("click",Qt,!0)},0)}function Un(m,l){let d=m.getBoundingClientRect();return mo(m,d,l)}function Io(m,l){let d=m.getBoundingClientRect(),_=[];for(let x=0;x<l.length;x++)_.push(mo(m,d,l[x]));return _}function lt(m){return i.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&i.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function mo(m,l,d){let _=m.offsetWidth===l.width?1:m.offsetWidth/l.width;return new i.Point((d.clientX-l.left)*_,(d.clientY-l.top)*_)}function It(m,l){var d=l[0],_=l[1],x=l[2],D=l[3],k=d*D-x*_;return k?(m[0]=D*(k=1/k),m[1]=-_*k,m[2]=-x*k,m[3]=d*k,m):null}function Bs(m){let{userImage:l}=m;return!!(l&&l.render&&l.render())&&(m.data.replace(new Uint8Array(l.data.buffer)),!0)}class Wa extends i.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(let{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,d){this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new i.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new i.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new i.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,d){if(!l)return!0;let _=0;for(let x of l){if(x[0]<_||x[1]<x[0]||d<x[1])return!1;_=x[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d){d.version=this.images[l].version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){let d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,d){let _=!0;if(!this.isLoaded())for(let x of l)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(l,d):this.requestors.push({ids:l,callback:d})}_notify(l,d){let _={};for(let x of l){this.images[x]||this.fire(new i.Event("styleimagemissing",{id:x}));let D=this.images[x];D?_[x]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)}:i.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){let{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){let d=this.patterns[l],_=this.getImage(l);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{let x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},D=new i.ImagePosition(x,_);this.patterns[l]={bin:x,position:D}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){let d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new i.Texture(l,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){let l=[];for(let D in this.patterns)l.push(this.patterns[D].bin);let{w:d,h:_}=i.potpack(l),x=this.atlasImage;x.resize({width:d||1,height:_||1});for(let D in this.patterns){let{bin:k}=this.patterns[D],R=k.x+1,z=k.y+1,G=this.images[D].data,H=G.width,Y=G.height;i.RGBAImage.copy(G,x,{x:0,y:0},{x:R,y:z},{width:H,height:Y}),i.RGBAImage.copy(G,x,{x:0,y:Y-1},{x:R,y:z-1},{width:H,height:1}),i.RGBAImage.copy(G,x,{x:0,y:0},{x:R,y:z+Y},{width:H,height:1}),i.RGBAImage.copy(G,x,{x:H-1,y:0},{x:R-1,y:z},{width:1,height:Y}),i.RGBAImage.copy(G,x,{x:0,y:0},{x:R+H,y:z},{width:1,height:Y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(let d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;let _=this.images[d];Bs(_)&&this.updateImage(d,_)}}}let An=new i.Properties({anchor:new i.DataConstantProperty(i.spec.light.anchor),position:new class{constructor(){this.specification=i.spec.light.position}possiblyEvaluate(m,l){return function([d,_,x]){let D=i.degToRad(_+90),k=i.degToRad(x);return{x:d*Math.cos(D)*Math.sin(k),y:d*Math.sin(D)*Math.sin(k),z:d*Math.cos(k),azimuthal:_,polar:x}}(m.expression.evaluate(l))}interpolate(m,l,d){return{x:i.number(m.x,l.x,d),y:i.number(m.y,l.y,d),z:i.number(m.z,l.z,d),azimuthal:i.number(m.azimuthal,l.azimuthal,d),polar:i.number(m.polar,l.polar,d)}}},color:new i.DataConstantProperty(i.spec.light.color),intensity:new i.DataConstantProperty(i.spec.light.intensity)});class Yi extends i.Evented{constructor(l){super(),this._transitionable=new i.Transitionable(An),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(i.validateLight,l,d))for(let _ in l){let x=l[_];i.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||_.validate!==!1)&&i.emitValidationErrors(this,l.call(i.validateStyle,i.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}let Xl=new i.Properties({source:new i.DataConstantProperty(i.spec.terrain.source),exaggeration:new i.DataConstantProperty(i.spec.terrain.exaggeration)}),Vs=class extends i.Evented{constructor(m,l){super(),this._transitionable=new i.Transitionable(Xl),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(m){for(let l in m){let d=m[l];i.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),d):this._transitionable.setValue(l,d)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function qa(m,l,d,_){let x=i.smoothstep(45,65,d),[D,k]=Yc(m,_),R=i.length(l),z=1-Math.min(1,Math.exp((R-D)/(k-D)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*x*m.alpha}function Yc(m,l){let d=.5/Math.tan(.5*l);return[m.range[0]+d,m.range[1]+d]}let Cn=new i.Properties({range:new i.DataConstantProperty(i.spec.fog.range),color:new i.DataConstantProperty(i.spec.fog.color),"high-color":new i.DataConstantProperty(i.spec.fog["high-color"]),"space-color":new i.DataConstantProperty(i.spec.fog["space-color"]),"horizon-blend":new i.DataConstantProperty(i.spec.fog["horizon-blend"]),"star-intensity":new i.DataConstantProperty(i.spec.fog["star-intensity"])});class Wo extends i.Evented{constructor(l,d){super(),this._transitionable=new i.Transitionable(Cn),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){let l=this._transform,d=l.projection.name==="globe",_=i.globeToMercatorTransition(l.zoom),x=this.properties.get("range"),D=[.5,3];return{range:d?[i.number(D[0],x[0],_),i.number(D[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d={}){if(!this._validate(i.validateFog,l,d)){for(let _ of Object.keys(i.spec.fog))l&&l[_]===void 0&&(l[_]=i.spec.fog[_].default);for(let _ in l){let x=l[_];i.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;let d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.smoothstep(45,65,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(_,x,D){let k=i.MercatorCoordinate.fromLngLat(x),R=D.elevation?D.elevation.getAtPointOrZero(k):0,z=[k.x,k.y,R];return i.transformMat4(z,z,D.mercatorFogMatrix),qa(_,z,D.pitch,D._fov)}(this.state,l,d):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Yc(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||_.validate!==!1)&&i.emitValidationErrors(this,l.call(i.validateStyle,i.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.spec})))}}class dr{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=i.uniqueId();let _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){let D=new dr.Actor(_[x],d,this.id);D.name=`Worker ${x}`,this.actors.push(D)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,d,_){i.asyncAll(this.actors,(x,D)=>{x.send(l,d,D)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function vr(m,l,d){return l*(i.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}dr.Actor=i.Actor;class go{constructor(l,d,_,x){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(l,d){let _,x;if(l instanceof i.Point||typeof l[0]=="number"){let D=i.Point.convert(l);_=[D],x=d.isPointAboveHorizon(D)}else{let D=i.Point.convert(l[0]),k=i.Point.convert(l[1]);_=[D,k],x=i.polygonizeBounds(D,k).every(R=>d.isPointAboveHorizon(R))}return new go(_,d.getCameraPoint(),x,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return i.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){let d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],x=i.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(x[3]=this.cameraPoint)),i.bufferConvexPolygon(x,l)}bufferedCameraGeometryGlobe(l){let d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.Point(1,1)):this.screenBounds[1],x=i.polygonizeBounds(d,_,l),D=this.cameraPoint.clone();switch(3*((D.y>d.y)+(D.y>_.y))+((D.x>d.x)+(D.x>_.x))){case 0:x[0]=D,x[4]=D.clone();break;case 1:x.splice(1,0,D);break;case 2:x[1]=D;break;case 3:x.splice(4,0,D);break;case 5:x.splice(2,0,D);break;case 6:x[3]=D;break;case 7:x.splice(3,0,D);break;case 8:x[2]=D}return x}containsTile(l,d,_,x=0){let D=l.queryPadding/d._pixelsPerMercatorPixel+1,k=_?this._bufferedCameraMercator(D,d):this._bufferedScreenMercator(D,d),R=l.tileID.wrap+(k.unwrapped?x:0),z=k.polygon.map(pe=>i.getTilePoint(l.tileTransform,pe,R));if(!i.polygonIntersectsBox(z,0,0,i.EXTENT,i.EXTENT))return;R=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);let G=this.screenGeometryMercator.polygon.map(pe=>i.getTileVec3(l.tileTransform,pe,R)),H=G.map(pe=>new i.Point(pe[0],pe[1])),Y=d.getFreeCameraOptions().position||new i.MercatorCoordinate(0,0,0),se=i.getTileVec3(l.tileTransform,Y,R),le=G.map(pe=>{let Q=i.sub(pe,pe,se);return i.normalize(Q,Q),new i.Ray(se,Q)}),fe=vr(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:le,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(he=i.getBounds(z),he.min.x=i.clamp(he.min.x,0,i.EXTENT),he.min.y=i.clamp(he.min.y,0,i.EXTENT),he.max.x=i.clamp(he.max.x,0,i.EXTENT),he.max.y=i.clamp(he.max.y,0,i.EXTENT),he),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:fe};var he}_bufferedScreenMercator(l,d){let _=Za(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(D=>d.pointCoordinate3D(D)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(l,d){let _=Za(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(D=>d.pointCoordinate3D(D)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(l,d){let _=function(D,k){let R=i.multiply([],k.pixelMatrix,k.globeMatrix),z=[0,-i.GLOBE_RADIUS,0,1],G=[0,i.GLOBE_RADIUS,0,1],H=[0,0,0,1];i.transformMat4$1(z,z,R),i.transformMat4$1(G,G,R),i.transformMat4$1(H,H,R);let Y=new i.Point(z[0]/z[3],z[1]/z[3]),se=new i.Point(G[0]/G[3],G[1]/G[3]),le=i.polygonContainsPoint(D,Y)&&z[3]<H[3],fe=i.polygonContainsPoint(D,se)&&G[3]<H[3];if(!le&&!fe)return null;let he=function(De,Be,Fe){for(let Ve=1;Ve<De.length;Ve++){let mt=hs(Be.pointCoordinate3D(De[Ve-1]).x),He=hs(Be.pointCoordinate3D(De[Ve]).x);if(Fe<0){if(mt<He)return{idx:Ve,t:-mt/(He-1-mt)}}else if(He<mt)return{idx:Ve,t:(1-mt)/(He+1-mt)}}return null}(D,k,le?-1:1);if(!he)return null;let{idx:pe,t:Q}=he,ue=pe>1?Fi(D.slice(0,pe),k):[],ye=pe<D.length?Fi(D.slice(pe),k):[];ue=ue.map(De=>new i.Point(hs(De.x),De.y)),ye=ye.map(De=>new i.Point(hs(De.x),De.y));let _e=[...ue];_e.length===0&&_e.push(ye[ye.length-1]);let Se=i.number(_e[_e.length-1].y,(ye.length===0?ue[0]:ye[0]).y,Q),ke;return ke=le?[new i.Point(0,Se),new i.Point(0,0),new i.Point(1,0),new i.Point(1,Se)]:[new i.Point(1,Se),new i.Point(1,1),new i.Point(0,1),new i.Point(0,Se)],_e.push(...ke),ye.length===0?_e.push(ue[0]):_e.push(...ye),{polygon:_e.map(De=>new i.MercatorCoordinate(De.x,De.y)),unwrapped:!1}}(l,d);if(_)return _;let x=function(D,k){let R=!1,z=-1/0,G=0;for(let Y=0;Y<D.length-1;Y++)D[Y].x>z&&(z=D[Y].x,G=Y);for(let Y=0;Y<D.length-1;Y++){let se=(G+Y)%(D.length-1),le=D[se],fe=D[se+1];Math.abs(le.x-fe.x)>.5&&(le.x<fe.x?(le.x+=1,se===0&&(D[D.length-1].x+=1)):(fe.x+=1,se+1===D.length-1&&(D[0].x+=1)),R=!0)}let H=i.mercatorXfromLng(k.center.lng);return R&&H<Math.abs(H-1)&&D.forEach(Y=>{Y.x-=1}),{polygon:D,unwrapped:R}}(Fi(l,d).map(D=>new i.Point(hs(D.x),D.y)),d);return{polygon:x.polygon.map(D=>new i.MercatorCoordinate(D.x,D.y)),unwrapped:x.unwrapped}}}function Fi(m,l){return i.resample(m,d=>{let _=l.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function hs(m){return m<0?1+m%1:m%1}function Za(m){return 100*m|0}function js(m,l,d,_,x){let D=function(k,R){if(k)return x(k);if(R){m.url&&R.tiles&&m.tiles&&delete m.tiles;let z=i.pick(i.extend(R,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);R.vector_layers&&(z.vectorLayers=R.vector_layers,z.vectorLayerIds=z.vectorLayers.map(G=>G.id)),z.tiles=l.canonicalizeTileset(z,m.url),x(null,z)}};return m.url?i.getJSON(l.transformRequest(l.normalizeSourceURL(m.url,null,d,_),i.ResourceType.Source),D):i.exported.frame(()=>D(null,m))}class Us{constructor(l,d,_){this.bounds=i.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){let d=Math.pow(2,l.z),_=Math.floor(i.mercatorXfromLng(this.bounds.getWest())*d),x=Math.floor(i.mercatorYfromLat(this.bounds.getNorth())*d),D=Math.ceil(i.mercatorXfromLng(this.bounds.getEast())*d),k=Math.ceil(i.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=_&&l.x<D&&l.y>=x&&l.y<k}}class fs{constructor(l,d,_){this.context=l;let x=l.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let _a={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xa{constructor(l,d,_,x){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=x,this.context=l;let D=l.gl;this.buffer=D.createBuffer(),l.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){let d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let _=0;_<this.attributes.length;_++){let x=d.attributes[this.attributes[_].name];x!==void 0&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,d,_){for(let x=0;x<this.attributes.length;x++){let D=this.attributes[x],k=d.attributes[D.name];k!==void 0&&l.vertexAttribPointer(k,D.components,l[_a[D.type]],!1,this.itemSize,D.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zt extends Nn{getDefault(){return i.Color.transparent}set(l){let d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class yo extends Nn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class va extends Nn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class _i extends Nn{getDefault(){return[!0,!0,!0,!0]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class _o extends Nn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Ya extends Nn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class ps extends Nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){let d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Kr extends Nn{getDefault(){let l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class $s extends Nn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class Yl extends Nn{getDefault(){return[0,1]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Kc extends Nn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Qr extends Nn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Kl extends Nn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Di extends Nn{getDefault(){let l=this.gl;return[l.ONE,l.ZERO]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class hd extends Nn{getDefault(){return i.Color.transparent}set(l){let d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class So extends Nn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class ba extends Nn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Ql extends Nn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Hs extends Nn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Jl,Qc=class extends Nn{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Ka extends Nn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class vo extends Nn{getDefault(){let l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Gs extends Nn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Mr extends Nn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ws extends Nn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class fd extends Nn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class be extends Nn{getDefault(){return null}set(l){let d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ie extends Nn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class re extends Nn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class ve extends Nn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Me extends Nn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Pe extends Nn{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class $e extends Pe{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class je extends Pe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Oe extends je{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Xe{constructor(l,d,_,x){this.context=l,this.width=d,this.height=_;let D=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new $e(l,D),x&&(this.depthAttachment=new je(l,D))}destroy(){let l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){let _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class wt{constructor(l,d=!1){if(this.gl=l,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){let _=l;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(l),deleteVertexArrayOES:_.deleteVertexArray.bind(l),bindVertexArrayOES:_.bindVertexArray.bind(l)}}this.clearColor=new Zt(this),this.clearDepth=new yo(this),this.clearStencil=new va(this),this.colorMask=new _i(this),this.depthMask=new _o(this),this.stencilMask=new Ya(this),this.stencilFunc=new ps(this),this.stencilOp=new Kr(this),this.stencilTest=new $s(this),this.depthRange=new Yl(this),this.depthTest=new Kc(this),this.depthFunc=new Qr(this),this.blend=new Kl(this),this.blendFunc=new Di(this),this.blendColor=new hd(this),this.blendEquation=new So(this),this.cullFace=new ba(this),this.cullFaceSide=new Ql(this),this.frontFace=new Hs(this),this.program=new Qc(this),this.activeTexture=new Ka(this),this.viewport=new vo(this),this.bindFramebuffer=new Gs(this),this.bindRenderbuffer=new Mr(this),this.bindTexture=new Ws(this),this.bindVertexBuffer=new fd(this),this.bindElementBuffer=new be(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ie(this),this.pixelStoreUnpack=new re(this),this.pixelStoreUnpackPremultiplyAlpha=new ve(this),this.pixelStoreUnpackFlipY=new Me(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new fs(this,l,d)}createVertexBuffer(l,d,_){return new Xa(this,l,d,_)}createRenderbuffer(l,d,_){let x=this.gl,D=x.createRenderbuffer();return this.bindRenderbuffer.set(D),x.renderbufferStorage(x.RENDERBUFFER,l,d,_),this.bindRenderbuffer.set(null),D}createFramebuffer(l,d,_){return new Xe(this,l,d,_)}clear({color:l,depth:d,stencil:_}){let x=this.gl,D=0;l&&(D|=x.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(D|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(D|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(D)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){C(l.blendFunction,i.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Mt extends i.Evented{constructor(l,d,_,x){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.extend(this,i.pick(d,["url","scheme","tileSize","promoteId"])),this._options=i.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.DedupedRequest}load(l){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"}));let d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=js(this._options,this.map._requestManager,d,_,(x,D)=>{this._tileJSONRequest=null,this._loaded=!0,x?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new i.ErrorEvent(x))):D&&(i.extend(this,D),D.bounds&&(this.tileBounds=new Us(D.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(D.tiles,this.map._requestManager._customAccessToken),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(x)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}loadTile(l,d){let _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,i.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",x,D.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",x,D.bind(this),void 0,!0);else{let k=i.loadVectorTile.call({deduped:this._deduped},x,(R,z)=>{R||!z?D.call(this,R):(x.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},l.actor&&l.actor.send("loadTile",x,D.bind(this),void 0,!0))},!0);l.request={cancel:k}}function D(k,R){return delete l.request,l.aborted?d(null):k&&k.status!==404?d(k):(R&&R.resourceTiming&&(l.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&l.setExpiryData(R),l.loadVectorData(R,this.map.painter),i.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class yt extends i.Evented{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.extend({type:"raster"},d),i.extend(this,i.pick(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=js(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new i.ErrorEvent(d)):_&&(i.extend(this,_),_.bounds&&(this.tileBounds=new Us(_.bounds,this.minzoom,this.maxzoom)),i.postTurnstileEvent(_.tiles),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){let _=i.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=i.getImage(this.map._requestManager.transformRequest(x,i.ResourceType.Tile),(D,k,R,z)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):D?(l.state="errored",d(D)):k?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:R,expires:z}),l.setTexture(k,this.map.painter),l.state="loaded",i.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(l,d,_){l.setTexture(d,_)}static unloadTileData(l,d){l.texture&&d.saveTileTexture(l.texture)}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&this.map.painter.saveTileTexture(l.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function an(m,l,d,_,x,D,k,R){let z=[m,d,x,l,_,D,1,1,1],G=[k,R,1],H=i.adjoint([],z),[Y,se,le]=i.transformMat3(G,G,i.transpose(H,H));return i.multiply$1(z,[Y,0,0,0,se,0,0,0,le],z)}class Dn extends i.Evented{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=d,this._dirty=!1}load(l,d){this._loaded=d||!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=i.getImage(this.map._requestManager.transformRequest(this.url,i.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new i.ErrorEvent(_));else if(x){let{HTMLImageElement:D}=i.window;this.image=x instanceof D?i.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;let d=l.map(i.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,D=1/0,k=-1/0,R=-1/0;for(let Y of _)x=Math.min(x,Y.x),D=Math.min(D,Y.y),k=Math.max(k,Y.x),R=Math.max(R,Y.y);let z=Math.max(k-x,R-D),G=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),H=Math.pow(2,G);return new i.CanonicalTileID(G,Math.floor((x+k)/2*H),Math.floor((D+R)/2*H))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(let z in this.tiles){let G=this.tiles[z];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray)return;let d=i.tileTransform(this.tileID,this.map.transform.projection),[_,x,D,k]=this.coordinates.map(z=>{let G=d.projection.project(z[0],z[1]);return i.getTilePoint(d,G)._round()});this.perspectiveTransform=function(z,G,H,Y,se,le,fe,he,pe,Q){let ue=an(0,0,z,0,0,G,z,G),ye=an(H,Y,se,le,fe,he,pe,Q);return i.multiply$1(ye,i.adjoint(ue,ue),ye),[ye[6]/ye[8]*z/i.EXTENT,ye[7]/ye[8]*G/i.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,k.x,k.y,D.x,D.y);let R=this._boundsArray=new i.StructArrayLayout4i8;R.emplaceBack(_.x,_.y,0,0),R.emplaceBack(x.x,x.y,i.EXTENT,0),R.emplaceBack(k.x,k.y,0,i.EXTENT),R.emplaceBack(D.x,D.y,i.EXTENT,i.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(R,i.boundsAttributes.members),this.boundsSegments=i.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let l=this.map.painter.context,d=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new i.Texture(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,d){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},d(null)):(l.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let cn={vector:Mt,raster:yt,"raster-dem":class extends yt{constructor(m,l,d,_){super(m,l,d,_),this.type="raster-dem",this.maxzoom=22,this._options=i.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(m,l){let d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,D){x&&(m.state="errored",l(x)),D&&(m.dem=D,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",l(null))}m.request=i.getImage(this.map._requestManager.transformRequest(d,i.ResourceType.Tile),function(x,D,k,R){if(delete m.request,m.aborted)m.state="unloaded",l(null);else if(x)m.state="errored",l(x);else if(D){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:k,expires:R});let z=i.window.ImageBitmap&&D instanceof i.window.ImageBitmap&&(Jl==null&&(Jl=i.window.OffscreenCanvas&&new i.window.OffscreenCanvas(1,1).getContext("2d")&&typeof i.window.createImageBitmap=="function"),Jl),G=1-(D.width-i.prevPowerOfTwo(D.width))/2;G<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));let H=z?D:i.exported.getImageData(D,G),Y={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:H,encoding:this.encoding,padding:G};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",Y,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){let l=m.canonical,d=Math.pow(2,l.z),_=(l.x-1+d)%d,x=l.x===0?m.wrap-1:m.wrap,D=(l.x+1+d)%d,k=l.x+1===d?m.wrap+1:m.wrap,R={};return R[new i.OverscaledTileID(m.overscaledZ,x,l.z,_,l.y).key]={backfilled:!1},R[new i.OverscaledTileID(m.overscaledZ,k,l.z,D,l.y).key]={backfilled:!1},l.y>0&&(R[new i.OverscaledTileID(m.overscaledZ,x,l.z,_,l.y-1).key]={backfilled:!1},R[new i.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},R[new i.OverscaledTileID(m.overscaledZ,k,l.z,D,l.y-1).key]={backfilled:!1}),l.y+1<d&&(R[new i.OverscaledTileID(m.overscaledZ,x,l.z,_,l.y+1).key]={backfilled:!1},R[new i.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},R[new i.OverscaledTileID(m.overscaledZ,k,l.z,D,l.y+1).key]={backfilled:!1}),R}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends i.Evented{constructor(m,l,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=l.data,this._options=i.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;let x=i.EXTENT/this.tileSize;this.workerOptions=i.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*x,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*x,extent:i.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:i.EXTENT,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*x,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},l),this}getClusterChildren(m,l){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},l),this}getClusterLeaves(m,l,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:l,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.Event("dataloading",{dataType:"source"})),this._loaded=!1;let m=i.extend({},this.workerOptions),l=this._data;typeof l=="string"?(m.request=this.map._requestManager.transformRequest(i.exported.resolveURL(l),i.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new i.ErrorEvent(d));else{let x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new i.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,l){let d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:i.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete m.request,m.unloadVectorData(),m.aborted?l(null):_?l(_):(m.loadVectorData(x,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Dn{constructor(m,l,d,_){super(m,l,d,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;let m=this.options;this.urls=[];for(let l of m.urls)this.urls.push(this.map._requestManager.transformRequest(l,i.ResourceType.Source).url);i.getVideo(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new i.ErrorEvent(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){let l=this.video.seekable;m<l.start(0)||m>l.end(0)?this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,l=m.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new i.Texture(m,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Dn,canvas:class extends Dn{constructor(m,l,d,_){super(m,l,d,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(D=>typeof D!="number"))||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof i.window.HTMLCanvasElement||this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.ErrorEvent(new i.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof i.window.HTMLCanvasElement?this.options.canvas:i.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let l=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.Evented{constructor(m,l,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Us(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),i.extend(this,i.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new i.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){let{x:l,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:l,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,l){let{x:d,y:_,z:x}=m.tileID.canonical,D=new i.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:x},{signal:D.signal})).then(function(k){return delete m.request,m.aborted?(m.state="unloaded",l(null)):k===void 0?(m.state="errored",l(null)):k===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",l(null)):function(R){return R instanceof i.window.ImageData||R instanceof i.window.HTMLCanvasElement||R instanceof i.window.ImageBitmap||R instanceof i.window.HTMLImageElement}(k)?(this.loadTileData(m,k),m.state="loaded",void l(null)):(m.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(k=>{k.code!==20&&(m.state="errored",l(k))}),m.request.cancel=()=>D.abort()}loadTileData(m,l){yt.loadTileData(m,l,this._map.painter)}unloadTileData(m){yt.unloadTileData(m,this._map.painter)}unloadTile(m,l){if(this.unloadTileData(m),this._implementation.unloadTile){let{x:d,y:_,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:x})}l()}abortTile(m,l){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new i.Event("data",{dataType:"source",sourceDataType:"content"}))}}},mn=function(m,l,d,_){let x=new cn[l.type](m,l,d,_);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return i.bindAll(["load","abort","unload","serialize","prepare"],x),x};function kn(m,l){let d=i.identity([]);return i.scale(d,d,[.5*m.width,.5*-m.height,1]),i.translate(d,d,[1,-1,0]),i.multiply(d,d,m.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function Rn(m,l,d,_,x,D,k,R=!1){let z=m.tilesIn(_,k,R);z.sort(Vr);let G=[];for(let Y of z)G.push({wrappedTileID:Y.tile.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(l,d,m._state,Y,x,D,kn(m.transform,Y.tile.tileID),R)});let H=function(Y){let se={},le={};for(let fe of Y){let he=fe.queryResults,pe=fe.wrappedTileID,Q=le[pe]=le[pe]||{};for(let ue in he){let ye=he[ue],_e=Q[ue]=Q[ue]||{},Se=se[ue]=se[ue]||[];for(let ke of ye)_e[ke.featureIndex]||(_e[ke.featureIndex]=!0,Se.push(ke))}}return se}(G);for(let Y in H)H[Y].forEach(se=>{let le=se.feature,fe=le.layer;fe&&fe.type!=="background"&&fe.type!=="sky"&&(le.source=fe.source,fe["source-layer"]&&(le.sourceLayer=fe["source-layer"]),le.state=le.id!==void 0?m.getFeatureState(fe["source-layer"],le.id):{})});return H}function Ki(m,l){let d=m.getRenderableIds().map(D=>m.getTileByID(D)),_=[],x={};for(let D=0;D<d.length;D++){let k=d[D],R=k.tileID.canonical.key;x[R]||(x[R]=!0,k.querySourceFeatures(_,l))}return _}function Vr(m,l){let d=m.tileID,_=l.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function hr(){return bc.workerClass!=null?new bc.workerClass:new i.window.Worker(bc.workerUrl)}let ms="mapboxgl_preloaded_worker_pool";class Ir{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Ir.workerCount;)this.workers.push(new hr);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ms]}numActive(){return Object.keys(this.active).length}}let jr;function ec(){return jr||(jr=new Ir),jr}function gp(m,l){let d={};for(let _ in m)_!=="ref"&&(d[_]=m[_]);return i.refProperties.forEach(_=>{_ in l&&(d[_]=l[_])}),d}function Mh(m){m=m.slice();let l=Object.create(null);for(let d=0;d<m.length;d++)l[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=gp(m[d],l[m[d].ref]));return m}Ir.workerCount=2;let ei={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Jc(m,l,d){d.push({command:ei.addSource,args:[m,l[m]]})}function xa(m,l,d){l.push({command:ei.removeSource,args:[m]}),d[m]=!0}function Ih(m,l,d,_){xa(m,d,_),Jc(m,l,d)}function vi(m,l,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&_!=="data"&&!C(m[d][_],l[d][_]))return!1;for(_ in l[d])if(l[d].hasOwnProperty(_)&&_!=="data"&&!C(m[d][_],l[d][_]))return!1;return!0}function qo(m,l,d,_,x,D){let k;for(k in l=l||{},m=m||{})m.hasOwnProperty(k)&&(C(m[k],l[k])||d.push({command:D,args:[_,k,l[k],x]}));for(k in l)l.hasOwnProperty(k)&&!m.hasOwnProperty(k)&&(C(m[k],l[k])||d.push({command:D,args:[_,k,l[k],x]}))}function gs(m){return m.id}function Sh(m,l){return m[l.id]=l,m}class Ah{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=i.clamp(l,0,1);let d=1,_=this._distances[d],x=l*this.paddedLength+this.padding;for(;_<x&&d<this._distances.length;)_=this._distances[++d];let D=d-1,k=this._distances[D],R=_-k,z=R>0?(x-k)/R:0;return this.points[D].mult(1-z).add(this.points[d].mult(z))}}class Qa{constructor(l,d,_){let x=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(d/_);for(let k=0;k<this.xCellCount*this.yCellCount;k++)x.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,_,x,D){this._forEachCell(d,_,x,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(D)}insertCircle(l,d,_,x){this._forEachCell(d-x,_-x,d+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(_),this.circles.push(x)}_insertBoxCell(l,d,_,x,D,k){this.boxCells[D].push(k)}_insertCircleCell(l,d,_,x,D,k){this.circleCells[D].push(k)}_query(l,d,_,x,D,k){if(_<0||l>this.width||x<0||d>this.height)return!D&&[];let R=[];if(l<=0&&d<=0&&this.width<=_&&this.height<=x){if(D)return!0;for(let z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){let G=this.circles[3*z],H=this.circles[3*z+1],Y=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:G-Y,y1:H-Y,x2:G+Y,y2:H+Y})}return k?R.filter(k):R}return this._forEachCell(l,d,_,x,this._queryCell,R,{hitTest:D,seenUids:{box:{},circle:{}}},k),D?R.length>0:R}_queryCircle(l,d,_,x,D){let k=l-_,R=l+_,z=d-_,G=d+_;if(R<0||k>this.width||G<0||z>this.height)return!x&&[];let H=[];return this._forEachCell(k,z,R,G,this._queryCellCircle,H,{hitTest:x,circle:{x:l,y:d,radius:_},seenUids:{box:{},circle:{}}},D),x?H.length>0:H}query(l,d,_,x,D){return this._query(l,d,_,x,!1,D)}hitTest(l,d,_,x,D){return this._query(l,d,_,x,!0,D)}hitTestCircle(l,d,_,x){return this._queryCircle(l,d,_,!0,x)}_queryCell(l,d,_,x,D,k,R,z){let G=R.seenUids,H=this.boxCells[D];if(H!==null){let se=this.bboxes;for(let le of H)if(!G.box[le]){G.box[le]=!0;let fe=4*le;if(l<=se[fe+2]&&d<=se[fe+3]&&_>=se[fe+0]&&x>=se[fe+1]&&(!z||z(this.boxKeys[le]))){if(R.hitTest)return k.push(!0),!0;k.push({key:this.boxKeys[le],x1:se[fe],y1:se[fe+1],x2:se[fe+2],y2:se[fe+3]})}}}let Y=this.circleCells[D];if(Y!==null){let se=this.circles;for(let le of Y)if(!G.circle[le]){G.circle[le]=!0;let fe=3*le;if(this._circleAndRectCollide(se[fe],se[fe+1],se[fe+2],l,d,_,x)&&(!z||z(this.circleKeys[le]))){if(R.hitTest)return k.push(!0),!0;{let he=se[fe],pe=se[fe+1],Q=se[fe+2];k.push({key:this.circleKeys[le],x1:he-Q,y1:pe-Q,x2:he+Q,y2:pe+Q})}}}}}_queryCellCircle(l,d,_,x,D,k,R,z){let G=R.circle,H=R.seenUids,Y=this.boxCells[D];if(Y!==null){let le=this.bboxes;for(let fe of Y)if(!H.box[fe]){H.box[fe]=!0;let he=4*fe;if(this._circleAndRectCollide(G.x,G.y,G.radius,le[he+0],le[he+1],le[he+2],le[he+3])&&(!z||z(this.boxKeys[fe])))return k.push(!0),!0}}let se=this.circleCells[D];if(se!==null){let le=this.circles;for(let fe of se)if(!H.circle[fe]){H.circle[fe]=!0;let he=3*fe;if(this._circlesCollide(le[he],le[he+1],le[he+2],G.x,G.y,G.radius)&&(!z||z(this.circleKeys[fe])))return k.push(!0),!0}}}_forEachCell(l,d,_,x,D,k,R,z){let G=this._convertToXCellCoord(l),H=this._convertToYCellCoord(d),Y=this._convertToXCellCoord(_),se=this._convertToYCellCoord(x);for(let le=G;le<=Y;le++)for(let fe=H;fe<=se;fe++)if(D.call(this,l,d,_,x,this.xCellCount*fe+le,k,R,z))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,_,x,D,k){let R=x-l,z=D-d,G=_+k;return G*G>R*R+z*z}_circleAndRectCollide(l,d,_,x,D,k,R){let z=(k-x)/2,G=Math.abs(l-(x+z));if(G>z+_)return!1;let H=(R-D)/2,Y=Math.abs(d-(D+H));if(Y>H+_)return!1;if(G<=z||Y<=H)return!0;let se=G-z,le=Y-H;return se*se+le*le<=_*_}}let qs={unknown:0,flipRequired:1,flipNotRequired:2},tc=Math.tan(85*Math.PI/180);function Je(m,l,d,_,x,D,k){let R=i.create();if(d)if(D.name==="globe"){let z=i.calculateGlobeLabelMatrix(x,l);i.multiply(R,R,z)}else{let z=It([],k);R[0]=z[0],R[1]=z[1],R[4]=z[2],R[5]=z[3],_||i.rotateZ(R,R,x.angle)}else i.multiply(R,x.labelPlaneMatrix,m);return R}function Zs(m,l,d,_,x,D,k){let R=Je(m,l,d,_,x,D,k);return D.name==="globe"&&d||(R[2]=R[6]=R[10]=R[14]=0),R}function sr(m,l,d,_,x,D,k){if(d){if(D.name==="globe"){let R=Je(m,l,d,_,x,D,k);return i.invert(R,R),i.multiply(R,m,R),R}{let R=i.clone(m),z=i.identity([]);return z[0]=k[0],z[1]=k[1],z[4]=k[2],z[5]=k[3],i.multiply(R,R,z),_||i.rotateZ(R,R,-x.angle),R}}return x.glCoordMatrix}function Sr(m,l,d,_){let x=[m,l,d,1];d?i.transformMat4$1(x,x,_):wn(x,x,_);let D=x[3];return x[0]/=D,x[1]/=D,x[2]/=D,x}function eu(m,l){return Math.min(.5+m/l*.5,1.5)}function Zo(m,l){let d=m[0]/m[3],_=m[1]/m[3];return d>=-l[0]&&d<=l[0]&&_>=-l[1]&&_<=l[1]}function pd(m,l,d,_,x,D,k,R,z,G){let H=d.transform,Y=_?m.textSizeData:m.iconSizeData,se=i.evaluateSizeForZoom(Y,d.transform.zoom),le=H.projection.name==="globe",fe=[256/d.width*2+1,256/d.height*2+1],he=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;he.clear();let pe=null;le&&(pe=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);let Q=m.lineVertexArray,ue=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,ye=d.transform.width/d.transform.height,_e,Se=!1;for(let ke=0;ke<ue.length;ke++){let De=ue.get(ke),{numGlyphs:Be,writingMode:Fe}=De;if(Fe!==i.WritingMode.vertical||Se||_e===i.WritingMode.horizontal||(Se=!0),_e=Fe,(De.hidden||Fe===i.WritingMode.vertical)&&!Se){Xo(Be,he);continue}Se=!1;let Ve=new i.Point(De.tileAnchorX,De.tileAnchorY),{x:mt,y:He,z:it}=H.projection.projectTilePoint(Ve.x,Ve.y,G.canonical);if(z){let[on,Ft,Xt]=z(Ve);mt+=on,He+=Ft,it+=Xt}let Ze=[mt,He,it,1];if(i.transformMat4$1(Ze,Ze,l),!Zo(Ze,fe)){Xo(Be,he);continue}let ut=eu(d.transform.cameraToCenterDistance,Ze[3]),Ge=i.evaluateSizeForFeature(Y,se,De),tt=k?Ge/ut:Ge*ut,gt=Sr(mt,He,it,x);if(gt[3]<=0){Xo(Be,he);continue}let at={},_t=k?null:z,$t=Dt(De,tt,!1,R,l,x,D,m.glyphOffsetArray,Q,he,pe,gt,Ve,at,ye,_t,H.projection,G,k);Se=$t.useVertical,_t&&$t.needsFlipping&&(at={}),($t.notEnoughRoom||Se||$t.needsFlipping&&Dt(De,tt,!0,R,l,x,D,m.glyphOffsetArray,Q,he,pe,gt,Ve,at,ye,_t,H.projection,G,k).notEnoughRoom)&&Xo(Be,he)}_?(m.text.dynamicLayoutVertexBuffer.updateData(he),pe&&m.text.globeExtVertexBuffer.updateData(pe)):(m.icon.dynamicLayoutVertexBuffer.updateData(he),pe&&m.icon.globeExtVertexBuffer.updateData(pe))}function tu(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he){let{lineStartIndex:pe,glyphStartIndex:Q,segment:ue}=R,ye=Q+R.numGlyphs,_e=pe+R.lineLength,Se=l.getoffsetX(Q),ke=l.getoffsetX(ye-1),De=bo(m*Se,d,_,x,D,k,ue,pe,_e,z,G,H,Y,se,!0,le,fe,he);if(!De)return null;let Be=bo(m*ke,d,_,x,D,k,ue,pe,_e,z,G,H,Y,se,!0,le,fe,he);return Be?{first:De,last:Be}:null}function Ja(m,l,d,_){return m===i.WritingMode.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:m===i.WritingMode.vertical?_>0?{needsFlipping:!0}:null:l!==qs.unknown&&function(x,D){return x===0||Math.abs(D/x)>tc}(d,_)?l===qs.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Dt(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he,pe,Q,ue){let ye=l/24,_e=m.lineOffsetX*ye,Se=m.lineOffsetY*ye,{lineStartIndex:ke,glyphStartIndex:De,numGlyphs:Be,segment:Fe,writingMode:Ve,flipState:mt}=m,He=ke+m.lineLength,it=Ze=>{if(H){let[gt,at,_t]=Ze.up,$t=G.length;i.updateGlobeVertexNormal(H,$t+0,gt,at,_t),i.updateGlobeVertexNormal(H,$t+1,gt,at,_t),i.updateGlobeVertexNormal(H,$t+2,gt,at,_t),i.updateGlobeVertexNormal(H,$t+3,gt,at,_t)}let[ut,Ge,tt]=Ze.point;i.addDynamicAttributes(G,ut,Ge,tt,Ze.angle)};if(Be>1){let Ze=tu(ye,R,_e,Se,d,Y,se,m,z,D,le,he,!1,pe,Q,ue);if(!Ze)return{notEnoughRoom:!0};if(_&&!d){let[ut,Ge,tt]=Ze.first.point,[gt,at,_t]=Ze.last.point;[ut,Ge]=Sr(ut,Ge,tt,k),[gt,at]=Sr(gt,at,_t,k);let $t=Ja(Ve,mt,(gt-ut)*fe,at-Ge);if(m.flipState=$t&&$t.needsFlipping?qs.flipRequired:qs.flipNotRequired,$t)return $t}it(Ze.first);for(let ut=De+1;ut<De+Be-1;ut++){let Ge=bo(ye*R.getoffsetX(ut),_e,Se,d,Y,se,Fe,ke,He,z,D,le,he,!1,!1,pe,Q,ue);if(!Ge)return G.length-=4*(ut-De),{notEnoughRoom:!0};it(Ge)}it(Ze.last)}else{if(_&&!d){let ut=Sr(se.x,se.y,0,x),Ge=ke+Fe+1,tt=new i.Point(z.getx(Ge),z.gety(Ge)),gt=Sr(tt.x,tt.y,0,x),at=gt[3]>0?gt:In(se,tt,ut,1,x,void 0,pe,Q.canonical),_t=Ja(Ve,mt,(at[0]-ut[0])*fe,at[1]-ut[1]);if(m.flipState=_t&&_t.needsFlipping?qs.flipRequired:qs.flipNotRequired,_t)return _t}let Ze=bo(ye*R.getoffsetX(De),_e,Se,d,Y,se,Fe,ke,He,z,D,le,he,!1,!1,pe,Q,ue);if(!Ze)return{notEnoughRoom:!0};it(Ze)}return{}}function xn(m,l,d,_,x){let{x:D,y:k,z:R}=_.projectTilePoint(m.x,m.y,l);if(!x)return Sr(D,k,R,d);let[z,G,H]=x(m);return Sr(D+z,k+G,R+H,d)}function In(m,l,d,_,x,D,k,R){let z=xn(m.sub(l)._unit()._add(m),R,x,k,D);return i.sub(z,d,z),i.normalize(z,z),i.scaleAndAdd(z,d,z,_)}function bo(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he,pe,Q){let ue=_?m-l:m+l,ye=ue>0?1:-1,_e=0;_&&(ye*=-1,_e=Math.PI),ye<0&&(_e+=Math.PI);let Se=R+k+(ye>0?0:1)|0,ke=x,De=x,Be=0,Fe=0,Ve=Math.abs(ue),mt=[],He=[],it=D,Ze=it,ut=()=>In(Ze,it,De,Ve-Be+1,H,se,he,pe.canonical);for(;Be+Fe<=Ve;){if(Se+=ye,Se<R||Se>=z)return null;if(De=ke,Ze=it,mt.push(De),le&&He.push(Ze),it=new i.Point(G.getx(Se),G.gety(Se)),ke=Y[Se],!ke){let Xt=xn(it,pe.canonical,H,he,se);ke=Xt[3]>0?Y[Se]=Xt:ut()}Be+=Fe,Fe=i.distance(De,ke)}fe&&se&&(Y[Se]&&(ke=ut(),Fe=i.distance(De,ke)),Y[Se]=ke);let Ge=(Ve-Be)/Fe,tt=it.sub(Ze)._mult(Ge)._add(Ze),gt=i.sub([],ke,De),at=i.scaleAndAdd([],De,gt,Ge),_t=[0,0,1],$t=gt[0],on=gt[1];if(Q&&(_t=he.upVector(pe.canonical,tt.x,tt.y),_t[0]!==0||_t[1]!==0||_t[2]!==1)){let Xt=[_t[2],0,-_t[0]],Ht=i.cross([],_t,Xt);i.normalize(Xt,Xt),i.normalize(Ht,Ht),$t=i.dot(gt,Xt),on=i.dot(gt,Ht)}if(d){let Xt=i.cross([],_t,gt);i.normalize(Xt,Xt),i.scaleAndAdd(at,at,Xt,d*ye)}let Ft=_e+Math.atan2(on,$t);return mt.push(at),le&&He.push(tt),{point:at,angle:Ft,path:mt,tilePath:He,up:_t}}function Xo(m,l){let d=l.length,_=d+4*m;l.resize(_),l.float32.fill(-1/0,4*d,4*_)}function wn(m,l,d){let _=l[0],x=l[1];return m[0]=d[0]*_+d[4]*x+d[12],m[1]=d[1]*_+d[5]*x+d[13],m[3]=d[3]*_+d[7]*x+d[15],m}let Ur=100;class nu{constructor(l,d,_=new Qa(l.width+200,l.height+200,25),x=new Qa(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ur,this.screenBottomBoundary=l.height+Ur,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,_,x,D,k,R,z){let G=_.projectedAnchorX,H=_.projectedAnchorY,Y=_.projectedAnchorZ,se=_.elevation,le=_.tileID,fe=l.getProjection();if(se&&le){let[ke,De,Be]=fe.upVector(le.canonical,_.tileAnchorX,_.tileAnchorY),Fe=fe.upVectorScale(le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;G+=ke*se*Fe,H+=De*se*Fe,Y+=Be*se*Fe}let he=this.projectAndGetPerspectiveRatio(R,G,H,Y,_.tileID,fe.name==="globe"||!!se||this.transform.pitch>0,fe),pe=k*he.perspectiveRatio,Q=(_.x1*d+x.x-_.padding)*pe+he.point.x,ue=(_.y1*d+x.y-_.padding)*pe+he.point.y,ye=(_.x2*d+x.x+_.padding)*pe+he.point.x,_e=(_.y2*d+x.y+_.padding)*pe+he.point.y,Se=he.perspectiveRatio<=.55||he.occluded;return!this.isInsideGrid(Q,ue,ye,_e)||!D&&this.grid.hitTest(Q,ue,ye,_e,z)||Se?{box:[],offscreen:!1,occluded:he.occluded}:{box:[Q,ue,ye,_e],offscreen:this.isOffscreen(Q,ue,ye,_e),occluded:!1}}placeCollisionCircles(l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he){let pe=[],Q=this.transform.elevation,ue=l.getProjection(),ye=Q?Q.getAtTileOffsetFunc(he,this.transform.center.lat,this.transform.worldSize,ue):null,_e=new i.Point(_.tileAnchorX,_.tileAnchorY),{x:Se,y:ke,z:De}=ue.projectTilePoint(_e.x,_e.y,he.canonical);if(ye){let[tt,gt,at]=ye(_e);Se+=tt,ke+=gt,De+=at}let Be=ue.name==="globe",Fe=this.projectAndGetPerspectiveRatio(R,Se,ke,De,he,Be||!!Q||this.transform.pitch>0,ue),{perspectiveRatio:Ve}=Fe,mt=(Y?k/Ve:k*Ve)/i.ONE_EM,He=Sr(Se,ke,De,z),it=Fe.signedDistanceFromCamera>0?tu(mt,D,_.lineOffsetX*mt,_.lineOffsetY*mt,!1,He,_e,_,x,z,{},Q&&!Y?ye:null,Y&&!!Q,ue,he,Y):null,Ze=!1,ut=!1,Ge=!0;if(it&&!Fe.occluded){let tt=.5*le*Ve+fe,gt=new i.Point(-100,-100),at=new i.Point(this.screenRightBoundary,this.screenBottomBoundary),_t=new Ah,{first:$t,last:on}=it,Ft=$t.path.length,Xt=[];for(let jt=Ft-1;jt>=1;jt--)Xt.push($t.path[jt]);for(let jt=1;jt<on.path.length;jt++)Xt.push(on.path[jt]);let Ht=2.5*tt;G&&(Xt=Xt.map(([jt,Xn,ui],di)=>(ye&&!Be&&(ui=ye(di<Ft-1?$t.tilePath[Ft-1-di]:on.tilePath[di-Ft+2])[2]),Sr(jt,Xn,ui,G))),Xt.some(jt=>jt[3]<=0)&&(Xt=[]));let En=[];if(Xt.length>0){let jt=1/0,Xn=-1/0,ui=1/0,di=-1/0;for(let hi of Xt)jt=Math.min(jt,hi[0]),ui=Math.min(ui,hi[1]),Xn=Math.max(Xn,hi[0]),di=Math.max(di,hi[1]);Xn>=gt.x&&jt<=at.x&&di>=gt.y&&ui<=at.y&&(En=[Xt.map(hi=>new i.Point(hi[0],hi[1]))],(jt<gt.x||Xn>at.x||ui<gt.y||di>at.y)&&(En=i.clipLine(En,gt.x,gt.y,at.x,at.y)))}for(let jt of En){_t.reset(jt,.25*tt);let Xn=0;Xn=_t.length<=.5*tt?1:Math.ceil(_t.paddedLength/Ht)+1;for(let ui=0;ui<Xn;ui++){let di=ui/Math.max(Xn-1,1),hi=_t.lerp(di),ar=hi.x+Ur,pr=hi.y+Ur;pe.push(ar,pr,tt,0);let Co=ar-tt,Jo=pr-tt,Ii=ar+tt,fi=pr+tt;if(Ge=Ge&&this.isOffscreen(Co,Jo,Ii,fi),ut=ut||this.isInsideGrid(Co,Jo,Ii,fi),!d&&this.grid.hitTestCircle(ar,pr,tt,se)&&(Ze=!0,!H))return{circles:[],offscreen:!1,collisionDetected:Ze,occluded:!1}}}}return{circles:!H&&Ze||!ut?[]:pe,offscreen:Ge,collisionDetected:Ze,occluded:Fe.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let d=[],_=1/0,x=1/0,D=-1/0,k=-1/0;for(let H of l){let Y=new i.Point(H.x+Ur,H.y+Ur);_=Math.min(_,Y.x),x=Math.min(x,Y.y),D=Math.max(D,Y.x),k=Math.max(k,Y.y),d.push(Y)}let R=this.grid.query(_,x,D,k).concat(this.ignoredGrid.query(_,x,D,k)),z={},G={};for(let H of R){let Y=H.key;if(z[Y.bucketInstanceId]===void 0&&(z[Y.bucketInstanceId]={}),z[Y.bucketInstanceId][Y.featureIndex])continue;let se=[new i.Point(H.x1,H.y1),new i.Point(H.x2,H.y1),new i.Point(H.x2,H.y2),new i.Point(H.x1,H.y2)];i.polygonIntersectsPolygon(d,se)&&(z[Y.bucketInstanceId][Y.featureIndex]=!0,G[Y.bucketInstanceId]===void 0&&(G[Y.bucketInstanceId]=[]),G[Y.bucketInstanceId].push(Y.featureIndex))}return G}insertCollisionBox(l,d,_,x,D){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:D},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,_,x,D){let k=d?this.ignoredGrid:this.grid,R={bucketInstanceId:_,featureIndex:x,collisionGroupID:D};for(let z=0;z<l.length;z+=4)k.insertCircle(R,l[z],l[z+1],l[z+2])}projectAndGetPerspectiveRatio(l,d,_,x,D,k,R){let z=[d,_,x,1],G=!1;x||this.transform.pitch>0?(i.transformMat4$1(z,z,l),this.fogState&&D&&R.name!=="globe"&&(G=function(se,le,fe,he,pe,Q){let ue=Q.calculateFogTileMatrix(pe),ye=[le,fe,he];return i.transformMat4(ye,ye,ue),qa(se,ye,Q.pitch,Q._fov)}(this.fogState,d,_,x,D.toUnwrapped(),this.transform)>.9)):wn(z,z,l);let H=z[3];return{point:new i.Point((z[0]/H+1)/2*this.transform.width+Ur,(-z[1]/H+1)/2*this.transform.height+Ur),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/H*.5,1.5),signedDistanceFromCamera:H,occluded:k&&z[2]>H||G}}isOffscreen(l,d,_,x){return _<Ur||l>=this.screenRightBoundary||x<Ur||d>this.screenBottomBoundary}isInsideGrid(l,d,_,x){return _>=0&&l<this.gridRightBoundary&&x>=0&&d<this.gridBottomBoundary}getViewportMatrix(){let l=i.identity([]);return i.translate(l,l,[-100,-100,0]),l}}function el(m,l,d){let _=l.createTileMatrix(m,m.worldSize,d.toUnwrapped());return i.multiply(new Float32Array(16),m.projMatrix,_)}function xo(m,l,d){if(l.projection.name===d.projection.name)return m.projMatrix;let _=d.clone();return _.setProjection(l.projection),el(_,l.getProjection(),m)}function Ti(m,l,d){return l.name===d.projection.name?m.projMatrix:el(d,l,m)}class tl{constructor(l,d,_,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Xs{constructor(l,d,_,x,D,k=!1){this.text=new tl(l?l.text:null,d,_,D),this.icon=new tl(l?l.icon:null,d,x,D),this.clipped=k}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wa{constructor(l,d,_,x=!1){this.text=l,this.icon=d,this.skipFade=_,this.clipped=x}}class iu{constructor(){this.invProjMatrix=i.create(),this.viewportMatrix=i.create(),this.circles=[]}}class kh{constructor(l,d,_,x,D){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=D}}class yp{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){let d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[l]}}function nl(m,l,d,_,x){let{horizontalAlign:D,verticalAlign:k}=i.getAnchorAlignment(m),R=-(D-.5)*l,z=-(k-.5)*d,G=i.evaluateVariableOffset(m,_);return new i.Point(R+G[0]*x,z+G[1]*x)}function ru(m,l,d,_,x){let D=new i.Point(m,l);return d&&D._rotate(_?x:-x),D}class il{constructor(l,d,_,x,D){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new nu(this.transform,D),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new yp(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,_,x){let D=_.getBucket(d),k=_.latestFeatureIndex;if(!D||!k||d.id!==D.layerIds[0])return;let R=D.layers[0].layout,z=_.collisionBoxArray,G=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),H=_.tileSize/i.EXTENT,Y=_.tileID.toUnwrapped();this.transform.setProjection(D.projection);let se=(le=_.tileID,fe=D.getProjection(),he=this.transform,fe.name===this.projection?he.calculateProjMatrix(le.toUnwrapped()):el(he,fe,le));var le,fe,he;let pe=R.get("text-pitch-alignment")==="map",Q=R.get("text-rotation-alignment")==="map";d.compileFilter();let ue=d.dynamicFilter(),ye=d.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(_),Se=Zs(se,_.tileID.canonical,pe,Q,this.transform,D.getProjection(),_e),ke=null;if(pe){let Fe=sr(se,_.tileID.canonical,pe,Q,this.transform,D.getProjection(),_e);ke=i.multiply([],this.transform.labelPlaneMatrix,Fe)}let De=null;ue&&_.latestFeatureIndex&&(De={unwrappedTileID:Y,dynamicFilter:ue,dynamicFilterNeedsFeature:ye,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[D.bucketInstanceId]=new kh(D.bucketInstanceId,k,D.sourceLayerIndex,D.index,_.tileID);let Be={bucket:D,layout:R,posMatrix:se,textLabelPlaneMatrix:Se,labelToScreenMatrix:ke,clippingData:De,scale:G,textPixelRatio:H,holdingForFade:_.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:i.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.evaluateSizeForZoom(D.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(x)for(let Fe of D.sortKeyRanges){let{sortKey:Ve,symbolInstanceStart:mt,symbolInstanceEnd:He}=Fe;l.push({sortKey:Ve,symbolInstanceStart:mt,symbolInstanceEnd:He,parameters:Be})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he,pe,Q,ue){let{textOffset0:ye,textOffset1:_e,crossTileID:Se}=se,ke=[ye,_e],De=nl(l,_,x,ke,D),Be=this.collisionIndex.placeCollisionBox(fe,D,d,ru(De.x,De.y,k,R,this.transform.angle),Y,z,G,H.predicate);if(pe){let Fe=fe.getSymbolInstanceIconSize(ue,this.transform.zoom,se.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,Fe,pe,ru(De.x,De.y,k,R,this.transform.angle),Y,z,G,H.predicate).box.length===0)return}if(Be.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Se]&&this.prevPlacement.placements[Se]&&this.prevPlacement.placements[Se].text&&(Fe=this.prevPlacement.variableOffsets[Se].anchor),this.variableOffsets[Se]={textOffset:ke,width:_,height:x,anchor:l,textScale:D,prevAnchor:Fe},this.markUsedJustification(fe,l,se,he),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,he,se),this.placedOrientations[Se]=he),{shift:De,placedGlyphBoxes:Be}}}placeLayerBucketPart(l,d,_,x){let{bucket:D,layout:k,posMatrix:R,textLabelPlaneMatrix:z,labelToScreenMatrix:G,clippingData:H,textPixelRatio:Y,holdingForFade:se,collisionBoxArray:le,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:he,collisionGroup:pe}=l.parameters,Q=k.get("text-optional"),ue=k.get("icon-optional"),ye=k.get("text-allow-overlap"),_e=k.get("icon-allow-overlap"),Se=k.get("text-rotation-alignment")==="map",ke=k.get("text-pitch-alignment")==="map",De=k.get("icon-text-fit")!=="none",Be=k.get("symbol-z-order")==="viewport-y";this.transform.setProjection(D.projection);let Fe=ye&&(_e||!D.hasIconData()||ue),Ve=_e&&(ye||!D.hasTextData()||Q);!D.collisionArrays&&le&&D.deserializeCollisionBoxes(le),_&&x&&D.updateCollisionDebugBuffers(this.transform.zoom,le);let mt=(He,it,Ze)=>{let{crossTileID:ut,numVerticalGlyphVertices:Ge}=He;if(H){let Ii={zoom:this.transform.zoom,pitch:this.transform.pitch},fi=null;if(H.dynamicFilterNeedsFeature){let rn=this.retainedQueryData[D.bucketInstanceId];fi=H.featureIndex.loadFeature({featureIndex:He.featureIndex,bucketIndex:rn.bucketIndex,sourceLayerIndex:rn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,H.dynamicFilter)(Ii,fi,this.retainedQueryData[D.bucketInstanceId].tileID.canonical,new i.Point(He.tileAnchorX,He.tileAnchorY),this.transform.calculateDistanceTileData(H.unwrappedTileID)))return this.placements[ut]=new wa(!1,!1,!1,!0),void d.add(ut)}if(d.has(ut))return;if(se)return void(this.placements[ut]=new wa(!1,!1,!1));let tt=!1,gt=!1,at=!0,_t=!1,$t=!1,on=null,Ft={box:null,offscreen:null,occluded:null},Xt={box:null,offscreen:null,occluded:null},Ht=null,En=null,jt=null,Xn=0,ui=0,di=0;Ze.textFeatureIndex?Xn=Ze.textFeatureIndex:He.useRuntimeCollisionCircles&&(Xn=He.featureIndex),Ze.verticalTextFeatureIndex&&(ui=Ze.verticalTextFeatureIndex);let hi=Ii=>{Ii.tileID=this.retainedQueryData[D.bucketInstanceId].tileID;let fi=this.transform.elevation;(fi||Ii.elevation)&&(Ii.elevation=fi?fi.getAtTileOffset(Ii.tileID,Ii.tileAnchorX,Ii.tileAnchorY):0)},ar=Ze.textBox;if(ar){hi(ar);let Ii=rn=>{let lr=i.WritingMode.horizontal;if(D.allowVerticalPlacement&&!rn&&this.prevPlacement){let eo=this.prevPlacement.placedOrientations[ut];eo&&(this.placedOrientations[ut]=eo,lr=eo,this.markUsedOrientation(D,lr,He))}return lr},fi=(rn,lr)=>{if(D.allowVerticalPlacement&&Ge>0&&Ze.verticalTextBox){for(let eo of D.writingModes)if(eo===i.WritingMode.vertical?(Ft=lr(),Xt=Ft):Ft=rn(),Ft&&Ft.box&&Ft.box.length)break}else Ft=rn()};if(k.get("text-variable-anchor")){let rn=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ut]){let bi=this.prevPlacement.variableOffsets[ut];rn.indexOf(bi.anchor)>0&&(rn=rn.filter(Lr=>Lr!==bi.anchor),rn.unshift(bi.anchor))}let lr=(bi,Lr,ea)=>{let Dl=D.getSymbolInstanceTextSize(fe,He,this.transform.zoom,it),gi=(bi.x2-bi.x1)*Dl+2*bi.padding,ta=(bi.y2-bi.y1)*Dl+2*bi.padding,na=De&&!_e?Lr:null;na&&hi(na);let ka={box:[],offscreen:!1,occluded:!1},Iu=ye?2*rn.length:rn.length;for(let Ji=0;Ji<Iu;++Ji){let sf=this.attemptAnchorPlacement(rn[Ji%rn.length],bi,gi,ta,Dl,Se,ke,Y,R,pe,Ji>=rn.length,He,it,D,ea,na,fe,he);if(sf&&(ka=sf.placedGlyphBoxes,ka&&ka.box&&ka.box.length)){tt=!0,on=sf.shift;break}}return ka};fi(()=>lr(ar,Ze.iconBox,i.WritingMode.horizontal),()=>{let bi=Ze.verticalTextBox;return bi&&hi(bi),D.allowVerticalPlacement&&!(Ft&&Ft.box&&Ft.box.length)&&Ge>0&&bi?lr(bi,Ze.verticalIconBox,i.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ft&&(tt=Ft.box,at=Ft.offscreen,_t=Ft.occluded);let eo=Ii(!(!Ft||!Ft.box));if(!tt&&this.prevPlacement){let bi=this.prevPlacement.variableOffsets[ut];bi&&(this.variableOffsets[ut]=bi,this.markUsedJustification(D,bi.anchor,He,eo))}}else{let rn=(lr,eo)=>{let bi=D.getSymbolInstanceTextSize(fe,He,this.transform.zoom,it),Lr=this.collisionIndex.placeCollisionBox(D,bi,lr,new i.Point(0,0),ye,Y,R,pe.predicate);return Lr&&Lr.box&&Lr.box.length&&(this.markUsedOrientation(D,eo,He),this.placedOrientations[ut]=eo),Lr};fi(()=>rn(ar,i.WritingMode.horizontal),()=>{let lr=Ze.verticalTextBox;return D.allowVerticalPlacement&&Ge>0&&lr?(hi(lr),rn(lr,i.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ii(!!(Ft&&Ft.box&&Ft.box.length))}}if(Ht=Ft,tt=Ht&&Ht.box&&Ht.box.length>0,at=Ht&&Ht.offscreen,_t=Ht&&Ht.occluded,He.useRuntimeCollisionCircles){let Ii=D.text.placedSymbolArray.get(He.centerJustifiedTextSymbolIndex>=0?He.centerJustifiedTextSymbolIndex:He.verticalPlacedTextSymbolIndex),fi=i.evaluateSizeForFeature(D.textSizeData,fe,Ii),rn=k.get("text-padding");En=this.collisionIndex.placeCollisionCircles(D,ye,Ii,D.lineVertexArray,D.glyphOffsetArray,fi,R,z,G,_,ke,pe.predicate,He.collisionCircleDiameter*fi/i.ONE_EM,rn,this.retainedQueryData[D.bucketInstanceId].tileID),tt=ye||En.circles.length>0&&!En.collisionDetected,at=at&&En.offscreen,_t=En.occluded}if(Ze.iconFeatureIndex&&(di=Ze.iconFeatureIndex),Ze.iconBox){let Ii=fi=>{hi(fi);let rn=De&&on?ru(on.x,on.y,Se,ke,this.transform.angle):new i.Point(0,0),lr=D.getSymbolInstanceIconSize(he,this.transform.zoom,He.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(D,lr,fi,rn,_e,Y,R,pe.predicate)};Xt&&Xt.box&&Xt.box.length&&Ze.verticalIconBox?(jt=Ii(Ze.verticalIconBox),gt=jt.box.length>0):(jt=Ii(Ze.iconBox),gt=jt.box.length>0),at=at&&jt.offscreen,$t=jt.occluded}let pr=Q||He.numHorizontalGlyphVertices===0&&Ge===0,Co=ue||He.numIconVertices===0;if(pr||Co?Co?pr||(gt=gt&&tt):tt=gt&&tt:gt=tt=gt&&tt,tt&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,k.get("text-ignore-placement"),D.bucketInstanceId,Xt&&Xt.box&&ui?ui:Xn,pe.ID),gt&&jt&&this.collisionIndex.insertCollisionBox(jt.box,k.get("icon-ignore-placement"),D.bucketInstanceId,di,pe.ID),En&&(tt&&this.collisionIndex.insertCollisionCircles(En.circles,k.get("text-ignore-placement"),D.bucketInstanceId,Xn,pe.ID),_)){let Ii=D.bucketInstanceId,fi=this.collisionCircleArrays[Ii];fi===void 0&&(fi=this.collisionCircleArrays[Ii]=new iu);for(let rn=0;rn<En.circles.length;rn+=4)fi.circles.push(En.circles[rn+0]),fi.circles.push(En.circles[rn+1]),fi.circles.push(En.circles[rn+2]),fi.circles.push(En.collisionDetected?1:0)}let Jo=D.projection.name!=="globe";Fe=Fe&&(Jo||!_t),Ve=Ve&&(Jo||!$t),this.placements[ut]=new wa(tt||Fe,gt||Ve,at||D.justReloaded),d.add(ut)};if(Be){let He=D.getSortedSymbolIndexes(this.transform.angle);for(let it=He.length-1;it>=0;--it){let Ze=He[it];mt(D.symbolInstances.get(Ze),Ze,D.collisionArrays[Ze])}}else for(let He=l.symbolInstanceStart;He<l.symbolInstanceEnd;He++)mt(D.symbolInstances.get(He),He,D.collisionArrays[He]);if(_&&D.bucketInstanceId in this.collisionCircleArrays){let He=this.collisionCircleArrays[D.bucketInstanceId];i.invert(He.invProjMatrix,R),He.viewportMatrix=this.collisionIndex.getViewportMatrix()}D.justReloaded=!1}markUsedJustification(l,d,_,x){let{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:z,crossTileID:G}=_,H=i.getAnchorJustification(d),Y=x===i.WritingMode.vertical?z:H==="left"?D:H==="center"?k:H==="right"?R:-1;D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=Y>=0&&D!==Y?0:G),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=Y>=0&&k!==Y?0:G),R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=Y>=0&&R!==Y?0:G),z>=0&&(l.text.placedSymbolArray.get(z).crossTileID=Y>=0&&z!==Y?0:G)}markUsedOrientation(l,d,_){let x=d===i.WritingMode.horizontal||d===i.WritingMode.horizontalOnly?d:0,D=d===i.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:G}=_,H=l.text.placedSymbolArray;k>=0&&(H.get(k).placedOrientation=x),R>=0&&(H.get(R).placedOrientation=x),z>=0&&(H.get(z).placedOrientation=x),G>=0&&(H.get(G).placedOrientation=D)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;let d=this.prevPlacement,_=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;let x=d?d.symbolFadeChange(l):1,D=d?d.opacities:{},k=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(let z in this.placements){let G=this.placements[z],H=D[z];H?(this.opacities[z]=new Xs(H,x,G.text,G.icon,null,G.clipped),_=_||G.text!==H.text.placed||G.icon!==H.icon.placed):(this.opacities[z]=new Xs(null,x,G.text,G.icon,G.skipFade,G.clipped),_=_||G.text||G.icon)}for(let z in D){let G=D[z];if(!this.opacities[z]){let H=new Xs(G,x,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||G.text.placed||G.icon.placed)}}for(let z in k)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=k[z]);for(let z in R)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=R[z]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){let _=new Set;for(let x of d){let D=x.getBucket(l);D&&x.latestFeatureIndex&&l.id===D.layerIds[0]&&this.updateBucketOpacities(D,_,x.collisionBoxArray)}}updateBucketOpacities(l,d,_){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();let x=l.layers[0].layout,D=!!l.layers[0].dynamicFilter(),k=new Xs(null,0,!1,!1,!0),R=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),G=x.get("text-variable-anchor"),H=x.get("text-rotation-alignment")==="map",Y=x.get("text-pitch-alignment")==="map",se=x.get("icon-text-fit")!=="none",le=new Xs(null,0,R&&(z||!l.hasIconData()||x.get("icon-optional")),z&&(R||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);let fe=(pe,Q,ue)=>{for(let ye=0;ye<Q/4;ye++)pe.opacityVertexArray.emplaceBack(ue)},he=0;for(let pe=0;pe<l.symbolInstances.length;pe++){let Q=l.symbolInstances.get(pe),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:ye,crossTileID:_e,numIconVertices:Se}=Q,ke=d.has(_e),De=this.opacities[_e];ke?De=k:De||(De=le,this.opacities[_e]=De),d.add(_e);let Be=ue>0||ye>0,Fe=Se>0,Ve=this.placedOrientations[_e],mt=Ve===i.WritingMode.vertical,He=Ve===i.WritingMode.horizontal||Ve===i.WritingMode.horizontalOnly;if(!Be&&!Fe||De.isHidden()||he++,Be){let it=su(De.text);fe(l.text,ue,mt?ji:it),fe(l.text,ye,He?ji:it);let Ze=De.text.isHidden(),{leftJustifiedTextSymbolIndex:ut,centerJustifiedTextSymbolIndex:Ge,rightJustifiedTextSymbolIndex:tt,verticalPlacedTextSymbolIndex:gt}=Q,at=l.text.placedSymbolArray,_t=Ze||mt?1:0;ut>=0&&(at.get(ut).hidden=_t),Ge>=0&&(at.get(Ge).hidden=_t),tt>=0&&(at.get(tt).hidden=_t),gt>=0&&(at.get(gt).hidden=Ze||He?1:0);let $t=this.variableOffsets[_e];$t&&this.markUsedJustification(l,$t.anchor,Q,Ve);let on=this.placedOrientations[_e];on&&(this.markUsedJustification(l,"left",Q,on),this.markUsedOrientation(l,on,Q))}if(Fe){let it=su(De.icon),{placedIconSymbolIndex:Ze,verticalPlacedIconSymbolIndex:ut}=Q,Ge=l.icon.placedSymbolArray,tt=De.icon.isHidden()?1:0;Ze>=0&&(fe(l.icon,Se,mt?ji:it),Ge.get(Ze).hidden=tt),ut>=0&&(fe(l.icon,Q.numVerticalIconVertices,He?ji:it),Ge.get(ut).hidden=tt)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){let it=l.collisionArrays[pe];if(it){let Ze=new i.Point(0,0),ut=!0;if(it.textBox||it.verticalTextBox){if(G){let tt=this.variableOffsets[_e];tt?(Ze=nl(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textScale),H&&Ze._rotate(Y?this.transform.angle:-this.transform.angle)):ut=!1}D&&(ut=!De.clipped),it.textBox&&rl(l.textCollisionBox.collisionVertexArray,De.text.placed,!ut||mt,Ze.x,Ze.y),it.verticalTextBox&&rl(l.textCollisionBox.collisionVertexArray,De.text.placed,!ut||He,Ze.x,Ze.y)}let Ge=ut&&!!(!He&&it.verticalIconBox);it.iconBox&&rl(l.iconCollisionBox.collisionVertexArray,De.icon.placed,Ge,se?Ze.x:0,se?Ze.y:0),it.verticalIconBox&&rl(l.iconCollisionBox.collisionVertexArray,De.icon.placed,!Ge,se?Ze.x:0,se?Ze.y:0)}}}if(l.fullyClipped=he===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){let pe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=pe.invProjMatrix,l.placementViewportMatrix=pe.viewportMatrix,l.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){let _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function rl(m,l,d,_,x){m.emplaceBack(l?1:0,d?1:0,_||0,x||0),m.emplaceBack(l?1:0,d?1:0,_||0,x||0),m.emplaceBack(l?1:0,d?1:0,_||0,x||0),m.emplaceBack(l?1:0,d?1:0,_||0,x||0)}let Vi=Math.pow(2,25),Qi=Math.pow(2,24),ol=Math.pow(2,17),ou=Math.pow(2,16),$r=Math.pow(2,9),wo=Math.pow(2,8),Rh=Math.pow(2,1);function su(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let l=m.placed?1:0,d=Math.floor(127*m.opacity);return d*Vi+l*Qi+d*ol+l*ou+d*$r+l*wo+d*Rh+l}let ji=0;class nc{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,_,x,D){let k=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(k,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<k.length;){let R=k[this._currentPartIndex];if(d.placeLayerBucketPart(R,this._seenCrossTileIDs,_,R.symbolInstanceStart===0),this._currentPartIndex++,D())return!0}return!1}}class au{constructor(l,d,_,x,D,k,R,z){this.placement=new il(l,D,k,R,z),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(l,d,_){let x=i.exported.now(),D=()=>{let k=i.exported.now()-x;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=d[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=R)&&(!k.maxzoom||k.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new nc(k)),this._inProgressLayer.continuePlacement(_[k.source],this.placement,this._showCollisionBoxes,k,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}let Ao=512/i.EXTENT/2;class Mi{constructor(l,d,_){this.tileID=l,this.bucketInstanceId=_,this.index=new i.KDBush(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let x=l.canonical.x*i.EXTENT,D=l.canonical.y*i.EXTENT;for(let k=0;k<d.length;k++){let{key:R,crossTileID:z,tileAnchorX:G,tileAnchorY:H}=d.get(k),Y=Math.floor((x+G)*Ao),se=Math.floor((D+H)*Ao);this.index.add(Y,se),this.keys.push(R),this.crossTileIDs.push(z)}this.index.finish()}findMatches(l,d,_){let x=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),D=Ao/Math.pow(2,d.canonical.z-this.tileID.canonical.z),k=d.canonical.x*i.EXTENT,R=d.canonical.y*i.EXTENT;for(let z=0;z<l.length;z++){let G=l.get(z);if(G.crossTileID)continue;let{key:H,tileAnchorX:Y,tileAnchorY:se}=G,le=Math.floor((k+Y)*D),fe=Math.floor((R+se)*D),he=this.index.range(le-x,fe-x,le+x,fe+x);for(let pe of he){let Q=this.crossTileIDs[pe];if(this.keys[pe]===H&&!_.has(Q)){_.add(Q),G.crossTileID=Q;break}}}}}class ic{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ph{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){let d=Math.round((l-this.lng)/360);if(d!==0)for(let _ in this.indexes){let x=this.indexes[_],D={};for(let k in x){let R=x[k];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),D[R.tileID.key]=R}this.indexes[_]=D}this.lng=l}addBucket(l,d,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let D=0;D<d.symbolInstances.length;D++)d.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);let x=this.usedCrossTileIDs[l.overscaledZ];for(let D in this.indexes){let k=this.indexes[D];if(Number(D)>l.overscaledZ)for(let R in k){let z=k[R];z.tileID.isChildOf(l)&&z.findMatches(d.symbolInstances,l,x)}else{let R=k[l.scaledTo(Number(D)).key];R&&R.findMatches(d.symbolInstances,l,x)}}for(let D=0;D<d.symbolInstances.length;D++){let k=d.symbolInstances.get(D);k.crossTileID||(k.crossTileID=_.generate(),x.add(k.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Mi(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(let _ of d.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let d=!1;for(let _ in this.indexes){let x=this.indexes[_];for(let D in x)l[x[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[D]),delete x[D],d=!0)}return d}}class Ys{constructor(){this.layerIndexes={},this.crossTileIDs=new ic,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,_,x){let D=this.layerIndexes[l.id];D===void 0&&(D=this.layerIndexes[l.id]=new Ph);let k=!1,R={};x.name!=="globe"&&D.handleWrapJump(_);for(let z of d){let G=z.getBucket(l);G&&l.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),D.addBucket(z.tileID,G,this.crossTileIDs)&&(k=!0),R[G.bucketInstanceId]=!0)}return D.removeStaleBuckets(R)&&(k=!0),k}pruneUnusedLayers(l){let d={};l.forEach(_=>{d[_]=!0});for(let _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}let Ea=(m,l)=>i.emitValidationErrors(m,l&&l.filter(d=>d.identifier!=="source.canvas")),lu=i.pick(ei,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),br=i.pick(ei,["setCenter","setZoom","setBearing","setPitch"]),ko={version:8,layers:[],sources:{}},sl={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ys extends i.Evented{constructor(l,d={}){super(),this.map=l,this.dispatcher=new dr(ec(),this),this.imageManager=new Wa,this.imageManager.setEventedParent(this),this.glyphManager=new i.GlyphManager(l._requestManager,d.localFontFamily?i.LocalGlyphMode.all:d.localIdeographFontFamily?i.LocalGlyphMode.ideographs:i.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new Ys,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.getReferrer());let _=this;this._rtlTextPluginCallback=ys.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(D,k)=>{if(i.triggerPluginCompletionEvent(D),k&&k.every(R=>R))for(let R in _._sourceCaches){let z=_._sourceCaches[R],G=z.getSource().type;G!=="vector"&&G!=="geojson"||z.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;let D=this.getSource(x.sourceId);if(D&&D.vectorLayerIds)for(let k in this._layers){let R=this._layers[k];R.source===D.id&&this._validateLayer(R)}})}loadURL(l,d={}){this.fire(new i.Event("dataloading",{dataType:"style"}));let _=typeof d.validate=="boolean"?d.validate:!i.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,d.accessToken);let x=this.map._requestManager.transformRequest(l,i.ResourceType.Style);this._request=i.getJSON(x,(D,k)=>{this._request=null,D?this.fire(new i.ErrorEvent(D)):k&&this._load(k,_)})}loadJSON(l,d={}){this.fire(new i.Event("dataloading",{dataType:"style"})),this._request=i.exported.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new i.Event("dataloading",{dataType:"style"})),this._load(ko,!1)}_updateLayerCount(l,d){let _=d?1:-1;l.is3D()&&(this._num3DLayers+=_),l.type==="circle"&&(this._numCircleLayers+=_),l.type==="symbol"&&(this._numSymbolLayers+=_)}_load(l,d){if(d&&Ea(this,i.validateStyle(l)))return;this._loaded=!0,this.stylesheet=i.clone$1(l),this._updateMapProjection();for(let x in l.sources)this.addSource(x,l.sources[x],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);let _=Mh(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _){let D=i.createStyleLayer(x);D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D,this._serializedLayers[D.id]=D.serialize(),this._updateLayerCount(D,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Yi(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new i.Event("data",{dataType:"style"})),this.fire(new i.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(d,_,x){let D,k,R,z=i.exported.devicePixelRatio>1?"@2x":"",G=i.getJSON(_.transformRequest(_.normalizeSpriteURL(d,z,".json"),i.ResourceType.SpriteJSON),(se,le)=>{G=null,R||(R=se,D=le,Y())}),H=i.getImage(_.transformRequest(_.normalizeSpriteURL(d,z,".png"),i.ResourceType.SpriteImage),(se,le)=>{H=null,R||(R=se,k=le,Y())});function Y(){if(R)x(R);else if(D&&k){let se=i.exported.getImageData(k),le={};for(let fe in D){let{width:he,height:pe,x:Q,y:ue,sdf:ye,pixelRatio:_e,stretchX:Se,stretchY:ke,content:De}=D[fe],Be=new i.RGBAImage({width:he,height:pe});i.RGBAImage.copy(se,Be,{x:Q,y:ue},{x:0,y:0},{width:he,height:pe}),le[fe]={data:Be,pixelRatio:_e,sdf:ye,stretchX:Se,stretchY:ke,content:De}}x(null,le)}}return{cancel(){G&&(G.cancel(),G=null),H&&(H.cancel(),H=null)}}}(l,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new i.ErrorEvent(d));else if(_)for(let x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new i.Event("data",{dataType:"style"}))})}_validateLayer(l){let d=this.getSource(l.source);if(!d)return;let _=l.sourceLayer;_&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(_)===-1)&&this.fire(new i.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){let d=[];for(let _ of l){let x=this._layers[_];x.type!=="custom"&&d.push(x.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(let l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped():sl[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;let d=this._changed;if(this._changed){let x=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(x.length||D.length)&&this._updateWorkerLayers(x,D);for(let k in this._updatedSources){let R=this._updatedSources[k];R==="reload"?this._reloadSource(k):R==="clear"&&this._clearSource(k)}this._updateTilesForChangedImages();for(let k in this._updatedPaintProps)this._layers[k].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}let _={};for(let x in this._sourceCaches){let D=this._sourceCaches[x];_[x]=D.used,D.used=!1}for(let x of this._order){let D=this._layers[x];if(D.recalculate(l,this._availableImages),!D.isHidden(l.zoom)){let R=this._getLayerSourceCache(D);R&&(R.used=!0)}let k=this.map.painter;if(k){let R=D.getProgramIds();if(!R)continue;let z=D.getProgramConfiguration(l.zoom);for(let G of R)k.useProgram(G,z)}}for(let x in _){let D=this._sourceCaches[x];_[x]!==D.used&&D.getSource().fire(new i.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new i.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let l=Object.keys(this._changedImages);if(l.length){for(let d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),Ea(this,i.validateStyle(l)))return!1;(l=i.clone$1(l)).layers=Mh(l.layers);let d=function(x,D){if(!x)return[{command:ei.setStyle,args:[D]}];let k=[];try{if(!C(x.version,D.version))return[{command:ei.setStyle,args:[D]}];C(x.center,D.center)||k.push({command:ei.setCenter,args:[D.center]}),C(x.zoom,D.zoom)||k.push({command:ei.setZoom,args:[D.zoom]}),C(x.bearing,D.bearing)||k.push({command:ei.setBearing,args:[D.bearing]}),C(x.pitch,D.pitch)||k.push({command:ei.setPitch,args:[D.pitch]}),C(x.sprite,D.sprite)||k.push({command:ei.setSprite,args:[D.sprite]}),C(x.glyphs,D.glyphs)||k.push({command:ei.setGlyphs,args:[D.glyphs]}),C(x.transition,D.transition)||k.push({command:ei.setTransition,args:[D.transition]}),C(x.light,D.light)||k.push({command:ei.setLight,args:[D.light]}),C(x.fog,D.fog)||k.push({command:ei.setFog,args:[D.fog]}),C(x.projection,D.projection)||k.push({command:ei.setProjection,args:[D.projection]});let R={},z=[];(function(Y,se,le,fe){let he;for(he in se=se||{},Y=Y||{})Y.hasOwnProperty(he)&&(se.hasOwnProperty(he)||xa(he,le,fe));for(he in se){if(!se.hasOwnProperty(he))continue;let pe=se[he];Y.hasOwnProperty(he)?C(Y[he],pe)||(Y[he].type==="geojson"&&pe.type==="geojson"&&vi(Y,se,he)?le.push({command:ei.setGeoJSONSourceData,args:[he,pe.data]}):Ih(he,se,le,fe)):Jc(he,se,le)}})(x.sources,D.sources,z,R);let G=[];x.layers&&x.layers.forEach(Y=>{Y.source&&R[Y.source]?k.push({command:ei.removeLayer,args:[Y.id]}):G.push(Y)});let H=x.terrain;H&&R[H.source]&&(k.push({command:ei.setTerrain,args:[void 0]}),H=void 0),k=k.concat(z),C(H,D.terrain)||k.push({command:ei.setTerrain,args:[D.terrain]}),function(Y,se,le){se=se||[];let fe=(Y=Y||[]).map(gs),he=se.map(gs),pe=Y.reduce(Sh,{}),Q=se.reduce(Sh,{}),ue=fe.slice(),ye=Object.create(null),_e,Se,ke,De,Be,Fe,Ve;for(_e=0,Se=0;_e<fe.length;_e++)ke=fe[_e],Q.hasOwnProperty(ke)?Se++:(le.push({command:ei.removeLayer,args:[ke]}),ue.splice(ue.indexOf(ke,Se),1));for(_e=0,Se=0;_e<he.length;_e++)ke=he[he.length-1-_e],ue[ue.length-1-_e]!==ke&&(pe.hasOwnProperty(ke)?(le.push({command:ei.removeLayer,args:[ke]}),ue.splice(ue.lastIndexOf(ke,ue.length-Se),1)):Se++,Fe=ue[ue.length-_e],le.push({command:ei.addLayer,args:[Q[ke],Fe]}),ue.splice(ue.length-_e,0,ke),ye[ke]=!0);for(_e=0;_e<he.length;_e++)if(ke=he[_e],De=pe[ke],Be=Q[ke],!ye[ke]&&!C(De,Be))if(C(De.source,Be.source)&&C(De["source-layer"],Be["source-layer"])&&C(De.type,Be.type)){for(Ve in qo(De.layout,Be.layout,le,ke,null,ei.setLayoutProperty),qo(De.paint,Be.paint,le,ke,null,ei.setPaintProperty),C(De.filter,Be.filter)||le.push({command:ei.setFilter,args:[ke,Be.filter]}),C(De.minzoom,Be.minzoom)&&C(De.maxzoom,Be.maxzoom)||le.push({command:ei.setLayerZoomRange,args:[ke,Be.minzoom,Be.maxzoom]}),De)De.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?qo(De[Ve],Be[Ve],le,ke,Ve.slice(6),ei.setPaintProperty):C(De[Ve],Be[Ve])||le.push({command:ei.setLayerProperty,args:[ke,Ve,Be[Ve]]}));for(Ve in Be)Be.hasOwnProperty(Ve)&&!De.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?qo(De[Ve],Be[Ve],le,ke,Ve.slice(6),ei.setPaintProperty):C(De[Ve],Be[Ve])||le.push({command:ei.setLayerProperty,args:[ke,Ve,Be[Ve]]}))}else le.push({command:ei.removeLayer,args:[ke]}),Fe=ue[ue.lastIndexOf(ke)+1],le.push({command:ei.addLayer,args:[Be,Fe]})}(G,D.layers,k)}catch(R){console.warn("Unable to compute style diff:",R),k=[{command:ei.setStyle,args:[D]}]}return k}(this.serialize(),l).filter(x=>!(x.command in br));if(d.length===0)return!1;let _=d.filter(x=>!(x.command in lu));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return d.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,d){return this.getImage(l)?this.fire(new i.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new i.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,d,_={}){if(this._checkLoaded(),this.getSource(l)!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(i.validateSource,`sources.${l}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);let x=mn(l,d,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:x.serialize(),sourceId:l}));let D=k=>{let R=(k?"symbol:":"other:")+l,z=this._sourceCaches[R]=new i.SourceCache(R,x,k);(k?this._symbolSourceCaches:this._otherSourceCaches)[l]=z,z.style=this,z.onAdd(this.map)};D(!1),d.type!=="vector"&&d.type!=="geojson"||D(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();let d=this.getSource(l);if(!d)throw new Error("There is no source with this ID");for(let x in this._layers)if(this._layers[x].source===l)return this.fire(new i.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new i.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));let _=this._getSourceCaches(l);for(let x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new i.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getSource(l).setData(d),this._changed=!0}getSource(l){let d=this._getSourceCache(l);return d&&d.getSource()}_getSources(){let l=[];for(let d in this._otherSourceCaches){let _=this._getSourceCache(d);_&&l.push(_.getSource())}return l}addLayer(l,d,_={}){this._checkLoaded();let x=l.id;if(this.getLayer(x))return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let D;if(l.type==="custom"){if(Ea(this,i.validateCustomStyleLayer(l)))return;D=i.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(x,l.source),l=i.clone$1(l),l=i.extend(l,{source:x})),this._validate(i.validateLayer,`layers.${x}`,l,{arrayIndex:-1},_))return;D=i.createStyleLayer(l),this._validateLayer(D),D.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[D.id]=D.serialize(),this._updateLayerCount(D,!0)}let k=d?this._order.indexOf(d):this._order.length;if(d&&k===-1)return void this.fire(new i.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(k,0,x),this._layerOrderChanged=!0,this._layers[x]=D;let R=this._getLayerSourceCache(D);if(this._removedLayers[x]&&D.source&&R&&D.type!=="custom"){let z=this._removedLayers[x];delete this._removedLayers[x],z.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",R.pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;let _=this._order.indexOf(l);this._order.splice(_,1);let x=d?this._order.indexOf(d):this._order.length;d&&x===-1?this.fire(new i.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(x,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();let d=this._layers[l];if(!d)return void this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);let _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(let d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,_){this._checkLoaded();let x=this.getLayer(l);x?x.minzoom===d&&x.maxzoom===_||(d!=null&&(x.minzoom=d),_!=null&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,d,_={}){this._checkLoaded();let x=this.getLayer(l);if(x){if(!C(x.filter,d))return d==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(i.validateFilter,`layers.${x.id}.filter`,d,{layerType:x.type},_)||(x.filter=i.clone$1(d),this._updateLayer(x)))}else this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){let d=this.getLayer(l);return d&&i.clone$1(d.filter)}setLayoutProperty(l,d,_,x={}){this._checkLoaded();let D=this.getLayer(l);D?C(D.getLayoutProperty(d),_)||(D.setLayoutProperty(d,_,x),this._updateLayer(D)):this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,d){let _=this.getLayer(l);if(_)return _.getLayoutProperty(d);this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,d,_,x={}){this._checkLoaded();let D=this.getLayer(l);D?C(D.getPaintProperty(d),_)||(D.setPaintProperty(d,_,x)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new i.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,d){let _=this.getLayer(l);return _&&_.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();let _=l.source,x=l.sourceLayer,D=this.getSource(_);if(!D)return void this.fire(new i.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));let k=D.type;if(k==="geojson"&&x)return void this.fire(new i.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(k==="vector"&&!x)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided.")));let R=this._getSourceCaches(_);for(let z of R)z.setFeatureState(x,l.id,d)}removeFeatureState(l,d){this._checkLoaded();let _=l.source,x=this.getSource(_);if(!x)return void this.fire(new i.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));let D=x.type,k=D==="vector"?l.sourceLayer:void 0;if(D==="vector"&&!k)return void this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new i.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let R=this._getSourceCaches(_);for(let z of R)z.removeFeatureState(k,l.id,d)}getFeatureState(l){this._checkLoaded();let d=l.source,_=l.sourceLayer,x=this.getSource(d);if(x){if(x.type!=="vector"||_)return l.id===void 0&&this.fire(new i.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,l.id);this.fire(new i.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new i.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return i.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let l={};for(let d in this._sourceCaches){let _=this._sourceCaches[d].getSource();l[_.id]||(l[_.id]=_.serialize())}return i.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0;let d=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&d&&d.getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",d.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){let d=k=>this._layers[k].type==="fill-extrusion",_={},x=[];for(let k=this._order.length-1;k>=0;k--){let R=this._order[k];if(d(R)){_[R]=k;for(let z of l){let G=z[R];if(G)for(let H of G)x.push(H)}}}x.sort((k,R)=>R.intersectionZ-k.intersectionZ);let D=[];for(let k=this._order.length-1;k>=0;k--){let R=this._order[k];if(d(R))for(let z=x.length-1;z>=0;z--){let G=x[z].feature;if(_[G.layer.id]<k)break;D.push(G),x.pop()}else for(let z of l){let G=z[R];if(G)for(let H of G)D.push(H.feature)}}return D}queryRenderedFeatures(l,d,_){d&&d.filter&&this._validate(i.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);let x={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new i.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let z of d.layers){let G=this._layers[z];if(!G)return this.fire(new i.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];x[G.source]=!0}}let D=[];d.availableImages=this._availableImages;let k=d&&d.layers?d.layers.some(z=>{let G=this.getLayer(z);return G&&G.is3D()}):this.has3DLayers(),R=go.createFromScreenPoints(l,_);for(let z in this._sourceCaches){let G=this._sourceCaches[z].getSource().id;d.layers&&!x[G]||D.push(Rn(this._sourceCaches[z],this._layers,this._serializedLayers,R,d,_,k,!!this.map._showQueryGeometry))}return this.placement&&D.push(function(z,G,H,Y,se,le,fe){let he={},pe=le.queryRenderedSymbols(Y),Q=[];for(let ue of Object.keys(pe).map(Number))Q.push(fe[ue]);Q.sort(Vr);for(let ue of Q){let ye=ue.featureIndex.lookupSymbolFeatures(pe[ue.bucketInstanceId],G,ue.bucketIndex,ue.sourceLayerIndex,se.filter,se.layers,se.availableImages,z);for(let _e in ye){let Se=he[_e]=he[_e]||[],ke=ye[_e];ke.sort((De,Be)=>{let Fe=ue.featureSortOrder;if(Fe){let Ve=Fe.indexOf(De.featureIndex);return Fe.indexOf(Be.featureIndex)-Ve}return Be.featureIndex-De.featureIndex});for(let De of ke)Se.push(De)}}for(let ue in he)he[ue].forEach(ye=>{let _e=ye.feature,Se=H(z[ue]);if(!Se)return;let ke=Se.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ke});return he}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),R.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(l,d){d&&d.filter&&this._validate(i.validateFilter,"querySourceFeatures.filter",d.filter,null,d);let _=this._getSourceCaches(l),x=[];for(let D of _)x=x.concat(Ki(D,d));return x}addSourceType(l,d,_){return ys.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(ys.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();let _=this.light.getLight(),x=!1;for(let k in l)if(!C(l[k],_[k])){x=!0;break}if(!x)return;let D=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,d),this.light.updateTransitions(D)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,d=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=l;if(d===1){if(typeof _.source=="object"){let x="terrain-dem-src";this.addSource(x,_.source),_=i.clone$1(_),_=i.extend(_,{source:x})}if(this._validate(i.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,d)}else{let x=this.terrain,D=x.get();for(let k of Object.keys(i.spec.terrain))!_.hasOwnProperty(k)&&i.spec.terrain[k].default&&(_[k]=i.spec.terrain[k].default);for(let k in _)if(!C(_[k],D[k])){x.set(_),this.stylesheet.terrain=_;let R=this._setTransitionParameters({duration:0});x.updateTransitions(R);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){let d=this.fog=new Wo(l,this.map.transform);this.stylesheet.fog=l;let _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let d=this.fog,_=d.get();Object.keys(l).length===0&&d.set(l);for(let x in l)if(!C(l[x],_[x])){d.set(l),this.stylesheet.fog=l;let D=this._setTransitionParameters({duration:0});d.updateTransitions(D);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:i.exported.now(),transition:i.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let l=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){let _=this.terrain=new Vs(l,d);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(let l in this._layers){let d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(let l in this._layers){let d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,_,x,D={}){return(!D||D.validate!==!1)&&Ea(this,l.call(i.validateStyle,i.extend({key:d,style:this.serialize(),value:_,styleSpec:i.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let l in this._layers)this._layers[l].setEventedParent(null);for(let l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){let d=this._getSourceCaches(l);for(let _ of d)_.clearTiles()}_reloadSource(l){let d=this._getSourceCaches(l);for(let _ of d)_.resume(),_.reload()}_reloadSources(){for(let l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(let d in this._sourceCaches)this._sourceCaches[d].update(l)}_generateCollisionBoxes(){for(let l in this._sourceCaches){let d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,_,x,D=!1){let k=!1,R=!1,z={};for(let G of this._order){let H=this._layers[G];if(H.type!=="symbol")continue;if(!z[H.source]){let se=this._getLayerSourceCache(H);if(!se)continue;z[H.source]=se.getRenderableIds(!0).map(le=>se.getTileByID(le)).sort((le,fe)=>fe.tileID.overscaledZ-le.tileID.overscaledZ||(le.tileID.isLessThan(fe.tileID)?-1:1))}let Y=this.crossTileSymbolIndex.addLayer(H,z[H.source],l.center.lng,l.projection);k=k||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),D=D||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new i.Event("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.exported.now(),l.zoom))&&(this.pauseablePlacement=new au(l,this._order,D,d,_,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.exported.now()),R=!0),k&&this.pauseablePlacement.placement.setStale()),R||k)for(let G of this._order){let H=this._layers[G];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.exported.now())}_releaseSymbolFadeTiles(){for(let l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();let x=D=>{D&&D.setDependencies(d.tileID.key,d.type,d.icons)};x(this._otherSourceCaches[d.source]),x(this._symbolSourceCaches[d.source])}getGlyphs(l,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(l,d,_){return i.makeRequest(d,_)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){let d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){let d=this._getSourceCaches(l);return d.length===0?(this.fire(new i.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ys.getSourceType=function(m){return cn[m]},ys.setSourceType=function(m,l){cn[m]=l},ys.registerForPluginStateChange=i.registerForPluginStateChange;var md=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Yo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ks=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ca=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_s=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let vs={},al={},cu=[];ll(md,cu),ll(Ks,cu),ll(Ca,cu),ll(_s,cu),vs=Zn("",Ks),al=Zn(_s,Ca);let rc=Zn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),uu=md,gd=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var du={background:Zn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Zn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Zn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Zn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Zn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Zn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Zn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Zn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Zn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Zn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Zn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Zn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Zn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Zn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Zn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Zn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Zn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Zn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Zn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Zn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Zn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Zn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Zn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yo),skyboxGradient:Zn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yo),skyboxCapture:Zn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Zn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ll(m,l){let d=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of d)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let x=_.split(" ");for(let D of x)l.includes(D)||l.push(D)}}function Zn(m,l){let d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},D=[...cu];return ll(m,D),ll(l,D),{fragmentSource:m=m.replace(d,(k,R,z,G,H)=>(x[H]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${z} ${G} ${H};
#else
uniform ${z} ${G} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${z} ${G} ${H} = u_${H};
#endif
`)),vertexSource:l=l.replace(d,(k,R,z,G,H)=>{let Y=G==="float"?"vec2":"vec4",se=H.match(/color/)?"color":Y;return x[H]?R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${z} ${Y} a_${H};
varying ${z} ${G} ${H};
#else
uniform ${z} ${G} u_${H};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${z} ${G} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${se}(a_${H}, u_${H}_t);
#else
    ${z} ${G} ${H} = u_${H};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${z} ${Y} a_${H};
#else
uniform ${z} ${G} u_${H};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${G} ${H} = a_${H};
#else
    ${z} ${G} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${G} ${H} = unpack_mix_${se}(a_${H}, u_${H}_t);
#else
    ${z} ${G} ${H} = u_${H};
#endif
`}),staticAttributes:_,usedDefines:D}}class Ug{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,_,x,D,k,R){this.context=l;let z=this.boundPaintVertexBuffers.length!==x.length;for(let H=0;!z&&H<x.length;H++)this.boundPaintVertexBuffers[H]!==x[H]&&(z=!0);let G=this.boundDynamicVertexBuffers.length!==R.length;for(let H=0;!G&&H<R.length;H++)this.boundDynamicVertexBuffers[H]!==R[H]&&(G=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||z||G||this.boundIndexBuffer!==D||this.boundVertexOffset!==k)this.freshBind(d,_,x,D,k,R);else{l.bindVertexArrayOES.set(this.vao);for(let H of R)H&&H.bind();D&&D.dynamicDraw&&D.bind()}}freshBind(l,d,_,x,D,k){let R,z=l.numAttributes,G=this.context,H=G.gl;if(G.extVertexArrayObject)this.vao&&this.destroy(),this.vao=G.extVertexArrayObject.createVertexArrayOES(),G.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=D,this.boundDynamicVertexBuffers=k;else{R=G.currentNumAttributes||0;for(let Y=z;Y<R;Y++)H.disableVertexAttribArray(Y)}d.enableAttributes(H,l),d.bind(),d.setVertexAttribPointers(H,l,D);for(let Y of _)Y.enableAttributes(H,l),Y.bind(),Y.setVertexAttribPointers(H,l,D);for(let Y of k)Y&&(Y.enableAttributes(H,l),Y.bind(),Y.setVertexAttribPointers(H,l,D));x&&x.bind(),G.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yd(m,l){let d=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new i.MercatorCoordinate(0,_/d).toLngLat().lat,new i.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function _d(m,l,d,_,x,D,k){let R=m.context,z=R.gl,G=d.fbo;if(!G)return;m.prepareDrawTile();let H=m.useProgram("hillshade");R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get());let Y=((he,pe,Q,ue)=>{let ye=Q.paint.get("hillshade-shadow-color"),_e=Q.paint.get("hillshade-highlight-color"),Se=Q.paint.get("hillshade-accent-color"),ke=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ke-=he.transform.angle);let De=!he.options.moving;return{u_matrix:ue||he.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),De),u_image:0,u_latrange:yd(0,pe.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),ke],u_shadow:ye,u_highlight:_e,u_accent:Se}})(m,d,_,m.terrain?l.projMatrix:null);m.prepareDrawProgram(R,H,l.toUnwrapped());let{tileBoundsBuffer:se,tileBoundsIndexBuffer:le,tileBoundsSegments:fe}=m.getTileBoundsBuffers(d);H.draw(R,z.TRIANGLES,x,D,k,i.CullFaceMode.disabled,Y,_.id,se,le,fe)}function Oh(m,l,d){if(!l.needsDEMTextureUpload)return;let _=m.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||m.getTileTexture(d.stride);let D=d.getPixels();l.demTexture?l.demTexture.update(D,{premultiply:!1}):l.demTexture=new i.Texture(_,D,x.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function _p(m,l,d,_,x,D){let k=m.context,R=k.gl;if(!l.dem)return;let z=l.dem;if(k.activeTexture.set(R.TEXTURE1),Oh(m,l,z),!l.demTexture)return;l.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);let G=z.dim;k.activeTexture.set(R.TEXTURE0);let H=l.fbo;if(!H){let fe=new i.Texture(k,{width:G,height:G,data:null},R.RGBA);fe.bind(R.LINEAR,R.CLAMP_TO_EDGE),H=l.fbo=k.createFramebuffer(G,G,!0),H.colorAttachment.set(fe.texture)}k.bindFramebuffer.set(H.framebuffer),k.viewport.set([0,0,G,G]);let{tileBoundsBuffer:Y,tileBoundsIndexBuffer:se,tileBoundsSegments:le}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(k,R.TRIANGLES,_,x,D,i.CullFaceMode.disabled,((fe,he)=>{let pe=he.stride,Q=i.create();return i.ortho(Q,0,i.EXTENT,-i.EXTENT,0,0,1),i.translate(Q,Q,[0,-i.EXTENT,0]),{u_matrix:Q,u_image:1,u_dimension:[pe,pe],u_zoom:fe.overscaledZ,u_unpack:he.unpackVector}})(l.tileID,z),d.id,Y,se,le),l.needsHillshadePrepare=!1}let Lh=m=>({u_matrix:new i.UniformMatrix4f(m),u_image0:new i.Uniform1i(m),u_skirt_height:new i.Uniform1f(m)}),oc=(m,l)=>({u_matrix:m,u_image0:0,u_skirt_height:l}),vd=(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:x,u_merc_center:D,u_image0:0,u_frustum_tl:k,u_frustum_tr:R,u_frustum_br:z,u_frustum_bl:G,u_globe_pos:H,u_globe_radius:Y,u_viewport:se,u_grid_matrix:fe?Float32Array.from(fe):new Float32Array(9),u_skirt_height:le});function Da(m,l){return m!=null&&l!=null&&!(!m.hasData()||!l.hasData())&&m.demTexture!=null&&l.demTexture!=null&&m.tileID.key!==l.tileID.key}let Qs=new class{constructor(){this.operations={}}newMorphing(m,l,d,_,x){if(m in this.operations){let D=this.operations[m];D.to.tileID.key!==d.tileID.key&&(D.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:x,from:l,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;let l=this.operations[m];return{from:l.from,to:l.to,phase:l.phase}}update(m){for(let l in this.operations){let d=this.operations[l];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[l];break}}}_nextOp(m,l){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=l,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},cl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bd(m){return 6*Math.pow(1.5,22-m)}function Fh(m,l){let d=1<<m.z;return!l&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}let bs=m=>({u_matrix:m});function xd(m,l,d,_,x){if(x>0){let D=i.exported.now(),k=(D-m.timeAdded)/x,R=l?(D-l.timeAdded)/x:-1,z=d.getSource(),G=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),H=!l||Math.abs(l.tileID.overscaledZ-G)>Math.abs(m.tileID.overscaledZ-G),Y=H&&m.refreshedUponExpiration?1:i.clamp(H?k:1-R,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}class wd extends i.SourceCache{constructor(l){let d={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new dr(ec(),null),x=mn("mock-dem",d,_,l.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class Ed extends i.SourceCache{constructor(l){let d=mn("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new dr(ec(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,_){if(l.freezeTileCoverage)return;this.transform=l;let x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((D,k)=>{if(D[k.key]="",!this._tiles[k.key]){let R=new i.Tile(k,this._source.tileSize*k.overscaleFactor(),l.tileZoom);R.state="loaded",this._tiles[k.key]=R}return D},{});for(let D in this._tiles)D in x||(this.freeFBO(D),this._tiles[D].unloadVectorData(),delete this._tiles[D])}freeFBO(l){let d=this.proxyCachedFBO[l];if(d!==void 0){let _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Cd extends i.OverscaledTileID{constructor(l,d,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Nh extends i.Elevation{constructor(l,d){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[_,x,D]=function(z){let G=new i.StructArrayLayout2i4,H=new i.StructArrayLayout3ui6,Y=131;G.reserve(17161),H.reserve(33800);let se=i.EXTENT/128,le=i.EXTENT+se/2,fe=le+se;for(let pe=-se;pe<fe;pe+=se)for(let Q=-se;Q<fe;Q+=se){let ue=Q<0||Q>le||pe<0||pe>le?24575:0,ye=i.clamp(Math.round(Q),0,i.EXTENT),_e=i.clamp(Math.round(pe),0,i.EXTENT);G.emplaceBack(ye+ue,_e)}let he=(pe,Q)=>{let ue=Q*Y+pe;H.emplaceBack(ue+1,ue,ue+Y),H.emplaceBack(ue+Y,ue+Y+1,ue+1)};for(let pe=1;pe<129;pe++)for(let Q=1;Q<129;Q++)he(Q,pe);return[0,129].forEach(pe=>{for(let Q=0;Q<130;Q++)he(Q,pe),he(pe,Q)}),[G,H,32768]}(),k=l.context;this.gridBuffer=k.createVertexBuffer(_,i.posAttributes.members),this.gridIndexBuffer=k.createIndexBuffer(x),this.gridSegments=i.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=i.SegmentVector.simpleSegment(0,0,_.length,D),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ed(d.map),this.orthoMatrix=i.create(),i.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.EXTENT,0,i.EXTENT,0,1);let R=k.gl;this._overlapStencilMode=new i.StencilMode({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wd(d.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,_){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;let x=l.terrain.properties;this.sourceCache=l.terrain.drapeRenderMode===0?this._mockSourceCache:l._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");let D=()=>{this.sourceCache.used&&i.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let k=this.getScaledDemTileSize();this.sourceCache.update(d,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||l.efficiency!==100&&i.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let x=this.proxyCoords=d.getIds().map(z=>{let G=d.getTileByID(z).tileID;return G.projMatrix=_.calculateProjMatrix(G.toUnwrapped()),G});(function(z,G){let H=G.transform.pointCoordinate(G.transform.getCameraPoint()),Y=new i.Point(H.x,H.y);z.sort((se,le)=>{if(le.overscaledZ-se.overscaledZ)return le.overscaledZ-se.overscaledZ;let fe=new i.Point(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),he=new i.Point(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),pe=Y.mult(1<<se.canonical.z);return pe.x-=.5,pe.y-=.5,pe.distSqr(fe)-pe.distSqr(he)})})(x,this.painter),this._previousZoom=_.zoom;let D=this.proxyToSource||{};this.proxyToSource={},x.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};let k=this._style._sourceCaches;for(let z in k){let G=k[z];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,l[z],D),G.usedForTerrain))continue;let H=l[z];G.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[d.id]=x.map(z=>new Cd(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(D),this.renderingToTexture=!1,this._updateTimestamp=i.exported.now();let R={};this._visibleDemTiles=[];for(let z of this.proxyCoords){let G=this.terrainTileForTile[z.key];if(!G)continue;let H=G.tileID.key;H in R||(this._visibleDemTiles.push(G),R[H]=H)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;let _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){let l=this.painter.context,d=l.gl;for(let _ in this.terrainTileForTile){let x=this.terrainTileForTile[_],D=x.dem;!D||x.demTexture&&!x.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),Oh(this.painter,x,D))}}_prepareDemTileUniforms(l,d,_,x){if(!d||d.demTexture==null)return!1;let D=l.tileID.canonical,k=Math.pow(2,d.tileID.canonical.z-D.z),R=x||"";return _[`u_dem_tl${R}`]=[D.x*k%1,D.y*k%1],_[`u_dem_scale${R}`]=k,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let l=this.painter.context,d=l.gl;if(!this._emptyDepthBufferTexture){let _=new i.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.Texture(l,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0,d=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;let D=x.dem.tree.minimums[0];return D>0&&l++,_+D},0);return l?d/l:0}_updateEmptyDEMTexture(){let l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);let _=this._getLoadedAreaMinimum(),x=new i.RGBAImage({width:1,height:1},new Uint8Array(i.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let D=this._emptyDEMTexture;return D?D.update(x,{premultiply:!1}):D=this._emptyDEMTexture=new i.Texture(l,x,d.RGBA,{premultiply:!1}),D}setupElevationDraw(l,d,_){let x=this.painter.context,D=x.gl,k=(R=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:i.DEMData.getUnpackVector(R),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var R;k.u_dem_size=this.sourceCache.getSource().tileSize,k.u_exaggeration=this.exaggeration();let z=null,G=null,H=1;if(_&&_.morphing&&this._useVertexMorphing){let Y=_.morphing.srcDemTile,se=_.morphing.dstDemTile;H=_.morphing.phase,Y&&se&&(this._prepareDemTileUniforms(l,Y,k,"_prev")&&(G=Y),this._prepareDemTileUniforms(l,se,k)&&(z=se))}if(G&&z?(x.activeTexture.set(D.TEXTURE2),z.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),x.activeTexture.set(D.TEXTURE4),G.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),k.u_dem_lerp=H):(z=this.terrainTileForTile[l.tileID.key],x.activeTexture.set(D.TEXTURE2),(this._prepareDemTileUniforms(l,z,k)?z.demTexture:this.emptyDEMTexture).bind(D.NEAREST,D.CLAMP_TO_EDGE)),x.activeTexture.set(D.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE),this._depthFBO&&(k.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE),k.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&z){let Y=(1<<z.tileID.canonical.z)*i.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;k.u_meter_to_dem=Y}if(_&&_.labelPlaneMatrixInv&&(k.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(x,k),this.painter.transform.projection.name==="globe"){let Y=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(x,Y)}}globeUniformValues(l,d,_){let x=l.projection;return{u_tile_tl_up:x.upVector(d,0,0),u_tile_tr_up:x.upVector(d,i.EXTENT,0),u_tile_br_up:x.upVector(d,i.EXTENT,i.EXTENT),u_tile_bl_up:x.upVector(d,0,i.EXTENT),u_tile_up_scale:_?i.globeMetersToEcef(1):x.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){let d=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,D,k,R,z){if(x.transform.projection.name==="globe")(function(G,H,Y,se,le){let fe=G.context,he=fe.gl,pe,Q,ue=G.options.showTerrainWireframe?2:0,ye=G.transform,_e=i.globeUseCustomAntiAliasing(G,fe,ye),Se=(ut,Ge)=>{if(Q===ut)return;let tt=[cl[ut],"PROJECTION_GLOBE_VIEW"];_e&&tt.push("CUSTOM_ANTIALIASING"),Ge&&tt.push(cl[ue]),pe=G.useProgram("globeRaster",null,tt),Q=ut},ke=G.colorModeForRenderPass(),De=new i.DepthMode(he.LEQUAL,i.DepthMode.ReadWrite,G.depthRangeFor3D);Qs.update(le);let Be=i.calculateGlobeMercatorMatrix(ye),Fe=[i.mercatorXfromLng(ye.center.lng),i.mercatorYfromLat(ye.center.lat)],Ve=ue?[!1,!0]:[!1],mt=G.globeSharedBuffers,He=[ye.width*i.exported.devicePixelRatio,ye.height*i.exported.devicePixelRatio],it=Float32Array.from(ye.globeMatrix),Ze={useDenormalizedUpVectorScale:!0};if(Ve.forEach(ut=>{let Ge=G.transform,tt=bd(Ge.zoom)*H.exaggeration();Q=-1;let gt=ut?he.LINES:he.TRIANGLES;for(let at of se){let _t=Y.getTile(at),$t=i.StencilMode.disabled,on=H.prevTerrainTileForTile[at.key],Ft=H.terrainTileForTile[at.key];Da(on,Ft)&&Qs.newMorphing(at.key,on,Ft,le,250),fe.activeTexture.set(he.TEXTURE0),_t.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE);let Xt=Qs.getMorphValuesForProxy(at.key),Ht=Xt?1:0;Xt&&i.extend$1(Ze,{morphing:{srcDemTile:Xt.from,dstDemTile:Xt.to,phase:i.easeCubicInOut(Xt.phase)}});let En=i.tileCornersToBounds(at.canonical),jt=i.getLatitudinalLod(En.getCenter().lat),Xn=i.getGridMatrix(at.canonical,En,jt,Ge.worldSize/Ge._pixelsPerMercatorPixel),ui=i.globeNormalizeECEF(i.globeTileBounds(at.canonical)),di=vd(Ge.projMatrix,it,Be,ui,i.globeToMercatorTransition(Ge.zoom),Fe,Ge.frustumCorners.TL,Ge.frustumCorners.TR,Ge.frustumCorners.BR,Ge.frustumCorners.BL,Ge.globeCenterInViewSpace,Ge.globeRadius,He,tt,Xn);if(Se(Ht,ut),H.setupElevationDraw(_t,pe,Ze),G.prepareDrawProgram(fe,pe,at.toUnwrapped()),mt){let[hi,ar,pr]=ut?mt.getWirefameBuffers(G.context,jt):mt.getGridBuffers(jt,tt!==0);pe.draw(fe,gt,De,$t,ke,i.CullFaceMode.backCCW,di,"globe_raster",hi,ar,pr)}}}),mt){let ut=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&ut.push("CUSTOM_ANTIALIASING"),pe=G.useProgram("globeRaster",null,ut);for(let Ge of se){let{x:tt,y:gt,z:at}=Ge.canonical,_t=gt===0,$t=gt===(1<<at)-1,[on,Ft,Xt,Ht]=mt.getPoleBuffers(at);if(Ht&&(_t||$t)){let En=Y.getTile(Ge);fe.activeTexture.set(he.TEXTURE0),En.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE);let jt=i.globePoleMatrixForTile(at,tt,ye),Xn=i.globeNormalizeECEF(i.globeTileBounds(Ge.canonical)),ui=(di,hi)=>di.draw(fe,he.TRIANGLES,De,i.StencilMode.disabled,ke,i.CullFaceMode.disabled,vd(ye.projMatrix,jt,jt,Xn,0,Fe,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,He,0),"globe_pole_raster",hi,Xt,Ht);H.setupElevationDraw(En,pe,Ze),G.prepareDrawProgram(fe,pe,Ge.toUnwrapped()),_t&&ui(pe,on),$t&&(jt=i.scale(i.create(),jt,[1,-1,1]),ui(pe,Ft))}}}})(x,D,k,R,z);else{let G=x.context,H=G.gl,Y,se,le=x.options.showTerrainWireframe?2:0,fe=(ye,_e)=>{if(se===ye)return;let Se=[cl[ye]];_e&&Se.push(cl[le]),Y=x.useProgram("terrainRaster",null,Se),se=ye},he=x.colorModeForRenderPass(),pe=new i.DepthMode(H.LEQUAL,i.DepthMode.ReadWrite,x.depthRangeFor3D);Qs.update(z);let Q=x.transform,ue=bd(Q.zoom)*D.exaggeration();(le?[!1,!0]:[!1]).forEach(ye=>{se=-1;let _e=ye?H.LINES:H.TRIANGLES,[Se,ke]=ye?D.getWirefameBuffer():[D.gridIndexBuffer,D.gridSegments];for(let De of R){let Be=k.getTile(De),Fe=i.StencilMode.disabled,Ve=D.prevTerrainTileForTile[De.key],mt=D.terrainTileForTile[De.key];Da(Ve,mt)&&Qs.newMorphing(De.key,Ve,mt,z,250),G.activeTexture.set(H.TEXTURE0),Be.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST);let He=Qs.getMorphValuesForProxy(De.key),it=He?1:0,Ze;He&&(Ze={morphing:{srcDemTile:He.from,dstDemTile:He.to,phase:i.easeCubicInOut(He.phase)}});let ut=oc(De.projMatrix,Fh(De.canonical,Q.renderWorldCopies)?ue/10:ue);fe(it,ye),D.setupElevationDraw(Be,Y,Ze),x.prepareDrawProgram(G,Y,De.toUnwrapped()),Y.draw(G,_e,pe,Fe,he,i.CullFaceMode.backCCW,ut,"terrain_raster",D.gridBuffer,Se,ke)}})}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;let d=this.painter,_=this.painter.context,x=this.proxySourceCache,D=this.proxiedCoords[x.id],k=this._drapedRenderBatches.shift(),R=[],z=d.style.order,G=0;for(let H of D){let Y=x.getTileByID(H.proxyTileKey),se=x.proxyCachedFBO[H.key]?x.proxyCachedFBO[H.key][l]:void 0,le=se!==void 0?x.renderCache[se]:this.pool[G++],fe=se!==void 0;if(Y.texture=le.tex,fe&&!le.dirty){R.push(Y.tileID);continue}let he;_.bindFramebuffer.set(le.fb.framebuffer),this.renderedToTile=!1,le.dirty&&(_.clear({color:i.Color.transparent,stencil:0}),le.dirty=!1);for(let pe=k.start;pe<=k.end;++pe){let Q=d.style._layers[z[pe]];if(Q.isHidden(d.transform.zoom))continue;let ue=d.style._getLayerSourceCache(Q),ye=ue?this.proxyToSource[H.key][ue.id]:[H];if(!ye)continue;let _e=ye;_.viewport.set([0,0,le.fb.width,le.fb.height]),he!==(ue?ue.id:null)&&(this._setupStencil(le,ye,Q,ue),he=ue?ue.id:null),d.renderLayer(d,ue,Q,_e)}this.renderedToTile?(le.dirty=!0,R.push(Y.tileID)):fe||--G,G===5&&(G=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),k.end+1}postRender(){}renderCacheEfficiency(l){let d=l.order.length;if(d===0)return{efficiency:100};let _,x=0,D=0,k=!1;for(let R=0;R<d;++R){let z=l._layers[l.order[R]];this._style.isLayerDraped(z)?(k&&++x,++D):k||(k=!0,_=z.id)}return D===0?{efficiency:100}:{efficiency:100*(1-x/D),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,_){if(!this._visibleDemTiles)return null;let x=this._visibleDemTiles.filter(D=>D.dem).map(D=>{let k=D.tileID,R=1<<k.overscaledZ,{x:z,y:G}=k.canonical,H=z/R,Y=(z+1)/R,se=G/R,le=(G+1)/R;return{minx:H,miny:se,maxx:Y,maxy:le,t:D.dem.tree.raycastRoot(H,se,Y,le,l,d,_),tile:D}});x.sort((D,k)=>(D.t!==null?D.t:Number.MAX_VALUE)-(k.t!==null?k.t:Number.MAX_VALUE));for(let D of x){if(D.t==null)return null;let k=D.tile.dem.tree.raycast(D.minx,D.miny,D.maxx,D.maxy,l,d,_);if(k!=null)return k}return null}_createFBO(){let l=this.painter.context,d=l.gl,_=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);let x=new i.Texture(l,{width:_[0],height:_[1],data:null},d.RGBA);x.bind(d.LINEAR,d.CLAMP_TO_EDGE);let D=l.createFramebuffer(_[0],_[1],!1);return D.colorAttachment.set(x.texture),D.depthAttachment=new Oe(l,D.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,D.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):D.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:D,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{let d=this._style._layers[l],_=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(let _ of this._style._getSources())if(_ instanceof Mt){l=!0;break}if(!l)return;let d={};for(let _=0;_<this._style.order.length;++_){let x=this._style._layers[this._style.order[_]],D=this._style._getLayerSourceCache(x);if(D&&!d[D.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof i.ZoomDependentExpression){d[D.id]=!0;for(let k of this.proxyCoords){let R=this.proxyToSource[k.key][D.id];if(R)for(let z of R)this._clearRenderCacheForTile(D.id,z)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(let _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof yt){l=!0;break}if(!l)return;let d={};for(let _=0;_<this._style.order.length;++_){let x=this._style._layers[this._style.order[_]],D=this._style._getLayerSourceCache(x);if(!D||d[D.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;let k=x.paint.get("raster-fade-duration");for(let R of this.proxyCoords){let z=this.proxyToSource[R.key][D.id];if(z)for(let G of z){let H=xd(D.getTile(G),D.findLoadedParent(G,0),D,this.painter.transform,k);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(D.id,G)}}}}_setupDrapedRenderBatches(){let l=this._style.order,d=l.length;if(d===0)return;let _=[],x,D=0,k=this._style._layers[l[D]];for(;!this._style.isLayerDraped(k)&&k.isHidden(this.painter.transform.zoom)&&++D<d;)k=this._style._layers[l[D]];for(;D<d;++D){let R=this._style._layers[l[D]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?x===void 0&&(x=D):x!==void 0&&(_.push({start:x,end:D-1}),x=void 0))}x!==void 0&&_.push({start:x,end:D-1}),this._drapedRenderBatches=_}_setupRenderCache(l){let d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){let k=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let R=0;R<k.length;++R){let z=Object.values(k[R]);d.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();let _=this.proxyCoords,x=this._tilesDirty;for(let k=_.length-1;k>=0;k--){let R=_[k];if(d.getTileByID(R.key),d.proxyCachedFBO[R.key]!==void 0){let z=l[R.key],G=this.proxyToSource[R.key],H=0;for(let Y in G){let se=G[Y],le=z[Y];if(!le||le.length!==se.length||se.some((fe,he)=>fe!==le[he]||x[Y]&&x[Y].hasOwnProperty(fe.key))){H=-1;break}++H}for(let Y in d.proxyCachedFBO[R.key])d.renderCache[d.proxyCachedFBO[R.key][Y]].dirty=H<0||H!==Object.values(z).length}}let D=[...this._drapedRenderBatches];D.sort((k,R)=>R.end-R.start-(k.end-k.start));for(let k of D)for(let R of _){if(d.proxyCachedFBO[R.key])continue;let z=d.renderCachePool.pop();z===void 0&&d.renderCache.length<50&&(z=d.renderCache.length,d.renderCache.push(this._createFBO())),z!==void 0&&(d.proxyCachedFBO[R.key]={},d.proxyCachedFBO[R.key][k.start]=z,d.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let D=this.painter.context,k=D.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let R;if(_.isTileClipped())R=d.length,this._overlapStencilMode.test={func:k.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:k.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(D.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):i.StencilMode.disabled}_renderTileClippingMasks(l,d){let _=this.painter,x=this.painter.context,D=x.gl;_._tileClippingMaskIDs={},x.setColorMode(i.ColorMode.disabled),x.setDepthMode(i.DepthMode.disabled);let k=_.useProgram("clippingMask");for(let R of l){let z=_._tileClippingMaskIDs[R.key]=--d;k.draw(x,D.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:D.ALWAYS,mask:0},z,255,D.KEEP,D.KEEP,D.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,bs(R.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){let d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;let _=[l.x,l.y,1,1];i.transformMat4$1(_,_,d.pixelMatrixInverse),i.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;let x=d._camera.position,D=i.mercatorZfromAltitude(1,d.center.lat),k=[x[0],x[1],x[2]/D,0],R=i.subtract([],_.slice(0,3),k);i.normalize(R,R);let z=this.raycast(k,R,this._exaggeration);return z!==null&&z?(i.scaleAndAdd(k,k,R,z),k[3]=k[2],k[2]*=D,k):null}drawDepth(){let l=this.painter,d=l.context,_=this.proxySourceCache,x=Math.ceil(l.width),D=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===D||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let k=d.gl,R=d.createFramebuffer(x,D,!0);d.activeTexture.set(k.TEXTURE0);let z=new i.Texture(d,{width:x,height:D,data:null},k.RGBA);z.bind(k.NEAREST,k.CLAMP_TO_EDGE),R.colorAttachment.set(z.texture);let G=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,x,D);R.depthAttachment.set(G),this._depthFBO=R,this._depthTexture=z}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,x,D]),function(k,R,z,G){if(k.transform.projection.name==="globe")return;let H=k.context,Y=H.gl;H.clear({depth:1});let se=k.useProgram("terrainDepth"),le=new i.DepthMode(Y.LESS,i.DepthMode.ReadWrite,k.depthRangeFor3D);for(let fe of G){let he=z.getTile(fe),pe=oc(fe.projMatrix,0);R.setupElevationDraw(he,se),se.draw(H,Y.TRIANGLES,le,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.backCCW,pe,"terrain_depth",R.gridBuffer,R.gridIndexBuffer,R.gridNoSkirtSegments)}}(l,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,d,_){if(l.getSource()instanceof Dn)return this._setupProxiedCoordsForImageSource(l,d,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};let x=this.proxiedCoords[l.id]=[],D=this.proxyCoords;for(let R=0;R<D.length;R++){let z=D[R],G=this._findTileCoveringTileID(z,l);if(G){let H=this._createProxiedId(z,G,_[z.key]&&_[z.key][l.id]);x.push(H),this.proxyToSource[z.key][l.id]=[H]}}let k=!1;for(let R=0;R<d.length;R++){let z=l.getTile(d[R]);if(!z||!z.hasData())continue;let G=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(G&&G.tileID.canonical.z!==z.tileID.canonical.z){let H=this.proxyToSource[G.tileID.key][l.id],Y=this._createProxiedId(G.tileID,z,_[G.tileID.key]&&_[G.tileID.key][l.id]);H?H.splice(H.length-1,0,Y):this.proxyToSource[G.tileID.key][l.id]=[Y],x.push(Y),k=!0}}this._sourceTilesOverlap[l.id]=k}_setupProxiedCoordsForImageSource(l,d,_){if(!l.getSource().loaded())return;let x=this.proxiedCoords[l.id]=[],D=this.proxyCoords,k=l.getSource(),R=new i.Point(k.tileID.x,k.tileID.y)._div(1<<k.tileID.z),z=k.coordinates.map(i.MercatorCoordinate.fromLngLat).reduce((H,Y)=>(H.min.x=Math.min(H.min.x,Y.x-R.x),H.min.y=Math.min(H.min.y,Y.y-R.y),H.max.x=Math.max(H.max.x,Y.x-R.x),H.max.y=Math.max(H.max.y,Y.y-R.y),H),{min:new i.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),G=(H,Y)=>{let se=H.wrap+H.canonical.x/(1<<H.canonical.z),le=H.canonical.y/(1<<H.canonical.z),fe=i.EXTENT/(1<<H.canonical.z),he=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),pe=Y.canonical.y/(1<<Y.canonical.z);return se+fe<he+z.min.x||se>he+z.max.x||le+fe<pe+z.min.y||le>pe+z.max.y};for(let H=0;H<D.length;H++){let Y=D[H];for(let se=0;se<d.length;se++){let le=l.getTile(d[se]);if(!le||!le.hasData()||G(Y,le.tileID))continue;let fe=this._createProxiedId(Y,le,_[Y.key]&&_[Y.key][l.id]),he=this.proxyToSource[Y.key][l.id];he?he.push(fe):this.proxyToSource[Y.key][l.id]=[fe],x.push(fe)}}}_createProxiedId(l,d,_){let x=this.orthoMatrix;if(_){let D=_.find(k=>k.key===d.tileID.key);if(D)return D}if(d.tileID.key!==l.key){let D=l.canonical.z-d.tileID.canonical.z,k,R,z;x=i.create();let G=d.tileID.wrap-l.wrap<<l.overscaledZ;D>0?(k=i.EXTENT>>D,R=k*((d.tileID.canonical.x<<D)-l.canonical.x+G),z=k*((d.tileID.canonical.y<<D)-l.canonical.y)):(k=i.EXTENT<<-D,R=i.EXTENT*(d.tileID.canonical.x-(l.canonical.x+G<<-D)),z=i.EXTENT*(d.tileID.canonical.y-(l.canonical.y<<-D))),i.ortho(x,0,k,0,k,0,1),i.translate(x,x,[R,z,0])}return new Cd(d.tileID,l.key,x)}_findTileCoveringTileID(l,d){let _=d.getTile(l);if(_&&_.hasData())return _;let x=this._findCoveringTileCache[d.id],D=x[l.key];if(_=D?d.getTileByID(D):null,_&&_.hasData()||D===null)return _;let k=_?_.tileID:l,R=k.overscaledZ,z=d.getSource().minzoom,G=[];if(!D){let Y=d.getSource().maxzoom;if(l.canonical.z>=Y){let se=l.canonical.z-Y;d.getSource().reparseOverscaled?(R=Math.max(l.canonical.z+2,d.transform.tileZoom),k=new i.OverscaledTileID(R,l.wrap,Y,l.canonical.x>>se,l.canonical.y>>se)):se!==0&&(R=Y,k=new i.OverscaledTileID(R,l.wrap,Y,l.canonical.x>>se,l.canonical.y>>se))}k.key!==l.key&&(G.push(k.key),_=d.getTile(k))}let H=Y=>{G.forEach(se=>{x[se]=Y}),G.length=0};for(R-=1;R>=z&&(!_||!_.hasData());R--){_&&H(_.tileID.key);let Y=k.calculateScaledKey(R);if(_=d.getTileByID(Y),_&&_.hasData())break;let se=x[Y];if(se===null)break;se===void 0?G.push(Y):_=d.getTileByID(se)}return H(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let l=function(d){let _=0,x=new i.StructArrayLayout2ui4,D=131;for(let k=1;k<129;k++){for(let R=1;R<129;R++)_=k*D+R,x.emplaceBack(_,_+1),x.emplaceBack(_,_+D),x.emplaceBack(_+1,_+D),k===128&&x.emplaceBack(_+D,_+D+1);x.emplaceBack(_+1,_+1+D)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=i.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Pn{static cacheKey(l,d,_,x){let D=`${d}${x?x.cacheKey:""}`;for(let k of _)l.usedDefines.includes(k)&&(D+=`/${k}`);return D}constructor(l,d,_,x,D,k){let R=l.gl;this.program=R.createProgram();let z=function(Q){let ue=[];for(let ye=0;ye<Q.length;ye++){if(Q[ye]===null)continue;let _e=Q[ye].split(" ");ue.push(_e.pop())}return ue}(_.staticAttributes),G=x?x.getBinderAttributes():[],H=z.concat(G),Y=x?x.defines():[];Y=Y.concat(k.map(Q=>`#define ${Q}`));let se=l.isWebGL2?`#version 300 es
`:"",le=se+Y.concat(l.extStandardDerivatives&&se.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(gd):gd,gd,uu,rc.fragmentSource,al.fragmentSource,_.fragmentSource).join(`
`),fe=se+Y.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,uu,rc.vertexSource,al.vertexSource,vs.vertexSource,_.vertexSource).join(`
`),he=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(he,le),R.compileShader(he),R.attachShader(this.program,he);let pe=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(pe,fe),R.compileShader(pe),R.attachShader(this.program,pe),this.attributes={},this.numAttributes=H.length;for(let Q=0;Q<this.numAttributes;Q++)H[Q]&&(R.bindAttribLocation(this.program,Q,H[Q]),this.attributes[H[Q]]=Q);R.linkProgram(this.program),R.deleteShader(pe),R.deleteShader(he),this.fixedUniforms=D(l),this.binderUniforms=x?x.getUniforms(l):[],k.includes("TERRAIN")&&(this.terrainUniforms=(Q=>({u_dem:new i.Uniform1i(Q),u_dem_prev:new i.Uniform1i(Q),u_dem_unpack:new i.Uniform4f(Q),u_dem_tl:new i.Uniform2f(Q),u_dem_scale:new i.Uniform1f(Q),u_dem_tl_prev:new i.Uniform2f(Q),u_dem_scale_prev:new i.Uniform1f(Q),u_dem_size:new i.Uniform1f(Q),u_dem_lerp:new i.Uniform1f(Q),u_exaggeration:new i.Uniform1f(Q),u_depth:new i.Uniform1i(Q),u_depth_size_inv:new i.Uniform2f(Q),u_meter_to_dem:new i.Uniform1f(Q),u_label_plane_matrix_inv:new i.UniformMatrix4f(Q)}))(l)),k.includes("GLOBE")&&(this.globeUniforms=(Q=>({u_tile_tl_up:new i.Uniform3f(Q),u_tile_tr_up:new i.Uniform3f(Q),u_tile_br_up:new i.Uniform3f(Q),u_tile_bl_up:new i.Uniform3f(Q),u_tile_up_scale:new i.Uniform1f(Q)}))(l)),k.includes("FOG")&&(this.fogUniforms=(Q=>({u_fog_matrix:new i.UniformMatrix4f(Q),u_fog_range:new i.Uniform2f(Q),u_fog_color:new i.Uniform4f(Q),u_fog_horizon_blend:new i.Uniform1f(Q),u_fog_temporal_offset:new i.Uniform1f(Q),u_frustum_tl:new i.Uniform3f(Q),u_frustum_tr:new i.Uniform3f(Q),u_frustum_br:new i.Uniform3f(Q),u_frustum_bl:new i.Uniform3f(Q),u_globe_pos:new i.Uniform3f(Q),u_globe_radius:new i.Uniform1f(Q),u_globe_transition:new i.Uniform1f(Q),u_is_globe:new i.Uniform1i(Q),u_viewport:new i.Uniform2f(Q)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;let _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in d)_[x]&&_[x].set(this.program,x,d[x])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;let _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in d)_[x]&&_[x].set(this.program,x,d[x])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;let _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let x in d)_[x].set(this.program,x,d[x])}}draw(l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he){let pe=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(x),l.setColorMode(D),l.setCullFace(k);for(let ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,R[ue]);fe&&fe.setUniforms(this.program,l,this.binderUniforms,se,{zoom:le});let Q={[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[d];for(let ue of Y.get()){let ye=ue.vaos||(ue.vaos={});(ye[z]||(ye[z]=new Ug)).bind(l,this,G,fe?fe.getPaintVertexBuffers():[],H,ue.vertexOffset,he||[]),pe.drawElements(d,ue.primitiveLength*Q,pe.UNSIGNED_SHORT,ue.primitiveOffset*Q*2)}}}function ul(m,l){let d=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,m.transform.tileZoom)/d,x=_*(l.tileID.canonical.x+l.tileID.wrap*d),D=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/vr(l,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,D>>16],u_pixel_coord_lower:[65535&x,65535&D]}}let hu=i.create(),sc=(m,l,d,_,x,D,k,R,z,G,H)=>{let Y=l.style.light,se=Y.properties.get("position"),le=[se.x,se.y,se.z],fe=i.create$1();Y.properties.get("anchor")==="viewport"&&(i.fromRotation(fe,-l.transform.angle),i.transformMat3(le,le,fe));let he=Y.properties.get("color"),pe=l.transform,Q={u_matrix:m,u_lightpos:le,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:D};return pe.projection.name==="globe"&&(Q.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Q.u_zoom_transition=z,Q.u_inv_rot_matrix=H,Q.u_merc_center=G,Q.u_up_dir=pe.projection.upVector(new i.CanonicalTileID(0,0,0),G[0]*i.EXTENT,G[1]*i.EXTENT),Q.u_height_lift=R),Q},vp=(m,l,d,_,x,D,k,R,z,G,H,Y)=>{let se=sc(m,l,d,_,x,D,k,z,G,H,Y),le={u_height_factor:-Math.pow(2,k.overscaledZ)/R.tileSize/8};return i.extend(se,ul(l,R),le)},Ta=m=>({u_matrix:m}),ac=(m,l,d)=>i.extend(Ta(m),ul(l,d)),dl=(m,l)=>({u_matrix:m,u_world:l}),$g=(m,l,d,_)=>i.extend(ac(m,l,d),{u_world:_}),hl=i.create(),zh=(m,l,d,_,x,D)=>{let k=m.transform,R=k.projection.name==="globe",z;if(D.paint.get("circle-pitch-alignment")==="map")if(R){let H=i.globePixelsToTileUnits(k.zoom,l.canonical)*k._pixelsPerMercatorPixel;z=Float32Array.from([H,0,0,H])}else z=k.calculatePixelsToTileUnitsMatrix(d);else z=new Float32Array([k.pixelsToGLUnits[0],0,0,k.pixelsToGLUnits[1]]);let G={u_camera_to_center_distance:k.cameraToCenterDistance,u_matrix:m.translatePosMatrix(l.projMatrix,d,D.paint.get("circle-translate"),D.paint.get("circle-translate-anchor")),u_device_pixel_ratio:i.exported.devicePixelRatio,u_extrude_scale:z,u_inv_rot_matrix:hl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){G.u_inv_rot_matrix=_,G.u_merc_center=x,G.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],G.u_zoom_transition=i.globeToMercatorTransition(k.zoom);let H=x[0]*i.EXTENT,Y=x[1]*i.EXTENT;G.u_up_dir=k.projection.upVector(new i.CanonicalTileID(0,0,0),H,Y)}return G},fl=m=>{let l=[];return m.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l},pl=(m,l,d,_)=>{let x=i.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},Dd=(m,l,d=1)=>({u_matrix:m,u_color:l,u_overlay:0,u_overlay_scale:d}),Td=i.create(),Md=(m,l,d,_,x,D,k)=>{let R=m.transform,z=R.projection.name==="globe",G=z?i.globePixelsToTileUnits(R.zoom,l.canonical)*R._pixelsPerMercatorPixel:vr(d,1,D),H={u_matrix:l.projMatrix,u_extrude_scale:G,u_intensity:k,u_inv_rot_matrix:Td,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){H.u_inv_rot_matrix=_,H.u_merc_center=x,H.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],H.u_zoom_transition=i.globeToMercatorTransition(R.zoom);let Y=x[0]*i.EXTENT,se=x[1]*i.EXTENT;H.u_up_dir=R.projection.upVector(new i.CanonicalTileID(0,0,0),Y,se)}return H},Hg=(m,l,d,_,x,D,k)=>{let R=m.transform,z=R.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:cc(m,l,d,_),u_pixels_to_tile_units:z,u_device_pixel_ratio:D,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:pu(d)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:lc(l,m.transform),u_alpha_discard_threshold:0,u_trim_offset:k}},fu=(m,l,d,_,x)=>{let D=m.transform;return{u_matrix:cc(m,l,d,_),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:lc(l,D),u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function lc(m,l){return 1/vr(m,1,l.tileZoom)}function cc(m,l,d,_){return m.translatePosMatrix(_||l.tileID.projMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function pu(m){let l=m.paint.get("line-dasharray").value;return l.value||l.kind!=="constant"}let Bh=(m,l,d,_,x,D)=>{return{u_matrix:m,u_tl_parent:l,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(R=x.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(k=x.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:Jr(x.paint.get("raster-hue-rotate")),u_perspective_transform:D};var k,R};function Jr(m){m*=Math.PI/180;let l=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}let Id=i.create(),Sd=(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he)=>{let pe=x.transform,Q={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:pe.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:pe.width/pe.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:k,u_coord_matrix:R,u_is_text:+z,u_pitch_with_map:+_,u_texsize:G,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Id,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Id,u_up_vector:[0,-1,0]};return he.name==="globe"&&(Q.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],Q.u_zoom_transition=Y,Q.u_inv_rot_matrix=le,Q.u_merc_center=se,Q.u_camera_forward=pe._camera.forward(),Q.u_ecef_origin=i.globeECEFOrigin(pe.globeMatrix,H.toUnwrapped()),Q.u_tile_matrix=Float32Array.from(pe.globeMatrix),Q.u_up_vector=fe),Q},Ad=(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he,pe)=>i.extend(Sd(m,l,d,_,x,D,k,R,z,G,Y,se,le,fe,he,pe),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.exported.devicePixelRatio,u_is_halo:+H}),bp=(m,l,d,_,x,D,k,R,z,G,H,Y,se,le,fe,he)=>i.extend(Ad(m,l,d,_,x,D,k,R,!0,z,!0,H,Y,se,le,fe,he),{u_texsize_icon:G,u_texture_icon:1}),Vh=(m,l,d)=>({u_matrix:m,u_opacity:l,u_color:d}),Gg=(m,l,d,_,x)=>i.extend(function(D,k,R){let z=k.imageManager.getPattern(D.toString()),{width:G,height:H}=k.imageManager.getPixelSize(),Y=Math.pow(2,R.tileID.overscaledZ),se=R.tileSize*Math.pow(2,k.transform.tileZoom)/Y,le=se*(R.tileID.canonical.x+R.tileID.wrap*Y),fe=se*R.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[G,H],u_pattern_size:z.displaySize,u_tile_units_to_pixels:1/vr(R,1,k.transform.tileZoom),u_pixel_coord_upper:[le>>16,fe>>16],u_pixel_coord_lower:[65535&le,65535&fe]}}(_,d,x),{u_matrix:m,u_opacity:l}),jh={fillExtrusion:m=>({u_matrix:new i.UniformMatrix4f(m),u_lightpos:new i.Uniform3f(m),u_lightintensity:new i.Uniform1f(m),u_lightcolor:new i.Uniform3f(m),u_vertical_gradient:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m),u_edge_radius:new i.Uniform1f(m),u_ao:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_up_dir:new i.Uniform3f(m),u_height_lift:new i.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_lightpos:new i.Uniform3f(m),u_lightintensity:new i.Uniform1f(m),u_lightcolor:new i.Uniform3f(m),u_vertical_gradient:new i.Uniform1f(m),u_height_factor:new i.Uniform1f(m),u_edge_radius:new i.Uniform1f(m),u_ao:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_up_dir:new i.Uniform3f(m),u_height_lift:new i.Uniform1f(m),u_image:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m)}),fill:m=>({u_matrix:new i.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_image:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m)}),fillOutline:m=>({u_matrix:new i.UniformMatrix4f(m),u_world:new i.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_world:new i.Uniform2f(m),u_image:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new i.Uniform1f(m),u_extrude_scale:new i.UniformMatrix2f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_up_dir:new i.Uniform3f(m)}),collisionBox:m=>({u_matrix:new i.UniformMatrix4f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_extrude_scale:new i.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new i.UniformMatrix4f(m),u_inv_matrix:new i.UniformMatrix4f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_viewport_size:new i.Uniform2f(m)}),debug:m=>({u_color:new i.UniformColor(m),u_matrix:new i.UniformMatrix4f(m),u_overlay:new i.Uniform1i(m),u_overlay_scale:new i.Uniform1f(m)}),clippingMask:m=>({u_matrix:new i.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new i.Uniform1f(m),u_intensity:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_up_dir:new i.Uniform3f(m)}),heatmapTexture:m=>({u_image:new i.Uniform1i(m),u_color_ramp:new i.Uniform1i(m),u_opacity:new i.Uniform1f(m)}),hillshade:m=>({u_matrix:new i.UniformMatrix4f(m),u_image:new i.Uniform1i(m),u_latrange:new i.Uniform2f(m),u_light:new i.Uniform2f(m),u_shadow:new i.UniformColor(m),u_highlight:new i.UniformColor(m),u_accent:new i.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new i.UniformMatrix4f(m),u_image:new i.Uniform1i(m),u_dimension:new i.Uniform2f(m),u_zoom:new i.Uniform1f(m),u_unpack:new i.Uniform4f(m)}),line:m=>({u_matrix:new i.UniformMatrix4f(m),u_pixels_to_tile_units:new i.UniformMatrix2f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_units_to_pixels:new i.Uniform2f(m),u_dash_image:new i.Uniform1i(m),u_gradient_image:new i.Uniform1i(m),u_image_height:new i.Uniform1f(m),u_texsize:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m),u_alpha_discard_threshold:new i.Uniform1f(m),u_trim_offset:new i.Uniform2f(m)}),linePattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_texsize:new i.Uniform2f(m),u_pixels_to_tile_units:new i.UniformMatrix2f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_image:new i.Uniform1i(m),u_units_to_pixels:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m),u_alpha_discard_threshold:new i.Uniform1f(m)}),raster:m=>({u_matrix:new i.UniformMatrix4f(m),u_tl_parent:new i.Uniform2f(m),u_scale_parent:new i.Uniform1f(m),u_fade_t:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m),u_image0:new i.Uniform1i(m),u_image1:new i.Uniform1i(m),u_brightness_low:new i.Uniform1f(m),u_brightness_high:new i.Uniform1f(m),u_saturation_factor:new i.Uniform1f(m),u_contrast_factor:new i.Uniform1f(m),u_spin_weights:new i.Uniform3f(m),u_perspective_transform:new i.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new i.Uniform1i(m),u_is_size_feature_constant:new i.Uniform1i(m),u_size_t:new i.Uniform1f(m),u_size:new i.Uniform1f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_rotate_symbol:new i.Uniform1i(m),u_aspect_ratio:new i.Uniform1f(m),u_fade_change:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_label_plane_matrix:new i.UniformMatrix4f(m),u_coord_matrix:new i.UniformMatrix4f(m),u_is_text:new i.Uniform1i(m),u_pitch_with_map:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_camera_forward:new i.Uniform3f(m),u_tile_matrix:new i.UniformMatrix4f(m),u_up_vector:new i.Uniform3f(m),u_ecef_origin:new i.Uniform3f(m),u_texture:new i.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new i.Uniform1i(m),u_is_size_feature_constant:new i.Uniform1i(m),u_size_t:new i.Uniform1f(m),u_size:new i.Uniform1f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_rotate_symbol:new i.Uniform1i(m),u_aspect_ratio:new i.Uniform1f(m),u_fade_change:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_label_plane_matrix:new i.UniformMatrix4f(m),u_coord_matrix:new i.UniformMatrix4f(m),u_is_text:new i.Uniform1i(m),u_pitch_with_map:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_texture:new i.Uniform1i(m),u_gamma_scale:new i.Uniform1f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_tile_id:new i.Uniform3f(m),u_zoom_transition:new i.Uniform1f(m),u_inv_rot_matrix:new i.UniformMatrix4f(m),u_merc_center:new i.Uniform2f(m),u_camera_forward:new i.Uniform3f(m),u_tile_matrix:new i.UniformMatrix4f(m),u_up_vector:new i.Uniform3f(m),u_ecef_origin:new i.Uniform3f(m),u_is_halo:new i.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new i.Uniform1i(m),u_is_size_feature_constant:new i.Uniform1i(m),u_size_t:new i.Uniform1f(m),u_size:new i.Uniform1f(m),u_camera_to_center_distance:new i.Uniform1f(m),u_rotate_symbol:new i.Uniform1i(m),u_aspect_ratio:new i.Uniform1f(m),u_fade_change:new i.Uniform1f(m),u_matrix:new i.UniformMatrix4f(m),u_label_plane_matrix:new i.UniformMatrix4f(m),u_coord_matrix:new i.UniformMatrix4f(m),u_is_text:new i.Uniform1i(m),u_pitch_with_map:new i.Uniform1i(m),u_texsize:new i.Uniform2f(m),u_texsize_icon:new i.Uniform2f(m),u_texture:new i.Uniform1i(m),u_texture_icon:new i.Uniform1i(m),u_gamma_scale:new i.Uniform1f(m),u_device_pixel_ratio:new i.Uniform1f(m),u_is_halo:new i.Uniform1i(m)}),background:m=>({u_matrix:new i.UniformMatrix4f(m),u_opacity:new i.Uniform1f(m),u_color:new i.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new i.UniformMatrix4f(m),u_opacity:new i.Uniform1f(m),u_image:new i.Uniform1i(m),u_pattern_tl:new i.Uniform2f(m),u_pattern_br:new i.Uniform2f(m),u_texsize:new i.Uniform2f(m),u_pattern_size:new i.Uniform2f(m),u_pixel_coord_upper:new i.Uniform2f(m),u_pixel_coord_lower:new i.Uniform2f(m),u_tile_units_to_pixels:new i.Uniform1f(m)}),terrainRaster:Lh,terrainDepth:Lh,skybox:m=>({u_matrix:new i.UniformMatrix4f(m),u_sun_direction:new i.Uniform3f(m),u_cubemap:new i.Uniform1i(m),u_opacity:new i.Uniform1f(m),u_temporal_offset:new i.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new i.UniformMatrix4f(m),u_color_ramp:new i.Uniform1i(m),u_center_direction:new i.Uniform3f(m),u_radius:new i.Uniform1f(m),u_opacity:new i.Uniform1f(m),u_temporal_offset:new i.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new i.UniformMatrix3f(m),u_sun_direction:new i.Uniform3f(m),u_sun_intensity:new i.Uniform1f(m),u_color_tint_r:new i.Uniform4f(m),u_color_tint_m:new i.Uniform4f(m),u_luminance:new i.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new i.UniformMatrix4f(m),u_globe_matrix:new i.UniformMatrix4f(m),u_normalize_matrix:new i.UniformMatrix4f(m),u_merc_matrix:new i.UniformMatrix4f(m),u_zoom_transition:new i.Uniform1f(m),u_merc_center:new i.Uniform2f(m),u_image0:new i.Uniform1i(m),u_grid_matrix:new i.UniformMatrix3f(m),u_skirt_height:new i.Uniform1f(m),u_frustum_tl:new i.Uniform3f(m),u_frustum_tr:new i.Uniform3f(m),u_frustum_br:new i.Uniform3f(m),u_frustum_bl:new i.Uniform3f(m),u_globe_pos:new i.Uniform3f(m),u_globe_radius:new i.Uniform1f(m),u_viewport:new i.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.Uniform3f(m),u_frustum_tr:new i.Uniform3f(m),u_frustum_br:new i.Uniform3f(m),u_frustum_bl:new i.Uniform3f(m),u_horizon:new i.Uniform1f(m),u_transition:new i.Uniform1f(m),u_fadeout_range:new i.Uniform1f(m),u_color:new i.Uniform4f(m),u_high_color:new i.Uniform4f(m),u_space_color:new i.Uniform4f(m),u_star_intensity:new i.Uniform1f(m),u_star_density:new i.Uniform1f(m),u_star_size:new i.Uniform1f(m),u_temporal_offset:new i.Uniform1f(m),u_horizon_angle:new i.Uniform1f(m),u_rotation_matrix:new i.UniformMatrix4f(m)})},mu;function gu(m,l,d,_,x,D,k){let R=m.context,z=R.gl,G=m.transform,H=m.useProgram("collisionBox"),Y=[],se=0,le=0;for(let _e=0;_e<_.length;_e++){let Se=_[_e],ke=l.getTile(Se),De=ke.getBucket(d);if(!De)continue;let Be=xo(Se,De,G),Fe=Be;x[0]===0&&x[1]===0||(Fe=m.translatePosMatrix(Be,ke,x,D));let Ve=k?De.textCollisionBox:De.iconCollisionBox,mt=De.collisionCircleArray;if(mt.length>0){let He=i.create(),it=Fe;i.mul(He,De.placementInvProjMatrix,G.glCoordMatrix),i.mul(He,He,De.placementViewportMatrix),Y.push({circleArray:mt,circleOffset:le,transform:it,invTransform:He,projection:De.getProjection()}),se+=mt.length/4,le=se}Ve&&(m.terrain&&m.terrain.setupElevationDraw(ke,H),H.draw(R,z.LINES,i.DepthMode.disabled,i.StencilMode.disabled,m.colorModeForRenderPass(),i.CullFaceMode.disabled,pl(Fe,G,ke,De.getProjection()),d.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,G.zoom,null,[Ve.collisionVertexBuffer,Ve.collisionVertexBufferExt]))}if(!k||!Y.length)return;let fe=m.useProgram("collisionCircle"),he=new i.StructArrayLayout2f1f2i16;he.resize(4*se),he._trim();let pe=0;for(let _e of Y)for(let Se=0;Se<_e.circleArray.length/4;Se++){let ke=4*Se,De=_e.circleArray[ke+0],Be=_e.circleArray[ke+1],Fe=_e.circleArray[ke+2],Ve=_e.circleArray[ke+3];he.emplace(pe++,De,Be,Fe,Ve,0),he.emplace(pe++,De,Be,Fe,Ve,1),he.emplace(pe++,De,Be,Fe,Ve,2),he.emplace(pe++,De,Be,Fe,Ve,3)}(!mu||mu.length<2*se)&&(mu=function(_e){let Se=2*_e,ke=new i.StructArrayLayout3ui6;ke.resize(Se),ke._trim();for(let De=0;De<Se;De++){let Be=6*De;ke.uint16[Be+0]=4*De+0,ke.uint16[Be+1]=4*De+1,ke.uint16[Be+2]=4*De+2,ke.uint16[Be+3]=4*De+2,ke.uint16[Be+4]=4*De+3,ke.uint16[Be+5]=4*De+0}return ke}(se));let Q=R.createIndexBuffer(mu,!0),ue=R.createVertexBuffer(he,i.collisionCircleLayout.members,!0);for(let _e of Y){let Se={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ye=G).getCameraToCenterDistance(_e.projection),u_viewport_size:[ye.width,ye.height]};fe.draw(R,z.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,m.colorModeForRenderPass(),i.CullFaceMode.disabled,Se,d.id,ue,Q,i.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,G.zoom)}var ye;ue.destroy(),Q.destroy()}let uc=i.create();function Js({width:m,height:l,anchor:d,textOffset:_,textScale:x},D){let{horizontalAlign:k,verticalAlign:R}=i.getAnchorAlignment(d),z=-(k-.5)*m,G=-(R-.5)*l,H=i.evaluateVariableOffset(d,_);return new i.Point((z/x+H[0])*D,(G/x+H[1])*D)}function Wg(m,l,d,_,x,D,k,R,z,G,H){let Y=m.text.placedSymbolArray,se=m.text.dynamicLayoutVertexArray,le=m.icon.dynamicLayoutVertexArray,fe={},he=m.getProjection(),pe=Ti(R,he,D),Q=D.elevation,ue=he.upVectorScale(R.canonical,D.center.lat,D.worldSize).metersToTile;se.clear();for(let ye=0;ye<Y.length;ye++){let _e=Y.get(ye),{tileAnchorX:Se,tileAnchorY:ke,numGlyphs:De}=_e,Be=_e.hidden||!_e.crossTileID||m.allowVerticalPlacement&&!_e.placedOrientation?null:_[_e.crossTileID];if(Be){let Fe=0,Ve=0,mt=0;if(Q){let _t=Q?Q.getAtTileOffset(R,Se,ke):0,[$t,on,Ft]=he.upVector(R.canonical,Se,ke);Fe=_t*$t*ue,Ve=_t*on*ue,mt=_t*Ft*ue}let[He,it,Ze,ut]=Sr(_e.projectedAnchorX+Fe,_e.projectedAnchorY+Ve,_e.projectedAnchorZ+mt,d?pe:k),Ge=eu(D.getCameraToCenterDistance(he),ut),tt=x.evaluateSizeForFeature(m.textSizeData,G,_e)*Ge/i.ONE_EM;d&&(tt*=m.tilePixelRatio/z);let gt=Js(Be,tt);d?({x:He,y:it,z:Ze}=he.projectTilePoint(Se+gt.x,ke+gt.y,R.canonical),[He,it,Ze]=Sr(He+Fe,it+Ve,Ze+mt,k)):(l&&gt._rotate(-D.angle),He+=gt.x,it+=gt.y,Ze=0);let at=m.allowVerticalPlacement&&_e.placedOrientation===i.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<De;_t++)i.addDynamicAttributes(se,He,it,Ze,at);H&&_e.associatedIconIndex>=0&&(fe[_e.associatedIconIndex]={x:He,y:it,z:Ze,angle:at})}else Xo(De,se)}if(H){le.clear();let ye=m.icon.placedSymbolArray;for(let _e=0;_e<ye.length;_e++){let Se=ye.get(_e),{numGlyphs:ke}=Se,De=fe[_e];if(Se.hidden||!De)Xo(ke,le);else{let{x:Be,y:Fe,z:Ve,angle:mt}=De;for(let He=0;He<ke;He++)i.addDynamicAttributes(le,Be,Fe,Ve,mt)}}m.icon.dynamicLayoutVertexBuffer.updateData(le)}m.text.dynamicLayoutVertexBuffer.updateData(se)}function Uh(m,l,d){return d.iconsInText&&l?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function xp(m,l,d,_,x,D,k,R,z,G,H,Y){let se=m.context,le=se.gl,fe=m.transform,he=R==="map",pe=z==="map",Q=he&&d.layout.get("symbol-placement")!=="point",ue=he&&!pe&&!Q,ye=d.layout.get("symbol-sort-key").constantOr(1)!==void 0,_e=!1,Se=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),ke=[i.mercatorXfromLng(fe.center.lng),i.mercatorYfromLat(fe.center.lat)],De=d.layout.get("text-variable-anchor"),Be=fe.projection.name==="globe",Fe=[],Ve=[0,-1,0],mt=Ve;!Be&&!fe.mercatorFromTransition||he||(mt=function(He){let it=He._camera.getWorldToCamera(He.worldSize,1),Ze=i.multiply([],it,He.globeMatrix);i.invert(Ze,Ze);let ut=[0,0,0],Ge=[0,1,0,0];return i.transformMat4$1(Ge,Ge,Ze),ut[0]=Ge[0],ut[1]=Ge[1],ut[2]=Ge[2],i.normalize(ut,ut),ut}(fe));for(let He of _){let it=l.getTile(He),Ze=it.getBucket(d);if(!Ze||Ze.projection.name==="mercator"&&Be)continue;let ut=x?Ze.text:Ze.icon;if(!ut||Ze.fullyClipped||!ut.segments.get().length)continue;let Ge=ut.programConfigurations.get(d.id),tt=x||Ze.sdfIcons,gt=x?Ze.textSizeData:Ze.iconSizeData,at=pe||fe.pitch!==0,_t=i.evaluateSizeForZoom(gt,fe.zoom),$t,on,Ft,Xt,Ht=[0,0],En=null;if(x)on=it.glyphAtlasTexture,Ft=le.LINEAR,$t=it.glyphAtlasTexture.size,Ze.iconsInText&&(Ht=it.imageAtlasTexture.size,En=it.imageAtlasTexture,Xt=at||m.options.rotating||m.options.zooming||gt.kind==="composite"||gt.kind==="camera"?le.LINEAR:le.NEAREST);else{let ta=d.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;on=it.imageAtlasTexture,Ft=tt||m.options.rotating||m.options.zooming||ta||at?le.LINEAR:le.NEAREST,$t=it.imageAtlasTexture.size}let jt=Ze.projection.name==="globe",Xn=jt?mt:Ve,ui=jt?i.globeToMercatorTransition(fe.zoom):0,di=Ti(He,Ze.getProjection(),fe),hi=fe.calculatePixelsToTileUnitsMatrix(it),ar=Je(di,it.tileID.canonical,pe,he,fe,Ze.getProjection(),hi),pr=m.terrain&&pe&&Q?i.invert(i.create(),ar):uc,Co=sr(di,it.tileID.canonical,pe,he,fe,Ze.getProjection(),hi),Jo=De&&Ze.hasTextData(),Ii=d.layout.get("icon-text-fit")!=="none"&&Jo&&Ze.hasIconData();if(Q){let ta=fe.elevation,na=ta?ta.getAtTileOffsetFunc(He,fe.center.lat,fe.worldSize,Ze.getProjection()):null,ka=Zs(di,it.tileID.canonical,pe,he,fe,Ze.getProjection(),hi);pd(Ze,di,m,x,ka,Co,pe,G,na,He)}let fi=Q||x&&De||Ii,rn=m.translatePosMatrix(di,it,D,k),lr=fi?uc:ar,eo=m.translatePosMatrix(Co,it,D,k,!0),bi=Ze.getProjection().createInversionMatrix(fe,He.canonical),Lr=[];m.terrainRenderModeElevated()&&pe&&Lr.push("PITCH_WITH_MAP_TERRAIN"),jt&&Lr.push("PROJECTION_GLOBE_VIEW"),fi&&Lr.push("PROJECTED_POS_ON_VIEWPORT");let ea=tt&&d.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Dl;Dl=tt?Ze.iconsInText?bp(gt.kind,_t,ue,pe,m,rn,lr,eo,$t,Ht,He,ui,ke,bi,Xn,Ze.getProjection()):Ad(gt.kind,_t,ue,pe,m,rn,lr,eo,x,$t,!0,He,ui,ke,bi,Xn,Ze.getProjection()):Sd(gt.kind,_t,ue,pe,m,rn,lr,eo,x,$t,He,ui,ke,bi,Xn,Ze.getProjection());let gi={program:m.useProgram(Uh(tt,x,Ze),Ge,Lr),buffers:ut,uniformValues:Dl,atlasTexture:on,atlasTextureIcon:En,atlasInterpolation:Ft,atlasInterpolationIcon:Xt,isSDF:tt,hasHalo:ea,tile:it,labelPlaneMatrixInv:pr};if(ye&&Ze.canOverlap){_e=!0;let ta=ut.segments.get();for(let na of ta)Fe.push({segments:new i.SegmentVector([na]),sortKey:na.sortKey,state:gi})}else Fe.push({segments:ut.segments,sortKey:0,state:gi})}_e&&Fe.sort((He,it)=>He.sortKey-it.sortKey);for(let He of Fe){let it=He.state;if(m.terrain&&m.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:!Be,labelPlaneMatrixInv:it.labelPlaneMatrixInv}),se.activeTexture.set(le.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,le.CLAMP_TO_EDGE),it.atlasTextureIcon&&(se.activeTexture.set(le.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),it.isSDF){let Ze=it.uniformValues;it.hasHalo&&(Ze.u_is_halo=1,yu(it.buffers,He.segments,d,m,it.program,Se,H,Y,Ze)),Ze.u_is_halo=0}yu(it.buffers,He.segments,d,m,it.program,Se,H,Y,it.uniformValues)}}function yu(m,l,d,_,x,D,k,R,z){let G=_.context,H=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];x.draw(G,G.gl.TRIANGLES,D,k,R,i.CullFaceMode.disabled,z,d.id,m.layoutVertexBuffer,m.indexBuffer,l,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),H)}function wp(m,l,d,_,x,D,k){let R=m.context.gl,z=d.paint.get("fill-pattern"),G=z&&z.constantOr(1),H,Y,se,le,fe;k?(Y=G&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=R.LINES):(Y=G?"fillPattern":"fill",H=R.TRIANGLES);for(let he of _){let pe=l.getTile(he);if(G&&!pe.patternsLoaded())continue;let Q=pe.getBucket(d);if(!Q)continue;m.prepareDrawTile();let ue=Q.programConfigurations.get(d.id),ye=m.useProgram(Y,ue);G&&(m.context.activeTexture.set(R.TEXTURE0),pe.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ue.updatePaintBuffers());let _e=z.constantOr(null);if(_e&&pe.imageAtlas){let ke=pe.imageAtlas.patternPositions[_e.toString()];ke&&ue.setConstantPatternPositions(ke)}let Se=m.translatePosMatrix(he.projMatrix,pe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(k){le=Q.indexBuffer2,fe=Q.segments2;let ke=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];se=Y==="fillOutlinePattern"&&G?$g(Se,m,pe,ke):dl(Se,ke)}else le=Q.indexBuffer,fe=Q.segments,se=G?ac(Se,m,pe):Ta(Se);m.prepareDrawProgram(m.context,ye,he.toUnwrapped()),ye.draw(m.context,H,x,m.stencilModeForClipping(he),D,i.CullFaceMode.disabled,se,d.id,Q.layoutVertexBuffer,le,fe,d.paint,m.transform.zoom,ue)}}function ml(m,l,d,_,x,D,k){let R=m.context,z=R.gl,G=m.transform,H=d.paint.get("fill-extrusion-pattern"),Y=H.constantOr(1),se=d.paint.get("fill-extrusion-opacity"),le=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],fe=d.layout.get("fill-extrusion-edge-radius"),he=fe>0&&!d.paint.get("fill-extrusion-rounded-roof"),pe=he?0:fe,Q=G.projection.name==="globe"?i.fillExtrusionHeightLift():0,ue=G.projection.name==="globe",ye=ue?i.globeToMercatorTransition(G.zoom):0,_e=[i.mercatorXfromLng(G.center.lng),i.mercatorYfromLat(G.center.lat)],Se=[];ue&&Se.push("PROJECTION_GLOBE_VIEW"),le[0]>0&&Se.push("FAUX_AO"),he&&Se.push("ZERO_ROOF_RADIUS");for(let ke of _){let De=l.getTile(ke),Be=De.getBucket(d);if(!Be||Be.projection.name!==G.projection.name)continue;let Fe=Be.programConfigurations.get(d.id),Ve=m.useProgram(Y?"fillExtrusionPattern":"fillExtrusion",Fe,Se);if(m.terrain){let tt=m.terrain;if(m.style.terrainSetForDrapingOnly())tt.setupElevationDraw(De,Ve,{useMeterToDem:!0});else{if(!Be.enableTerrain)continue;if(tt.setupElevationDraw(De,Ve,{useMeterToDem:!0}),kd(R,l,ke,Be,d,tt),!Be.centroidVertexBuffer){let gt=Ve.attributes.a_centroid_pos;gt!==void 0&&z.vertexAttrib2f(gt,0,0)}}}Y&&(m.context.activeTexture.set(z.TEXTURE0),De.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Fe.updatePaintBuffers());let mt=H.constantOr(null);if(mt&&De.imageAtlas){let tt=De.imageAtlas.patternPositions[mt.toString()];tt&&Fe.setConstantPatternPositions(tt)}let He=m.translatePosMatrix(ke.projMatrix,De,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),it=G.projection.createInversionMatrix(G,ke.canonical),Ze=d.paint.get("fill-extrusion-vertical-gradient"),ut=Y?vp(He,m,Ze,se,le,pe,ke,De,Q,ye,_e,it):sc(He,m,Ze,se,le,pe,ke,Q,ye,_e,it);m.prepareDrawProgram(R,Ve,ke.toUnwrapped());let Ge=[];m.terrain&&Ge.push(Be.centroidVertexBuffer),ue&&Ge.push(Be.layoutVertexExtBuffer),Ve.draw(R,R.gl.TRIANGLES,x,D,k,i.CullFaceMode.backCCW,ut,d.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,d.paint,m.transform.zoom,Fe,Ge)}}function kd(m,l,d,_,x,D){let k=[Q=>{let ue=Q.canonical.x-1,ye=Q.wrap;return ue<0&&(ue=(1<<Q.canonical.z)-1,ye--),new i.OverscaledTileID(Q.overscaledZ,ye,Q.canonical.z,ue,Q.canonical.y)},Q=>{let ue=Q.canonical.x+1,ye=Q.wrap;return ue===1<<Q.canonical.z&&(ue=0,ye++),new i.OverscaledTileID(Q.overscaledZ,ye,Q.canonical.z,ue,Q.canonical.y)},Q=>new i.OverscaledTileID(Q.overscaledZ,Q.wrap,Q.canonical.z,Q.canonical.x,(Q.canonical.y===0?1<<Q.canonical.z:Q.canonical.y)-1),Q=>new i.OverscaledTileID(Q.overscaledZ,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y===(1<<Q.canonical.z)-1?0:Q.canonical.y+1)],R=Q=>{let ue=l.getSource().minzoom,ye=Se=>{let ke=l.getTileByID(Se);if(ke&&ke.hasData())return ke.getBucket(x)},_e=[0,-1,1];for(let Se of _e){if(Q.overscaledZ+Se<ue)continue;let ke=ye(Q.calculateScaledKey(Q.overscaledZ+Se));if(ke)return ke}},z=[0,0,0],G=(Q,ue)=>(z[0]=Math.min(Q.min.y,ue.min.y),z[1]=Math.max(Q.max.y,ue.max.y),z[2]=i.EXTENT-ue.min.x>Q.max.x?ue.min.x-i.EXTENT:Q.max.x,z),H=(Q,ue)=>(z[0]=Math.min(Q.min.x,ue.min.x),z[1]=Math.max(Q.max.x,ue.max.x),z[2]=i.EXTENT-ue.min.y>Q.max.y?ue.min.y-i.EXTENT:Q.max.y,z),Y=[(Q,ue)=>G(Q,ue),(Q,ue)=>G(ue,Q),(Q,ue)=>H(Q,ue),(Q,ue)=>H(ue,Q)],se=new i.Point(0,0),le,fe,he,pe=(Q,ue,ye,_e,Se)=>{let ke=[[_e?ye:Q,_e?Q:ye,0],[_e?ye:ue,_e?ue:ye,0]],De=Se<0?i.EXTENT+Se:Se,Be=[_e?De:(Q+ue)/2,_e?(Q+ue)/2:De,0];return ye===0&&Se<0||ye!==0&&Se>0?D.getForTilePoints(he,[Be],!0,fe):ke.push(Be),D.getForTilePoints(d,ke,!0,le),Math.max(ke[0][2],ke[1][2],Be[2])/D.exaggeration()};for(let Q=0;Q<4;Q++){let ue=(Q<2?1:5)-Q,ye=_.borders[Q];if(ye.length===0)continue;let _e=he=k[Q](d),Se=R(_e);if(!(Se&&Se instanceof i.FillExtrusionBucket&&Se.enableTerrain)||_.borderDoneWithNeighborZ[Q]===Se.canonical.z&&Se.borderDoneWithNeighborZ[ue]===_.canonical.z||(fe=D.findDEMTileFor(_e),!fe||!fe.dem))continue;if(!le){let Fe=D.findDEMTileFor(d);if(!Fe||!Fe.dem)return;le=Fe}let ke=Se.borders[ue],De=0,Be=Se.borderDoneWithNeighborZ[ue]!==_.canonical.z;if(_.canonical.z===Se.canonical.z){for(let Fe=0;Fe<ye.length;Fe++){let Ve=_.featuresOnBorder[ye[Fe]],mt=Ve.borders[Q],He;for(;De<ke.length&&(He=Se.featuresOnBorder[ke[De]],!(He.borders[ue][1]>mt[0]+3));)Be&&Se.encodeCentroid(void 0,He,!1),De++;if(He&&De<ke.length){let it=De,Ze=0;for(;!(He.borders[ue][0]>mt[1]-3)&&(Ze++,++De!==ke.length);)He=Se.featuresOnBorder[ke[De]];if(He=Se.featuresOnBorder[ke[it]],Ve.intersectsCount()>1||He.intersectsCount()>1||Ze!==1){Ze!==1&&(De=it),_.encodeCentroid(void 0,Ve,!1),Be&&Se.encodeCentroid(void 0,He,!1);continue}let ut=Y[Q](Ve,He),Ge=Q%2?i.EXTENT-1:0;se.x=pe(ut[0],Math.min(i.EXTENT-1,ut[1]),Ge,Q<2,ut[2]),se.y=0,_.encodeCentroid(se,Ve,!1),Be&&Se.encodeCentroid(se,He,!1)}else _.encodeCentroid(void 0,Ve,!1)}_.borderDoneWithNeighborZ[Q]=Se.canonical.z,_.needsCentroidUpdate=!0,Be&&(Se.borderDoneWithNeighborZ[ue]=_.canonical.z,Se.needsCentroidUpdate=!0)}else{for(let Fe of ye)_.encodeCentroid(void 0,_.featuresOnBorder[Fe],!1);if(Be){for(let Fe of ke)Se.encodeCentroid(void 0,Se.featuresOnBorder[Fe],!1);Se.borderDoneWithNeighborZ[ue]=_.canonical.z,Se.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Q]=Se.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(m)}let dc=new i.Color(1,0,0,1),Rd=new i.Color(0,1,0,1),$h=new i.Color(0,0,1,1),qg=new i.Color(1,0,1,1),Ep=new i.Color(0,1,1,1);function _u(m,l,d){let _=m.context,x=m.transform,D=_.gl,k=x.projection.name==="globe",R=k?["PROJECTION_GLOBE_VIEW"]:null,z=d.projMatrix;if(k&&i.globeToMercatorTransition(x.zoom)>0){let Ve=i.transitionTileAABBinECEF(d.canonical,x),mt=i.globeDenormalizeECEF(Ve);z=i.multiply(new Float32Array(16),x.globeMatrix,mt),i.multiply(z,x.projMatrix,z)}let G=m.useProgram("debug",null,R),H=l.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(H,G);let Y=i.DepthMode.disabled,se=i.StencilMode.disabled,le=m.colorModeForRenderPass(),fe="$debug";_.activeTexture.set(D.TEXTURE0),m.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),k?H._makeGlobeTileDebugBuffers(m.context,x):H._makeDebugTileBoundsBuffers(m.context,x.projection);let he=H._tileDebugBuffer||m.debugBuffer,pe=H._tileDebugIndexBuffer||m.debugIndexBuffer,Q=H._tileDebugSegments||m.debugSegments;G.draw(_,D.LINE_STRIP,Y,se,le,i.CullFaceMode.disabled,Dd(z,i.Color.red),fe,he,pe,Q,null,null,null,[H._globeTileDebugBorderBuffer]);let ue=H.latestRawTileData,ye=Math.floor((ue&&ue.byteLength||0)/1024),_e=l.getTile(d).tileSize,Se=512/Math.min(_e,512)*(d.overscaledZ/x.zoom)*.5,ke=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ke+=` => ${d.overscaledZ}`),ke+=` ${ye}kb`,function(Ve,mt){Ve.initDebugOverlayCanvas();let He=Ve.debugOverlayCanvas,it=Ve.context.gl,Ze=Ve.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,He.width,He.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(mt,5,5),Ze.strokeText(mt,5,5),Ve.debugOverlayTexture.update(He),Ve.debugOverlayTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE)}(m,ke);let De=H._tileDebugTextBuffer||m.debugBuffer,Be=H._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Fe=H._tileDebugTextSegments||m.debugSegments;G.draw(_,D.TRIANGLES,Y,se,i.ColorMode.alphaBlended,i.CullFaceMode.disabled,Dd(z,i.Color.transparent,Se),fe,De,Be,Fe,null,null,null,[H._globeTileDebugTextBuffer])}function Cp(m,l,d,_){hc(m,0,l+d/2,m.transform.width,d,_)}function gl(m,l,d,_){hc(m,l-d/2,0,d,m.transform.height,_)}function hc(m,l,d,_,x,D){let k=m.context,R=k.gl;R.enable(R.SCISSOR_TEST),R.scissor(l*i.exported.devicePixelRatio,d*i.exported.devicePixelRatio,_*i.exported.devicePixelRatio,x*i.exported.devicePixelRatio),k.clear({color:D}),R.disable(R.SCISSOR_TEST)}let Dp=i.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ro}=Dp;function ao(m,l,d,_){m.emplaceBack(l,d,_)}class Pd{constructor(l){this.vertexArray=new i.StructArrayLayout3f12,this.indices=new i.StructArrayLayout3ui6,ao(this.vertexArray,-1,-1,1),ao(this.vertexArray,1,-1,1),ao(this.vertexArray,-1,1,1),ao(this.vertexArray,1,1,1),ao(this.vertexArray,-1,-1,-1),ao(this.vertexArray,1,-1,-1),ao(this.vertexArray,-1,1,-1),ao(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Ro),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=i.SegmentVector.simpleSegment(0,0,36,12)}}function Eo(m,l,d,_,x,D){let k=m.gl,R=l.paint.get("sky-atmosphere-color"),z=l.paint.get("sky-atmosphere-halo-color"),G=l.paint.get("sky-atmosphere-sun-intensity"),H=((Y,se,le,fe,he)=>({u_matrix_3f:Y,u_sun_direction:se,u_sun_intensity:le,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[he.r,he.g,he.b,he.a],u_luminance:5e-5}))(i.fromMat4(i.create$1(),_),x,G,R,z);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+D,l.skyboxTexture,0),d.draw(m,k.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,i.ColorMode.unblended,i.CullFaceMode.frontCW,H,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}let vu=i.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Od{constructor(l){let d=new i.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);let _=new i.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,vu.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=i.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let yl={symbol:function(m,l,d,_,x){if(m.renderPass!=="translucent")return;let D=i.StencilMode.disabled,k=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(R,z,G,H,Y,se,le){let fe=z.transform,he=Y==="map",pe=se==="map";for(let Q of R){let ue=H.getTile(Q),ye=ue.getBucket(G);if(!ye||!ye.text||!ye.text.segments.get().length)continue;let _e=i.evaluateSizeForZoom(ye.textSizeData,fe.zoom),Se=Ti(Q,ye.getProjection(),fe),ke=fe.calculatePixelsToTileUnitsMatrix(ue),De=Je(Se,ue.tileID.canonical,pe,he,fe,ye.getProjection(),ke),Be=G.layout.get("icon-text-fit")!=="none"&&ye.hasIconData();if(_e){let Fe=Math.pow(2,fe.zoom-ue.tileID.overscaledZ);Wg(ye,he,pe,le,i.symbolSize,fe,De,Q,Fe,_e,Be)}}}(_,m,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),x),d.paint.get("icon-opacity").constantOr(1)!==0&&xp(m,l,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),D,k),d.paint.get("text-opacity").constantOr(1)!==0&&xp(m,l,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),D,k),l.map.showCollisionBoxes&&(gu(m,l,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),gu(m,l,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,l,d,_){if(m.renderPass!=="translucent")return;let x=d.paint.get("circle-opacity"),D=d.paint.get("circle-stroke-width"),k=d.paint.get("circle-stroke-opacity"),R=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(D.constantOr(1)===0||k.constantOr(1)===0))return;let z=m.context,G=z.gl,H=m.transform,Y=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),se=i.StencilMode.disabled,le=m.colorModeForRenderPass(),fe=H.projection.name==="globe",he=[i.mercatorXfromLng(H.center.lng),i.mercatorYfromLat(H.center.lat)],pe=[];for(let ue=0;ue<_.length;ue++){let ye=_[ue],_e=l.getTile(ye),Se=_e.getBucket(d);if(!Se||Se.projection.name!==H.projection.name)continue;let ke=Se.programConfigurations.get(d.id),De=fl(d);fe&&De.push("PROJECTION_GLOBE_VIEW");let Be=m.useProgram("circle",ke,De),Fe=Se.layoutVertexBuffer,Ve=Se.globeExtVertexBuffer,mt=Se.indexBuffer,He=H.projection.createInversionMatrix(H,ye.canonical),it={programConfiguration:ke,program:Be,layoutVertexBuffer:Fe,globeExtVertexBuffer:Ve,indexBuffer:mt,uniformValues:zh(m,ye,_e,He,he,d),tile:_e};if(R){let Ze=Se.segments.get();for(let ut of Ze)pe.push({segments:new i.SegmentVector([ut]),sortKey:ut.sortKey,state:it})}else pe.push({segments:Se.segments,sortKey:0,state:it})}R&&pe.sort((ue,ye)=>ue.sortKey-ye.sortKey);let Q={useDepthForOcclusion:!fe};for(let ue of pe){let{programConfiguration:ye,program:_e,layoutVertexBuffer:Se,globeExtVertexBuffer:ke,indexBuffer:De,uniformValues:Be,tile:Fe}=ue.state,Ve=ue.segments;m.terrain&&m.terrain.setupElevationDraw(Fe,_e,Q),m.prepareDrawProgram(z,_e,Fe.tileID.toUnwrapped()),_e.draw(z,G.TRIANGLES,Y,se,le,i.CullFaceMode.disabled,Be,d.id,Se,De,Ve,d.paint,H.zoom,ye,[ke])}},heatmap:function(m,l,d,_){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let x=m.context,D=x.gl,k=i.StencilMode.disabled,R=new i.ColorMode([D.ONE,D.ONE],i.Color.transparent,[!0,!0,!0,!0]);(function(le,fe,he,pe){let Q=le.gl,ue=fe.width*pe,ye=fe.height*pe;le.activeTexture.set(Q.TEXTURE1),le.viewport.set([0,0,ue,ye]);let _e=he.heatmapFbo;if(!_e||_e&&(_e.width!==ue||_e.height!==ye)){_e&&_e.destroy();let Se=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,Se),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),_e=he.heatmapFbo=le.createFramebuffer(ue,ye,!1),function(ke,De,Be,Fe,Ve,mt){let He=ke.gl;He.texImage2D(He.TEXTURE_2D,0,ke.isWebGL2&&ke.extRenderToTextureHalfFloat?He.RGBA16F:He.RGBA,Ve,mt,0,He.RGBA,ke.extRenderToTextureHalfFloat?ke.isWebGL2?He.HALF_FLOAT:ke.extTextureHalfFloat.HALF_FLOAT_OES:He.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Be)}(le,0,Se,_e,ue,ye)}else Q.bindTexture(Q.TEXTURE_2D,_e.colorAttachment.get()),le.bindFramebuffer.set(_e.framebuffer)})(x,m,d,m.transform.projection.name==="globe"?.5:.25),x.clear({color:i.Color.transparent});let z=m.transform,G=z.projection.name==="globe",H=G?["PROJECTION_GLOBE_VIEW"]:null,Y=G?i.CullFaceMode.frontCCW:i.CullFaceMode.disabled,se=[i.mercatorXfromLng(z.center.lng),i.mercatorYfromLat(z.center.lat)];for(let le=0;le<_.length;le++){let fe=_[le];if(l.hasRenderableParent(fe))continue;let he=l.getTile(fe),pe=he.getBucket(d);if(!pe||pe.projection.name!==z.projection.name)continue;let Q=pe.programConfigurations.get(d.id),ue=m.useProgram("heatmap",Q,H),{zoom:ye}=m.transform;m.terrain&&m.terrain.setupElevationDraw(he,ue),m.prepareDrawProgram(x,ue,fe.toUnwrapped());let _e=z.projection.createInversionMatrix(z,fe.canonical);ue.draw(x,D.TRIANGLES,i.DepthMode.disabled,k,R,Y,Md(m,fe,he,_e,se,ye,d.paint.get("heatmap-intensity")),d.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,d.paint,m.transform.zoom,Q,G?[pe.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,D){let k=x.context,R=k.gl,z=D.heatmapFbo;if(!z)return;k.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get()),k.activeTexture.set(R.TEXTURE1);let G=D.colorRampTexture;G||(G=D.colorRampTexture=new i.Texture(k,D.colorRamp,R.RGBA)),G.bind(R.LINEAR,R.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(k,R.TRIANGLES,i.DepthMode.disabled,i.StencilMode.disabled,x.colorModeForRenderPass(),i.CullFaceMode.disabled,((H,Y,se,le)=>({u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}))(0,D),D.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,D.paint,x.transform.zoom)}(m,d))},line:function(m,l,d,_){if(m.renderPass!=="translucent")return;let x=d.paint.get("line-opacity"),D=d.paint.get("line-width");if(x.constantOr(1)===0||D.constantOr(1)===0)return;let k=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),R=m.colorModeForRenderPass(),z=m.terrain&&m.terrain.renderingToTexture?1:i.exported.devicePixelRatio,G=d.paint.get("line-dasharray"),H=G.constantOr(1),Y=d.layout.get("line-cap"),se=d.paint.get("line-pattern"),le=se.constantOr(1),fe=d.paint.get("line-gradient"),he=le?"linePattern":"line",pe=m.context,Q=pe.gl,ue=(_e=>{let Se=[];pu(_e)&&Se.push("RENDER_LINE_DASH"),_e.paint.get("line-gradient")&&Se.push("RENDER_LINE_GRADIENT");let ke=_e.paint.get("line-trim-offset");ke[0]===0&&ke[1]===0||Se.push("RENDER_LINE_TRIM_OFFSET");let De=_e.paint.get("line-pattern").constantOr(1),Be=_e.paint.get("line-opacity").constantOr(1)!==1;return!De&&Be&&Se.push("RENDER_LINE_ALPHA_DISCARD"),Se})(d),ye=ue.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ye=!1);for(let _e of _){let Se=l.getTile(_e);if(le&&!Se.patternsLoaded())continue;let ke=Se.getBucket(d);if(!ke)continue;m.prepareDrawTile();let De=ke.programConfigurations.get(d.id),Be=m.useProgram(he,De,ue),Fe=se.constantOr(null);if(Fe&&Se.imageAtlas){let tt=Se.imageAtlas.patternPositions[Fe.toString()];tt&&De.setConstantPatternPositions(tt)}let Ve=G.constantOr(null),mt=Y.constantOr(null);if(!le&&Ve&&mt&&Se.lineAtlas){let tt=Se.lineAtlas.getDash(Ve,mt);tt&&De.setConstantPatternPositions(tt)}let[He,it]=d.paint.get("line-trim-offset");(mt==="round"||mt==="square")&&He!==it&&(He===0&&(He-=1),it===1&&(it+=1));let Ze=m.terrain?_e.projMatrix:null,ut=le?fu(m,Se,d,Ze,z):Hg(m,Se,d,Ze,ke.lineClipsArray.length,z,[He,it]);if(fe){let tt=ke.gradients[d.id],gt=tt.texture;if(d.gradientVersion!==tt.version){let at=256;if(d.stepInterpolant){let _t=l.getSource().maxzoom,$t=_e.canonical.z===_t?Math.ceil(1<<m.transform.maxZoom-_e.canonical.z):1;at=i.clamp(i.nextPowerOfTwo(ke.maxLineLength/i.EXTENT*1024*$t),256,pe.maxTextureSize)}tt.gradient=i.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:tt.gradient||void 0,clips:ke.lineClipsArray}),tt.texture?tt.texture.update(tt.gradient):tt.texture=new i.Texture(pe,tt.gradient,Q.RGBA),tt.version=d.gradientVersion,gt=tt.texture}pe.activeTexture.set(Q.TEXTURE1),gt.bind(d.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}H&&(pe.activeTexture.set(Q.TEXTURE0),Se.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),De.updatePaintBuffers()),le&&(pe.activeTexture.set(Q.TEXTURE0),Se.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),De.updatePaintBuffers()),m.prepareDrawProgram(pe,Be,_e.toUnwrapped());let Ge=tt=>{Be.draw(pe,Q.TRIANGLES,k,tt,R,i.CullFaceMode.disabled,ut,d.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,d.paint,m.transform.zoom,De,[ke.layoutVertexBuffer2])};if(ye){let tt=m.stencilModeForClipping(_e).ref;tt===0&&m.terrain&&pe.clear({stencil:0});let gt={func:Q.EQUAL,mask:255};ut.u_alpha_discard_threshold=.8,Ge(new i.StencilMode(gt,tt,255,Q.KEEP,Q.KEEP,Q.INVERT)),ut.u_alpha_discard_threshold=0,Ge(new i.StencilMode(gt,tt,255,Q.KEEP,Q.KEEP,Q.KEEP))}else Ge(m.stencilModeForClipping(_e))}ye&&(m.resetStencilClippingMasks(),m.terrain&&pe.clear({stencil:0}))},fill:function(m,l,d,_){let x=d.paint.get("fill-color"),D=d.paint.get("fill-opacity");if(D.constantOr(1)===0)return;let k=m.colorModeForRenderPass(),R=d.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!R.constantOr(1)&&x.constantOr(i.Color.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===z){let G=m.depthModeForSublayer(1,m.renderPass==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly);wp(m,l,d,_,G,k,!1)}if(m.renderPass==="translucent"&&d.paint.get("fill-antialias")){let G=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,i.DepthMode.ReadOnly);wp(m,l,d,_,G,k,!0)}},"fill-extrusion":function(m,l,d,_){let x=d.paint.get("fill-extrusion-opacity");if(x!==0&&m.renderPass==="translucent"){let D=new i.DepthMode(m.context.gl.LEQUAL,i.DepthMode.ReadWrite,m.depthRangeFor3D);if(x!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))ml(m,l,d,_,D,i.StencilMode.disabled,i.ColorMode.disabled),ml(m,l,d,_,D,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{let k=m.colorModeForRenderPass();ml(m,l,d,_,D,i.StencilMode.disabled,k)}}},hillshade:function(m,l,d,_){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;let x=m.context,D=m.depthModeForSublayer(0,i.DepthMode.ReadOnly),k=m.colorModeForRenderPass(),R=m.terrain&&m.terrain.renderingToTexture,[z,G]=m.renderPass!=="translucent"||R?[{},_]:m.stencilConfigForOverlap(_);for(let H of G){let Y=l.getTile(H);if(Y.needsHillshadePrepare&&m.renderPass==="offscreen")_p(m,Y,d,D,i.StencilMode.disabled,k);else if(m.renderPass==="translucent"){let se=R&&m.terrain?m.terrain.stencilModeForRTTOverlap(H):z[H.overscaledZ];_d(m,H,Y,d,D,se,k)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,l,d,_,x,D){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!_.length)return;let k=m.context,R=k.gl,z=l.getSource(),G=m.useProgram("raster"),H=m.colorModeForRenderPass(),Y=m.terrain&&m.terrain.renderingToTexture,[se,le]=z instanceof Dn||Y?[{},_]:m.stencilConfigForOverlap(_),fe=le[le.length-1].overscaledZ,he=!m.options.moving;for(let pe of le){let Q=Y?i.DepthMode.disabled:m.depthModeForSublayer(pe.overscaledZ-fe,d.paint.get("raster-opacity")===1?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly,R.LESS),ue=pe.toUnwrapped(),ye=l.getTile(pe);if(Y&&(!ye||!ye.hasData()))continue;let _e=Y?pe.projMatrix:m.transform.calculateProjMatrix(ue,he),Se=m.terrain&&Y?m.terrain.stencilModeForRTTOverlap(pe):se[pe.overscaledZ],ke=D?0:d.paint.get("raster-fade-duration");ye.registerFadeDuration(ke);let De=l.findLoadedParent(pe,0),Be=xd(ye,De,l,m.transform,ke),Fe,Ve;m.terrain&&m.terrain.prepareDrawTile();let mt=d.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;k.activeTexture.set(R.TEXTURE0),ye.texture.bind(mt,R.CLAMP_TO_EDGE),k.activeTexture.set(R.TEXTURE1),De?(De.texture.bind(mt,R.CLAMP_TO_EDGE),Fe=Math.pow(2,De.tileID.overscaledZ-ye.tileID.overscaledZ),Ve=[ye.tileID.canonical.x*Fe%1,ye.tileID.canonical.y*Fe%1]):ye.texture.bind(mt,R.CLAMP_TO_EDGE),ye.texture.useMipmap&&k.extTextureFilterAnisotropic&&m.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);let He=Bh(_e,Ve||[0,0],Fe||1,Be,d,z instanceof Dn?z.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(k,G,ue),z instanceof Dn)z.boundsBuffer&&z.boundsSegments&&G.draw(k,R.TRIANGLES,Q,i.StencilMode.disabled,H,i.CullFaceMode.disabled,He,d.id,z.boundsBuffer,m.quadTriangleIndexBuffer,z.boundsSegments);else{let{tileBoundsBuffer:it,tileBoundsIndexBuffer:Ze,tileBoundsSegments:ut}=m.getTileBoundsBuffers(ye);G.draw(k,R.TRIANGLES,Q,Se,H,i.CullFaceMode.disabled,He,d.id,it,Ze,ut)}}m.resetStencilClippingMasks()},background:function(m,l,d,_){let x=d.paint.get("background-color"),D=d.paint.get("background-opacity");if(D===0)return;let k=m.context,R=k.gl,z=m.transform,G=z.tileSize,H=d.paint.get("background-pattern");if(m.isPatternMissing(H))return;let Y=!H&&x.a===1&&D===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Y)return;let se=i.StencilMode.disabled,le=m.depthModeForSublayer(0,Y==="opaque"?i.DepthMode.ReadWrite:i.DepthMode.ReadOnly),fe=m.colorModeForRenderPass(),he=m.useProgram(H?"backgroundPattern":"background"),pe,Q=_;Q||(pe=m.getBackgroundTiles(),Q=Object.values(pe).map(ue=>ue.tileID)),H&&(k.activeTexture.set(R.TEXTURE0),m.imageManager.bind(m.context));for(let ue of Q){let ye=ue.toUnwrapped(),_e=_?ue.projMatrix:m.transform.calculateProjMatrix(ye);m.prepareDrawTile();let Se=l?l.getTile(ue):pe?pe[ue.key]:new i.Tile(ue,G,z.zoom,m),ke=H?Gg(_e,D,m,H,{tileID:ue,tileSize:G}):Vh(_e,D,x);m.prepareDrawProgram(k,he,ye);let{tileBoundsBuffer:De,tileBoundsIndexBuffer:Be,tileBoundsSegments:Fe}=m.getTileBoundsBuffers(Se);he.draw(k,R.TRIANGLES,le,se,fe,i.CullFaceMode.disabled,ke,d.id,De,Be,Fe)}},sky:function(m,l,d){let _=m.transform,x=_.projection.name==="mercator"||_.projection.name==="globe"?1:i.smoothstep(7,8,_.zoom),D=d.paint.get("sky-opacity")*x;if(D===0)return;let k=m.context,R=d.paint.get("sky-type"),z=new i.DepthMode(k.gl.LEQUAL,i.DepthMode.ReadOnly,[0,1]),G=m.frameCounter/1e3%1;R==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(H,Y,se,le){let fe=H.context,he=fe.gl,pe=Y.skyboxFbo;if(!pe){pe=Y.skyboxFbo=fe.createFramebuffer(32,32,!1),Y.skyboxGeometry=new Pd(fe),Y.skyboxTexture=fe.gl.createTexture(),he.bindTexture(he.TEXTURE_CUBE_MAP,Y.skyboxTexture),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MAG_FILTER,he.LINEAR);for(let _e=0;_e<6;++_e)he.texImage2D(he.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,he.RGBA,32,32,0,he.RGBA,he.UNSIGNED_BYTE,null)}fe.bindFramebuffer.set(pe.framebuffer),fe.viewport.set([0,0,32,32]);let Q=Y.getCenter(H,!0),ue=H.useProgram("skyboxCapture"),ye=new Float64Array(16);i.identity(ye),i.rotateY(ye,ye,.5*-Math.PI),Eo(fe,Y,ue,ye,Q,0),i.identity(ye),i.rotateY(ye,ye,.5*Math.PI),Eo(fe,Y,ue,ye,Q,1),i.identity(ye),i.rotateX(ye,ye,.5*-Math.PI),Eo(fe,Y,ue,ye,Q,2),i.identity(ye),i.rotateX(ye,ye,.5*Math.PI),Eo(fe,Y,ue,ye,Q,3),i.identity(ye),Eo(fe,Y,ue,ye,Q,4),i.identity(ye),i.rotateY(ye,ye,Math.PI),Eo(fe,Y,ue,ye,Q,5),fe.viewport.set([0,0,H.width,H.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(H,Y,se,le,fe){let he=H.context,pe=he.gl,Q=H.transform,ue=H.useProgram("skybox");he.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_CUBE_MAP,Y.skyboxTexture);let ye=((_e,Se,ke,De,Be)=>({u_matrix:_e,u_sun_direction:Se,u_cubemap:0,u_opacity:De,u_temporal_offset:Be}))(Q.skyboxMatrix,Y.getCenter(H,!1),0,le,fe);H.prepareDrawProgram(he,ue),ue.draw(he,pe.TRIANGLES,se,i.StencilMode.disabled,H.colorModeForRenderPass(),i.CullFaceMode.backCW,ye,"skybox",Y.skyboxGeometry.vertexBuffer,Y.skyboxGeometry.indexBuffer,Y.skyboxGeometry.segment)}(m,d,z,D,G):R==="gradient"&&m.renderPass==="sky"&&function(H,Y,se,le,fe){let he=H.context,pe=he.gl,Q=H.transform,ue=H.useProgram("skyboxGradient");Y.skyboxGeometry||(Y.skyboxGeometry=new Pd(he)),he.activeTexture.set(pe.TEXTURE0);let ye=Y.colorRampTexture;ye||(ye=Y.colorRampTexture=new i.Texture(he,Y.colorRamp,pe.RGBA)),ye.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);let _e=((Se,ke,De,Be,Fe)=>({u_matrix:Se,u_color_ramp:0,u_center_direction:ke,u_radius:i.degToRad(De),u_opacity:Be,u_temporal_offset:Fe}))(Q.skyboxMatrix,Y.getCenter(H,!1),Y.paint.get("sky-gradient-radius"),le,fe);H.prepareDrawProgram(he,ue),ue.draw(he,pe.TRIANGLES,se,i.StencilMode.disabled,H.colorModeForRenderPass(),i.CullFaceMode.backCW,_e,"skyboxGradient",Y.skyboxGeometry.vertexBuffer,Y.skyboxGeometry.indexBuffer,Y.skyboxGeometry.segment)}(m,d,z,D,G)},debug:function(m,l,d){for(let _=0;_<d.length;_++)_u(m,l,d[_])},custom:function(m,l,d,_){let x=m.context,D=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&d.isLayerDraped()){if(m.renderPass==="offscreen"){let k=D.prerender;if(k){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){let R=m.transform.pointMerc;k.call(D,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(m.transform.zoom),[R.x,R.y],m.transform.pixelsPerMeterRatio)}else k.call(D,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){let R=D.renderToTile;if(R){let z=_[0].canonical,G=new i.MercatorCoordinate(z.x+_[0].wrap*(1<<z.z),z.y,z.z);x.setDepthMode(i.DepthMode.disabled),x.setStencilMode(i.StencilMode.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),R.call(D,x.gl,G),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(i.StencilMode.disabled);let k=D.renderingMode==="3d"?new i.DepthMode(m.context.gl.LEQUAL,i.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,i.DepthMode.ReadOnly);if(x.setDepthMode(k),m.transform.projection.name==="globe"){let R=m.transform.pointMerc;D.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.globeToMercatorTransition(m.transform.zoom),[R.x,R.y],m.transform.pixelsPerMeterRatio)}else D.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else i.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class fc{constructor(l,d,_=!1){this.context=new wt(l,_),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=i.SourceCache.maxUnderzooming+i.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,d){let _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nh(this,l));let x=this._terrain;this.transform.elevation=_?x:null,x.update(l,this.transform,d)}_updateFog(l){let d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[_,x]=d.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);let D=_+.78*(x-_);this.transform.fogCullDistSq=D*D}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,d){if(this.width=l*i.exported.devicePixelRatio,this.height=d*i.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let _ of this.style.order)this.style._layers[_].resize()}setup(){let l=this.context,d=new i.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(i.EXTENT,0),d.emplaceBack(0,i.EXTENT),d.emplaceBack(i.EXTENT,i.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,i.posAttributes.members),this.tileExtentSegments=i.SegmentVector.simpleSegment(0,0,4,2);let _=new i.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(i.EXTENT,0),_.emplaceBack(0,i.EXTENT),_.emplaceBack(i.EXTENT,i.EXTENT),this.debugBuffer=l.createVertexBuffer(_,i.posAttributes.members),this.debugSegments=i.SegmentVector.simpleSegment(0,0,4,5);let x=new i.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,i.posAttributes.members),this.viewportSegments=i.SegmentVector.simpleSegment(0,0,4,2);let D=new i.StructArrayLayout4i8;D.emplaceBack(0,0,0,0),D.emplaceBack(i.EXTENT,0,i.EXTENT,0),D.emplaceBack(0,i.EXTENT,0,i.EXTENT),D.emplaceBack(i.EXTENT,i.EXTENT,i.EXTENT,i.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(D,i.boundsAttributes.members),this.mercatorBoundsSegments=i.SegmentVector.simpleSegment(0,0,4,2);let k=new i.StructArrayLayout3ui6;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(k);let R=new i.StructArrayLayout1ui2;for(let G of[0,1,3,2,0])R.emplaceBack(G);this.debugIndexBuffer=l.createIndexBuffer(R),this.emptyTexture=new i.Texture(l,new i.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=i.create();let z=this.context.gl;this.stencilClearMode=new i.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(i.window.performance.now()),this.atmosphereBuffer=new Od(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,d.TRIANGLES,i.DepthMode.disabled,this.stencilClearMode,i.ColorMode.disabled,i.CullFaceMode.disabled,bs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,_){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(let z of _)if(this._tileClippingMaskIDs[z.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=d.id;let x=this.context,D=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(i.ColorMode.disabled),x.setDepthMode(i.DepthMode.disabled);let k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let R of _){let z=d.getTile(R),G=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:Y,tileBoundsSegments:se}=this.getTileBoundsBuffers(z);k.draw(x,D.TRIANGLES,i.DepthMode.disabled,new i.StencilMode({func:D.ALWAYS,mask:0},G,255,D.KEEP,D.KEEP,D.REPLACE),i.ColorMode.disabled,i.CullFaceMode.disabled,bs(R.projMatrix),"$clipping",H,Y,se)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let l=this.nextStencilID++,d=this.context.gl;return new i.StencilMode({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);let d=this.context.gl;return new i.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){let d=this.context.gl,_=l.sort((k,R)=>R.overscaledZ-k.overscaledZ),x=_[_.length-1].overscaledZ,D=_[0].overscaledZ-x+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();let k={};for(let R=0;R<D;R++)k[R+x]=new i.StencilMode({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=D,[k,_]}return[{[x]:i.StencilMode.disabled},_]}colorModeForRenderPass(){let l=this.context.gl;return this._showOverdrawInspector?new i.ColorMode([l.CONSTANT_COLOR,l.ONE],new i.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?i.ColorMode.unblended:i.ColorMode.alphaBlended}depthModeForSublayer(l,d,_){if(!this.opaquePassEnabledForLayer())return i.DepthMode.disabled;let x=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new i.DepthMode(_||this.context.gl.LEQUAL,d,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(i.exported.now()),this.imageManager.beginFrame();let _=this.style.order,x=this.style._sourceCaches;for(let G in x){let H=x[G];H.used&&H.prepare(this.context)}let D={},k={},R={};for(let G in x){let H=x[G];D[G]=H.getVisibleCoordinates(),k[G]=D[G].slice().reverse(),R[G]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<_.length;G++)if(this.style._layers[_[G]].is3D()){this.opaquePassCutoff=G;break}if(this.terrain&&(this.terrain.updateTileBinding(R),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.GlobeSharedBuffers(this.context)),!i.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(let G of _){let H=this.style._layers[G],Y=l._getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;let se=Y?k[Y.id]:void 0;(H.type==="custom"||H.isSky()||se&&se.length)&&this.renderLayer(this,Y,H,se)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];let z=this.terrain;if(z&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&z.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?i.Color.black:i.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){let G=this.style._layers[_[this.currentLayer]],H=l._getLayerSourceCache(G);if(G.isSky())continue;let Y=H?k[H.id]:void 0;this._renderTileClippingMasks(G,H,Y),this.renderLayer(this,H,G,Y)}if(this.style.fog&&this.transform.projection.supportsFog&&function(G,H){let Y=G.context,se=Y.gl,le=G.transform,fe=new i.DepthMode(se.LEQUAL,i.DepthMode.ReadOnly,[0,1]),he=G.useProgram("globeAtmosphere",null,le.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),pe=i.globeToMercatorTransition(le.zoom),Q=H.properties.get("color").toArray01(),ue=H.properties.get("high-color").toArray01(),ye=H.properties.get("space-color").toArray01PremultipliedAlpha(),_e=i.identity$1([]);i.rotateY$1(_e,_e,-i.degToRad(le._center.lng)),i.rotateX$1(_e,_e,i.degToRad(le._center.lat)),i.rotateZ$1(_e,_e,le.angle),i.rotateX$1(_e,_e,-le._pitch);let Se=i.fromQuat(new Float32Array(16),_e),ke=i.mapValue(H.properties.get("star-intensity"),0,1,0,.25),De=5e-4,Be=i.mapValue(H.properties.get("horizon-blend"),0,1,De,.25),Fe=i.globeUseCustomAntiAliasing(G,Y,le)&&Be===De?le.worldSize/(2*Math.PI*1.025)-1:le.globeRadius,Ve=G.frameCounter/1e3%1,mt=i.length(le.globeCenterInViewSpace),He=Math.sqrt(Math.pow(mt,2)-Math.pow(Fe,2)),it=Math.acos(He/mt),Ze=((Ge,tt,gt,at,_t,$t,on,Ft,Xt,Ht,En,jt,Xn,ui)=>({u_frustum_tl:Ge,u_frustum_tr:tt,u_frustum_br:gt,u_frustum_bl:at,u_horizon:_t,u_transition:$t,u_fadeout_range:on,u_color:Ft,u_high_color:Xt,u_space_color:Ht,u_star_intensity:En,u_star_size:5*i.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:jt,u_horizon_angle:Xn,u_rotation_matrix:ui}))(le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.frustumCorners.horizon,pe,Be,Q,ue,ye,ke,Ve,it,Se);G.prepareDrawProgram(Y,he);let ut=G.atmosphereBuffer;ut&&he.draw(Y,se.TRIANGLES,fe,i.StencilMode.disabled,i.ColorMode.alphaBlended,i.CullFaceMode.backCW,Ze,"skybox",ut.vertexBuffer,ut.indexBuffer,ut.segments)}(this,this.style.fog),this.renderPass="sky",(i.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){let G=this.style._layers[_[this.currentLayer]],H=l._getLayerSourceCache(G);G.isSky()&&this.renderLayer(this,H,G,H?k[H.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){let G=this.style._layers[_[this.currentLayer]],H=l._getLayerSourceCache(G);if(G.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(G)){if(G.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let Y=H?(G.type==="symbol"?R:k)[H.id]:void 0;this._renderTileClippingMasks(G,H,H?D[H.id]:void 0),this.renderLayer(this,H,G,Y),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let G=null;i.values(this.style._layers).forEach(H=>{let Y=l._getLayerSourceCache(H);Y&&!H.isHidden(this.transform.zoom)&&(!G||G.getSource().maxzoom<Y.getSource().maxzoom)&&(G=Y)}),G&&this.options.showTileBoundaries&&yl.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){let H=G.transform.padding;Cp(G,G.transform.height-(H.top||0),3,dc),Cp(G,H.bottom||0,3,Rd),gl(G,H.left||0,3,$h),gl(G,G.transform.width-(H.right||0),3,qg);let Y=G.transform.centerPoint;(function(se,le,fe,he){hc(se,le-1,fe-10,2,20,he),hc(se,le-10,fe-1,20,2,he)})(G,Y.x,G.transform.height-Y.y,Ep)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(i.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,d,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(_.type)||l.terrain&&_.type==="custom")&&yl[_.type](l,d,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;let d=this.context.extTimerQuery,_=this.gpuTimers[l.id];_||(_=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let l=this.context.extTimerQuery,d=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),l.beginQueryEXT(l.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){let l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){let l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){let d={};for(let _ in l){let x=l[_],D=this.context.extTimerQuery,k=D.getQueryObjectEXT(x.query,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(x.query),d[_]=k}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;let d=this.context.extTimerQuery,_=0;for(let x of l)_+=d.getQueryObjectEXT(x,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(x);return _}translatePosMatrix(l,d,_,x,D){if(!_[0]&&!_[1])return l;let k=D?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(k){let G=Math.sin(k),H=Math.cos(k);_=[_[0]*H-_[1]*G,_[0]*G+_[1]*H]}let R=[D?_[0]:vr(d,_[0],this.transform.zoom),D?_[1]:vr(d,_[1],this.transform.zoom),0],z=new Float32Array(16);return i.translate(z,l,R),z}saveTileTexture(l){let d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){let d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){let l=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),d&&x.push("ZERO_EXAGGERATION"),_&&!l&&_.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),l&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(l,d,_){this.cache=this.cache||{};let x=_||[],D=this.currentGlobalDefines().concat(x),k=Pn.cacheKey(du[l],l,D,d);return this.cache[k]||(this.cache[k]=new Pn(this.context,l,du[l],d,jh[l],D)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=i.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let D=x.getOpacity(this.transform.pitch),k=((R,z,G,H,Y,se,le,fe,he,pe,Q)=>{let ue=R.transform,ye=z.properties.get("color").toArray01();ye[3]=H;let _e=R.frameCounter/1e3%1;return{u_fog_matrix:G?ue.calculateFogTileMatrix(G):R.identityMat,u_fog_range:z.getFovAdjustedRange(ue._fov),u_fog_color:ye,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_temporal_offset:_e,u_frustum_tl:Y,u_frustum_tr:se,u_frustum_br:le,u_frustum_bl:fe,u_globe_pos:he,u_globe_radius:pe,u_viewport:Q,u_globe_transition:i.globeToMercatorTransition(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,x,_,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.exported.devicePixelRatio,this.transform.height*i.exported.devicePixelRatio]);d.setFogUniformValues(l,k)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){let l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){let l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let l=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(let x of _)d[x.key]=l[x.key]||new i.Tile(x,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class bu{constructor(l=0,d=0,_=0,x=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=_,this.right=x}interpolate(l,d,_){return d.top!=null&&l.top!=null&&(this.top=i.number(l.top,d.top,_)),d.bottom!=null&&l.bottom!=null&&(this.bottom=i.number(l.bottom,d.bottom,_)),d.left!=null&&l.left!=null&&(this.left=i.number(l.left,d.left,_)),d.right!=null&&l.right!=null&&(this.right=i.number(l.right,d.right,_)),this}getCenter(l,d){let _=i.clamp((this.left+l-this.right)/2,0,l),x=i.clamp((this.top+d-this.bottom)/2,0,d);return new i.Point(_,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new bu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ld(m,l){let d=i.getColumn(m,3);i.fromQuat(m,l),i.setColumn(m,3,d)}function $n(m,l){let d=i.identity$1([]);return i.rotateZ$1(d,d,-l),i.rotateX$1(d,d,-m),d}function Or(m,l){let d=[m[0],m[1],0],_=[l[0],l[1],0];if(i.length(d)>=1e-15){let k=i.normalize([],d);i.scale$2(_,k,i.dot(_,k)),l[0]=_[0],l[1]=_[1]}let x=i.cross([],l,m);if(i.len(x)<1e-15)return null;let D=Math.atan2(-x[1],x[0]);return $n(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),D)}class mi{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){let d=l instanceof i.MercatorCoordinate?l:new i.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=i.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;let _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(i.MercatorCoordinate.fromLngLat(l)):0,D=i.MercatorCoordinate.fromLngLat(l,x),k=[D.x-_.x,D.y-_.y,D.z-_.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Or(k,d)}setPitchBearing(l,d){this.orientation=$n(i.degToRad(l),i.degToRad(-d))}}class Fd{constructor(l,d){this._transform=i.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){let l=this.position;return new i.MercatorCoordinate(l[0],l[1],l[2])}get position(){let l=i.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&i.setColumn(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||i.identity$1([]),l&&Ld(this._transform,this._orientation)}getPitchBearing(){let l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=$n(l,d),Ld(this._transform,this._orientation)}forward(){let l=i.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){let l=i.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){let l=i.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){let _=new Float64Array(16);return i.invert(_,this.getWorldToCamera(l,d)),_}getWorldToCameraPosition(l,d,_){let x=this.position;i.scale$2(x,x,-l);let D=new Float64Array(16);return i.fromScaling(D,[_,_,_]),i.translate(D,D,x),D[10]*=d,D}getWorldToCamera(l,d){let _=new Float64Array(16),x=new Float64Array(4),D=this.position;return i.conjugate(x,this._orientation),i.scale$2(D,D,-l),i.fromQuat(_,x),i.translate(_,_,D),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(l,d,_,x){let D=new Float64Array(16);return i.perspective(D,l,d,_,x),D}getDistanceToElevation(l,d=!1){let _=l===0?0:i.mercatorZfromAltitude(l,d?i.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new Fd([...this.position],[...this.orientation])}}function _l(m,l){let d=vl(m.projection,m.zoom,m.width,m.height),_=function(D,k,R,z,G){let H=new i.LngLat(R.lng-180*si,R.lat),Y=new i.LngLat(R.lng+180*si,R.lat),se=D.project(H.lng,H.lat),le=D.project(Y.lng,Y.lat),fe=-Math.atan2(le.y-se.y,le.x-se.x),he=i.MercatorCoordinate.fromLngLat(R);he.y=i.clamp(he.y,-1+si,1-si);let pe=he.toLngLat(),Q=D.project(pe.lng,pe.lat),ue=i.MercatorCoordinate.fromLngLat(pe);ue.x+=si;let ye=ue.toLngLat(),_e=D.project(ye.lng,ye.lat),Se=zd(_e.x-Q.x,_e.y-Q.y,fe),ke=i.MercatorCoordinate.fromLngLat(pe);ke.y+=si;let De=ke.toLngLat(),Be=D.project(De.lng,De.lat),Fe=zd(Be.x-Q.x,Be.y-Q.y,fe),Ve=Math.abs(Se.x)/Math.abs(Fe.y),mt=i.identity([]);i.rotateZ(mt,mt,-fe*(1-(G?0:z)));let He=i.identity([]);return i.scale(He,He,[1,1-(1-Ve)*z,1]),He[4]=-Fe.x/Fe.y*z,i.rotateZ(He,He,fe),i.multiply(He,mt,He),He}(m.projection,0,m.center,d,l),x=Nd(m);return i.scale(_,_,[x,x,1]),_}function Nd(m){let l=m.projection,d=vl(m.projection,m.zoom,m.width,m.height),_=Hh(l,m.center),x=Hh(l,i.LngLat.convert(l.center));return Math.pow(2,_*d+(1-d)*x)}function vl(m,l,d,_,x=1/0){let D=m.range;if(!D)return 0;let k=Math.min(x,Math.max(d,_)),R=Math.log(k/1024)/Math.LN2;return i.smoothstep(D[0]+R,D[1]+R,l)}let si=1/4e4;function Hh(m,l){let d=i.clamp(l.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),_=new i.LngLat(l.lng-180*si,d),x=new i.LngLat(l.lng+180*si,d),D=m.project(_.lng,d),k=m.project(x.lng,d),R=i.MercatorCoordinate.fromLngLat(_),z=i.MercatorCoordinate.fromLngLat(x),G=k.x-D.x,H=k.y-D.y,Y=z.x-R.x,se=z.y-R.y,le=Math.sqrt((Y*Y+se*se)/(G*G+H*H));return Math.log(le)/Math.LN2}function zd(m,l,d){let _=Math.cos(d),x=Math.sin(d);return{x:m*_-l*x,y:m*x+l*_}}class bl{constructor(l,d,_,x,D,k,R){this.tileSize=512,this._renderWorldCopies=D===void 0||D,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(k),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new i.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new bu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Fd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let l=new bl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,d=!1){let _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return i.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};let d=this.projection?this.getProjection():void 0;this.projection=i.getProjection(this.projectionOptions);let _=!C(d,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){let l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.getProjection({name:"mercator"});let d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){let l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.Point(this.width,this.height)}get bearing(){return i.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){let d=-l*Math.PI/180;var _;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new i.ARRAY_TYPE(4),i.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(x,D,k){var R=D[0],z=D[1],G=D[2],H=D[3],Y=Math.sin(k),se=Math.cos(k);x[0]=R*se+G*Y,x[1]=z*se+H*Y,x[2]=R*-Y+G*se,x[3]=z*-Y+H*se}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){let d=i.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=i.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){let d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop(),x=0,D=0;for(let k=0;k<d.length;k++){let R=new i.Point(d[k][0]*this.width,_+d[k][1]*(this.height-_)),z=l.pointCoordinate(R);if(!z)continue;let G=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);x+=z[3]*G,D+=G}return D===0?NaN:x/D}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,x=this._mercatorZfromZoom(l),D=this._mercatorZfromZoom(this._maxZoom),k=Math.max(x-_,D);this._setZoom(this._zoomFromMercatorZ(k))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){let d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude())),_;_=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];let x=i.length(i.sub([],this._camera.position,_));return i.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!i.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){let _=[l.position.x,l.position.y,l.position.z];i.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let l=this._camera.position,d=new mi;return d.position=new i.MercatorCoordinate(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!i.length$1(l))return!1;i.normalize$1(l,l);let d=i.transformQuat([],[0,0,-1],l),_=i.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;let x=Or(d,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(l){let d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;l[2]=i.clamp(l[2],x/_,x/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,_){this._unmodified=!1,this._edgeInsets.interpolate(l,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){let d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){let d=[new i.UnwrappedTileID(0,l)];if(this.renderWorldCopies){let _=this.pointCoordinate(new i.Point(0,0)),x=this.pointCoordinate(new i.Point(this.width,0)),D=this.pointCoordinate(new i.Point(this.width,this.height)),k=this.pointCoordinate(new i.Point(0,this.height)),R=Math.floor(Math.min(_.x,x.x,D.x,k.x)),z=Math.floor(Math.max(_.x,x.x,D.x,k.x)),G=1;for(let H=R-G;H<=z+G;H++)H!==0&&d.push(new i.UnwrappedTileID(H,l))}return d}coveringTiles(l){let d=this.coveringZoomLevel(l),_=d,x=this.elevation&&!l.isTerrainDEM,D=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);let k=this.locationCoordinate(this.center),R=this.center.lat,z=1<<d,G=[z*k.x,z*k.y,0],H=this.projection.name==="globe",Y=!H,se=i.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,Y),le=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),fe=z*i.mercatorZfromAltitude(1,this.center.lat),he=this._camera.position[2]/i.mercatorZfromAltitude(1,this.center.lat),pe=[z*le.x,z*le.y,he*(Y?1:fe)],Q=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ue=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ye=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=l.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?Nd(this):1,ke=Ge=>{let gt=new i.MercatorCoordinate(Ge.x+25e-6,Ge.y,Ge.z),at=new i.MercatorCoordinate(Ge.x,Ge.y+25e-6,Ge.z),_t=Ge.toLngLat(),$t=gt.toLngLat(),on=at.toLngLat(),Ft=this.locationCoordinate(_t),Xt=this.locationCoordinate($t),Ht=this.locationCoordinate(on),En=Math.hypot(Xt.x-Ft.x,Xt.y-Ft.y),jt=Math.hypot(Ht.x-Ft.x,Ht.y-Ft.y);return Math.sqrt(En*jt)*Se/25e-6},De=Ge=>{let tt=ye,gt=_e;return{aabb:i.tileAABB(this,z,0,0,0,Ge,gt,tt,this.projection),zoom:0,x:0,y:0,minZ:gt,maxZ:tt,wrap:Ge,fullyVisible:!1}},Be=[],Fe=[],Ve=d,mt=l.reparseOverscaled?_:d,He=Ge=>Ge*Ge,it=He((he-this._centerAltitude)*fe),Ze=Ge=>{if(!this._elevation||!Ge.tileID||!D)return;let tt=this._elevation.getMinMaxForTile(Ge.tileID),gt=Ge.aabb;tt?(gt.min[2]=tt.min,gt.max[2]=tt.max,gt.center[2]=(gt.min[2]+gt.max[2])/2):(Ge.shouldSplit=ut(Ge),Ge.shouldSplit||(gt.min[2]=gt.max[2]=gt.center[2]=this._centerAltitude))},ut=Ge=>{if(Ge.zoom<ue)return!0;if(Ge.zoom===Ve)return!1;if(Ge.shouldSplit!=null)return Ge.shouldSplit;let tt=Ge.aabb.distanceX(pe),gt=Ge.aabb.distanceY(pe),at=it,_t=1;if(H){at=He(Ge.aabb.distanceZ(pe));let Ft=Math.pow(2,Ge.zoom),Xt=i.latFromMercatorY((Ge.y+1)/Ft),Ht=i.latFromMercatorY(Ge.y/Ft),En=Math.min(Math.max(R,Xt),Ht),jt=i.circumferenceAtLatitude(En)/i.circumferenceAtLatitude(R);if(_t=En===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jt/this._mercatorScaleRatio),this.zoom<=i.GLOBE_ZOOM_THRESHOLD_MIN&&Ge.zoom===Ve-1&&jt>=.9)return!0}else if(x&&(at=He(Ge.aabb.distanceZ(pe)*fe)),this.projection.isReprojectedInTileSpace&&_<=5){let Ft=Math.pow(2,Ge.zoom),Xt=ke(new i.MercatorCoordinate((Ge.x+.5)/Ft,(Ge.y+.5)/Ft));_t=Xt>.85?1:Xt}let $t=tt*tt+gt*gt+at,on=He((1<<Ve-Ge.zoom)*Q*_t*((Ft,Xt)=>{if(Xt*He(.707)<Ft)return 1;let Ht=Math.sqrt(Xt/Ft);return Ht/(1.4144271570014144+(Math.pow(1.1,Ht-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,it),$t));return $t<on};if(this.renderWorldCopies)for(let Ge=1;Ge<=3;Ge++)Be.push(De(-Ge)),Be.push(De(Ge));for(Be.push(De(0));Be.length>0;){let Ge=Be.pop(),tt=Ge.x,gt=Ge.y,at=Ge.fullyVisible;if(!at){let _t=Ge.aabb.intersects(se);if(_t===0)continue;at=_t===2}if(Ge.zoom!==Ve&&ut(Ge))for(let _t=0;_t<4;_t++){let $t=(tt<<1)+_t%2,on=(gt<<1)+(_t>>1),Ft={aabb:D?Ge.aabb.quadrant(_t):i.tileAABB(this,z,Ge.zoom+1,$t,on,Ge.wrap,Ge.minZ,Ge.maxZ,this.projection),zoom:Ge.zoom+1,x:$t,y:on,wrap:Ge.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Ge.minZ,maxZ:Ge.maxZ};x&&!H&&(Ft.tileID=new i.OverscaledTileID(Ge.zoom+1===Ve?mt:Ge.zoom+1,Ge.wrap,Ge.zoom+1,$t,on),Ze(Ft)),Be.push(Ft)}else{let _t=Ge.zoom===Ve?mt:Ge.zoom;if(l.minzoom&&l.minzoom>_t)continue;let $t=G[0]-(.5+tt+(Ge.wrap<<Ge.zoom))*(1<<d-Ge.zoom),on=G[1]-.5-gt,Ft=Ge.tileID?Ge.tileID:new i.OverscaledTileID(_t,Ge.wrap,Ge.zoom,tt,gt);Fe.push({tileID:Ft,distanceSq:$t*$t+on*on})}}if(this.fogCullDistSq){let Ge=this.fogCullDistSq,tt=this.horizonLineFromTop();Fe=Fe.filter(gt=>{let at=[0,0,0,1],_t=[i.EXTENT,i.EXTENT,0,1],$t=this.calculateFogTileMatrix(gt.tileID.toUnwrapped());i.transformMat4$1(at,at,$t),i.transformMat4$1(_t,_t,$t);let on=i.getAABBPointSquareDist(at,_t);if(on===0)return!0;let Ft=!1,Xt=this._elevation;if(Xt&&on>Ge&&tt!==0){let Ht=this.calculateProjMatrix(gt.tileID.toUnwrapped()),En;l.isTerrainDEM||(En=Xt.getMinMaxForTile(gt.tileID)),En||(En={min:_e,max:ye});let jt=i.furthestTileCorner(this.rotation),Xn=[jt[0]*i.EXTENT,jt[1]*i.EXTENT,En.max];i.transformMat4(Xn,Xn,Ht),Ft=(1-Xn[1])*this.height*.5<tt}return on<Ge||Ft})}return Fe.sort((Ge,tt)=>Ge.distanceSq-tt.distanceSq).map(Ge=>Ge.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){let d=i.clamp(l.lat,-i.MAX_MERCATOR_LATITUDE,i.MAX_MERCATOR_LATITUDE),_=this.projection.project(l.lng,d);return new i.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let _,x,D=this.centerPoint;if(this.projection.name==="globe"){let R=this.worldSize;_=(d.x-D.x)/R,x=(d.y-D.y)/R}else{let R=this.pointCoordinate(d),z=this.pointCoordinate(D);_=R.x-z.x,x=R.y-z.y}let k=this.locationCoordinate(l);this.setLocation(new i.MercatorCoordinate(k.x-_,k.y-x))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){let _=d?i.mercatorZfromAltitude(d,l.lat):void 0,x=this.projection.project(l.lng,l.lat);return new i.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){let _=d??this._centerAltitude,x=[l.x,l.y,0,1],D=[l.x,l.y,1,1];i.transformMat4$1(x,x,this.pixelMatrixInverse),i.transformMat4$1(D,D,this.pixelMatrixInverse);let k=D[3];i.scale$1(x,x,1/x[3]),i.scale$1(D,D,1/k);let R=x[2],z=D[2];return{p0:x,p1:D,t:R===z?0:(_-R)/(z-R)}}screenPointToMercatorRay(l){let d=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return i.transformMat4$1(d,d,this.pixelMatrixInverse),i.transformMat4$1(_,_,this.pixelMatrixInverse),i.scale$1(d,d,1/d[3]),i.scale$1(_,_,1/_[3]),d[2]=i.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=i.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,i.scale$1(d,d,1/this.worldSize),i.scale$1(_,_,1/this.worldSize),new i.Ray([d[0],d[1],d[2]],i.normalize([],i.sub([],_,d)))}rayIntersectionCoordinate(l){let{p0:d,p1:_,t:x}=l,D=i.mercatorZfromAltitude(d[2],this._center.lat),k=i.mercatorZfromAltitude(_[2],this._center.lat);return new i.MercatorCoordinate(i.number(d[0],_[0],x)/this.worldSize,i.number(d[1],_[1],x)/this.worldSize,i.number(D,k,x))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new i.MercatorCoordinate(d[0],d[1],d[2]);let _=0,x=this.horizonLineFromTop();if(l.y>x)return this.pointCoordinate(l);let D=.02*x,k=l.clone();for(let R=0;R<10&&x-_>D;R++){k.y=i.number(_,x,.66);let z=this.projection.pointCoordinate3D(this,k.x,k.y);z?(x=k.y,d=z):_=k.y}return d?new i.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);let d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){let _=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,x=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return i.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new i.Point(x[0]/x[3],x[1]/x[3]):new i.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:l,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,D=this.pointLocation3D(new i.Point(d,l)),k=this.pointLocation3D(new i.Point(x,l)),R=this.pointLocation3D(new i.Point(x,_)),z=this.pointLocation3D(new i.Point(d,_)),G=Math.min(D.lng,k.lng,R.lng,z.lng),H=Math.max(D.lng,k.lng,R.lng,z.lng),Y=Math.min(D.lat,k.lat,R.lat,z.lat),se=Math.max(D.lat,k.lat,R.lat,z.lat),le=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,he=(pe,Q,ue,ye,_e)=>{let Se=(pe+ue)/2,ke=(Q+ye)/2,De=new i.Point(Se,ke),{lng:Be,lat:Fe}=this.pointLocation3D(De),Ve=Math.max(0,G-Be,Y-Fe,Be-H,Fe-se);G=Math.min(G,Be),H=Math.max(H,Be),Y=Math.min(Y,Fe),se=Math.max(se,Fe),(_e<fe||Ve>le)&&(he(pe,Q,Se,ke,_e+1),he(Se,ke,ue,ye,_e+1))};if(he(d,l,x,l,1),he(x,l,x,_,1),he(x,_,d,_,1),he(d,_,d,l,1),this.projection.name==="globe"){let[pe,Q]=i.polesInViewport(this);pe?(se=90,H=180,G=-180):Q&&(Y=-90,H=180,G=-180)}return new i.LngLatBounds(new i.LngLat(G,Y),new i.LngLat(H,se))}_getBoundsRectangular(l,d){let{top:_,left:x}=this._edgeInsets,D=this.height-this._edgeInsets.bottom,k=this.width-this._edgeInsets.right,R=new i.Point(x,_),z=new i.Point(k,_),G=new i.Point(k,D),H=new i.Point(x,D),Y=this.pointCoordinate(R,l),se=this.pointCoordinate(z,l),le=this.pointCoordinate(G,d),fe=this.pointCoordinate(H,d),he=(pe,Q)=>(Q.y-pe.y)/(Q.x-pe.x);return Y.y>1&&se.y>=0?Y=new i.MercatorCoordinate((1-fe.y)/he(fe,Y)+fe.x,1):Y.y<0&&se.y<=1&&(Y=new i.MercatorCoordinate(-fe.y/he(fe,Y)+fe.x,0)),se.y>1&&Y.y>=0?se=new i.MercatorCoordinate((1-le.y)/he(le,se)+le.x,1):se.y<0&&Y.y<=1&&(se=new i.MercatorCoordinate(-le.y/he(le,se)+le.x,0)),new i.LngLatBounds().extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(le))}_getBoundsRectangularTerrain(){let l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);let d=l.visibleDemTiles.reduce((_,x)=>{if(x.dem){let D=x.dem.tree;_.min=Math.min(_.min,D.minimums[0]),_.max=Math.max(_.max,D.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){let d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-i.MAX_MERCATOR_LATITUDE,this.maxLat=i.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=i.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=i.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=i.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){let d=l.key,_=this._distanceTileDataCache;if(_[d])return _[d];let x=l.canonical,D=1/this.height,k=this.cameraWorldSize,R=k/this.zoomScale(x.z),z=(x.x+Math.pow(2,x.z)*l.wrap)*R,G=x.y*R,H=this.point;H.x*=k/this.worldSize,H.y*=k/this.worldSize;let Y=this.angle,se=Math.sin(-Y),le=-Math.cos(-Y);return _[d]={bearing:[se,le],center:[(H.x-z)*D,(H.y-G)*D],scale:R/i.EXTENT*D},_[d]}calculateFogTileMatrix(l){let d=l.key,_=this._fogTileMatrixCache;if(_[d])return _[d];let x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return i.multiply(x,this.worldToFogMatrix,x),_[d]=new Float32Array(x),_[d]}calculateProjMatrix(l,d=!1){let _=l.key,x=d?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];let D=this.calculatePosMatrix(l,this.worldSize);return i.multiply(D,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,D),x[_]=new Float32Array(D),x[_]}calculatePixelsToTileUnitsMatrix(l){let d=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];let x=function(D,k){let{scale:R}=D.tileTransform,z=R*i.EXTENT/(D.tileSize*Math.pow(2,k.zoom-D.tileID.overscaledZ+D.tileID.canonical.z));return G=new Float32Array(4),se=(H=k.inverseAdjustmentMatrix)[1],le=H[2],fe=H[3],pe=(Y=[z,z])[1],G[0]=H[0]*(he=Y[0]),G[1]=se*he,G[2]=le*pe,G[3]=fe*pe,G;var G,H,Y,se,le,fe,he,pe}(l,this);return _[d]=x,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let l=1/this.worldSize,d=i.fromScaling([],[l,l,l]);return i.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let l=this._elevation;this._updateCameraState();let d=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),x=this._camera.forward(),D=i.mercatorZfromAltitude(1,this._center.lat);_[2]/=D,x[2]/=D,i.normalize(x,x);let k=l.raycast(_,x,l.exaggeration());if(k){let R=i.scaleAndAdd([],_,x,k),z=new i.MercatorCoordinate(R[0],R[1],i.mercatorZfromAltitude(R[2],i.latFromMercatorY(R[1]))),G=(z.z+i.length([z.x-_[0],z.y-_[1],z.z-_[2]*D]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;let d=this._elevation,_=i.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),D=d.getAtPointOrZero(new i.MercatorCoordinate(...x)),k=this.pixelsPerMeter/this.worldSize*D,R=this._minimumHeightOverTerrain(),z=x[2]-k;if(z<=R)if(z<0||l){let G=this.locationCoordinate(this._center,this._centerAltitude),H=[x[0],x[1],G.z-x[2]],Y=i.length(H);H[2]-=(R-z)/this._pixelsPerMercatorPixel;let se=i.length(H);if(se===0)return;i.scale$2(H,H,Y/se*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],G.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){let se=this.center;return se.lat=i.clamp(se.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(se.lng=i.clamp(se.lng,this.minLng,this.maxLng)),this.center=se,void(this._constraining=!1)}let d=this._unmodified,{x:_,y:x}=this.point,D=0,k=_,R=x,z=this.width/2,G=this.height/2,H=this.worldMinY*this.scale,Y=this.worldMaxY*this.scale;if(x-G<H&&(R=H+G),x+G>Y&&(R=Y-G),Y-H<this.height&&(D=Math.max(D,this.height/(Y-H)),R=(Y+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let se=this.worldMinX*this.scale,le=this.worldMaxX*this.scale,fe=this.worldSize/2-(se+le)/2;k=(_+fe+this.worldSize)%this.worldSize-fe,k-z<se&&(k=se+z),k+z>le&&(k=le-z),le-se<this.width&&(D=Math.max(D,this.width/(le-se)),k=(le+se)/2)}k===_&&R===x||(this.center=this.unproject(new i.Point(k,R))),D&&(this.zoom+=this.scaleZoom(D)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let l=this.centerOffset,d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.mercatorZfromAltitude(1,this.center.lat)/i.mercatorZfromAltitude(1,i.GLOBE_SCALE_MATCH_LATITUDE));let _=vl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let x=this.projection.zAxisUnit==="meters"?d:1,D=this._camera.getWorldToCamera(this.worldSize,x),k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height;let R=i.mul([],k,D);if(this.projection.isReprojectedInTileSpace){let ke=this.locationCoordinate(this.center),De=i.identity([]);i.translate(De,De,[ke.x*this.worldSize,ke.y*this.worldSize,0]),i.multiply(De,De,_l(this)),i.translate(De,De,[-ke.x*this.worldSize,-ke.y*this.worldSize,0]),i.multiply(R,R,De),this.inverseAdjustmentMatrix=function(Be){let Fe=_l(Be,!0);return It([],[Fe[0],Fe[1],Fe[4],Fe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=i.scale([],R,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=R,this.invProjMatrix=i.invert(new Float64Array(16),this.projMatrix);let z=i.invert([],k);this.frustumCorners=i.FrustumCorners.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height);let G=new Float32Array(16);i.identity(G),i.scale(G,G,[1,-1,1]),i.rotateX(G,G,this._pitch),i.rotateZ(G,G,this.angle);let H=i.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-l.x/this.width,H[9]=2*(l.y+Y)/this.height,this.skyboxMatrix=i.multiply(G,H,G);let se=this.point,le=se.x,fe=se.y,he=this.width%2/2,pe=this.height%2/2,Q=Math.cos(this.angle),ue=Math.sin(this.angle),ye=le-Math.round(le)+Q*he+ue*pe,_e=fe-Math.round(fe)+Q*pe+ue*he,Se=new Float64Array(R);if(i.translate(Se,Se,[ye>.5?ye-1:ye,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=Se,R=i.create(),i.scale(R,R,[this.width/2,-this.height/2,1]),i.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=i.create(),i.scale(R,R,[1,-1,1]),i.translate(R,R,[-1,-1,0]),i.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=i.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},R=i.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.calculateGlobeMatrix(this);let ke=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.transformMat4(ke,ke,D),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,D=[l,l,d];i.scale$2(D,D,x),i.scale$2(_,_,-1),i.multiply$2(_,_,D);let k=i.create();i.translate(k,k,_),i.scale(k,k,D),this.mercatorFogMatrix=k,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,x)}_computeCameraPosition(l){let d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,D=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*D,x.y/this.worldSize-_[1]*D,l/this.worldSize*this._centerAltitude-_[2]*D]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){let d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=l[2],D=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(D=Math.min((d-_)/x,1)),this._camera.position=i.scaleAndAdd([],this._camera.position,l,D),this._updateStateFromCamera()}_updateStateFromCamera(){let l=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),D=i.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,k=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.degToRad(this._maxPitch)),R=Math.max((l[2]-D)/Math.cos(_),k),z=this._zoomFromMercatorZ(R);i.scaleAndAdd(l,l,d,R),this._pitch=i.clamp(_,i.degToRad(this.minPitch),i.degToRad(this.maxPitch)),this.angle=i.wrap(x,-Math.PI,Math.PI),this._setZoom(i.clamp(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){let l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,_=i.GLOBE_ZOOM_THRESHOLD_MAX,x=0,D=1/0;for(;_-d>1e-6&&_>d;){let k=d+.5*(_-d),R=this.tileSize*Math.pow(2,k),z=this.getCameraToCenterDistance(this.projection,k,R),G=this.scaleZoom(z/(l*this.tileSize)),H=Math.abs(k-G);H<D&&(D=H,x=k),k<G?d=k:_=k}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){let _=Math.min(l.x,d.x),x=Math.max(l.x,d.x),D=Math.min(l.y,d.y),k=Math.max(l.y,d.y);if(D<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let R=[new i.Point(_,D),new i.Point(x,k),new i.Point(_,k),new i.Point(x,D)],z=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(let H of R){let Y=this.pointRayIntersection(H);if(Y.t<0)return!0;let se=this.rayIntersectionCoordinate(Y);if(se.x<z||se.y<0||se.x>G||se.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.Point(0,0),new i.Point(this.width,this.height))}zoomDeltaToMovement(l,d){let _=i.length(i.sub([],this._camera.position,l)),x=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){let l=function([d,_,x],D){let k=[d,_,x,1];i.transformMat4$1(k,k,D);let R=k[3]=Math.max(k[3],1e-6);return k[0]/=R,k[1]/=R,k[2]/=R,k}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.Point(l[0],l[1])}{let l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.Point(0,l))}}getCameraToCenterDistance(l,d=this.zoom,_=this.worldSize){let x=vl(l,d,this.width,this.height,1024),D=l.pixelSpaceConversion(this.center.lat,_,x);return .5/Math.tan(.5*this._fov)*this.height*D}getWorldToCameraMatrix(){let l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.multiply(l,l,this.globeMatrix),l}}function Kt(m,l){let d=!1,_=null,x=()=>{_=null,d&&(m(),_=setTimeout(x,l),d=!1)};return()=>(d=!0,_||x(),_)}class Bd{constructor(l){this._hashName=l&&encodeURIComponent(l),i.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kt(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,i.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),i.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let l=this._map;if(!l)return"";let d=Ma(l);if(this._hashName){let _=this._hashName,x=!1,D=i.window.location.hash.slice(1).split("&").map(k=>{let R=k.split("=")[0];return R===_?(x=!0,`${R}=${d}`):k}).filter(k=>k);return x||D.push(`${_}=${d}`),`#${D.join("&")}`}return`#${d}`}_getCurrentHash(){let l=i.window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){let l=this._map;if(!l)return!1;let d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){let _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){let l=i.window.location.href.replace(/(#.+)?$/,this.getHashString());i.window.history.replaceState(i.window.history.state,null,l)}}function Ma(m,l){let d=m.getCenter(),_=Math.round(100*m.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,x),k=Math.round(d.lng*D)/D,R=Math.round(d.lat*D)/D,z=m.getBearing(),G=m.getPitch(),H=l?`/${k}/${R}/${_}`:`${_}/${R}/${k}`;return(z||G)&&(H+="/"+Math.round(10*z)/10),G&&(H+=`/${Math.round(G)}`),H}let xu={linearity:.3,easing:i.bezier(0,0,.3,1)},xl=i.extend({deceleration:2500,maxSpeed:1400},xu),gn=i.extend({deceleration:20,maxSpeed:1400},xu),Rt=i.extend({deceleration:1e3,maxSpeed:360},xu),Ko=i.extend({deceleration:1e3,maxSpeed:90},xu);class Tp{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.exported.now(),settings:l})}_drainInertiaBuffer(){let l=this._inertiaBuffer,d=i.exported.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let d={zoom:0,bearing:0,pitch:0,pan:new i.Point(0,0),pinchAround:void 0,around:void 0};for(let{settings:D}of this._inertiaBuffer)d.zoom+=D.zoomDelta||0,d.bearing+=D.bearingDelta||0,d.pitch+=D.pitchDelta||0,D.panDelta&&d.pan._add(D.panDelta),D.around&&(d.around=D.around),D.pinchAround&&(d.pinchAround=D.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(d.pan.mag()){let D=pc(d.pan.mag(),_,i.extend({},xl,l||{}));x.offset=d.pan.mult(D.amount/d.pan.mag()),x.center=this._map.transform.center,wu(x,D)}if(d.zoom){let D=pc(d.zoom,_,gn);x.zoom=this._map.transform.zoom+D.amount,wu(x,D)}if(d.bearing){let D=pc(d.bearing,_,Rt);x.bearing=this._map.transform.bearing+i.clamp(D.amount,-179,179),wu(x,D)}if(d.pitch){let D=pc(d.pitch,_,Ko);x.pitch=this._map.transform.pitch+D.amount,wu(x,D)}if(x.zoom||x.bearing){let D=d.pinchAround===void 0?d.around:d.pinchAround;x.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function wu(m,l){(!m.duration||m.duration<l.duration)&&(m.duration=l.duration,m.easing=l.easing)}function pc(m,l,d){let{maxSpeed:_,linearity:x,deceleration:D}=d,k=i.clamp(m*x/(l/1e3),-_,_),R=Math.abs(k)/(D*x);return{easing:d.easing,duration:1e3*R,amount:k*(R/2)}}class fr extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_,x={}){let D=Un(d.getCanvasContainer(),_),k=d.unproject(D);super(l,i.extend({point:D,lngLat:k,originalEvent:_},x)),this._defaultPrevented=!1,this.target=d}}class Eu extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){let x=l==="touchend"?_.changedTouches:_.touches,D=Io(d.getCanvasContainer(),x),k=D.map(z=>d.unproject(z)),R=D.reduce((z,G,H,Y)=>z.add(G.div(Y.length)),new i.Point(0,0));super(l,{points:D,point:R,lngLats:k,lngLat:d.unproject(R),originalEvent:_}),this._defaultPrevented=!1}}class Vd extends i.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class Gh{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Vd(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new fr(l.type,this._map,l))}mouseup(l){this._map.fire(new fr(l.type,this._map,l))}preclick(l){let d=i.extend({},l);d.type="preclick",this._map.fire(new fr(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new fr(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new fr(l.type,this._map,l))}mouseover(l){this._map.fire(new fr(l.type,this._map,l))}mouseout(l){this._map.fire(new fr(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Eu(l.type,this._map,l))}touchmove(l){this._map.fire(new Eu(l.type,this._map,l))}touchend(l){this._map.fire(new Eu(l.type,this._map,l))}touchcancel(l){this._map.fire(new Eu(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wl{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new fr(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new fr(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mp{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(bt(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;let _=d,x=this._startPos,D=this._lastPos;if(!x||!D||D.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=oe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));let k=Math.min(x.x,_.x),R=Math.max(x.x,_.x),z=Math.min(x.y,_.y),G=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${k}px,${z}px)`,this._box.style.width=R-k+"px",this._box.style.height=G-z+"px")})}mouseupWindow(l,d){if(!this._active)return;let _=this._startPos,x=d;if(_&&l.button===0){if(this.reset(),yi(),_.x!==x.x||_.y!==x.y)return this._map.fire(new i.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:D=>D.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ut(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new i.Event(l,{originalEvent:d}))}}function Cu(m,l){let d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=l[_];return d}class mc{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){let D=new i.Point(0,0);for(let k of x)D._add(k);return D.div(x.length)}(d),this.touches=Cu(_,d)))}touchmove(l,d,_){if(this.aborted||!this.centroid)return;let x=Cu(_,d);for(let D in this.touches){let k=x[D];(!k||k.dist(this.touches[D])>30)&&(this.aborted=!0)}}touchend(l,d,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Wh{constructor(l){this.singleTap=new mc(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,_){this.singleTap.touchstart(l,d,_)}touchmove(l,d,_){this.singleTap.touchmove(l,d,_)}touchend(l,d,_){let x=this.singleTap.touchend(l,d,_);if(x){let D=l.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(x)<30;if(D&&k||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Zg{constructor(){this._zoomIn=new Wh({numTouches:1,numTaps:2}),this._zoomOut=new Wh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,_){this._zoomIn.touchstart(l,d,_),this._zoomOut.touchstart(l,d,_)}touchmove(l,d,_){this._zoomIn.touchmove(l,d,_),this._zoomOut.touchmove(l,d,_)}touchend(l,d,_){let x=this._zoomIn.touchend(l,d,_),D=this._zoomOut.touchend(l,d,_);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(x)},{originalEvent:l})}):D?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(D)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Ip={0:1,2:2};class gc{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;let _=lt(l);this._correctButton(l,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(l,d){let _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(x,D){let k=Ip[D];return x.buttons===void 0||(x.buttons&k)!==k}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}}mouseupWindow(l){this._lastPoint&&lt(l)===this._eventButton&&(this._moved&&yi(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jd extends gc{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class qh extends gc{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){let _=.8*(d.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Zh extends gc{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){let _=-.5*(d.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class Du{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),i.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.Point(0,0)}touchstart(l,d,_){return this._calculateTransform(l,d,_)}touchmove(l,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!i.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,_)}}touchend(l,d,_){this._calculateTransform(l,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,_){_.length>0&&(this._active=!0);let x=Cu(_,d),D=new i.Point(0,0),k=new i.Point(0,0),R=0;for(let G in x){let H=x[G],Y=this._touches[G];Y&&(D._add(H),k._add(H.sub(Y)),R++,x[G]=H)}if(this._touches=x,R<this._minTouches||!k.mag())return;let z=k.div(R);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(R),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class yc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,_){return{}}touchstart(l,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,_){let x=this._firstTwoTouches;if(!x)return;l.preventDefault();let[D,k]=x,R=lo(_,d,D),z=lo(_,d,k);if(!R||!z)return;let G=this._aroundCenter?null:R.add(z).div(2);return this._move([R,z],G,l)}touchend(l,d,_){if(!this._firstTwoTouches)return;let[x,D]=this._firstTwoTouches,k=lo(_,d,x),R=lo(_,d,D);k&&R||(this._active&&yi(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function lo(m,l,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return l[_]}function Xh(m,l){return Math.log(m/l)/Math.LN2}class Sp extends yc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){let _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xh(this._distance,_),pinchAround:d}}}function Yh(m,l){return 180*m.angleWith(l)/Math.PI}class Kh extends yc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){let _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Yh(this._vector,_),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());let d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;let x=Yh(l,_);return Math.abs(x)<d}}function Ia(m){return Math.abs(m.y)>Math.abs(m.x)}class Ap extends yc{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Ia(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,_){let x=this._lastPoints;if(!x)return;let D=l[0].sub(x[0]),k=l[1].sub(x[1]);return this._map._cooperativeGestures&&!i.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(D,k,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(D.y+k.y)/2*-.5})}gestureBeginsVertically(l,d,_){if(this._valid!==void 0)return this._valid;let x=l.mag()>=2,D=d.mag()>=2;if(!x&&!D)return;if(!x||!D)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;let k=l.y>0==d.y>0;return Ia(l)&&Ia(d)&&k}}let Tu={panStep:100,bearingStep:15,pitchStep:10};class Xg{constructor(){let l=Tu;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,_=0,x=0,D=0,k=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),D=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),D=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),k=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:R=>{let z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Qh,zoom:d?Math.round(z)+d*(l.shiftKey?2:1):z,bearing:R.getBearing()+_*this._bearingStep,pitch:R.getPitch()+x*this._pitchStep,offset:[-D*this._panStep,-k*this._panStep],center:R.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qh(m){return m*(2-m)}let Jh=4.000244140625;class kp{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,i.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||i.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===i.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,_=i.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%Jh==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let d=Un(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){let z=this._type==="wheel"&&Math.abs(this._delta)>Jh?this._wheelZoomRate:this._defaultZoomRate,G=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&G!==0&&(G=1/G);let H=d(),Y=Math.pow(2,H),se=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):Y;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(se*G))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._delta=0}let _=typeof this._targetZoom=="number"?this._targetZoom:d(),x=this._startZoom,D=this._easing,k,R=!1;if(this._type==="wheel"&&x&&D){let z=Math.min((i.exported.now()-this._lastWheelEventTime)/200,1),G=D(z);k=i.number(x,_,G),z<1?this._frameId||(this._frameId=!0):R=!0}else k=_,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:k-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=i.ease;if(this._prevEase){let _=this._prevEase,x=(i.exported.now()-_.start)/_.duration,D=_.easing(x+.01)-_.easing(x),k=.27/Math.sqrt(D*D+1e-4)*.01,R=Math.sqrt(.0729-k*k);d=i.bezier(k,R,.25,1)}return this._prevEase={start:i.exported.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(i.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ef{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yg{constructor(){this._tap=new Wh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,d,_))}touchmove(l,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let x=d[0],D=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(l,d,_)}touchend(l,d,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,d,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rp{constructor(l,d,_){this._el=l,this._mousePan=d,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _c{constructor(l,d,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pp{constructor(l,d,_,x){this._el=l,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Po=m=>m.zoom||m.drag||m.pitch||m.rotate;class Op extends i.Event{}class Lp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){let _=i.sub([],d,l);this.radius=i.length(_[2]<0?i.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){i.div(l,l,this.constants),i.normalize(l,l),i.mul$1(l,l,this.constants);let d=i.scale$2([],l,this.radius);if(d[2]>0){let _=i.scale$2([],[0,0,1],i.dot(d,[0,0,1])),x=i.scale$2([],i.normalize([],[d[0],d[1],0]),this.radius),D=i.add([],d,i.scale$2([],i.sub([],i.add([],x,_),d),2));d[0]=D[0],d[1]=D[1]}return d}}function Qo(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class xs{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tp(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),i.bindAll(["handleEvent","handleWindowEvent"],this);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[i.window.document,"mousemove",{capture:!0}],[i.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[i.window,"blur",void 0]];for(let[x,D,k]of this._listeners)x.addEventListener(D,x===i.window.document?this.handleWindowEvent:this.handleEvent,k)}destroy(){for(let[l,d,_]of this._listeners)l.removeEventListener(d,l===i.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){let d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Gh(d,l));let x=d.boxZoom=new Mp(d,l);this._add("boxZoom",x);let D=new Zg,k=new Hr;d.doubleClickZoom=new ef(k,D),this._add("tapZoom",D),this._add("clickZoom",k);let R=new Yg;this._add("tapDragZoom",R);let z=d.touchPitch=new Ap(d);this._add("touchPitch",z);let G=new qh(l),H=new Zh(l);d.dragRotate=new _c(l,G,H),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);let Y=new jd(l),se=new Du(d,l);d.dragPan=new Rp(_,Y,se),this._add("mousePan",Y),this._add("touchPan",se,["touchZoom","touchRotate"]);let le=new Kh,fe=new Sp;d.touchZoomRotate=new Pp(_,fe,le,R),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wl(d));let he=d.scrollZoom=new kp(d,this);this._add("scrollZoom",he,["mousePan"]);let pe=d.keyboard=new Xg;this._add("keyboard",pe);for(let Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Q]&&d[Q].enable(l[Q])}_add(l,d,_){this._handlers.push({handlerName:l,handler:d,allowed:_}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(let{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(let{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Po(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,_){for(let x in l)if(x!==_&&(!d||d.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){let d=[];for(let _ of l)this._el.contains(_.target)&&d.push(_);return d}handleEvent(l,d){this._updatingCamera=!0;let _=l.type==="renderFrame",x=_?void 0:l,D={needsRenderFrame:!1},k={},R={},z=l.touches?this._getMapTouches(l.touches):void 0,G=z?Io(this._el,z):_?void 0:Un(this._el,l);for(let{handlerName:se,handler:le,allowed:fe}of this._handlers){if(!le.isEnabled())continue;let he;this._blockedByActive(R,fe,se)?le.reset():le[d||l.type]&&(he=le[d||l.type](l,G,z),this.mergeHandlerResult(D,k,he,se,x),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||le.isActive())&&(R[se]=le)}let H={};for(let se in this._previousActiveHandlers)R[se]||(H[se]=x);this._previousActiveHandlers=R,(Object.keys(H).length||Qo(D))&&(this._changes.push([D,k,H]),this._triggerRenderFrame()),(Object.keys(R).length||Qo(D))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Y}=D;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))}mergeHandlerResult(l,d,_,x,D){if(!_)return;i.extend(l,_);let k={handlerName:x,originalEvent:_.originalEvent||D};_.zoomDelta!==void 0&&(d.zoom=k),_.panDelta!==void 0&&(d.drag=k),_.pitchDelta!==void 0&&(d.pitch=k),_.bearingDelta!==void 0&&(d.rotate=k)}_applyChanges(){let l={},d={},_={};for(let[x,D,k]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new i.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(l.around=x.around),x.aroundCoord!==void 0&&(l.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),i.extend(d,D),i.extend(_,k);this._updateMapTransform(l,d,_),this._changes=[]}_updateMapTransform(l,d,_){let x=this._map,D=x.transform,k=ue=>[ue.x,ue.y,ue.z];if((ue=>{let ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!Qo(l)){let ue=D.zoom;D.cameraElevationReference="sea",D.recenterOnTerrain(),D.cameraElevationReference="ground",ue!==D.zoom&&this._map._update(!0)}if(D._isCameraConstrained&&x._stop(!0),!Qo(l))return void this._fireEvents(d,_,!0);let{panDelta:R,zoomDelta:z,bearingDelta:G,pitchDelta:H,around:Y,aroundCoord:se,pinchAround:le}=l;D._isCameraConstrained&&(z>0&&(z=0),D._isCameraConstrained=!1),le!==void 0&&(Y=le),(z||(ue=>d[ue]&&!this._eventsInProgress[ue])("drag"))&&Y&&(this._dragOrigin=k(D.pointCoordinate3D(Y)),this._trackingEllipsoid.setup(D._camera.position,this._dragOrigin)),D.cameraElevationReference="sea",x._stop(!0),Y=Y||x.transform.centerPoint,G&&(D.bearing+=G),H&&(D.pitch+=H),D._updateCameraState();let fe=[0,0,0];if(R)if(D.projection.name==="mercator"){let ue=this._trackingEllipsoid.projectRay(D.screenPointToMercatorRay(Y).dir),ye=this._trackingEllipsoid.projectRay(D.screenPointToMercatorRay(Y.sub(R)).dir);fe[0]=ye[0]-ue[0],fe[1]=ye[1]-ue[1]}else{let ue=D.pointCoordinate(Y);if(D.projection.name==="globe"){R=R.rotate(-D.angle);let ye=D._pixelsPerMercatorPixel/D.worldSize;fe[0]=-R.x*i.mercatorScale(i.latFromMercatorY(ue.y))*ye,fe[1]=-R.y*i.mercatorScale(D.center.lat)*ye}else{let ye=D.pointCoordinate(Y.sub(R));ue&&ye&&(fe[0]=ye.x-ue.x,fe[1]=ye.y-ue.y)}}let he=D.zoom,pe=[0,0,0];if(z){let ue=k(se||D.pointCoordinate3D(Y)),ye={dir:i.normalize([],i.sub([],ue,D._camera.position))};if(ye.dir[2]<0){let _e=D.zoomDeltaToMovement(ue,z);i.scale$2(pe,ye.dir,_e)}}let Q=i.add(fe,fe,pe);D._translateCameraConstrained(Q),z&&Math.abs(D.zoom-he)>1e-4&&D.recenterOnTerrain(),D.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,_,!0)}_fireEvents(l,d,_){let x=Po(this._eventsInProgress),D=Po(l),k={};for(let H in l){let{originalEvent:Y}=l[H];this._eventsInProgress[H]||(k[`${H}start`]=Y),this._eventsInProgress[H]=l[H]}!x&&D&&this._fireEvent("movestart",D.originalEvent);for(let H in k)this._fireEvent(H,k[H]);D&&this._fireEvent("move",D.originalEvent);for(let H in l){let{originalEvent:Y}=l[H];this._fireEvent(H,Y)}let R={},z;for(let H in this._eventsInProgress){let{handlerName:Y,originalEvent:se}=this._eventsInProgress[H];this._handlersById[Y].isActive()||(delete this._eventsInProgress[H],z=d[Y]||se,R[`${H}end`]=z)}for(let H in R)this._fireEvent(H,R[H]);let G=Po(this._eventsInProgress);if(_&&(x||D)&&!G){this._updatingCamera=!0;let H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;H?(Y(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:z})):(this._map.fire(new i.Event("moveend",{originalEvent:z})),Y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new i.Event(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new Op("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let El="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class vc extends i.Evented{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,i.bindAll(["_renderFrameCallback"],this)}getCenter(){return new i.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,_){return l=i.Point.convert(l).mult(-1),this.panTo(this.transform.center,i.extend({offset:l},d),_)}panTo(l,d,_){return this.easeTo(i.extend({center:l},d),_)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,_){return this.easeTo(i.extend({zoom:l},d),_)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,_){return this.easeTo(i.extend({bearing:l},d),_)}resetNorth(l,d){return this.rotateTo(0,i.extend({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(i.extend({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=i.LngLatBounds.convert(l);let _=d&&d.bearing||0,x=d&&d.pitch||0,D=l.getNorthWest(),k=l.getSouthEast();return this._cameraForBounds(this.transform,D,k,_,x,d)}_extendCameraOptions(l){let d={top:0,bottom:0,right:0,left:0};if(typeof(l=i.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){let _=l.padding;l.padding={top:_,bottom:_,right:_,left:_}}return l.padding=i.extend(d,l.padding),l}_minimumAABBFrustumDistance(l,d){let _=d.max[0]-d.min[0],x=d.max[1]-d.min[1];return _/x>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):x/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,_,x,D,k){let R=l.clone(),z=this._extendCameraOptions(k);R.bearing=x,R.pitch=D;let G=i.LngLat.convert(d),H=i.LngLat.convert(_),Y=.5*(G.lat+H.lat),se=.5*(G.lng+H.lng),le=i.latLngToECEF(Y,se),fe=i.normalize([],le),he=i.normalize([],i.cross([],fe,[0,1,0])),pe=i.cross([],he,fe),Q=[he[0],he[1],he[2],0,pe[0],pe[1],pe[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],ue=[le,i.latLngToECEF(G.lat,G.lng),i.latLngToECEF(H.lat,G.lng),i.latLngToECEF(H.lat,H.lng),i.latLngToECEF(G.lat,H.lng),i.latLngToECEF(Y,G.lng),i.latLngToECEF(Y,H.lng),i.latLngToECEF(G.lat,se),i.latLngToECEF(H.lat,se)],ye=i.Aabb.fromPoints(ue.map(at=>[i.dot(he,at),i.dot(pe,at),i.dot(fe,at)])),_e=i.transformMat4([],ye.center,Q);i.squaredLength(_e)===0&&i.set(_e,0,0,1),i.normalize(_e,_e),i.scale$2(_e,_e,i.GLOBE_RADIUS),R.center=i.ecefToLatLng(_e);let Se=R.getWorldToCameraMatrix(),ke=i.invert(new Float64Array(16),Se);ye=i.Aabb.applyTransform(ye,i.multiply([],Se,Q)),i.transformMat4(_e,_e,Se);let De=.5*(ye.max[2]-ye.min[2]),Be=this._minimumAABBFrustumDistance(R,ye),Fe=i.scale$2([],[0,0,1],De),Ve=i.add(Fe,_e,Fe),mt=Be+(R.pitch===0?0:i.distance(_e,Ve)),He=R.globeCenterInViewSpace,it=i.sub([],_e,[He[0],He[1],He[2]]);i.normalize(it,it),i.scale$2(it,it,mt);let Ze=i.add([],_e,it);i.transformMat4(Ze,Ze,ke);let ut=i.earthRadius/i.GLOBE_RADIUS,Ge=i.length(Ze),tt=i.mercatorZfromAltitude(Math.max(Ge*ut-i.earthRadius,Number.EPSILON),0),gt=Math.min(R.zoomFromMercatorZAdjusted(tt),z.maxZoom);return gt>.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(R.setProjection({name:"mercator"}),R.zoom=gt,this._cameraForBounds(R,d,_,x,D,k)):{center:R.center,zoom:gt,bearing:x,pitch:D}}queryTerrainElevation(l,d){let _=this.transform.elevation;return _?(d=i.extend({},{exaggerated:!0},d),_.getAtPoint(i.MercatorCoordinate.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,_,x,D,k){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,_,x,D,k);let R=l.clone(),z=this._extendCameraOptions(k),G=R.padding;R.bearing=x,R.pitch=D;let H=i.LngLat.convert(d),Y=i.LngLat.convert(_),se=new i.LngLat(H.lng,Y.lat),le=new i.LngLat(Y.lng,H.lat),fe=R.project(H),he=R.project(Y),pe=this.queryTerrainElevation(H),Q=this.queryTerrainElevation(Y),ue=this.queryTerrainElevation(se),ye=this.queryTerrainElevation(le),_e=[[fe.x,fe.y,Math.min(pe||0,Q||0,ue||0,ye||0)],[he.x,he.y,Math.max(pe||0,Q||0,ue||0,ye||0)]],Se=i.Aabb.fromPoints(_e),ke=R.getWorldToCameraMatrix(),De=i.invert(new Float64Array(16),ke);Se=i.Aabb.applyTransform(Se,ke);let Be=i.sub([],Se.max,Se.min),Fe=G.left||0,Ve=G.right||0,mt=G.bottom||0,He=G.top||0,{left:it,right:Ze,top:ut,bottom:Ge}=z.padding,tt=.5*(Fe+Ve),gt=.5*(He+mt),at=Math.min(R.scaleZoom(R.scale*Math.min((R.width-(Fe+Ve+it+Ze))/Be[0],(R.height-(mt+He+Ge+ut))/Be[1])),z.maxZoom),_t=R.scale/R.zoomScale(at);Se=new i.Aabb([Se.min[0]-(it+tt)*_t,Se.min[1]-(Ge+gt)*_t,Se.min[2]],[Se.max[0]+(Ze+tt)*_t,Se.max[1]+(ut+gt)*_t,Se.max[2]]);let $t=.5*Be[2],on=this._minimumAABBFrustumDistance(R,Se),Ft=[0,0,1,0];i.transformMat4$1(Ft,Ft,ke),i.normalize$2(Ft,Ft);let Xt=i.scale$2([],Ft,on+$t),Ht=i.add([],Se.center,Xt),En=(typeof z.offset.x=="number"&&typeof z.offset.y=="number"?new i.Point(z.offset.x,z.offset.y):i.Point.convert(z.offset)).rotate(-i.degToRad(x));Se.center[0]-=En.x*_t,Se.center[1]+=En.y*_t,i.transformMat4(Se.center,Se.center,De),i.transformMat4(Ht,Ht,De);let jt=[Se.center[0],Se.center[1],Ht[2]*R.pixelsPerMeter];i.scale$2(jt,jt,1/R.worldSize);let Xn=i.lngFromMercatorX(jt[0]),ui=i.latFromMercatorY(jt[1]),di=Math.min(R._zoomFromMercatorZ(jt[2]),z.maxZoom),hi=new i.LngLat(Xn,ui);return R.mercatorFromTransition&&di<.5*(i.GLOBE_ZOOM_THRESHOLD_MIN+i.GLOBE_ZOOM_THRESHOLD_MAX)?(R.setProjection({name:"globe"}),R.zoom=di,this._cameraForBounds(R,d,_,x,D,k)):{center:hi,zoom:di,bearing:x,pitch:D}}fitBounds(l,d,_){let x=this.cameraForBounds(l,d);return this._fitInternal(x,d,_)}fitScreenCoordinates(l,d,_,x,D){let k=i.Point.convert(l),R=i.Point.convert(d),z=new i.Point(Math.min(k.x,R.x),Math.min(k.y,R.y)),G=new i.Point(Math.max(k.x,R.x),Math.max(k.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(k,R))return this;let H=this.transform.pointLocation3D(z),Y=this.transform.pointLocation3D(G),se=this.transform.pointLocation3D(new i.Point(z.x,G.y)),le=this.transform.pointLocation3D(new i.Point(G.x,z.y)),fe=[Math.min(H.lng,Y.lng,se.lng,le.lng),Math.min(H.lat,Y.lat,se.lat,le.lat)],he=[Math.max(H.lng,Y.lng,se.lng,le.lng),Math.max(H.lat,Y.lat,se.lat,le.lat)],pe=x&&x.pitch?x.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,fe,he,_,pe,x);return this._fitInternal(Q,x,D)}_fitInternal(l,d,_){return l?(delete(d=i.extend(l,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(l,d){this.stop();let _=l.preloadOnly?this.transform.clone():this.transform,x=!1,D=!1,k=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=i.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(D=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(k=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new i.Event("movestart",d)).fire(new i.Event("move",d)),x&&this.fire(new i.Event("zoomstart",d)).fire(new i.Event("zoom",d)).fire(new i.Event("zoomend",d)),D&&this.fire(new i.Event("rotatestart",d)).fire(new i.Event("rotate",d)).fire(new i.Event("rotateend",d)),k&&this.fire(new i.Event("pitchstart",d)).fire(new i.Event("pitch",d)).fire(new i.Event("pitchend",d)),this.fire(new i.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.warnOnce(El),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){let _=this.transform;if(!_.projection.supportsFreeCamera)return i.warnOnce(El),this;this.stop();let x=_.zoom,D=_.pitch,k=_.bearing;_.setFreeCameraOptions(l);let R=x!==_.zoom,z=D!==_.pitch,G=k!==_.bearing;return this.fire(new i.Event("movestart",d)).fire(new i.Event("move",d)),R&&this.fire(new i.Event("zoomstart",d)).fire(new i.Event("zoom",d)).fire(new i.Event("zoomend",d)),G&&this.fire(new i.Event("rotatestart",d)).fire(new i.Event("rotate",d)).fire(new i.Event("rotateend",d)),z&&this.fire(new i.Event("pitchstart",d)).fire(new i.Event("pitch",d)).fire(new i.Event("pitchend",d)),this.fire(new i.Event("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=i.extend({offset:[0,0],duration:500,easing:i.ease},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);let _=this.transform,x=this.getZoom(),D=this.getBearing(),k=this.getPitch(),R=this.getPadding(),z="zoom"in l?+l.zoom:x,G="bearing"in l?this._normalizeBearing(l.bearing,D):D,H="pitch"in l?+l.pitch:k,Y="padding"in l?l.padding:_.padding,se=i.Point.convert(l.offset),le,fe,he;if(_.projection.name==="globe"){let Fe=i.MercatorCoordinate.fromLngLat(_.center),Ve=se.rotate(-_.angle);Fe.x+=Ve.x/_.worldSize,Fe.y+=Ve.y/_.worldSize;let mt=Fe.toLngLat(),He=i.LngLat.convert(l.center||mt);this._normalizeCenter(He),le=_.centerPoint.add(Ve),fe=new i.Point(Fe.x,Fe.y).mult(_.worldSize),he=new i.Point(i.mercatorXfromLng(He.lng),i.mercatorYfromLat(He.lat)).mult(_.worldSize).sub(fe)}else{le=_.centerPoint.add(se);let Fe=_.pointLocation(le),Ve=i.LngLat.convert(l.center||Fe);this._normalizeCenter(Ve),fe=_.project(Fe),he=_.project(Ve).sub(fe)}let pe=_.zoomScale(z-x),Q,ue;l.around&&(Q=i.LngLat.convert(l.around),ue=_.locationPoint(Q));let ye=this._zooming||z!==x,_e=this._rotating||D!==G,Se=this._pitching||H!==k,ke=!_.isPaddingEqual(Y),De=Fe=>Ve=>{if(ye&&(Fe.zoom=i.number(x,z,Ve)),_e&&(Fe.bearing=i.number(D,G,Ve)),Se&&(Fe.pitch=i.number(k,H,Ve)),ke&&(Fe.interpolatePadding(R,Y,Ve),le=Fe.centerPoint.add(se)),Q)Fe.setLocationAtPoint(Q,ue);else{let mt=Fe.zoomScale(Fe.zoom-x),He=z>x?Math.min(2,pe):Math.max(.5,pe),it=Math.pow(He,1-Ve),Ze=Fe.unproject(fe.add(he.mult(Ve*it)).mult(mt));Fe.setLocationAtPoint(Fe.renderWorldCopies?Ze.wrap():Ze,le)}return l.preloadOnly||this._fireMoveEvents(d),Fe};if(l.preloadOnly){let Fe=this._emulate(De,l.duration,_);return this._preloadTiles(Fe),this}let Be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=_e,this._pitching=Se,this._padding=ke,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Be),this._ease(De(_),Fe=>{_.recenterOnTerrain(),this._afterEase(d,Fe)},l),this}_prepareEase(l,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new i.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new i.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new i.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new i.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new i.Event("move",l)),this._zooming&&this.fire(new i.Event("zoom",l)),this._rotating&&this.fire(new i.Event("rotate",l)),this._pitching&&this.fire(new i.Event("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let _=this._zooming,x=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new i.Event("zoomend",l)),x&&this.fire(new i.Event("rotateend",l)),D&&this.fire(new i.Event("pitchend",l)),this.fire(new i.Event("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){let at=i.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,d)}this.stop(),l=i.extend({offset:[0,0],speed:1.2,curve:1.42,easing:i.ease},l);let _=this.transform,x=this.getZoom(),D=this.getBearing(),k=this.getPitch(),R=this.getPadding(),z="zoom"in l?i.clamp(+l.zoom,_.minZoom,_.maxZoom):x,G="bearing"in l?this._normalizeBearing(l.bearing,D):D,H="pitch"in l?+l.pitch:k,Y="padding"in l?l.padding:_.padding,se=_.zoomScale(z-x),le=i.Point.convert(l.offset),fe=_.centerPoint.add(le),he=_.pointLocation(fe),pe=i.LngLat.convert(l.center||he);this._normalizeCenter(pe);let Q=_.project(he),ue=_.project(pe).sub(Q),ye=l.curve,_e=Math.max(_.width,_.height),Se=_e/se,ke=ue.mag();if("minZoom"in l){let at=i.clamp(Math.min(l.minZoom,x,z),_.minZoom,_.maxZoom),_t=_e/_.zoomScale(at-x);ye=Math.sqrt(_t/ke*2)}let De=ye*ye;function Be(at){let _t=(Se*Se-_e*_e+(at?-1:1)*De*De*ke*ke)/(2*(at?Se:_e)*De*ke);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Fe(at){return(Math.exp(at)-Math.exp(-at))/2}function Ve(at){return(Math.exp(at)+Math.exp(-at))/2}let mt=Be(0),He=function(at){return Ve(mt)/Ve(mt+ye*at)},it=function(at){return _e*((Ve(mt)*(Fe(_t=mt+ye*at)/Ve(_t))-Fe(mt))/De)/ke;var _t},Ze=(Be(1)-mt)/ye;if(Math.abs(ke)<1e-6||!isFinite(Ze)){if(Math.abs(_e-Se)<1e-6)return this.easeTo(l,d);let at=Se<_e?-1:1;Ze=Math.abs(Math.log(Se/_e))/ye,it=function(){return 0},He=function(_t){return Math.exp(at*ye*_t)}}l.duration="duration"in l?+l.duration:1e3*Ze/("screenSpeed"in l?+l.screenSpeed/ye:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);let ut=D!==G,Ge=H!==k,tt=!_.isPaddingEqual(Y),gt=at=>_t=>{let $t=_t*Ze,on=1/He($t);at.zoom=_t===1?z:x+at.scaleZoom(on),ut&&(at.bearing=i.number(D,G,_t)),Ge&&(at.pitch=i.number(k,H,_t)),tt&&(at.interpolatePadding(R,Y,_t),fe=at.centerPoint.add(le));let Ft=_t===1?pe:at.unproject(Q.add(ue.mult(it($t))).mult(on));return at.setLocationAtPoint(at.renderWorldCopies?Ft.wrap():Ft,fe),at._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),at};if(l.preloadOnly){let at=this._emulate(gt,l.duration,_);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=ut,this._pitching=Ge,this._padding=tt,this._prepareEase(d,!1),this._ease(gt(_),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!l){let _=this.handlers;_&&_.stop(!1)}return this}_ease(l,d,_){_.animate===!1||_.duration===0?(l(1),d()):(this._easeStart=i.exported.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let l=Math.min((i.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=i.wrap(l,-180,180);let _=Math.abs(l-d);return Math.abs(l-360-d)<_&&(l-=360),Math.abs(l+360-d)<_&&(l+=360),l}_normalizeCenter(l){let d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;let _=l.lng-d.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&i.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,_){let x=Math.ceil(15*d/1e3),D=[],k=l(_.clone());for(let R=0;R<=x;R++){let z=k(R/x);D.push(z.clone())}return D}}class Ot{constructor(l={}){this.options=l,i.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){let d=this.options&&this.options.compact;return this._map=l,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=oe("button","mapboxgl-ctrl-attrib-button",this._container),oe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,d){let _=this._map._getUIString(`AttributionControl.${d}`);l.setAttribute("aria-label",_),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));let d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.config.ACCESS_TOKEN}];if(l){let _=d.reduce((x,D,k)=>(D.value&&(x+=`${D.key}=${D.value}${k<d.length-1?"&":""}`),x),"?");l.href=`${i.config.FEEDBACK_URL}/${_}#${Ma(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){let x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}let d=this._map.style._sourceCaches;for(let x in d){let D=d[x];if(D.used){let k=D.getSource();k.attribution&&l.indexOf(k.attribution)<0&&l.push(k.attribution)}}l.sort((x,D)=>x.length-D.length),l=l.filter((x,D)=>{for(let k=D+1;k<l.length;k++)if(l[k].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));let _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sa{constructor(){i.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=oe("div","mapboxgl-ctrl");let d=oe("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(let d in l){let _=l[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){let l=this._container.children;if(l.length){let d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class tf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){let d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){let d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(let x of _)if(x.id===l)return void(x.cancelled=!0)}run(l=0){let d=this._currentlyRunning=this._queue;this._queue=[];for(let _ of d)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Aa(m,l,d){if(m=new i.LngLat(m.lng,m.lat),l){let _=new i.LngLat(m.lng-360,m.lat),x=new i.LngLat(m.lng+360,m.lat),D=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),k=d.locationPoint(m).distSqr(l),R=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(_).distSqr(l)<k&&(R||Math.abs(_.lng-d.center.lng)<D)?m=_:d.locationPoint(x).distSqr(l)<k&&(R||Math.abs(x.lng-d.center.lng)<D)&&(m=x)}for(;Math.abs(m.lng-d.center.lng)>180;){let _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}let Cl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class St extends i.Evented{constructor(l,d){if(super(),(l instanceof i.window.HTMLElement||d)&&(l=i.extend({element:l},d)),i.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=i.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe("div");let x=41,D=27,k=Ee("svg",{display:"block",height:x*this._scale+"px",width:D*this._scale+"px",viewBox:`0 0 ${D} ${x}`},this._element),R=Ee("radialGradient",{id:"shadowGradient"},Ee("defs",{},k));Ee("stop",{offset:"10%","stop-opacity":.4},R),Ee("stop",{offset:"100%","stop-opacity":.05},R),Ee("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),Ee("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),Ee("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),Ee("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=i.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});let _=this._element.classList;for(let x in Cl)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){let l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=i.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){let x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){let d=l.code,_=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){let d=l.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let l=this._map,d=this._pos;if(!l||!d)return!1;let _=l.unproject(d),x=l.getFreeCameraOptions();if(!x.position)return!1;let D=x.position.toLngLat();return D.distanceTo(_)<.9*D.distanceTo(this._lngLat)}_evaluateOpacity(){let l=this._map;if(!l)return;let d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();let _=l.unproject(d),x;l._showingGlobe()&&i.isLngLatBehindGlobe(l.transform,this._lngLat)?x=0:(x=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let l=this._pos;if(!l||!this._map)return;let d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${Cl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){let l=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!l||_!=="map")return"";if(!d._showingGlobe()){let z=d.getPitch();return z?`rotateX(${z}deg)`:""}let x=i.radToDeg(i.globeTiltAtLngLat(d.transform,this._lngLat)),D=l.sub(i.globeCenterToScreenPoint(d.transform)),k=Math.abs(D.x)+Math.abs(D.y);if(k===0)return"";let R=x/k;return`rotateX(${-D.y*R}deg) rotateY(${D.x*R}deg)`}_calculateZTransform(){let l=this._pos,d=this._map;if(!d||!l)return"";let _=0,x=this.getRotationAlignment();if(x==="map")if(d._showingGlobe()){let D=d.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),k=d.project(new i.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(D);_=i.radToDeg(Math.atan2(k.y,k.x))-90}else _=-d.getBearing();else if(x==="horizon"){let D=i.smoothstep(4,6,d.getZoom()),k=i.globeCenterToScreenPoint(d.transform);k.y+=D*d.transform.height;let R=l.sub(k),z=i.radToDeg(Math.atan2(R.y,R.x));_=(z>90?z-270:z+90)*(1-D)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){i.window.cancelAnimationFrame(this._updateFrameId);let d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Aa(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=i.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=i.Point.convert(l),this._update(),this}_onMove(l){let d=this._map;if(!d)return;let _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){let D=this._clickTolerance||d._clickTolerance;if(l.point.dist(_)<D)return;this._isDragging=!0}this._pos=l.point.sub(x),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.Event("dragstart"))),this.fire(new i.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.Event("dragend")),this._state="inactive"}_addDragHandler(l){let d=this._map,_=this._pos;d&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;let d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Ud={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Kg=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fp(m=new i.Point(0,0),l="bottom"){if(typeof m=="number"){let d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(l){case"top":return new i.Point(0,m);case"top-left":return new i.Point(d,d);case"top-right":return new i.Point(-d,d);case"bottom":return new i.Point(0,-m);case"bottom-left":return new i.Point(d,-d);case"bottom-right":return new i.Point(-d,-d);case"left":return new i.Point(m,0);case"right":return new i.Point(-m,0)}return new i.Point(0,0)}return m instanceof i.Point||Array.isArray(m)?i.Point.convert(m):i.Point.convert(m[l]||[0,0])}class nf{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;let d=i.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,_){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+_}}let Np={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},zp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Qg={showCompass:!0,showZoom:!0,visualizePitch:!1};class $d{constructor(l,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new qh({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Zh({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),i.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),bt()}move(l,d){let _=this.map,x=this.mouseRotate.mousemoveWindow(l,d),D=x&&x.bearingDelta;if(D&&_.setBearing(_.getBearing()+D),this.mousePitch){let k=this.mousePitch.mousemoveWindow(l,d),R=k&&k.pitchDelta;R&&_.setPitch(_.getPitch()+R)}}off(){let l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ut(),i.window.removeEventListener("mousemove",this.mousemove),i.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(i.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Un(this.element,l)),i.window.addEventListener("mousemove",this.mousemove),i.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Un(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Io(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Io(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Mu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rf={maxWidth:100,unit:"metric"},of={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},bc={version:i.version,supported:F,setRTLTextPlugin:i.setRTLTextPlugin,getRTLTextPluginStatus:i.getRTLTextPluginStatus,Map:class extends vc{constructor(m){if(i.LivePerformanceUtils.mark(i.PerformanceMarkers.create),(m=i.extend({},zp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.isSafariWithAntialiasingBug(i.window)&&(m.antialias=!1,i.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new bl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new tf,this._domRenderTaskQueue=new tf,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.uniqueId(),this._locale=i.extend({},Np,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new nf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=i.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof i.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),i.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),i.window!==void 0&&(i.window.addEventListener("online",this._onWindowOnline,!1),i.window.addEventListener("resize",this._onWindowResize,!1),i.window.addEventListener("orientationchange",this._onWindowResize,!1),i.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new xs(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Bd(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,i.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Ot({customAttribution:m.customAttribution})),this._logoControl=new Sa,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new i.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new i.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(m,l){if(l===void 0&&(l=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let d=m.onAdd(this);this._controls.push(m);let _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let l=this._controls.indexOf(m);return l>-1&&this._controls.splice(l,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let l=!this._moving;return l&&this.fire(new i.Event("movestart",m)).fire(new i.Event("move",m)),this.fire(new i.Event("resize",m)),l&&this.fire(new i.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.Event("zoomstart")).fire(new i.Event("zoom")).fire(new i.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.Event("pitchstart")).fire(new i.Event("pitch")).fire(new i.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?i.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(l=>l==="auto"?i.window.navigator.language:l):m}setLanguage(m){let l=this._parseLanguage(m);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(let d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let m=this.transform,l=m.projection.name,d;l==="globe"&&m.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),d=!0):l==="mercator"&&m.zoom<i.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,l){return this._updateProjection(m||l||{name:"mercator"})}_updateProjection(m){let l;if(l=m.name==="globe"&&this.transform.zoom>=i.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(let d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(i.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(i.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,l,d){if(m==="mouseenter"||m==="mouseover"){let _=!1,x=k=>{let R=l.filter(G=>this.getLayer(G)),z=R.length?this.queryRenderedFeatures(k.point,{layers:R}):[];z.length?_||(_=!0,d.call(this,new fr(m,this,k.originalEvent,{features:z}))):_=!1},D=()=>{_=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:x,mouseout:D}}}if(m==="mouseleave"||m==="mouseout"){let _=!1,x=k=>{let R=l.filter(z=>this.getLayer(z));(R.length?this.queryRenderedFeatures(k.point,{layers:R}):[]).length?_=!0:_&&(_=!1,d.call(this,new fr(m,this,k.originalEvent)))},D=k=>{_&&(_=!1,d.call(this,new fr(m,this,k.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:x,mouseout:D}}}{let _=x=>{let D=l.filter(R=>this.getLayer(R)),k=D.length?this.queryRenderedFeatures(x.point,{layers:D}):[];k.length&&(x.features=k,d.call(this,x),delete x.features)};return{layers:new Set(l),listener:d,delegates:{[m]:_}}}}on(m,l,d){if(d===void 0)return super.on(m,l);Array.isArray(l)||(l=[l]);let _=this._createDelegatedListener(m,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(let x in _.delegates)this.on(x,_.delegates[x]);return this}once(m,l,d){if(d===void 0)return super.once(m,l);Array.isArray(l)||(l=[l]);let _=this._createDelegatedListener(m,l,d);for(let x in _.delegates)this.once(x,_.delegates[x]);return this}off(m,l,d){if(d===void 0)return super.off(m,l);l=new Set(Array.isArray(l)?l:[l]);let _=(D,k)=>{if(D.size!==k.size)return!1;for(let R of D)if(!k.has(R))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(D=>{for(let k=0;k<D.length;k++){let R=D[k];if(R.listener===d&&_(R.layers,l)){for(let z in R.delegates)this.off(z,R.delegates[z]);return D.splice(k,1),this}}})(x),this}queryRenderedFeatures(m,l){return this.style?(l!==void 0||m===void 0||m instanceof i.Point||Array.isArray(m)||(l=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(m,l){return this.style.querySourceFeatures(m,l)}isPointOnSurface(m){let{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&i.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.Point.convert(m))}setStyle(m,l){return(l=i.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(m,l))}_getUIString(m){let l=this._locale[m];if(l==null)throw new Error(`Missing UI string '${m}'`);return l}_updateStyle(m,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new ys(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,l){if(typeof m=="string"){let d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,i.ResourceType.Style);i.getJSON(_,(x,D)=>{x?this.fire(new i.ErrorEvent(x)):D&&this._updateDiff(D,l)})}else typeof m=="object"&&this._updateDiff(m,l)}_updateDiff(m,l){try{this.style.setState(m)&&this._update(!0)}catch(d){i.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.warnOnce("There is no style added to the map."),!1)}addSource(m,l){return this._lazyInitEmptyStyle(),this.style.addSource(m,l),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){let m=this.style&&this.style._sourceCaches;for(let l in m){let d=m[l]._tiles;for(let _ in d){let x=d[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(m,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,l,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,l,{pixelRatio:d=1,sdf:_=!1,stretchX:x,stretchY:D,content:k}={}){if(this._lazyInitEmptyStyle(),l instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&l instanceof i.window.ImageBitmap){let{width:R,height:z,data:G}=i.exported.getImageData(l);this.style.addImage(m,{data:new i.RGBAImage({width:R,height:z},G),pixelRatio:d,stretchX:x,stretchY:D,content:k,sdf:_,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:R,height:z}=l,G=l;this.style.addImage(m,{data:new i.RGBAImage({width:R,height:z},new Uint8Array(G.data)),pixelRatio:d,stretchX:x,stretchY:D,content:k,sdf:_,version:0,userImage:G}),G.onAdd&&G.onAdd(this,m)}}updateImage(m,l){let d=this.style.getImage(m);if(!d)return void this.fire(new i.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=l instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&l instanceof i.window.ImageBitmap?i.exported.getImageData(l):l,{width:x,height:D}=_;x!==void 0&&D!==void 0?x===d.data.width&&D===d.data.height?(d.data.replace(_.data,!(l instanceof i.window.HTMLImageElement||i.window.ImageBitmap&&l instanceof i.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new i.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${D})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`))):this.fire(new i.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new i.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,l){i.getImage(this._requestManager.transformRequest(m,i.ResourceType.Image),(d,_)=>{l(d,_ instanceof i.window.HTMLImageElement?i.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,l){return this._lazyInitEmptyStyle(),this.style.addLayer(m,l),this._update(!0)}moveLayer(m,l){return this.style.moveLayer(m,l),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,l,d){return this.style.setLayerZoomRange(m,l,d),this._update(!0)}setFilter(m,l,d={}){return this.style.setFilter(m,l,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,l,d,_={}){return this.style.setPaintProperty(m,l,d,_),this._update(!0)}getPaintProperty(m,l){return this.style.getPaintProperty(m,l)}setLayoutProperty(m,l,d,_={}){return this.style.setLayoutProperty(m,l,d,_),this._update(!0)}getLayoutProperty(m,l){return this.style.getLayoutProperty(m,l)}setLight(m,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.LngLat.convert(m),this.transform):0}setFeatureState(m,l){return this.style.setFeatureState(m,l),this._update()}removeFeatureState(m,l){return this.style.removeFeatureState(m,l),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;let m=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300,d,_,x,D=this._container;for(;D&&(!_||!x);){let k=i.window.getComputedStyle(D).transform;k&&k!=="none"&&(d=k.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(_=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(x=d[3])),D=D.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=x?Math.abs(l/x):l}_detectMissingCSS(){i.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=oe("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();let l=this._canvasContainer=oe("div","mapboxgl-canvas-container",m);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=oe("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let d=this._controlContainer=oe("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=oe("div",`mapboxgl-ctrl-${x}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,l){let d=i.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${l}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){let l=this._markers.indexOf(m);l!==-1&&this._markers.splice(l,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){let l=this._popups.indexOf(m);l!==-1&&this._popups.splice(l,1)}_setupPainter(){let m=i.extend({},F.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",m),d=l||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);d?(this._useWebGL2&&!l&&i.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),i.storeAuthState(d,!0),this.painter=new fc(d,this.transform,!!l),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.exported$1.testSupport(d)):this.fire(new i.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new i.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let l,d=this.painter.context.extTimerQuery,_=i.exported.now();if(this.listens("gpu-timing-frame")&&(l=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],i.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],i.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();let x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let R=this.transform.zoom,z=this.transform.pitch,G=i.exported.now(),H=new i.EvaluationParameters(R,{now:G,fadeDuration:x,pitch:z,transition:this.style.getTransition()});this.style.update(H)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let D=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),D=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):D=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){let R=i.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,l),setTimeout(()=>{let z=d.getQueryObjectEXT(l,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(l),this.fire(new i.Event("gpu-timing-frame",{cpuTime:R,gpuTime:z})),i.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:z}})},50)}if(this.listens("gpu-timing-layer")){let R=this.painter.collectGpuTimers();setTimeout(()=>{let z=this.painter.queryGpuTimers(R);this.fire(new i.Event("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){let R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let z=this.painter.queryGpuTimeDeferredRender(R);this.fire(new i.Event("gpu-timing-deferred-render",{gpuTime:z}))},50)}let k=this._sourcesDirty||this._styleDirty||this._placementDirty||D;if(k||this._repaint)this.triggerRepaint();else{let R=!this.isMoving()&&this.loaded();if(R&&(D=this._updateAverageElevation(_,!0)),D)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new i.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let z=this._calculateSpeedIndex();this.fire(new i.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,i.LivePerformanceUtils.mark(i.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&i.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(let l of this._markers)m&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(let l of this._popups)!m||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(m,l=!1){let d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);if((l||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){let _=this.transform.averageElevation,x=this.transform.sampleAverageElevation(),D=!1;this.transform.elevation&&(D=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;let k=Math.abs(_-x);if(k>1){if(this._isInitialLoad||D)return this._averageElevation.jumpTo(x),d(x);this._averageElevation.easeTo(x,m,300)}else if(k>1e-4)return this._averageElevation.jumpTo(x),d(x)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){i.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===i.AUTH_ERR_MSG||m.status===401)){let l=this.painter.context.gl;i.storeAuthState(l,!1),this._logoControl instanceof Sa&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){let m=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());let d=this.painter.context.gl,_=d.createFramebuffer();function x(D){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,D,0);let k=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,k),k}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(x(m),l.canvasCopies.map(x),l.timeStamps)}_canvasPixelComparison(m,l,d){let _=d[1]-d[0],x=m.length/4;for(let D=0;D<l.length;D++){let k=l[D],R=0;for(let z=0;z<k.length;z+=4)k[z]===m[z]&&k[z+1]===m[z+1]&&k[z+2]===m[z+2]&&k[z+3]===m[z+3]&&(R+=1);_+=(d[D+2]-d[D+1])*(1-R/x)}return _}remove(){this._hash&&this._hash.remove();for(let l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),i.window!==void 0&&(i.window.removeEventListener("resize",this._onWindowResize,!1),i.window.removeEventListener("orientationchange",this._onWindowResize,!1),i.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),i.window.removeEventListener("online",this._onWindowOnline,!1),i.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new i.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.exported.frame(l=>{let d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(m){let l=this.style?Object.values(this.style._sourceCaches):[];return i.asyncAll(l,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){i.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,l){i.setCacheLimits(m,l)}get version(){return i.version}},NavigationControl:class{constructor(m){this.options=i.extend({},Qg,m),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(i.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),oe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),oe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{let d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=oe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let m=this._map;if(!m)return;let l=m.getZoom(),d=l===m.getMaxZoom(),_=l===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){let m=this._map;if(!m)return;let l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $d(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){let m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,l){let d=oe("button",m,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(m,l){if(!this._map)return;let d=this._map._getUIString(`NavigationControl.${l}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends i.Evented{constructor(m){super(),this.options=i.extend({geolocation:i.window.navigator.geolocation},Mu,m),i.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kt(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){let l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):i.window.navigator.permissions!==void 0?i.window.navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(m){let l=this._map.getMaxBounds(),d=m.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("geolocate",m)),this._finish()}}_updateCamera(m){let l=new i.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),x=i.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),x,{geolocateSource:!0})}_updateMarker(m){if(m){let l=new i.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let m=this._map.transform,l=i.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new i.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=oe("button","mapboxgl-ctrl-geolocate",this._container),oe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{let l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe("div","mapboxgl-user-location"),this._dotElement.appendChild(oe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(oe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new St({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=oe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new St({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let m=()=>{i.window.addEventListener("ondeviceorientationabsolute"in i.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};i.window.DeviceMotionEvent!==void 0&&typeof i.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),i.window.removeEventListener("deviceorientation",this._onDeviceOrientation),i.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ot,ScaleControl:class{constructor(m){this.options=i.extend({},rf,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let m=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,_=l._containerWidth/2-m/2,x=l.unproject([_,d]),D=l.unproject([_+m,d]),k=x.distanceTo(D);if(this.options.unit==="imperial"){let R=3.2808*k;R>5280?this._setScale(m,R/5280,"mile"):this._setScale(m,R,"foot")}else this.options.unit==="nautical"?this._setScale(m,k/1852,"nautical-mile"):k>=1e3?this._setScale(m,k/1e3,"kilometer"):this._setScale(m,k,"meter")}_setScale(m,l,d){this._map._requestDomTask(()=>{let _=function(D){let k=Math.pow(10,`${Math.floor(D)}`.length-1),R=D/k;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(z){let G=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*G)/G}(R),k*R}(l),x=_/l;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(_):`${_}&nbsp;${of[d]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof i.window.HTMLElement?this._container=m.container:i.warnOnce("Full screen control 'container' must be a DOM element.")),i.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in i.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in i.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,i.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!i.window.document.fullscreenEnabled&&!i.window.document.webkitFullscreenEnabled)}_setupUI(){let m=this._fullscreenButton=oe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);oe("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),i.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(i.window.document.fullscreenElement||i.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?i.window.document.exitFullscreen?i.window.document.exitFullscreen():i.window.document.webkitCancelFullScreen&&i.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.Evented{constructor(m){super(),this.options=i.extend(Object.create(Ud),m),i.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();let l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(i.window.document.createTextNode(m))}setHTML(m){let l=i.window.document.createDocumentFragment(),d=i.window.document.createElement("body"),_;for(d.innerHTML=m;_=d.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=oe("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(m),this.options.closeButton){let d=this._closeButton=oe("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let l;return this._classList.delete(m)?l=!1:(this._classList.add(m),l=!0),this._updateClassList(),l}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;let l=this._map,d=this._container,_=this._pos;if(!l||!d||!_)return"bottom";let x=d.offsetWidth,D=d.offsetHeight,k=_.x<x/2,R=_.x>l.transform.width-x/2;if(_.y+m<D)return k?"top-left":R?"top-right":"top";if(_.y>l.transform.height-D){if(k)return"bottom-left";if(R)return"bottom-right"}return k?"left":R?"right":"bottom"}_updateClassList(){let m=this._container;if(!m)return;let l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),m.className=l.join(" ")}_update(m){let l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=oe("div","mapboxgl-popup",l.getContainer()),this._tip=oe("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Aa(this._lngLat,this._pos,l.transform)),!this._trackPointer||m){let x=this._pos=this._trackPointer&&m?m:l.project(this._lngLat),D=Fp(this.options.offset),k=this._anchor=this._getAnchor(D.y),R=Fp(this.options.offset,k),z=x.add(R).round();l._requestDomTask(()=>{this._container&&k&&(this._container.style.transform=`${Cl[k]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&l._showingGlobe()){let x=i.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(Kg);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:St,Style:ys,LngLat:i.LngLat,LngLatBounds:i.LngLatBounds,Point:i.Point,MercatorCoordinate:i.MercatorCoordinate,FreeCameraOptions:mi,Evented:i.Evented,config:i.config,prewarm:function(){ec().acquire(ms)},clearPrewarmedResources:function(){let m=jr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(ms),jr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.config.ACCESS_TOKEN},set accessToken(m){i.config.ACCESS_TOKEN=m},get baseApiUrl(){return i.config.API_URL},set baseApiUrl(m){i.config.API_URL=m},get workerCount(){return Ir.workerCount},set workerCount(m){Ir.workerCount=m},get maxParallelImageRequests(){return i.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:i.exported.setNow,restoreNow:i.exported.restoreNow};return bc});var h=t;return h})});var _L=DI((fv,dM)=>{"use strict";(function(n,r){typeof fv=="object"&&typeof dM=="object"?(n._Highcharts=r(),dM.exports=n._Highcharts):typeof define=="function"&&define.amd?define("highcharts/highcharts",[],r):typeof fv=="object"?(n._Highcharts=r(),fv.highcharts=n._Highcharts):(n.Highcharts&&n.Highcharts.error(16,!0),n.Highcharts=r())})(typeof window>"u"?fv:window,()=>(()=>{"use strict";let n,r;var t,a,h,i,C,F,V,K,oe,Ee,Ye,Ne,ct,bt,Ut,Qt,yi,Un={};Un.d=(P,u)=>{for(var p in u)Un.o(u,p)&&!Un.o(P,p)&&Object.defineProperty(P,p,{enumerable:!0,get:u[p]})},Un.o=(P,u)=>Object.prototype.hasOwnProperty.call(P,u);var Io={};Un.d(Io,{default:()=>Zw}),function(P){P.SVG_NS="http://www.w3.org/2000/svg",P.product="Highcharts",P.version="12.1.2",P.win=typeof window<"u"?window:{},P.doc=P.win.document,P.svg=P.doc&&P.doc.createElementNS&&!!P.doc.createElementNS(P.SVG_NS,"svg").createSVGRect,P.pageLang=P.doc?.documentElement?.closest("[lang]")?.lang,P.userAgent=P.win.navigator&&P.win.navigator.userAgent||"",P.isChrome=P.win.chrome,P.isFirefox=P.userAgent.indexOf("Firefox")!==-1,P.isMS=/(edge|msie|trident)/i.test(P.userAgent)&&!P.win.opera,P.isSafari=!P.isChrome&&P.userAgent.indexOf("Safari")!==-1,P.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(P.userAgent),P.isWebKit=P.userAgent.indexOf("AppleWebKit")!==-1,P.deg2rad=2*Math.PI/360,P.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],P.noop=function(){},P.supportsPassiveEvents=function(){let u=!1;if(!P.isMS){let p=Object.defineProperty({},"passive",{get:function(){u=!0}});P.win.addEventListener&&P.win.removeEventListener&&(P.win.addEventListener("testPassive",P.noop,p),P.win.removeEventListener("testPassive",P.noop,p))}return u}(),P.charts=[],P.composed=[],P.dateFormats={},P.seriesTypes={},P.symbolSizes={},P.chartCount=0}(t||(t={}));let lt=t,{charts:mo,doc:It,win:Bs}=lt;function Wa(P,u,p,y){let b=u?"Highcharts error":"Highcharts warning";P===32&&(P=`${b}: Deprecated member`);let w=Cn(P),T=w?`${b} #${P}: www.highcharts.com/errors/${P}/`:P.toString();if(y!==void 0){let M="";w&&(T+="?"),fs(y,function(S,O){M+=`
 - ${O}: ${S}`,w&&(T+=encodeURI(O)+"="+encodeURI(S))}),T+=M}Xa(lt,"displayError",{chart:p,code:P,message:T,params:y},function(){if(u)throw Error(T);Bs.console&&Wa.messages.indexOf(T)===-1&&console.warn(T)}),Wa.messages.push(T)}function An(P,u){return parseInt(P,u||10)}function Yi(P){return typeof P=="string"}function Xl(P){let u=Object.prototype.toString.call(P);return u==="[object Array]"||u==="[object Array Iterator]"}function Vs(P,u){return!!P&&typeof P=="object"&&(!u||!Xl(P))}function qa(P){return Vs(P)&&typeof P.nodeType=="number"}function Yc(P){let u=P&&P.constructor;return!!(Vs(P,!0)&&!qa(P)&&u&&u.name&&u.name!=="Object")}function Cn(P){return typeof P=="number"&&!isNaN(P)&&P<1/0&&P>-1/0}function Wo(P){return P!=null}function dr(P,u,p){let y,b=Yi(u)&&!Wo(p),w=(T,M)=>{Wo(T)?P.setAttribute(M,T):b?(y=P.getAttribute(M))||M!=="class"||(y=P.getAttribute(M+"Name")):P.removeAttribute(M)};return Yi(u)?w(p,u):fs(u,w),y}function vr(P){return Xl(P)?P:[P]}function go(P,u){let p;for(p in P||(P={}),u)P[p]=u[p];return P}function Fi(){let P=arguments,u=P.length;for(let p=0;p<u;p++){let y=P[p];if(y!=null)return y}}function hs(P,u){go(P.style,u)}function Za(P){return Math.pow(10,Math.floor(Math.log(P)/Math.LN10))}function js(P,u){return P>1e14?P:parseFloat(P.toPrecision(u||14))}(Wa||(Wa={})).messages=[],Math.easeInOutSine=function(P){return-.5*(Math.cos(Math.PI*P)-1)};let Us=Array.prototype.find?function(P,u){return P.find(u)}:function(P,u){let p,y=P.length;for(p=0;p<y;p++)if(u(P[p],p))return P[p]};function fs(P,u,p){for(let y in P)Object.hasOwnProperty.call(P,y)&&u.call(p||P[y],P[y],y,P)}function _a(P,u,p){function y(T,M){let S=P.removeEventListener;S&&S.call(P,T,M,!1)}function b(T){let M,S;P.nodeName&&(u?(M={})[u]=!0:M=T,fs(M,function(O,B){if(T[B])for(S=T[B].length;S--;)y(B,T[B][S].fn)}))}let w=typeof P=="function"&&P.prototype||P;if(Object.hasOwnProperty.call(w,"hcEvents")){let T=w.hcEvents;if(u){let M=T[u]||[];p?(T[u]=M.filter(function(S){return p!==S.fn}),y(u,p)):(b(T),T[u]=[])}else b(T),delete w.hcEvents}}function Xa(P,u,p,y){if(p=p||{},It.createEvent&&(P.dispatchEvent||P.fireEvent&&P!==lt)){let b=It.createEvent("Events");b.initEvent(u,!0,!0),p=go(b,p),P.dispatchEvent?P.dispatchEvent(p):P.fireEvent(u,p)}else if(P.hcEvents){p.target||go(p,{preventDefault:function(){p.defaultPrevented=!0},target:P,type:u});let b=[],w=P,T=!1;for(;w.hcEvents;)Object.hasOwnProperty.call(w,"hcEvents")&&w.hcEvents[u]&&(b.length&&(T=!0),b.unshift.apply(b,w.hcEvents[u])),w=Object.getPrototypeOf(w);T&&b.sort((M,S)=>M.order-S.order),b.forEach(M=>{M.fn.call(P,p)===!1&&p.preventDefault()})}y&&!p.defaultPrevented&&y.call(P,p)}let Nn=function(){let P=Math.random().toString(36).substring(2,9)+"-",u=0;return function(){return"highcharts-"+(n?"":P)+u++}}();Bs.jQuery&&(Bs.jQuery.fn.highcharts=function(){let P=[].slice.call(arguments);if(this[0])return P[0]?(new lt[Yi(P[0])?P.shift():"Chart"](this[0],P[0],P[1]),this):mo[dr(this[0],"data-highcharts-chart")]});let Zt={addEvent:function(P,u,p,y={}){let b=typeof P=="function"&&P.prototype||P;Object.hasOwnProperty.call(b,"hcEvents")||(b.hcEvents={});let w=b.hcEvents;lt.Point&&P instanceof lt.Point&&P.series&&P.series.chart&&(P.series.chart.runTrackerClick=!0);let T=P.addEventListener;T&&T.call(P,u,p,!!lt.supportsPassiveEvents&&{passive:y.passive===void 0?u.indexOf("touch")!==-1:y.passive,capture:!1}),w[u]||(w[u]=[]);let M={fn:p,order:typeof y.order=="number"?y.order:1/0};return w[u].push(M),w[u].sort((S,O)=>S.order-O.order),function(){_a(P,u,p)}},arrayMax:function(P){let u=P.length,p=P[0];for(;u--;)P[u]>p&&(p=P[u]);return p},arrayMin:function(P){let u=P.length,p=P[0];for(;u--;)P[u]<p&&(p=P[u]);return p},attr:dr,clamp:function(P,u,p){return P>u?P<p?P:p:u},clearTimeout:function(P){Wo(P)&&clearTimeout(P)},correctFloat:js,createElement:function(P,u,p,y,b){let w=It.createElement(P);return u&&go(w,u),b&&hs(w,{padding:"0",border:"none",margin:"0"}),p&&hs(w,p),y&&y.appendChild(w),w},crisp:function(P,u=0,p){let y=u%2/2,b=p?-1:1;return(Math.round(P*b-y)+y)*b},css:hs,defined:Wo,destroyObjectProperties:function(P,u,p){fs(P,function(y,b){y!==u&&y?.destroy&&y.destroy(),(y?.destroy||!p)&&delete P[b]})},diffObjects:function(P,u,p,y){let b={};return function w(T,M,S,O){let B=p?M:T;fs(T,function(N,U){if(!O&&y&&y.indexOf(U)>-1&&M[U]){N=vr(N),S[U]=[];for(let X=0;X<Math.max(N.length,M[U].length);X++)M[U][X]&&(N[X]===void 0?S[U][X]=M[U][X]:(S[U][X]={},w(N[X],M[U][X],S[U][X],O+1)))}else Vs(N,!0)&&!N.nodeType?(S[U]=Xl(N)?[]:{},w(N,M[U]||{},S[U],O+1),Object.keys(S[U]).length!==0||U==="colorAxis"&&O===0||delete S[U]):(T[U]!==M[U]||U in T&&!(U in M))&&U!=="__proto__"&&U!=="constructor"&&(S[U]=B[U])})}(P,u,b,0),b},discardElement:function(P){P&&P.parentElement&&P.parentElement.removeChild(P)},erase:function(P,u){let p=P.length;for(;p--;)if(P[p]===u){P.splice(p,1);break}},error:Wa,extend:go,extendClass:function(P,u){let p=function(){};return p.prototype=new P,go(p.prototype,u),p},find:Us,fireEvent:Xa,getAlignFactor:(P="")=>({center:.5,right:1,middle:.5,bottom:1})[P]||0,getClosestDistance:function(P,u){let p,y,b,w,T=!u;return P.forEach(M=>{if(M.length>1)for(w=y=M.length-1;w>0;w--)(b=M[w]-M[w-1])<0&&!T?(u?.(),u=void 0):b&&(p===void 0||b<p)&&(p=b)}),p},getMagnitude:Za,getNestedProperty:function(P,u){let p=P.split(".");for(;p.length&&Wo(u);){let y=p.shift();if(y===void 0||y==="__proto__")return;if(y==="this"){let w;return Vs(u)&&(w=u["@this"]),w??u}let b=u[y.replace(/[\\'"]/g,"")];if(!Wo(b)||typeof b=="function"||typeof b.nodeType=="number"||b===Bs)return;u=b}return u},getStyle:function P(u,p,y){let b;if(p==="width"){let T=Math.min(u.offsetWidth,u.scrollWidth),M=u.getBoundingClientRect&&u.getBoundingClientRect().width;return M<T&&M>=T-1&&(T=Math.floor(M)),Math.max(0,T-(P(u,"padding-left",!0)||0)-(P(u,"padding-right",!0)||0))}if(p==="height")return Math.max(0,Math.min(u.offsetHeight,u.scrollHeight)-(P(u,"padding-top",!0)||0)-(P(u,"padding-bottom",!0)||0));let w=Bs.getComputedStyle(u,void 0);return w&&(b=w.getPropertyValue(p),Fi(y,p!=="opacity")&&(b=An(b))),b},insertItem:function(P,u){let p,y=P.options.index,b=u.length;for(p=P.options.isInternal?b:0;p<b+1;p++)if(!u[p]||Cn(y)&&y<Fi(u[p].options.index,u[p]._i)||u[p].options.isInternal){u.splice(p,0,P);break}return p},isArray:Xl,isClass:Yc,isDOMElement:qa,isFunction:function(P){return typeof P=="function"},isNumber:Cn,isObject:Vs,isString:Yi,merge:function(P,...u){let p,y=[P,...u],b={},w=function(M,S){return typeof M!="object"&&(M={}),fs(S,function(O,B){B!=="__proto__"&&B!=="constructor"&&(!Vs(O,!0)||Yc(O)||qa(O)?M[B]=S[B]:M[B]=w(M[B]||{},O))}),M};P===!0&&(b=y[1],y=Array.prototype.slice.call(y,2));let T=y.length;for(p=0;p<T;p++)b=w(b,y[p]);return b},normalizeTickInterval:function(P,u,p,y,b){let w,T=P;p=Fi(p,Za(P));let M=P/p;for(!u&&(u=b?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],y===!1&&(p===1?u=u.filter(function(S){return S%1==0}):p<=.1&&(u=[1/p]))),w=0;w<u.length&&(T=u[w],(!b||!(T*p>=P))&&(b||!(M<=(u[w]+(u[w+1]||u[w]))/2)));w++);return js(T*p,-Math.round(Math.log(.001)/Math.LN10))},objectEach:fs,offset:function(P){let u=It.documentElement,p=P.parentElement||P.parentNode?P.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:p.top+(Bs.pageYOffset||u.scrollTop)-(u.clientTop||0),left:p.left+(Bs.pageXOffset||u.scrollLeft)-(u.clientLeft||0),width:p.width,height:p.height}},pad:function(P,u,p){return Array((u||2)+1-String(P).replace("-","").length).join(p||"0")+P},pick:Fi,pInt:An,pushUnique:function(P,u){return 0>P.indexOf(u)&&!!P.push(u)},relativeLength:function(P,u,p){return/%$/.test(P)?u*parseFloat(P)/100+(p||0):parseFloat(P)},removeEvent:_a,replaceNested:function(P,...u){let p,y;do for(y of(p=P,u))P=P.replace(y[0],y[1]);while(P!==p);return P},splat:vr,stableSort:function(P,u){let p,y,b=P.length;for(y=0;y<b;y++)P[y].safeI=y;for(P.sort(function(w,T){return(p=u(w,T))===0?w.safeI-T.safeI:p}),y=0;y<b;y++)delete P[y].safeI},syncTimeout:function(P,u,p){return u>0?setTimeout(P,u,p):(P.call(0,p),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(P){return Yi(P)?P.substring(0,1).toUpperCase()+P.substring(1):String(P)},uniqueKey:Nn,useSerialIds:function(P){return n=Fi(P,n)},wrap:function(P,u,p){let y=P[u];P[u]=function(){let b=arguments,w=this;return p.apply(this,[function(){return y.apply(w,arguments.length?arguments:b)}].concat([].slice.call(arguments)))}}},{pageLang:yo,win:va}=lt,{defined:_i,error:_o,extend:Ya,isNumber:ps,isObject:Kr,isString:$s,merge:Yl,objectEach:Kc,pad:Qr,splat:Kl,timeUnits:Di,ucfirst:hd}=Zt,So=lt.isSafari&&va.Intl&&!va.Intl.DateTimeFormat.prototype.formatRange,ba=P=>P.main===void 0,Ql=P=>["D","L","M","X","J","V","S"].indexOf(P),Hs=class{constructor(P){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=va.Date,this.update(P)}update(P={}){this.dTLCache={},this.options=P=Yl(!0,this.options,P);let{timezoneOffset:u,useUTC:p}=P;this.Date=P.Date||va.Date||Date;let y=P.timezone;_i(p)&&(y=p?"UTC":void 0),u&&u%60==0&&(y="Etc/GMT"+(u>0?"+":"")+u/60),this.variableTimezone=y!=="UTC"&&y?.indexOf("Etc/GMT")!==0,this.timezone=y,["months","shortMonths","weekdays","shortWeekdays"].forEach(b=>{let w=/months/i.test(b),T=/short/.test(b),M={timeZone:"UTC"};M[w?"month":"weekday"]=T?"short":"long",this[b]=(w?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(S=>this.dateFormat(M,(w?31:1)*24*36e5*S))})}toParts(P){let[u,p,y,b,w,T,M]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},P,"es").split(/(?:, |\/|:)/g);return[b,+y-1,p,w,T,M,Math.floor(Number(P)||0)%1e3,Ql(u)].map(Number)}dateTimeFormat(P,u,p=this.options.locale||yo){let y=JSON.stringify(P)+p;$s(P)&&(P=this.str2dtf(P));let b=this.dTLCache[y];if(!b){P.timeZone??(P.timeZone=this.timezone);try{b=new Intl.DateTimeFormat(p,P)}catch(w){/Invalid time zone/i.test(w.message)?(_o(34),P.timeZone="UTC",b=new Intl.DateTimeFormat(p,P)):_o(w.message,!1)}}return this.dTLCache[y]=b,b?.format(u)||""}str2dtf(P,u={}){let p={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(p).forEach(y=>{P.indexOf(y)!==-1&&Ya(u,p[y])}),u}makeTime(P,u,p=1,y=0,b,w,T){let M=this.Date.UTC(P,u,p,y,b||0,w||0,T||0);if(this.timezone!=="UTC"){let S=this.getTimezoneOffset(M);if(M+=S,[2,3,8,9,10,11].indexOf(u)!==-1&&(y<5||y>20)){let O=this.getTimezoneOffset(M);S!==O?M+=O-S:S-36e5!==this.getTimezoneOffset(M-36e5)||So||(M-=36e5)}}return M}parse(P){if(!$s(P))return P??void 0;let u=(P=P.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(P),p=/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(P);u||p||(P+="Z");let y=Date.parse(P);if(ps(y))return y+(!u||p?this.getTimezoneOffset(y):0)}getTimezoneOffset(P){if(this.timezone!=="UTC"){let[u,p,y,b,w=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},P,"en").split(/(GMT|:)/).map(Number),T=-(36e5*(y+w/60));if(ps(T))return T}return 0}dateFormat(P,u,p){let y=lt.defaultOptions?.lang;if(!_i(u)||isNaN(u))return y?.invalidDate||"";if($s(P=P??"%Y-%m-%d %H:%M:%S")){let b,w=/%\[([a-zA-Z]+)\]/g;for(;b=w.exec(P);)P=P.replace(b[0],this.dateTimeFormat(b[1],u))}if($s(P)&&P.indexOf("%")!==-1){let b=this,[w,T,M,S,O,B,N,U]=this.toParts(u),X=y?.weekdays||this.weekdays,Z=y?.shortWeekdays||this.shortWeekdays,te=y?.months||this.months,ne=y?.shortMonths||this.shortMonths;Kc(Ya({a:Z?Z[U]:X[U].substr(0,3),A:X[U],d:Qr(M),e:Qr(M,2," "),w:U,b:ne[T],B:te[T],m:Qr(T+1),o:T+1,y:w.toString().substr(2,2),Y:w,H:Qr(S),k:S,I:Qr(S%12||12),l:S%12||12,M:Qr(O),p:S<12?"AM":"PM",P:S<12?"am":"pm",S:Qr(B),L:Qr(N,3)},lt.dateFormats),function(J,ce){if($s(P))for(;P.indexOf("%"+ce)!==-1;)P=P.replace("%"+ce,typeof J=="function"?J.call(b,u):J)})}else if(Kr(P)){let b=(this.getTimezoneOffset(u)||0)/36e5,w=this.timezone||"Etc/GMT"+(b>=0?"+":"")+b,{prefix:T="",suffix:M=""}=P;P=T+this.dateTimeFormat(Ya({timeZone:w},P),u)+M}return p?hd(P):P}resolveDTLFormat(P){return Kr(P,!0)?Kr(P,!0)&&ba(P)?{main:P}:P:{main:(P=Kl(P))[0],from:P[1],to:P[2]}}getTimeTicks(P,u,p,y){let b=this,w=[],T={},{count:M=1,unitRange:S}=P,[O,B,N,U,X,Z]=b.toParts(u),te=(u||0)%1e3,ne;if(y??(y=1),_i(u)){if(te=S>=Di.second?0:M*Math.floor(te/M),S>=Di.second&&(Z=S>=Di.minute?0:M*Math.floor(Z/M)),S>=Di.minute&&(X=S>=Di.hour?0:M*Math.floor(X/M)),S>=Di.hour&&(U=S>=Di.day?0:M*Math.floor(U/M)),S>=Di.day&&(N=S>=Di.month?1:Math.max(1,M*Math.floor(N/M))),S>=Di.month&&(B=S>=Di.year?0:M*Math.floor(B/M)),S>=Di.year&&(O-=O%M),S===Di.week){M&&(u=b.makeTime(O,B,N,U,X,Z,te));let de=Ql(this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},u,"es"));N+=-de+y+(de<y?-7:0)}u=b.makeTime(O,B,N,U,X,Z,te),b.variableTimezone&&_i(p)&&(ne=p-u>4*Di.month||b.getTimezoneOffset(u)!==b.getTimezoneOffset(p));let J=u,ce=1;for(;J<p;)w.push(J),S===Di.year?J=b.makeTime(O+ce*M,0):S===Di.month?J=b.makeTime(O,B+ce*M):ne&&(S===Di.day||S===Di.week)?J=b.makeTime(O,B,N+ce*M*(S===Di.day?1:7)):ne&&S===Di.hour&&M>1?J=b.makeTime(O,B,N,U+ce*M):J+=S*M,ce++;w.push(J),S<=Di.hour&&w.length<1e4&&w.forEach(de=>{de%18e5==0&&b.dateFormat("%H%M%S%L",de)==="000000000"&&(T[de]="day")})}return w.info=Ya(P,{higherRanks:T,totalRange:S*M}),w}getDateFormat(P,u,p,y){let b=this.dateFormat("%m-%d %H:%M:%S.%L",u),w="01-01 00:00:00.000",T={millisecond:15,second:12,minute:9,hour:6,day:3},M="millisecond",S=M;for(M in Di){if(P===Di.week&&+this.dateFormat("%w",u)===p&&b.substr(6)===w.substr(6)){M="week";break}if(Di[M]>P){M=S;break}if(T[M]&&b.substr(T[M])!==w.substr(T[M]))break;M!=="week"&&(S=M)}return this.resolveDTLFormat(y[M]).main}},{isTouchDevice:Jl}=lt,{fireEvent:Qc,merge:Ka}=Zt,vo={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{locale:void 0,loading:"Loading...",months:void 0,shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:P=>Math.sqrt(1-Math.pow(P-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"Week from %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,shape:"callout",shared:!1,snap:Jl?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,shadow:!0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},Gs=new Hs(vo.time),Mr={defaultOptions:vo,defaultTime:Gs,getOptions:function(){return vo},setOptions:function(P){return Qc(lt,"setOptions",{options:P}),Ka(!0,vo,P),P.time&&Gs.update(vo.time),P.lang&&"locale"in P.lang&&Gs.update({locale:P.lang.locale}),vo}},{isNumber:Ws,merge:fd,pInt:be,defined:ie}=Zt;class re{static parse(u){return u?new re(u):re.None}constructor(u){let p,y,b,w;this.rgba=[NaN,NaN,NaN,NaN],this.input=u;let T=lt.Color;if(T&&T!==re)return new T(u);if(typeof u=="object"&&u.stops!==void 0)this.stops=u.stops.map(M=>new re(M[1]));else if(typeof u=="string")for(this.input=u=re.names[u.toLowerCase()]||u,b=re.parsers.length;b--&&!y;)(p=(w=re.parsers[b]).regex.exec(u))&&(y=w.parse(p));y&&(this.rgba=y)}get(u){let p=this.input,y=this.rgba;if(typeof p=="object"&&this.stops!==void 0){let b=fd(p);return b.stops=[].slice.call(b.stops),this.stops.forEach((w,T)=>{b.stops[T]=[b.stops[T][0],w.get(u)]}),b}return y&&Ws(y[0])?u!=="rgb"&&(u||y[3]!==1)?u==="a"?`${y[3]}`:"rgba("+y.join(",")+")":"rgb("+y[0]+","+y[1]+","+y[2]+")":p}brighten(u){let p=this.rgba;if(this.stops)this.stops.forEach(function(y){y.brighten(u)});else if(Ws(u)&&u!==0)for(let y=0;y<3;y++)p[y]+=be(255*u),p[y]<0&&(p[y]=0),p[y]>255&&(p[y]=255);return this}setOpacity(u){return this.rgba[3]=u,this}tweenTo(u,p){let y=this.rgba,b=u.rgba;if(!Ws(y[0])||!Ws(b[0]))return u.input||"none";let w=b[3]!==1||y[3]!==1,T=(S,O)=>S+(y[O]-S)*(1-p),M=b.slice(0,3).map(T).map(Math.round);return w&&M.push(T(b[3],3)),(w?"rgba(":"rgb(")+M.join(",")+")"}}re.names={white:"#ffffff",black:"#000000"},re.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(P){return[be(P[1]),be(P[2]),be(P[3]),parseFloat(P[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(P){return[be(P[1]),be(P[2]),be(P[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(P){return[be(P[1]+P[1],16),be(P[2]+P[2],16),be(P[3]+P[3],16),ie(P[4])?be(P[4]+P[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(P){return[be(P[1],16),be(P[2],16),be(P[3],16),ie(P[4])?be(P[4],16)/255:1]}}],re.None=new re("");let{parse:ve}=re,{win:Me}=lt,{isNumber:Pe,objectEach:$e}=Zt,je=(()=>{class P{constructor(p,y,b){this.pos=NaN,this.options=y,this.elem=p,this.prop=b}dSetter(){let p=this.paths,y=p&&p[0],b=p&&p[1],w=this.now||0,T=[];if(w!==1&&y&&b)if(y.length===b.length&&w<1)for(let M=0;M<b.length;M++){let S=y[M],O=b[M],B=[];for(let N=0;N<O.length;N++){let U=S[N],X=O[N];Pe(U)&&Pe(X)&&!(O[0]==="A"&&(N===4||N===5))?B[N]=U+w*(X-U):B[N]=X}T.push(B)}else T=b;else T=this.toD||[];this.elem.attr("d",T,void 0,!0)}update(){let p=this.elem,y=this.prop,b=this.now,w=this.options.step;this[y+"Setter"]?this[y+"Setter"]():p.attr?p.element&&p.attr(y,b,null,!0):p.style[y]=b+this.unit,w&&w.call(p,b,this)}run(p,y,b){let w=this,T=w.options,M=function(B){return!M.stopped&&w.step(B)},S=Me.requestAnimationFrame||function(B){setTimeout(B,13)},O=function(){for(let B=0;B<P.timers.length;B++)P.timers[B]()||P.timers.splice(B--,1);P.timers.length&&S(O)};p!==y||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=p,this.end=y,this.unit=b,this.now=this.start,this.pos=0,M.elem=this.elem,M.prop=this.prop,M()&&P.timers.push(M)===1&&S(O)):(delete T.curAnim[this.prop],T.complete&&Object.keys(T.curAnim).length===0&&T.complete.call(this.elem))}step(p){let y,b,w=+new Date,T=this.options,M=this.elem,S=T.complete,O=T.duration,B=T.curAnim;return M.attr&&!M.element?y=!1:p||w>=O+this.startTime?(this.now=this.end,this.pos=1,this.update(),B[this.prop]=!0,b=!0,$e(B,function(N){N!==!0&&(b=!1)}),b&&S&&S.call(M),y=!1):(this.pos=T.easing((w-this.startTime)/O),this.now=this.start+(this.end-this.start)*this.pos,this.update(),y=!0),y}initPath(p,y,b){let w=p.startX,T=p.endX,M=b.slice(),S=p.isArea,O=S?2:1,B=y&&b.length>y.length&&b.hasStackedCliffs,N,U,X,Z,te=y&&y.slice();if(!te||B)return[M,M];function ne(ce,de){for(;ce.length<U;){let Ae=ce[0],Ue=de[U-ce.length];if(Ue&&Ae[0]==="M"&&(Ue[0]==="C"?ce[0]=["C",Ae[1],Ae[2],Ae[1],Ae[2],Ae[1],Ae[2]]:ce[0]=["L",Ae[1],Ae[2]]),ce.unshift(Ae),S){let Le=ce.pop();ce.push(ce[ce.length-1],Le)}}}function J(ce){for(;ce.length<U;){let de=ce[Math.floor(ce.length/O)-1].slice();if(de[0]==="C"&&(de[1]=de[5],de[2]=de[6]),S){let Ae=ce[Math.floor(ce.length/O)].slice();ce.splice(ce.length/2,0,de,Ae)}else ce.push(de)}}if(w&&T&&T.length){for(X=0;X<w.length;X++){if(w[X]===T[0]){N=X;break}if(w[0]===T[T.length-w.length+X]){N=X,Z=!0;break}if(w[w.length-1]===T[T.length-w.length+X]){N=w.length-X;break}}N===void 0&&(te=[])}return te.length&&Pe(N)&&(U=M.length+N*O,Z?(ne(te,M),J(M)):(ne(M,te),J(te))),[te,M]}fillSetter(){P.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,ve(this.start).tweenTo(ve(this.end),this.pos),void 0,!0)}}return P.timers=[],P})(),{defined:Oe,getStyle:Xe,isArray:wt,isNumber:Mt,isObject:yt,merge:an,objectEach:Dn,pick:cn}=Zt;function mn(P){return yt(P)?an({duration:500,defer:0},P):{duration:P?500:0,defer:0}}function kn(P,u){let p=je.timers.length;for(;p--;)je.timers[p].elem!==P||u&&u!==je.timers[p].prop||(je.timers[p].stopped=!0)}let Rn={animate:function(P,u,p){let y,b="",w,T,M;yt(p)||(M=arguments,p={duration:M[2],easing:M[3],complete:M[4]}),Mt(p.duration)||(p.duration=400),p.easing=typeof p.easing=="function"?p.easing:Math[p.easing]||Math.easeInOutSine,p.curAnim=an(u),Dn(u,function(S,O){kn(P,O),T=new je(P,p,O),w=void 0,O==="d"&&wt(u.d)?(T.paths=T.initPath(P,P.pathArray,u.d),T.toD=u.d,y=0,w=1):P.attr?y=P.attr(O):(y=parseFloat(Xe(P,O))||0,O!=="opacity"&&(b="px")),w||(w=S),typeof w=="string"&&w.match("px")&&(w=w.replace(/px/g,"")),T.run(y,w,b)})},animObject:mn,getDeferredAnimation:function(P,u,p){let y=mn(u),b=p?[p]:P.series,w=0,T=0;return b.forEach(M=>{let S=mn(M.options.animation);w=yt(u)&&Oe(u.defer)?y.defer:Math.max(w,S.duration+S.defer),T=Math.min(y.duration,S.duration)}),P.renderer.forExport&&(w=0),{defer:Math.max(0,w-T),duration:Math.min(w,T)}},setAnimation:function(P,u){u.renderer.globalAnimation=cn(P,u.options.chart.animation,!0)},stop:kn},{SVG_NS:Ki,win:Vr}=lt,{attr:hr,createElement:ms,css:Ir,error:jr,isFunction:ec,isString:gp,objectEach:Mh,splat:ei}=Zt,{trustedTypes:Jc}=Vr,xa=Jc&&ec(Jc.createPolicy)&&Jc.createPolicy("highcharts",{createHTML:P=>P}),Ih=xa?xa.createHTML(""):"";class vi{static filterUserAttributes(u){return Mh(u,(p,y)=>{let b=!0;vi.allowedAttributes.indexOf(y)===-1&&(b=!1),["background","dynsrc","href","lowsrc","src"].indexOf(y)!==-1&&(b=gp(p)&&vi.allowedReferences.some(w=>p.indexOf(w)===0)),b||(jr(33,!1,void 0,{"Invalid attribute in config":`${y}`}),delete u[y]),gp(p)&&u[y]&&(u[y]=p.replace(/</g,"&lt;"))}),u}static parseStyle(u){return u.split(";").reduce((p,y)=>{let b=y.split(":").map(T=>T.trim()),w=b.shift();return w&&b.length&&(p[w.replace(/-([a-z])/g,T=>T[1].toUpperCase())]=b.join(":")),p},{})}static setElementHTML(u,p){u.innerHTML=vi.emptyHTML,p&&new vi(p).addToDOM(u)}constructor(u){this.nodes=typeof u=="string"?this.parseMarkup(u):u}addToDOM(u){return function p(y,b){let w;return ei(y).forEach(function(T){let M,S=T.tagName,O=T.textContent?lt.doc.createTextNode(T.textContent):void 0,B=vi.bypassHTMLFiltering;if(S)if(S==="#text")M=O;else if(vi.allowedTags.indexOf(S)!==-1||B){let N=S==="svg"?Ki:b.namespaceURI||Ki,U=lt.doc.createElementNS(N,S),X=T.attributes||{};Mh(T,function(Z,te){te!=="tagName"&&te!=="attributes"&&te!=="children"&&te!=="style"&&te!=="textContent"&&(X[te]=Z)}),hr(U,B?X:vi.filterUserAttributes(X)),T.style&&Ir(U,T.style),O&&U.appendChild(O),p(T.children||[],U),M=U}else jr(33,!1,void 0,{"Invalid tagName in config":S});M&&b.appendChild(M),w=M}),w}(this.nodes,u)}parseMarkup(u){let p,y=[];u=u.trim().replace(/ style=(["'])/g," data-style=$1");try{p=new DOMParser().parseFromString(xa?xa.createHTML(u):u,"text/html")}catch{}if(!p){let w=ms("div");w.innerHTML=u,p={body:w}}let b=(w,T)=>{let M=w.nodeName.toLowerCase(),S={tagName:M};M==="#text"&&(S.textContent=w.textContent||"");let O=w.attributes;if(O){let B={};[].forEach.call(O,N=>{N.name==="data-style"?S.style=vi.parseStyle(N.value):B[N.name]=N.value}),S.attributes=B}if(w.childNodes.length){let B=[];[].forEach.call(w.childNodes,N=>{b(N,B)}),B.length&&(S.children=B)}T.push(S)};return[].forEach.call(p.body.childNodes,w=>b(w,y)),y}}vi.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],vi.allowedReferences=["https://","http://","mailto:","/","../","./","#"],vi.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMorphology","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"],vi.emptyHTML=Ih,vi.bypassHTMLFiltering=!1;let{defaultOptions:qo,defaultTime:gs}=Mr,{pageLang:Sh}=lt,{extend:Ah,getNestedProperty:Qa,isArray:qs,isNumber:tc,isObject:Je,isString:Zs,pick:sr,ucfirst:Sr}=Zt,eu={add:(P,u)=>P+u,divide:(P,u)=>u!==0?P/u:"",eq:(P,u)=>P==u,each:function(P){let u=arguments[arguments.length-1];return!!qs(P)&&P.map((p,y)=>tu(u.body,Ah(Je(p)?p:{"@this":p},{"@index":y,"@first":y===0,"@last":y===P.length-1}))).join("")},ge:(P,u)=>P>=u,gt:(P,u)=>P>u,if:P=>!!P,le:(P,u)=>P<=u,lt:(P,u)=>P<u,multiply:(P,u)=>P*u,ne:(P,u)=>P!=u,subtract:(P,u)=>P-u,ucfirst:Sr,unless:P=>!P},Zo={},pd=P=>/^["'].+["']$/.test(P);function tu(P="",u,p){let y=/\{([\p{L}\d:\.,;\-\/<>\[\]%_@+"'= #\(\)]+)\}/gu,b=/\(([\p{L}\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/gu,w=[],T=/f$/,M=/\.(\d)/,S=p?.options.lang||qo.lang,O=p&&p.time||gs,B=p&&p.numberFormatter||Ja,N=(ne="")=>{let J;return ne==="true"||ne!=="false"&&((J=Number(ne)).toString()===ne?J:pd(ne)?ne.slice(1,-1):Qa(ne,u))},U,X,Z=0,te;for(;(U=y.exec(P))!==null;){let ne=U,J=b.exec(U[1]);J&&(U=J,te=!0),X&&X.isBlock||(X={ctx:u,expression:U[1],find:U[0],isBlock:U[1].charAt(0)==="#",start:U.index,startInner:U.index+U[0].length,length:U[0].length});let ce=(X.isBlock?ne:U)[1].split(" ")[0].replace("#","");eu[ce]&&(X.isBlock&&ce===X.fn&&Z++,X.fn||(X.fn=ce));let de=U[1]==="else";if(X.isBlock&&X.fn&&(U[1]===`/${X.fn}`||de))if(Z)!de&&Z--;else{let Ae=X.startInner,Ue=P.substr(Ae,U.index-Ae);X.body===void 0?(X.body=Ue,X.startInner=U.index+U[0].length):X.elseBody=Ue,X.find+=Ue+U[0],de||(w.push(X),X=void 0)}else X.isBlock||w.push(X);if(J&&!X?.isBlock)break}return w.forEach(ne=>{let J,ce,{body:de,elseBody:Ae,expression:Ue,fn:Le}=ne;if(Le){let Ie=[ne],ze=[],nt=Ue.length,rt=0,ft;for(ce=0;ce<=nt;ce++){let Bt=Ue.charAt(ce);ft||Bt!=='"'&&Bt!=="'"?ft===Bt&&(ft=""):ft=Bt,ft||Bt!==" "&&ce!==nt||(ze.push(Ue.substr(rt,ce-rt)),rt=ce+1)}for(ce=eu[Le].length;ce--;)Ie.unshift(N(ze[ce+1]));J=eu[Le].apply(u,Ie),ne.isBlock&&typeof J=="boolean"&&(J=tu(J?de:Ae,u,p))}else{let Ie=pd(Ue)?[Ue]:Ue.split(":");if(J=N(Ie.shift()||""),Ie.length&&typeof J=="number"){let ze=Ie.join(":");if(T.test(ze)){let nt=parseInt((ze.match(M)||["","-1"])[1],10);J!==null&&(J=B(J,nt,S.decimalPoint,ze.indexOf(",")>-1?S.thousandsSep:""))}else J=O.dateFormat(ze,J)}b.lastIndex=0,b.test(ne.find)&&Zs(J)&&(J=`"${J}"`)}P=P.replace(ne.find,sr(J,""))}),te?tu(P,u,p):P}function Ja(P,u,p,y){u=+u;let b,w,[T,M]=(P=+P||0).toString().split("e").map(Number),S=this?.options?.lang||qo.lang,O=(P.toString().split(".")[1]||"").split("e")[0].length,B=u,N={};p??(p=S.decimalPoint),y??(y=S.thousandsSep),u===-1?u=Math.min(O,20):tc(u)?u&&M<0&&((w=u+M)>=0?(T=+T.toExponential(w).split("e")[0],u=w):(T=Math.floor(T),P=u<20?+(T*Math.pow(10,M)).toFixed(u):0,M=0)):u=2,M&&(u??(u=2),P=T),tc(u)&&u>=0&&(N.minimumFractionDigits=u,N.maximumFractionDigits=u),y===""&&(N.useGrouping=!1);let U=y||p,X=U?"en":this?.locale||S.locale||Sh,Z=JSON.stringify(N)+X;return b=(Zo[Z]??(Zo[Z]=new Intl.NumberFormat(X,N))).format(P),U&&(b=b.replace(/([,\.])/g,"_$1").replace(/_\,/g,y??",").replace("_.",p??".")),(u||+b!=0)&&(!(M<0)||B)||(b="0"),M&&+b!=0&&(b+="e"+(M<0?"":"+")+M),b}let Dt={dateFormat:function(P,u,p){return gs.dateFormat(P,u,p)},format:tu,helpers:eu,numberFormat:Ja};(function(P){let u;P.rendererTypes={},P.getRendererType=function(p=u){return P.rendererTypes[p]||P.rendererTypes[u]},P.registerRendererType=function(p,y,b){P.rendererTypes[p]=y,(!u||b)&&(u=p,lt.Renderer=y)}})(a||(a={}));let xn=a,{clamp:In,pick:bo,pushUnique:Xo,stableSort:wn}=Zt;(h||(h={})).distribute=function P(u,p,y){let b=u,w=b.reducedLen||p,T=(de,Ae)=>de.target-Ae.target,M=[],S=u.length,O=[],B=M.push,N,U,X,Z=!0,te,ne,J=0,ce;for(N=S;N--;)J+=u[N].size;if(J>w){for(wn(u,(de,Ae)=>(Ae.rank||0)-(de.rank||0)),X=(ce=u[0].rank===u[u.length-1].rank)?S/2:-1,U=ce?X:S-1;X&&J>w;)te=u[N=Math.floor(U)],Xo(O,N)&&(J-=te.size),U+=X,ce&&U>=u.length&&(X/=2,U=X);O.sort((de,Ae)=>Ae-de).forEach(de=>B.apply(M,u.splice(de,1)))}for(wn(u,T),u=u.map(de=>({size:de.size,targets:[de.target],align:bo(de.align,.5)}));Z;){for(N=u.length;N--;)te=u[N],ne=(Math.min.apply(0,te.targets)+Math.max.apply(0,te.targets))/2,te.pos=In(ne-te.size*te.align,0,p-te.size);for(N=u.length,Z=!1;N--;)N>0&&u[N-1].pos+u[N-1].size>u[N].pos&&(u[N-1].size+=u[N].size,u[N-1].targets=u[N-1].targets.concat(u[N].targets),u[N-1].align=.5,u[N-1].pos+u[N-1].size>p&&(u[N-1].pos=p-u[N-1].size),u.splice(N,1),Z=!0)}return B.apply(b,M),N=0,u.some(de=>{let Ae=0;return(de.targets||[]).some(()=>(b[N].pos=de.pos+Ae,y!==void 0&&Math.abs(b[N].pos-b[N].target)>y?(b.slice(0,N+1).forEach(Ue=>delete Ue.pos),b.reducedLen=(b.reducedLen||p)-.1*p,b.reducedLen>.1*p&&P(b,p,y),!0):(Ae+=b[N].size,N++,!1)))}),wn(b,T),b};let Ur=h,{animate:nu,animObject:el,stop:xo}=Rn,{deg2rad:Ti,doc:tl,svg:Xs,SVG_NS:wa,win:iu,isFirefox:kh}=lt,{addEvent:yp,attr:nl,createElement:ru,crisp:il,css:rl,defined:Vi,erase:Qi,extend:ol,fireEvent:ou,getAlignFactor:$r,isArray:wo,isFunction:Rh,isNumber:su,isObject:ji,isString:nc,merge:au,objectEach:Ao,pick:Mi,pInt:ic,pushUnique:Ph,replaceNested:Ys,syncTimeout:Ea,uniqueKey:lu}=Zt;class br{_defaultGetter(u){let p=Mi(this[u+"Value"],this[u],this.element?this.element.getAttribute(u):null,0);return/^-?[\d\.]+$/.test(p)&&(p=parseFloat(p)),p}_defaultSetter(u,p,y){y.setAttribute(p,u)}add(u){let p,y=this.renderer,b=this.element;return u&&(this.parentGroup=u),this.textStr!==void 0&&this.element.nodeName==="text"&&y.buildText(this),this.added=!0,(!u||u.handleZ||this.zIndex)&&(p=this.zIndexSetter()),p||(u?u.element:y.box).appendChild(b),this.onAdd&&this.onAdd(),this}addClass(u,p){let y=p?"":this.attr("class")||"";return(u=(u||"").split(/ /g).reduce(function(b,w){return y.indexOf(w)===-1&&b.push(w),b},y?[y]:[]).join(" "))!==y&&this.attr("class",u),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(u,p,y,b=!0){let w=this.renderer,T=w.alignedObjects,M=!!u;u?(this.alignOptions=u,this.alignByTranslate=p,this.alignTo=y):(u=this.alignOptions||{},p=this.alignByTranslate,y=this.alignTo);let S=!y||nc(y)?y||"renderer":void 0;S&&(M&&Ph(T,this),y=void 0);let O=Mi(y,w[S],w),B=(O.x||0)+(u.x||0)+((O.width||0)-(u.width||0))*$r(u.align),N=(O.y||0)+(u.y||0)+((O.height||0)-(u.height||0))*$r(u.verticalAlign),U={"text-align":u?.align};return U[p?"translateX":"x"]=Math.round(B),U[p?"translateY":"y"]=Math.round(N),b&&(this[this.placed?"animate":"attr"](U),this.placed=!0),this.alignAttr=U,this}alignSetter(u){let p={left:"start",center:"middle",right:"end"};p[u]&&(this.alignValue=u,this.element.setAttribute("text-anchor",p[u]))}animate(u,p,y){let b=el(Mi(p,this.renderer.globalAnimation,!0)),w=b.defer;return tl.hidden&&(b.duration=0),b.duration!==0?(y&&(b.complete=y),Ea(()=>{this.element&&nu(this,u,b)},w)):(this.attr(u,void 0,y||b.complete),Ao(u,function(T,M){b.step&&b.step.call(this,T,{prop:M,pos:1,elem:this})},this)),this}applyTextOutline(u){let p=this.element;u.indexOf("contrast")!==-1&&(u=u.replace(/contrast/g,this.renderer.getContrast(p.style.fill)));let y=u.split(" "),b=y[y.length-1],w=y[0];if(w&&w!=="none"&&lt.svg){this.fakeTS=!0,w=w.replace(/(^[\d\.]+)(.*?)$/g,function(B,N,U){return 2*Number(N)+U}),this.removeTextOutline();let T=tl.createElementNS(wa,"tspan");nl(T,{class:"highcharts-text-outline",fill:b,stroke:b,"stroke-width":w,"stroke-linejoin":"round"});let M=p.querySelector("textPath")||p;[].forEach.call(M.childNodes,B=>{let N=B.cloneNode(!0);N.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(U=>N.removeAttribute(U)),T.appendChild(N)});let S=0;[].forEach.call(M.querySelectorAll("text tspan"),B=>{S+=Number(B.getAttribute("dy"))});let O=tl.createElementNS(wa,"tspan");O.textContent="\u200B",nl(O,{x:Number(p.getAttribute("x")),dy:-S}),T.appendChild(O),M.insertBefore(T,M.firstChild)}}attr(u,p,y,b){let{element:w}=this,T=br.symbolCustomAttribs,M,S,O=this,B;return typeof u=="string"&&p!==void 0&&(M=u,(u={})[M]=p),typeof u=="string"?O=(this[u+"Getter"]||this._defaultGetter).call(this,u,w):(Ao(u,function(N,U){B=!1,b||xo(this,U),this.symbolName&&T.indexOf(U)!==-1&&(S||(this.symbolAttr(u),S=!0),B=!0),this.rotation&&(U==="x"||U==="y")&&(this.doTransform=!0),B||(this[U+"Setter"]||this._defaultSetter).call(this,N,U,w)},this),this.afterSetters()),y&&y.call(this),O}clip(u){if(u&&!u.clipPath){let p=lu()+"-",y=this.renderer.createElement("clipPath").attr({id:p}).add(this.renderer.defs);ol(u,{clipPath:y,id:p,count:0}),u.add(y)}return this.attr("clip-path",u?`url(${this.renderer.url}#${u.id})`:"none")}crisp(u,p){p=Math.round(p||u.strokeWidth||0);let y=u.x||this.x||0,b=u.y||this.y||0,w=(u.width||this.width||0)+y,T=(u.height||this.height||0)+b,M=il(y,p),S=il(b,p);return ol(u,{x:M,y:S,width:il(w,p)-M,height:il(T,p)-S}),Vi(u.strokeWidth)&&(u.strokeWidth=p),u}complexColor(u,p,y){let b=this.renderer,w,T,M,S,O,B,N,U,X,Z,te=[],ne;ou(this.renderer,"complexColor",{args:arguments},function(){if(u.radialGradient?T="radialGradient":u.linearGradient&&(T="linearGradient"),T){if(M=u[T],O=b.gradients,B=u.stops,X=y.radialReference,wo(M)&&(u[T]=M={x1:M[0],y1:M[1],x2:M[2],y2:M[3],gradientUnits:"userSpaceOnUse"}),T==="radialGradient"&&X&&!Vi(M.gradientUnits)&&(S=M,M=au(M,b.getRadialAttr(X,S),{gradientUnits:"userSpaceOnUse"})),Ao(M,function(J,ce){ce!=="id"&&te.push(ce,J)}),Ao(B,function(J){te.push(J)}),O[te=te.join(",")])Z=O[te].attr("id");else{M.id=Z=lu();let J=O[te]=b.createElement(T).attr(M).add(b.defs);J.radAttr=S,J.stops=[],B.forEach(function(ce){ce[1].indexOf("rgba")===0?(N=(w=re.parse(ce[1])).get("rgb"),U=w.get("a")):(N=ce[1],U=1);let de=b.createElement("stop").attr({offset:ce[0],"stop-color":N,"stop-opacity":U}).add(J);J.stops.push(de)})}ne="url("+b.url+"#"+Z+")",y.setAttribute(p,ne),y.gradient=te,u.toString=function(){return ne}}})}css(u){let p=this.styles,y={},b=this.element,w,T=!p;if(p&&Ao(u,function(M,S){p&&p[S]!==M&&(y[S]=M,T=!0)}),T){p&&(u=ol(p,y)),u.width===null||u.width==="auto"?delete this.textWidth:b.nodeName.toLowerCase()==="text"&&u.width&&(w=this.textWidth=ic(u.width)),ol(this.styles,u),w&&!Xs&&this.renderer.forExport&&delete u.width;let M=kh&&u.fontSize||null;M&&(su(M)||/^\d+$/.test(M))&&(u.fontSize+="px");let S=au(u);b.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(O=>S&&delete S[O]),S.color&&(S.fill=S.color)),rl(b,S)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),u.textOutline&&this.applyTextOutline(u.textOutline)),this}dashstyleSetter(u){let p,y=this["stroke-width"];if(y==="inherit"&&(y=1),u=u&&u.toLowerCase()){let b=u.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(p=b.length;p--;)b[p]=""+ic(b[p])*Mi(y,NaN);u=b.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",u)}}destroy(){let u=this,p=u.element||{},y=u.renderer,b=p.ownerSVGElement,w=p.nodeName==="SPAN"&&u.parentGroup||void 0,T,M;if(p.onclick=p.onmouseout=p.onmouseover=p.onmousemove=p.point=null,xo(u),u.clipPath&&b){let S=u.clipPath;[].forEach.call(b.querySelectorAll("[clip-path],[CLIP-PATH]"),function(O){O.getAttribute("clip-path").indexOf(S.element.id)>-1&&O.removeAttribute("clip-path")}),u.clipPath=S.destroy()}if(u.connector=u.connector?.destroy(),u.stops){for(M=0;M<u.stops.length;M++)u.stops[M].destroy();u.stops.length=0,u.stops=void 0}for(u.safeRemoveChild(p);w&&w.div&&w.div.childNodes.length===0;)T=w.parentGroup,u.safeRemoveChild(w.div),delete w.div,w=T;u.alignOptions&&Qi(y.alignedObjects,u),Ao(u,function(S,O){u[O]&&u[O].parentGroup===u&&u[O].destroy&&u[O].destroy(),delete u[O]})}dSetter(u,p,y){wo(u)&&(typeof u[0]=="string"&&(u=this.renderer.pathToSegments(u)),this.pathArray=u,u=u.reduce((b,w,T)=>w&&w.join?(T?b+" ":"")+w.join(" "):(w||"").toString(),"")),/(NaN| {2}|^$)/.test(u)&&(u="M 0 0"),this[p]!==u&&(y.setAttribute(p,u),this[p]=u)}fillSetter(u,p,y){typeof u=="string"?y.setAttribute(p,u):u&&this.complexColor(u,p,y)}hrefSetter(u,p,y){y.setAttributeNS("http://www.w3.org/1999/xlink",p,u)}getBBox(u,p){let y,b,w,T,{alignValue:M,element:S,renderer:O,styles:B,textStr:N}=this,{cache:U,cacheKeys:X}=O,Z=S.namespaceURI===this.SVG_NS,te=Mi(p,this.rotation,0),ne=O.styledMode?S&&br.prototype.getStyle.call(S,"font-size"):B.fontSize;if(Vi(N)&&((T=N.toString()).indexOf("<")===-1&&(T=T.replace(/\d/g,"0")),T+=["",O.rootFontSize,ne,te,this.textWidth,M,B.lineClamp,B.textOverflow,B.fontWeight].join(",")),T&&!u&&(y=U[T]),!y||y.polygon){if(Z||O.forExport){try{w=this.fakeTS&&function(ce){let de=S.querySelector(".highcharts-text-outline");de&&rl(de,{display:ce})},Rh(w)&&w("none"),y=S.getBBox?ol({},S.getBBox()):{width:S.offsetWidth,height:S.offsetHeight,x:0,y:0},Rh(w)&&w("")}catch{}(!y||y.width<0)&&(y={x:0,y:0,width:0,height:0})}else y=this.htmlGetBBox();b=y.height,Z&&(y.height=b={"11px,17":14,"13px,20":16}[`${ne||""},${Math.round(b)}`]||b),te&&(y=this.getRotatedBox(y,te));let J={bBox:y};ou(this,"afterGetBBox",J),y=J.bBox}if(T&&(N===""||y.height>0)){for(;X.length>250;)delete U[X.shift()];U[T]||X.push(T),U[T]=y}return y}getRotatedBox(u,p){let{x:y,y:b,width:w,height:T}=u,{alignValue:M,translateY:S,rotationOriginX:O=0,rotationOriginY:B=0}=this,N=$r(M),U=Number(this.element.getAttribute("y")||0)-(S?0:b),X=p*Ti,Z=(p-90)*Ti,te=Math.cos(X),ne=Math.sin(X),J=w*te,ce=w*ne,de=Math.cos(Z),Ae=Math.sin(Z),[[Ue,Le],[Ie,ze]]=[O,B].map(sn=>[sn-sn*te,sn*ne]),nt=y+N*(w-J)+Ue+ze+U*de,rt=nt+J,ft=rt-T*de,Bt=ft-J,Lt=b+U-N*ce-Le+Ie+U*Ae,Vt=Lt+ce,Yt=Vt-T*Ae,zt=Yt-ce,Tn=Math.min(nt,rt,ft,Bt),un=Math.min(Lt,Vt,Yt,zt),dn=Math.max(nt,rt,ft,Bt)-Tn,Hn=Math.max(Lt,Vt,Yt,zt)-un;return{x:Tn,y:un,width:dn,height:Hn,polygon:[[nt,Lt],[rt,Vt],[ft,Yt],[Bt,zt]]}}getStyle(u){return iu.getComputedStyle(this.element||this,"").getPropertyValue(u)}hasClass(u){return(""+this.attr("class")).split(" ").indexOf(u)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(u,p){this.onEvents={},this.opacity=1,this.SVG_NS=wa,this.element=p==="span"||p==="body"?ru(p):tl.createElementNS(this.SVG_NS,p),this.renderer=u,this.styles={},ou(this,"afterInit")}on(u,p){let{onEvents:y}=this;return y[u]&&y[u](),y[u]=yp(this.element,u,p),this}opacitySetter(u,p,y){let b=Number(Number(u).toFixed(3));this.opacity=b,y.setAttribute(p,b)}reAlign(){this.alignOptions?.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(u){return this.attr("class",(""+this.attr("class")).replace(nc(u)?RegExp(`(^| )${u}( |$)`):u," ").replace(/ +/g," ").trim())}removeTextOutline(){let u=this.element.querySelector("tspan.highcharts-text-outline");u&&this.safeRemoveChild(u)}safeRemoveChild(u){let p=u.parentNode;p&&p.removeChild(u)}setRadialReference(u){let p=this.element.gradient&&this.renderer.gradients[this.element.gradient];return this.element.radialReference=u,p&&p.radAttr&&p.animate(this.renderer.getRadialAttr(u,p.radAttr)),this}shadow(u){let{renderer:p}=this,y=au(this.parentGroup?.rotation===90?{offsetX:-1,offsetY:-1}:{},ji(u)?u:{}),b=p.shadowDefinition(y);return this.attr({filter:u?`url(${p.url}#${b})`:"none"})}show(u=!0){return this.attr({visibility:u?"inherit":"visible"})}"stroke-widthSetter"(u,p,y){this[p]=u,y.setAttribute(p,u)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let u=this.getStyle("stroke-width"),p=0,y;return/px$/.test(u)?p=ic(u):u!==""&&(nl(y=tl.createElementNS(wa,"rect"),{width:u,"stroke-width":0}),this.element.parentNode.appendChild(y),p=y.getBBox().width,y.parentNode.removeChild(y)),p}symbolAttr(u){let p=this;br.symbolCustomAttribs.forEach(function(y){p[y]=Mi(u[y],p[y])}),p.attr({d:p.renderer.symbols[p.symbolName](p.x,p.y,p.width,p.height,p)})}textSetter(u){u!==this.textStr&&(delete this.textPxLength,this.textStr=u,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(u){let p=this.element,y=p.getElementsByTagName("title")[0]||tl.createElementNS(this.SVG_NS,"title");p.insertBefore?p.insertBefore(y,p.firstChild):p.appendChild(y),y.textContent=Ys(Mi(u,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let u=this.element;return u.parentNode.appendChild(u),this}translate(u,p){return this.attr({translateX:u,translateY:p})}updateTransform(u="transform"){let{element:p,matrix:y,rotation:b=0,rotationOriginX:w,rotationOriginY:T,scaleX:M,scaleY:S,translateX:O=0,translateY:B=0}=this,N=["translate("+O+","+B+")"];Vi(y)&&N.push("matrix("+y.join(",")+")"),b&&(N.push("rotate("+b+" "+Mi(w,p.getAttribute("x"),0)+" "+Mi(T,p.getAttribute("y")||0)+")"),this.text?.element.tagName==="SPAN"&&this.text.attr({rotation:b,rotationOriginX:(w||0)-this.padding,rotationOriginY:(T||0)-this.padding})),(Vi(M)||Vi(S))&&N.push("scale("+Mi(M,1)+" "+Mi(S,1)+")"),N.length&&!(this.text||this).textPath&&p.setAttribute(u,N.join(" "))}visibilitySetter(u,p,y){u==="inherit"?y.removeAttribute(p):this[p]!==u&&y.setAttribute(p,u),this[p]=u}xGetter(u){return this.element.nodeName==="circle"&&(u==="x"?u="cx":u==="y"&&(u="cy")),this._defaultGetter(u)}zIndexSetter(u,p){let y=this.renderer,b=this.parentGroup,w=(b||y).element||y.box,T=this.element,M=w===y.box,S,O,B,N=!1,U,X=this.added,Z;if(Vi(u)?(T.setAttribute("data-z-index",u),u=+u,this[p]===u&&(X=!1)):Vi(this[p])&&T.removeAttribute("data-z-index"),this[p]=u,X){for((u=this.zIndex)&&b&&(b.handleZ=!0),Z=(S=w.childNodes).length-1;Z>=0&&!N;Z--)U=!Vi(B=(O=S[Z]).getAttribute("data-z-index")),O!==T&&(u<0&&U&&!M&&!Z?(w.insertBefore(T,S[Z]),N=!0):(ic(B)<=u||U&&(!Vi(u)||u>=0))&&(w.insertBefore(T,S[Z+1]),N=!0));N||(w.insertBefore(T,S[M?3:0]),N=!0)}return N}}br.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],br.prototype.strokeSetter=br.prototype.fillSetter,br.prototype.yGetter=br.prototype.xGetter,br.prototype.matrixSetter=br.prototype.rotationOriginXSetter=br.prototype.rotationOriginYSetter=br.prototype.rotationSetter=br.prototype.scaleXSetter=br.prototype.scaleYSetter=br.prototype.translateXSetter=br.prototype.translateYSetter=br.prototype.verticalAlignSetter=function(P,u){this[u]=P,this.doTransform=!0};let ko=br,{defined:sl,extend:ys,getAlignFactor:md,isNumber:Yo,merge:Ks,pick:Ca,removeEvent:_s}=Zt;class vs extends ko{constructor(u,p,y,b,w,T,M,S,O,B){let N;super(u,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=p,this.x=y,this.y=b,this.anchorX=T,this.anchorY=M,this.baseline=O,this.className=B,this.addClass(B==="button"?"highcharts-no-tooltip":"highcharts-label"),B&&this.addClass("highcharts-"+B),this.text=u.text(void 0,0,0,S).attr({zIndex:1}),typeof w=="string"&&((N=/^url\((.*?)\)$/.test(w))||this.renderer.symbols[w])&&(this.symbolKey=w),this.bBox=vs.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=u.styledMode||N,this.deferredAttr={},this.alignFactor=0}alignSetter(u){let p=md(u);this.textAlign=u,p!==this.alignFactor&&(this.alignFactor=p,this.bBox&&Yo(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(u,p){this.anchorX=u,this.boxAttr(p,Math.round(u)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(u,p){this.anchorY=u,this.boxAttr(p,u-this.ySetting)}boxAttr(u,p){this.box?this.box.attr(u,p):this.deferredAttr[u]=p}css(u){if(u){let p={};u=Ks(u),vs.textProps.forEach(y=>{u[y]!==void 0&&(p[y]=u[y],delete u[y])}),this.text.css(p),"fontSize"in p||"fontWeight"in p?this.updateTextPadding():("width"in p||"textOverflow"in p)&&this.updateBoxSize()}return ko.prototype.css.call(this,u)}destroy(){_s(this.element,"mouseenter"),_s(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),ko.prototype.destroy.call(this)}fillSetter(u,p){u&&(this.needsBox=!0),this.fill=u,this.boxAttr(p,u)}getBBox(u,p){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:y,height:b=0,translateX:w=0,translateY:T=0,width:M=0}=this,S=Ca(this.paddingLeft,y),O=p??(this.rotation||0),B={width:M,height:b,x:w+this.bBox.x-S,y:T+this.bBox.y-y+this.baselineOffset};return O&&(B=this.getRotatedBox(B,O)),B}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(u){this.heightSetting=u,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:Ca(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&sl(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(u,p){Yo(u)?u!==this[p]&&(this[p]=u,this.updateTextPadding()):this[p]=void 0}rSetter(u,p){this.boxAttr(p,u)}strokeSetter(u,p){this.stroke=u,this.boxAttr(p,u)}"stroke-widthSetter"(u,p){u&&(this.needsBox=!0),this["stroke-width"]=u,this.boxAttr(p,u)}"text-alignSetter"(u){this.textAlign=this["text-align"]=u,this.updateTextPadding()}textSetter(u){u!==void 0&&this.text.attr({text:u}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let u,p=this.text,y={},b=this.padding,w=this.bBox=(!Yo(this.widthSetting)||!Yo(this.heightSetting)||this.textAlign)&&sl(p.textStr)?p.getBBox(void 0,0):vs.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||w.height||0)+2*b;let T=this.renderer.fontMetrics(p);if(this.baselineOffset=b+Math.min((this.text.firstLineMetrics||T).b,w.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-T.h)/2),this.needsBox&&!p.textPath){if(!this.box){let M=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();M.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),M.add(this)}u=this.getCrispAdjust(),y.x=u,y.y=(this.baseline?-this.baselineOffset:0)+u,y.width=Math.round(this.width),y.height=Math.round(this.height),this.box.attr(ys(y,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let u=this.text,p=u.styles.textAlign||this.textAlign;if(!u.textPath){this.updateBoxSize();let y=this.baseline?0:this.baselineOffset,b=(this.paddingLeft??this.padding)+md(p)*(this.widthSetting??this.bBox.width);(b!==u.x||y!==u.y)&&(u.attr({align:p,x:b}),y!==void 0&&u.attr("y",y)),u.x=b,u.y=y}}widthSetter(u){this.widthSetting=Yo(u)?u:void 0,this.doUpdate=!0}getPaddedWidth(){let u=this.padding,p=Ca(this.paddingLeft,u),y=Ca(this.paddingRight,u);return(this.widthSetting||this.bBox.width||0)+p+y}xSetter(u){this.x=u,this.alignFactor&&(u-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(u),this.attr("translateX",this.xSetting)}ySetter(u){this.ySetting=this.y=Math.round(u),this.attr("translateY",this.ySetting)}}vs.emptyBBox={width:0,height:0,x:0,y:0},vs.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:al,isNumber:cu,pick:rc}=Zt;function uu(P,u,p,y,b){let w=[];if(b){let T=b.start||0,M=rc(b.r,p),S=rc(b.r,y||p),O=2e-4/(b.borderRadius?1:Math.max(M,1)),B=Math.abs((b.end||0)-T-2*Math.PI)<O,N=(b.end||0)-(B?O:0),U=b.innerR,X=rc(b.open,B),Z=Math.cos(T),te=Math.sin(T),ne=Math.cos(N),J=Math.sin(N),ce=rc(b.longArc,N-T-Math.PI<O?0:1),de=["A",M,S,0,ce,rc(b.clockwise,1),P+M*ne,u+S*J];de.params={start:T,end:N,cx:P,cy:u},w.push(["M",P+M*Z,u+S*te],de),al(U)&&((de=["A",U,U,0,ce,al(b.clockwise)?1-b.clockwise:0,P+U*Z,u+U*te]).params={start:N,end:T,cx:P,cy:u},w.push(X?["M",P+U*ne,u+U*J]:["L",P+U*ne,u+U*J],de)),X||w.push(["Z"])}return w}function gd(P,u,p,y,b){return b&&b.r?du(P,u,p,y,b):[["M",P,u],["L",P+p,u],["L",P+p,u+y],["L",P,u+y],["Z"]]}function du(P,u,p,y,b){let w=b?.r||0;return[["M",P+w,u],["L",P+p-w,u],["A",w,w,0,0,1,P+p,u+w],["L",P+p,u+y-w],["A",w,w,0,0,1,P+p-w,u+y],["L",P+w,u+y],["A",w,w,0,0,1,P,u+y-w],["L",P,u+w],["A",w,w,0,0,1,P+w,u],["Z"]]}let ll={arc:uu,callout:function(P,u,p,y,b){let w=Math.min(b&&b.r||0,p,y),T=w+6,M=b&&b.anchorX,S=b&&b.anchorY||0,O=du(P,u,p,y,{r:w});if(!cu(M)||M<p&&M>0&&S<y&&S>0)return O;if(P+M>p-T)if(S>u+T&&S<u+y-T)O.splice(3,1,["L",P+p,S-6],["L",P+p+6,S],["L",P+p,S+6],["L",P+p,u+y-w]);else if(M<p){let B=S<u+T,N=B?u:u+y;O.splice(B?2:5,0,["L",M,S],["L",P+p-w,N])}else O.splice(3,1,["L",P+p,y/2],["L",M,S],["L",P+p,y/2],["L",P+p,u+y-w]);else if(P+M<T)if(S>u+T&&S<u+y-T)O.splice(7,1,["L",P,S+6],["L",P-6,S],["L",P,S-6],["L",P,u+w]);else if(M>0){let B=S<u+T,N=B?u:u+y;O.splice(B?1:6,0,["L",M,S],["L",P+w,N])}else O.splice(7,1,["L",P,y/2],["L",M,S],["L",P,y/2],["L",P,u+w]);else S>y&&M<p-T?O.splice(5,1,["L",M+6,u+y],["L",M,u+y+6],["L",M-6,u+y],["L",P+w,u+y]):S<0&&M>T&&O.splice(1,1,["L",M-6,u],["L",M,u-6],["L",M+6,u],["L",p-w,u]);return O},circle:function(P,u,p,y){return uu(P+p/2,u+y/2,p/2,y/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(P,u,p,y){return[["M",P+p/2,u],["L",P+p,u+y/2],["L",P+p/2,u+y],["L",P,u+y/2],["Z"]]},rect:gd,roundedRect:du,square:gd,triangle:function(P,u,p,y){return[["M",P+p/2,u],["L",P+p,u+y],["L",P,u+y],["Z"]]},"triangle-down":function(P,u,p,y){return[["M",P,u],["L",P+p,u],["L",P+p/2,u+y],["Z"]]}},{doc:Zn,SVG_NS:Ug,win:yd}=lt,{attr:_d,extend:Oh,fireEvent:_p,isString:Lh,objectEach:oc,pick:vd}=Zt,Da=(P,u)=>P.substring(0,u)+"\u2026",Qs=class{constructor(P){let u=P.styles;this.renderer=P.renderer,this.svgElement=P,this.width=P.textWidth,this.textLineHeight=u&&u.lineHeight,this.textOutline=u&&u.textOutline,this.ellipsis=!!(u&&u.textOverflow==="ellipsis"),this.lineClamp=u?.lineClamp,this.noWrap=!!(u&&u.whiteSpace==="nowrap")}buildSVG(){let P=this.svgElement,u=P.element,p=P.renderer,y=vd(P.textStr,"").toString(),b=y.indexOf("<")!==-1,w=u.childNodes,T=!P.added&&p.box,M=[y,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,P.getStyle("font-size"),P.styles.lineClamp,this.width].join(",");if(M!==P.textCache){P.textCache=M,delete P.actualWidth;for(let S=w.length;S--;)u.removeChild(w[S]);if(b||this.ellipsis||this.width||P.textPath||y.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(y))){if(y!==""){T&&T.appendChild(u);let S=new vi(y);this.modifyTree(S.nodes),S.addToDOM(u),this.modifyDOM(),this.ellipsis&&(u.textContent||"").indexOf("\u2026")!==-1&&P.attr("title",this.unescapeEntities(P.textStr||"",["&lt;","&gt;"])),T&&T.removeChild(u)}}else u.appendChild(Zn.createTextNode(this.unescapeEntities(y)));Lh(this.textOutline)&&P.applyTextOutline&&P.applyTextOutline(this.textOutline)}}modifyDOM(){let P,u=this.svgElement,p=_d(u.element,"x");for(u.firstLineMetrics=void 0;(P=u.element.firstChild)&&/^[\s\u200B]*$/.test(P.textContent||" ");)u.element.removeChild(P);[].forEach.call(u.element.querySelectorAll("tspan.highcharts-br"),(T,M)=>{T.nextSibling&&T.previousSibling&&(M===0&&T.previousSibling.nodeType===1&&(u.firstLineMetrics=u.renderer.fontMetrics(T.previousSibling)),_d(T,{dy:this.getLineHeight(T.nextSibling),x:p}))});let y=this.width||0;if(!y)return;let b=(T,M)=>{let S=T.textContent||"",O=S.replace(/([^\^])-/g,"$1- ").split(" "),B=!this.noWrap&&(O.length>1||u.element.childNodes.length>1),N=this.getLineHeight(M),U=Math.max(0,y-.8*N),X=0,Z=u.actualWidth;if(B){let te=[],ne=[];for(;M.firstChild&&M.firstChild!==T;)ne.push(M.firstChild),M.removeChild(M.firstChild);for(;O.length;)if(O.length&&!this.noWrap&&X>0&&(te.push(T.textContent||""),T.textContent=O.join(" ").replace(/- /g,"-")),this.truncate(T,void 0,O,X===0&&Z||0,y,U,(J,ce)=>O.slice(0,ce).join(" ").replace(/- /g,"-")),Z=u.actualWidth,X++,this.lineClamp&&X>=this.lineClamp){O.length&&(this.truncate(T,T.textContent||"",void 0,0,y,U,Da),T.textContent=T.textContent?.replace("\u2026","")+"\u2026");break}ne.forEach(J=>{M.insertBefore(J,T)}),te.forEach(J=>{M.insertBefore(Zn.createTextNode(J),T);let ce=Zn.createElementNS(Ug,"tspan");ce.textContent="\u200B",_d(ce,{dy:N,x:p}),M.insertBefore(ce,T)})}else this.ellipsis&&S&&this.truncate(T,S,void 0,0,y,U,Da)},w=T=>{[].slice.call(T.childNodes).forEach(M=>{M.nodeType===yd.Node.TEXT_NODE?b(M,T):(M.className.baseVal.indexOf("highcharts-br")!==-1&&(u.actualWidth=0),w(M))})};w(u.element)}getLineHeight(P){let u=P.nodeType===yd.Node.TEXT_NODE?P.parentElement:P;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(u||this.svgElement.element).h}modifyTree(P){let u=(p,y)=>{let{attributes:b={},children:w,style:T={},tagName:M}=p,S=this.renderer.styledMode;if(M==="b"||M==="strong"?S?b.class="highcharts-strong":T.fontWeight="bold":(M==="i"||M==="em")&&(S?b.class="highcharts-emphasized":T.fontStyle="italic"),T&&T.color&&(T.fill=T.color),M==="br"){b.class="highcharts-br",p.textContent="\u200B";let O=P[y+1];O&&O.textContent&&(O.textContent=O.textContent.replace(/^ +/gm,""))}else M==="a"&&w&&w.some(O=>O.tagName==="#text")&&(p.children=[{children:w,tagName:"tspan"}]);M!=="#text"&&M!=="a"&&(p.tagName="tspan"),Oh(p,{attributes:b,style:T}),w&&w.filter(O=>O.tagName!=="#text").forEach(u)};P.forEach(u),_p(this.svgElement,"afterModifyTree",{nodes:P})}truncate(P,u,p,y,b,w,T){let M,S,O=this.svgElement,{rotation:B}=O,N=[],U=p&&!y?1:0,X=(u||p||"").length,Z=X;p||(b=w);let te=function(ne,J){let ce=J||ne,de=P.parentNode;if(de&&N[ce]===void 0&&de.getSubStringLength)try{N[ce]=y+de.getSubStringLength(0,p?ce+1:ce)}catch{}return N[ce]};if(O.rotation=0,y+(S=te(P.textContent.length))>b){for(;U<=X;)Z=Math.ceil((U+X)/2),p&&(M=T(p,Z)),S=te(Z,M&&M.length-1),U===X?U=X+1:S>b?X=Z-1:U=Z;X===0?P.textContent="":u&&X===u.length-1||(P.textContent=M||T(u||p,Z)),this.ellipsis&&S>b&&this.truncate(P,P.textContent||"",void 0,0,b,w,Da)}p&&p.splice(0,Z),O.actualWidth=S,O.rotation=B}unescapeEntities(P,u){return oc(this.renderer.escapes,function(p,y){u&&u.indexOf(p)!==-1||(P=P.toString().replace(RegExp(p,"g"),y))}),P}},{defaultOptions:cl}=Mr,{charts:bd,deg2rad:Fh,doc:bs,isFirefox:xd,isMS:wd,isWebKit:Ed,noop:Cd,SVG_NS:Nh,symbolSizes:Pn,win:ul}=lt,{addEvent:hu,attr:sc,createElement:vp,crisp:Ta,css:ac,defined:dl,destroyObjectProperties:$g,extend:hl,isArray:zh,isNumber:fl,isObject:pl,isString:Dd,merge:Td,pick:Md,pInt:Hg,replaceNested:fu,uniqueKey:lc}=Zt;class cc{constructor(u,p,y,b,w,T,M){let S,O,B=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),N=B.element;M||B.css(this.getStyle(b||{})),u.appendChild(N),sc(u,"dir","ltr"),u.innerHTML.indexOf("xmlns")===-1&&sc(N,"xmlns",this.SVG_NS),this.box=N,this.boxWrapper=B,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(bs.createTextNode("Created with Highcharts 12.1.2")),this.defs=this.createElement("defs").add(),this.allowHTML=T,this.forExport=w,this.styledMode=M,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=B.getStyle("font-size"),this.setSize(p,y,!1),xd&&u.getBoundingClientRect&&((S=function(){ac(u,{left:0,top:0}),O=u.getBoundingClientRect(),ac(u,{left:Math.ceil(O.left)-O.left+"px",top:Math.ceil(O.top)-O.top+"px"})})(),this.unSubPixelFix=hu(ul,"resize",S))}definition(u){return new vi([u]).addToDOM(this.defs.element)}getReferenceURL(){if((xd||Ed)&&bs.getElementsByTagName("base").length){if(!dl(r)){let u=lc(),p=new vi([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:u},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${u})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(bs.body);ac(p,{position:"fixed",top:0,left:0,zIndex:9e5});let y=bs.elementFromPoint(6,6);r=(y&&y.id)==="hitme",bs.body.removeChild(p)}if(r)return fu(ul.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(u){return this.style=hl({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},u),this.style}setStyle(u){this.boxWrapper.css(this.getStyle(u))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let u=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),$g(this.gradients||{}),this.gradients=null,this.defs=u.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(u){return new this.Element(this,u)}getRadialAttr(u,p){return{cx:u[0]-u[2]/2+(p.cx||0)*u[2],cy:u[1]-u[2]/2+(p.cy||0)*u[2],r:(p.r||0)*u[2]}}shadowDefinition(u){let p=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(u).map(b=>`${b}-${u[b]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),y=Td({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},u);return this.defs.element.querySelector(`#${p}`)||this.definition({tagName:"filter",attributes:{id:p,filterUnits:y.filterUnits},children:this.getShadowFilterContent(y)}),p}getShadowFilterContent(u){return[{tagName:"feDropShadow",attributes:{dx:u.offsetX,dy:u.offsetY,"flood-color":u.color,"flood-opacity":Math.min(5*u.opacity,1),stdDeviation:u.width/2}}]}buildText(u){new Qs(u).buildSVG()}getContrast(u){let p=re.parse(u).rgba.map(b=>{let w=b/255;return w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4)}),y=.2126*p[0]+.7152*p[1]+.0722*p[2];return 1.05/(y+.05)>(y+.05)/.05?"#FFFFFF":"#000000"}button(u,p,y,b,w={},T,M,S,O,B){let N=this.label(u,p,y,O,void 0,void 0,B,void 0,"button"),U=this.styledMode,X=arguments,Z=0;w=Td(cl.global.buttonTheme,w),U&&(delete w.fill,delete w.stroke,delete w["stroke-width"]);let te=w.states||{},ne=w.style||{};delete w.states,delete w.style;let J=[vi.filterUserAttributes(w)],ce=[ne];return U||["hover","select","disabled"].forEach((de,Ae)=>{J.push(Td(J[0],vi.filterUserAttributes(X[Ae+5]||te[de]||{}))),ce.push(J[Ae+1].style),delete J[Ae+1].style}),hu(N.element,wd?"mouseover":"mouseenter",function(){Z!==3&&N.setState(1)}),hu(N.element,wd?"mouseout":"mouseleave",function(){Z!==3&&N.setState(Z)}),N.setState=(de=0)=>{if(de!==1&&(N.state=Z=de),N.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][de]),!U){N.attr(J[de]);let Ae=ce[de];pl(Ae)&&N.css(Ae)}},N.attr(J[0]),!U&&(N.css(hl({cursor:"default"},ne)),B&&N.text.css({pointerEvents:"none"})),N.on("touchstart",de=>de.stopPropagation()).on("click",function(de){Z!==3&&b.call(N,de)})}crispLine(u,p){let[y,b]=u;return dl(y[1])&&y[1]===b[1]&&(y[1]=b[1]=Ta(y[1],p)),dl(y[2])&&y[2]===b[2]&&(y[2]=b[2]=Ta(y[2],p)),u}path(u){let p=this.styledMode?{}:{fill:"none"};return zh(u)?p.d=u:pl(u)&&hl(p,u),this.createElement("path").attr(p)}circle(u,p,y){let b=pl(u)?u:u===void 0?{}:{x:u,y:p,r:y},w=this.createElement("circle");return w.xSetter=w.ySetter=function(T,M,S){S.setAttribute("c"+M,T)},w.attr(b)}arc(u,p,y,b,w,T){let M;pl(u)?(p=(M=u).y,y=M.r,b=M.innerR,w=M.start,T=M.end,u=M.x):M={innerR:b,start:w,end:T};let S=this.symbol("arc",u,p,y,y,M);return S.r=y,S}rect(u,p,y,b,w,T){let M=pl(u)?u:u===void 0?{}:{x:u,y:p,r:w,width:Math.max(y||0,0),height:Math.max(b||0,0)},S=this.createElement("rect");return this.styledMode||(T!==void 0&&(M["stroke-width"]=T,hl(M,S.crisp(M))),M.fill="none"),S.rSetter=function(O,B,N){S.r=O,sc(N,{rx:O,ry:O})},S.rGetter=function(){return S.r||0},S.attr(M)}roundedRect(u){return this.symbol("roundedRect").attr(u)}setSize(u,p,y){this.width=u,this.height=p,this.boxWrapper.animate({width:u,height:p},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:Md(y,!0)?void 0:0}),this.alignElements()}g(u){let p=this.createElement("g");return u?p.attr({class:"highcharts-"+u}):p}image(u,p,y,b,w,T){let M={preserveAspectRatio:"none"};fl(p)&&(M.x=p),fl(y)&&(M.y=y),fl(b)&&(M.width=b),fl(w)&&(M.height=w);let S=this.createElement("image").attr(M),O=function(B){S.attr({href:u}),T.call(S,B)};if(T){S.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let B=new ul.Image;hu(B,"load",O),B.src=u,B.complete&&O({})}else S.attr({href:u});return S}symbol(u,p,y,b,w,T){let M,S,O,B,N=this,U=/^url\((.*?)\)$/,X=U.test(u),Z=!X&&(this.symbols[u]?u:"circle"),te=Z&&this.symbols[Z];if(te)typeof p=="number"&&(S=te.call(this.symbols,p||0,y||0,b||0,w||0,T)),M=this.path(S),N.styledMode||M.attr("fill","none"),hl(M,{symbolName:Z||void 0,x:p,y,width:b,height:w}),T&&hl(M,T);else if(X){O=u.match(U)[1];let ne=M=this.image(O);ne.imgwidth=Md(T&&T.width,Pn[O]&&Pn[O].width),ne.imgheight=Md(T&&T.height,Pn[O]&&Pn[O].height),B=J=>J.attr({width:J.width,height:J.height}),["width","height"].forEach(J=>{ne[`${J}Setter`]=function(ce,de){this[de]=ce;let{alignByTranslate:Ae,element:Ue,width:Le,height:Ie,imgwidth:ze,imgheight:nt}=this,rt=de==="width"?ze:nt,ft=1;T&&T.backgroundSize==="within"&&Le&&Ie&&ze&&nt?(ft=Math.min(Le/ze,Ie/nt),sc(Ue,{width:Math.round(ze*ft),height:Math.round(nt*ft)})):Ue&&rt&&Ue.setAttribute(de,rt),!Ae&&ze&&nt&&this.translate(((Le||0)-ze*ft)/2,((Ie||0)-nt*ft)/2)}}),dl(p)&&ne.attr({x:p,y}),ne.isImg=!0,ne.symbolUrl=u,dl(ne.imgwidth)&&dl(ne.imgheight)?B(ne):(ne.attr({width:0,height:0}),vp("img",{onload:function(){let J=bd[N.chartIndex];this.width===0&&(ac(this,{position:"absolute",top:"-999em"}),bs.body.appendChild(this)),Pn[O]={width:this.width,height:this.height},ne.imgwidth=this.width,ne.imgheight=this.height,ne.element&&B(ne),this.parentNode&&this.parentNode.removeChild(this),N.imgCount--,N.imgCount||!J||J.hasLoaded||J.onload()},src:O}),this.imgCount++)}return M}clipRect(u,p,y,b){return this.rect(u,p,y,b,0)}text(u,p,y,b){let w={};if(b&&(this.allowHTML||!this.forExport))return this.html(u,p,y);w.x=Math.round(p||0),y&&(w.y=Math.round(y)),dl(u)&&(w.text=u);let T=this.createElement("text").attr(w);return b&&(!this.forExport||this.allowHTML)||(T.xSetter=function(M,S,O){let B=O.getElementsByTagName("tspan"),N=O.getAttribute(S);for(let U=0,X;U<B.length;U++)(X=B[U]).getAttribute(S)===N&&X.setAttribute(S,M);O.setAttribute(S,M)}),T}fontMetrics(u){let p=Hg(ko.prototype.getStyle.call(u,"font-size")||0),y=p<24?p+3:Math.round(1.2*p),b=Math.round(.8*y);return{h:y,b,f:p}}rotCorr(u,p,y){let b=u;return p&&y&&(b=Math.max(b*Math.cos(p*Fh),4)),{x:-u/3*Math.sin(p*Fh),y:b}}pathToSegments(u){let p=[],y=[],b={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let w=0;w<u.length;w++)Dd(y[0])&&fl(u[w])&&y.length===b[y[0].toUpperCase()]&&u.splice(w,0,y[0].replace("M","L").replace("m","l")),typeof u[w]=="string"&&(y.length&&p.push(y.slice(0)),y.length=0),y.push(u[w]);return p.push(y.slice(0)),p}label(u,p,y,b,w,T,M,S,O){return new vs(this,u,p,y,b,w,T,M,S,O)}alignElements(){this.alignedObjects.forEach(u=>u.align())}}hl(cc.prototype,{Element:ko,SVG_NS:Nh,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:ll,draw:Cd}),xn.registerRendererType("svg",cc,!0);let{composed:pu}=lt,{attr:Bh,css:Jr,createElement:Id,defined:Sd,extend:Ad,getAlignFactor:bp,isNumber:Vh,pInt:Gg,pushUnique:jh}=Zt;function mu(P,u,p){let y=this.div?.style||p.style;ko.prototype[`${u}Setter`].call(this,P,u,p),y&&(y[u]=P)}let gu=(P,u)=>{if(!P.div){let p=Bh(P.element,"class"),y=P.css,b=Id("div",p?{className:p}:void 0,vn(ht({position:"absolute",left:`${P.translateX||0}px`,top:`${P.translateY||0}px`},P.styles),{display:P.display,opacity:P.opacity,visibility:P.visibility}),P.parentGroup?.div||u);P.classSetter=(w,T,M)=>{M.setAttribute("class",w),b.className=w},P.translateXSetter=P.translateYSetter=(w,T)=>{P[T]=w,b.style[T==="translateX"?"left":"top"]=`${w}px`,P.doTransform=!0},P.opacitySetter=P.visibilitySetter=mu,P.css=w=>(y.call(P,w),w.cursor&&(b.style.cursor=w.cursor),w.pointerEvents&&(b.style.pointerEvents=w.pointerEvents),P),P.on=function(){return ko.prototype.on.apply({element:b,onEvents:P.onEvents},arguments),P},P.div=b}return P.div};class uc extends ko{static compose(u){jh(pu,this.compose)&&(u.prototype.html=function(p,y,b){return new uc(this,"span").attr({text:p,x:Math.round(y),y:Math.round(b)})})}constructor(u,p){super(u,p),this.css(ht({position:"absolute"},u.styledMode?{}:{fontFamily:u.style.fontFamily,fontSize:u.style.fontSize}))}getSpanCorrection(u,p,y){this.xCorr=-u*y,this.yCorr=-p}css(u){let p,{element:y}=this,b=y.tagName==="SPAN"&&u&&"width"in u,w=b&&u.width;return b&&(delete u.width,this.textWidth=Gg(w)||void 0,p=!0),u?.textOverflow==="ellipsis"&&(u.overflow="hidden"),u?.lineClamp&&(u.display="-webkit-box",u.WebkitLineClamp=u.lineClamp,u.WebkitBoxOrient="vertical",u.overflow="hidden"),Vh(Number(u?.fontSize))&&(u.fontSize=u.fontSize+"px"),Ad(this.styles,u),Jr(y,u),p&&this.updateTransform(),this}htmlGetBBox(){let{element:u}=this;return{x:u.offsetLeft,y:u.offsetTop,width:u.offsetWidth,height:u.offsetHeight}}updateTransform(){if(!this.added){this.alignOnAdd=!0;return}let{element:u,renderer:p,rotation:y,rotationOriginX:b,rotationOriginY:w,scaleX:T,scaleY:M,styles:S,textAlign:O="left",textWidth:B,translateX:N=0,translateY:U=0,x:X=0,y:Z=0}=this,{display:te="block",whiteSpace:ne}=S;if(Jr(u,{marginLeft:`${N}px`,marginTop:`${U}px`}),u.tagName==="SPAN"){let J,ce=[y,O,u.innerHTML,B,this.textAlign].join(","),de=-(this.parentGroup?.padding*1)||0;if(B!==this.oldTextWidth){let Ie=this.textPxLength?this.textPxLength:(Jr(u,{width:"",whiteSpace:ne||"nowrap"}),u.offsetWidth),ze=B||0;(ze>this.oldTextWidth||Ie>ze)&&(/[ \-]/.test(u.textContent||u.innerText)||u.style.textOverflow==="ellipsis")&&(Jr(u,{width:Ie>ze||y||T?B+"px":"auto",display:te,whiteSpace:ne||"normal"}),this.oldTextWidth=B)}ce!==this.cTT&&(J=p.fontMetrics(u).b,Sd(y)&&(y!==(this.oldRotation||0)||O!==this.oldAlign)&&this.setSpanRotation(y,de,de),this.getSpanCorrection(!Sd(y)&&!this.textWidth&&this.textPxLength||u.offsetWidth,J,bp(O)));let{xCorr:Ae=0,yCorr:Ue=0}=this,Le={left:`${X+Ae}px`,top:`${Z+Ue}px`,textAlign:O,transformOrigin:`${(b??X)-Ae-X-de}px ${(w??Z)-Ue-Z-de}px`};(T||M)&&(Le.transform=`scale(${T??1},${M??1})`),Jr(u,Le),this.cTT=ce,this.oldRotation=y,this.oldAlign=O}}setSpanRotation(u,p,y){Jr(this.element,{transform:`rotate(${u}deg)`,transformOrigin:`${p}% ${y}px`})}add(u){let p,y=this.renderer.box.parentNode,b=[];if(this.parentGroup=u,u&&!(p=u.div)){let w=u;for(;w;)b.push(w),w=w.parentGroup;for(let T of b.reverse())p=gu(T,y)}return(p||y).appendChild(this.element),this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(u){u!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,vi.setElementHTML(this.element,u??""),this.textStr=u,this.doTransform=!0)}alignSetter(u){this.alignValue=this.textAlign=u,this.doTransform=!0}xSetter(u,p){this[p]=u,this.doTransform=!0}}let Js=uc.prototype;Js.visibilitySetter=Js.opacitySetter=mu,Js.ySetter=Js.rotationSetter=Js.rotationOriginXSetter=Js.rotationOriginYSetter=Js.xSetter,function(P){P.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},P.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{text:"Values"},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:u}=this.axis.chart;return u(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(i||(i={}));let Wg=i,{addEvent:Uh,isFunction:xp,objectEach:yu,removeEvent:wp}=Zt;(C||(C={})).registerEventOptions=function(P,u){P.eventOptions=P.eventOptions||{},yu(u.events,function(p,y){P.eventOptions[y]!==p&&(P.eventOptions[y]&&(wp(P,y,P.eventOptions[y]),delete P.eventOptions[y]),xp(p)&&(P.eventOptions[y]=p,Uh(P,y,p,{order:0})))})};let ml=C,{deg2rad:kd}=lt,{clamp:dc,correctFloat:Rd,defined:$h,destroyObjectProperties:qg,extend:Ep,fireEvent:_u,getAlignFactor:Cp,isNumber:gl,merge:hc,objectEach:Dp,pick:Ro}=Zt,ao=class{constructor(P,u,p,y,b){this.isNew=!0,this.isNewLabel=!0,this.axis=P,this.pos=u,this.type=p||"",this.parameters=b||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,_u(this,"init"),p||y||this.addLabel()}addLabel(){let P=this,u=P.axis,p=u.options,y=u.chart,b=u.categories,w=u.logarithmic,T=u.names,M=P.pos,S=Ro(P.options&&P.options.labels,p.labels),O=u.tickPositions,B=M===O[0],N=M===O[O.length-1],U=(!S.step||S.step===1)&&u.tickInterval===1,X=O.info,Z=P.label,te,ne,J,ce=this.parameters.category||(b?Ro(b[M],T[M],M):M);w&&gl(ce)&&(ce=Rd(w.lin2log(ce))),u.dateTime&&(X?te=(ne=y.time.resolveDTLFormat(p.dateTimeLabelFormats[!p.grid&&X.higherRanks[M]||X.unitName])).main:gl(ce)&&(te=u.dateTime.getXDateFormat(ce,p.dateTimeLabelFormats||{}))),P.isFirst=B,P.isLast=N;let de={axis:u,chart:y,dateTimeLabelFormat:te,isFirst:B,isLast:N,pos:M,tick:P,tickPositionInfo:X,value:ce};_u(this,"labelFormat",de);let Ae=Ie=>S.formatter?S.formatter.call(Ie,Ie):S.format?(Ie.text=u.defaultLabelFormatter.call(Ie),Dt.format(S.format,Ie,y)):u.defaultLabelFormatter.call(Ie),Ue=Ae.call(de,de),Le=ne&&ne.list;Le?P.shortenLabel=function(){for(J=0;J<Le.length;J++)if(Ep(de,{dateTimeLabelFormat:Le[J]}),Z.attr({text:Ae.call(de,de)}),Z.getBBox().width<u.getSlotWidth(P)-2*(S.padding||0))return;Z.attr({text:""})}:P.shortenLabel=void 0,U&&u._addedPlotLB&&P.moveLabel(Ue,S),$h(Z)||P.movedLabel?Z&&Z.textStr!==Ue&&!U&&(!Z.textWidth||S.style.width||Z.styles.width||Z.css({width:null}),Z.attr({text:Ue}),Z.textPxLength=Z.getBBox().width):(P.label=Z=P.createLabel(Ue,S),P.rotation=0)}createLabel(P,u,p){let y=this.axis,{renderer:b,styledMode:w}=y.chart,T=$h(P)&&u.enabled?b.text(P,p?.x,p?.y,u.useHTML).add(y.labelGroup):void 0;if(T){let M=u.style.whiteSpace||"normal";w||T.css(hc(u.style,{whiteSpace:"nowrap"})),T.textPxLength=T.getBBox().width,w||T.css({whiteSpace:M})}return T}destroy(){qg(this,this.axis)}getPosition(P,u,p,y){let b=this.axis,w=b.chart,T=y&&w.oldChartHeight||w.chartHeight,M={x:P?Rd(b.translate(u+p,void 0,void 0,y)+b.transB):b.left+b.offset+(b.opposite?(y&&w.oldChartWidth||w.chartWidth)-b.right-b.left:0),y:P?T-b.bottom+b.offset-(b.opposite?b.height:0):Rd(T-b.translate(u+p,void 0,void 0,y)-b.transB)};return M.y=dc(M.y,-1e9,1e9),_u(this,"afterGetPosition",{pos:M}),M}getLabelPosition(P,u,p,y,b,w,T,M){let S,O,B=this.axis,N=B.transA,U=B.isLinked&&B.linkedParent?B.linkedParent.reversed:B.reversed,X=B.staggerLines,Z=B.tickRotCorr||{x:0,y:0},te=y||B.reserveSpaceDefault?0:-B.labelOffset*(B.labelAlign==="center"?.5:1),ne=b.distance,J={};return S=B.side===0?p.rotation?-ne:-p.getBBox().height:B.side===2?Z.y+ne:Math.cos(p.rotation*kd)*(Z.y-p.getBBox(!1,0).height/2),$h(b.y)&&(S=B.side===0&&B.horiz?b.y+S:b.y),P=P+Ro(b.x,[0,1,0,-1][B.side]*ne)+te+Z.x-(w&&y?w*N*(U?-1:1):0),u=u+S-(w&&!y?w*N*(U?1:-1):0),X&&(O=T/(M||1)%X,B.opposite&&(O=X-O-1),u+=O*(B.labelOffset/X)),J.x=P,J.y=Math.round(u),_u(this,"afterGetLabelPosition",{pos:J,tickmarkOffset:w,index:T}),J}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(P,u,p,y,b=!1,w){return w.crispLine([["M",P,u],["L",P+(b?0:-p),u+(b?p:0)]],y)}handleOverflow(P){let u=this.axis,p=u.options.labels,y=P.x,b=u.chart.chartWidth,w=u.chart.spacing,T=Ro(u.labelLeft,Math.min(u.pos,w[3])),M=Ro(u.labelRight,Math.max(u.isRadial?0:u.pos+u.len,b-w[1])),S=this.label,O=this.rotation,B=Cp(u.labelAlign||S.attr("align")),N=S.getBBox().width,U=u.getSlotWidth(this),X=U,Z=1,te,ne,J;O||p.overflow!=="justify"?O<0&&y-B*N<T?J=Math.round(y/Math.cos(O*kd)-T):O>0&&y+B*N>M&&(J=Math.round((b-y)/Math.cos(O*kd))):(te=y-B*N,ne=y+(1-B)*N,te<T?X=P.x+X*(1-B)-T:ne>M&&(X=M-P.x+X*B,Z=-1),(X=Math.min(U,X))<U&&u.labelAlign==="center"&&(P.x+=Z*(U-X-B*(U-Math.min(N,X)))),(N>X||u.autoRotation&&(S.styles||{}).width)&&(J=X)),J&&S&&(this.shortenLabel?this.shortenLabel():S.css(Ep({},{width:Math.floor(J)+"px",lineClamp:u.isRadial?0:1})))}moveLabel(P,u){let p=this,y=p.label,b=p.axis,w=!1,T;y&&y.textStr===P?(p.movedLabel=y,w=!0,delete p.label):Dp(b.ticks,function(M){w||M.isNew||M===p||!M.label||M.label.textStr!==P||(p.movedLabel=M.label,w=!0,M.labelPos=p.movedLabel.xy,delete M.label)}),!w&&(p.labelPos||y)&&(T=p.labelPos||y.xy,p.movedLabel=p.createLabel(P,u,T),p.movedLabel&&p.movedLabel.attr({opacity:0}))}render(P,u,p){let y=this.axis,b=y.horiz,w=this.pos,T=Ro(this.tickmarkOffset,y.tickmarkOffset),M=this.getPosition(b,w,T,u),S=M.x,O=M.y,B=y.pos,N=B+y.len,U=b?S:O;!y.chart.polar&&this.isNew&&(Rd(U)<B||U>N)&&(p=0);let X=Ro(p,this.label&&this.label.newOpacity,1);p=Ro(p,1),this.isActive=!0,this.renderGridLine(u,p),this.renderMark(M,p),this.renderLabel(M,u,X,P),this.isNew=!1,_u(this,"afterRender")}renderGridLine(P,u){let p=this.axis,y=p.options,b={},w=this.pos,T=this.type,M=Ro(this.tickmarkOffset,p.tickmarkOffset),S=p.chart.renderer,O=this.gridLine,B,N=y.gridLineWidth,U=y.gridLineColor,X=y.gridLineDashStyle;this.type==="minor"&&(N=y.minorGridLineWidth,U=y.minorGridLineColor,X=y.minorGridLineDashStyle),O||(p.chart.styledMode||(b.stroke=U,b["stroke-width"]=N||0,b.dashstyle=X),T||(b.zIndex=1),P&&(u=0),this.gridLine=O=S.path().attr(b).addClass("highcharts-"+(T?T+"-":"")+"grid-line").add(p.gridGroup)),O&&(B=p.getPlotLinePath({value:w+M,lineWidth:O.strokeWidth(),force:"pass",old:P,acrossPanes:!1}))&&O[P||this.isNew?"attr":"animate"]({d:B,opacity:u})}renderMark(P,u){let p=this.axis,y=p.options,b=p.chart.renderer,w=this.type,T=p.tickSize(w?w+"Tick":"tick"),M=P.x,S=P.y,O=Ro(y[w!=="minor"?"tickWidth":"minorTickWidth"],!w&&p.isXAxis?1:0),B=y[w!=="minor"?"tickColor":"minorTickColor"],N=this.mark,U=!N;T&&(p.opposite&&(T[0]=-T[0]),N||(this.mark=N=b.path().addClass("highcharts-"+(w?w+"-":"")+"tick").add(p.axisGroup),p.chart.styledMode||N.attr({stroke:B,"stroke-width":O})),N[U?"attr":"animate"]({d:this.getMarkPath(M,S,T[0],N.strokeWidth(),p.horiz,b),opacity:u}))}renderLabel(P,u,p,y){let b=this.axis,w=b.horiz,T=b.options,M=this.label,S=T.labels,O=S.step,B=Ro(this.tickmarkOffset,b.tickmarkOffset),N=P.x,U=P.y,X=!0;M&&gl(N)&&(M.xy=P=this.getLabelPosition(N,U,M,w,S,B,y,O),(!this.isFirst||this.isLast||T.showFirstLabel)&&(!this.isLast||this.isFirst||T.showLastLabel)?!w||S.step||S.rotation||u||p===0||this.handleOverflow(P):X=!1,O&&y%O&&(X=!1),X&&gl(P.y)?(P.opacity=p,M[this.isNewLabel?"attr":"animate"](P).show(!0),this.isNewLabel=!1):(M.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let P=this.label,u=this.axis;P&&!this.isNew&&(P.animate({opacity:0},void 0,P.destroy),delete this.label),u.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:Pd}=Rn,{xAxis:Eo,yAxis:vu}=Wg,{defaultOptions:Od}=Mr,{registerEventOptions:yl}=ml,{deg2rad:fc}=lt,{arrayMax:bu,arrayMin:Ld,clamp:$n,correctFloat:Or,defined:mi,destroyObjectProperties:Fd,erase:_l,error:Nd,extend:vl,fireEvent:si,getClosestDistance:Hh,insertItem:zd,isArray:bl,isNumber:Kt,isString:Bd,merge:Ma,normalizeTickInterval:xu,objectEach:xl,pick:gn,relativeLength:Rt,removeEvent:Ko,splat:Tp,syncTimeout:wu}=Zt,pc=(P,u)=>xu(u,void 0,void 0,gn(P.options.allowDecimals,u<.5||P.tickAmount!==void 0),!!P.tickAmount);vl(Od,{xAxis:Eo,yAxis:Ma(Eo,vu)});let fr=(()=>{class P{constructor(p,y,b){this.init(p,y,b)}init(p,y,b=this.coll){let w=b==="xAxis",T=this.isZAxis||(p.inverted?!w:w);this.chart=p,this.horiz=T,this.isXAxis=w,this.coll=b,si(this,"init",{userOptions:y}),this.opposite=gn(y.opposite,this.opposite),this.side=gn(y.side,this.side,T?this.opposite?0:2:this.opposite?1:3),this.setOptions(y);let M=this.options,S=M.labels;this.type??(this.type=M.type||"linear"),this.uniqueNames??(this.uniqueNames=M.uniqueNames??!0),si(this,"afterSetType"),this.userOptions=y,this.minPixelPadding=0,this.reversed=gn(M.reversed,this.reversed),this.visible=M.visible,this.zoomEnabled=M.zoomEnabled,this.hasNames=this.type==="category"||M.categories===!0,this.categories=bl(M.categories)&&M.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=mi(M.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=M.minRange||M.maxZoom,this.range=M.range,this.offset=M.offset||0,this.max=void 0,this.min=void 0;let O=gn(M.crosshair,Tp(p.options.tooltip.crosshairs)[w?0:1]);this.crosshair=O===!0?{}:O,p.axes.indexOf(this)===-1&&(w?p.axes.splice(p.xAxis.length,0,this):p.axes.push(this),zd(this,p[this.coll])),p.orderItems(this.coll),this.series=this.series||[],p.inverted&&!this.isZAxis&&w&&!mi(this.reversed)&&(this.reversed=!0),this.labelRotation=Kt(S.rotation)?S.rotation:void 0,yl(this,M),si(this,"afterInit")}setOptions(p){let y=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=Ma(y,Od[this.coll],p),si(this,"afterSetOptions",{userOptions:p})}defaultLabelFormatter(){let p=this.axis,{numberFormatter:y}=this.chart,b=Kt(this.value)?this.value:NaN,w=p.chart.time,T=p.categories,M=this.dateTimeLabelFormat,S=Od.lang,O=S.numericSymbols,B=S.numericSymbolMagnitude||1e3,N=p.logarithmic?Math.abs(b):p.tickInterval,U=O&&O.length,X,Z;if(T)Z=`${this.value}`;else if(M)Z=w.dateFormat(M,b,!0);else if(U&&O&&N>=1e3)for(;U--&&Z===void 0;)N>=(X=Math.pow(B,U+1))&&10*b%X==0&&O[U]!==null&&b!==0&&(Z=y(b/X,-1)+O[U]);return Z===void 0&&(Z=Math.abs(b)>=1e4?y(b,-1):y(b,-1,void 0,"")),Z}getSeriesExtremes(){let p,y=this;si(this,"getSeriesExtremes",null,function(){y.hasVisibleSeries=!1,y.dataMin=y.dataMax=y.threshold=void 0,y.softThreshold=!y.isXAxis,y.series.forEach(b=>{if(b.reserveSpace()){let w=b.options,T,M=w.threshold,S,O;if(y.hasVisibleSeries=!0,y.positiveValuesOnly&&0>=(M||0)&&(M=void 0),y.isXAxis)(T=b.getColumn("x")).length&&(T=y.logarithmic?T.filter(B=>B>0):T,S=(p=b.getXExtremes(T)).min,O=p.max,Kt(S)||S instanceof Date||(T=T.filter(Kt),S=(p=b.getXExtremes(T)).min,O=p.max),T.length&&(y.dataMin=Math.min(gn(y.dataMin,S),S),y.dataMax=Math.max(gn(y.dataMax,O),O)));else{let B=b.applyExtremes();Kt(B.dataMin)&&(S=B.dataMin,y.dataMin=Math.min(gn(y.dataMin,S),S)),Kt(B.dataMax)&&(O=B.dataMax,y.dataMax=Math.max(gn(y.dataMax,O),O)),mi(M)&&(y.threshold=M),(!w.softThreshold||y.positiveValuesOnly)&&(y.softThreshold=!1)}}})}),si(this,"afterGetSeriesExtremes")}translate(p,y,b,w,T,M){let S=this.linkedParent||this,O=w&&S.old?S.old.min:S.min;if(!Kt(O))return NaN;let B=S.minPixelPadding,N=(S.isOrdinal||S.brokenAxis?.hasBreaks||S.logarithmic&&T)&&S.lin2val,U=1,X=0,Z=w&&S.old?S.old.transA:S.transA,te=0;return Z||(Z=S.transA),b&&(U*=-1,X=S.len),S.reversed&&(U*=-1,X-=U*(S.sector||S.len)),y?(te=(p=p*U+X-B)/Z+O,N&&(te=S.lin2val(te))):(N&&(p=S.val2lin(p)),te=U*(p-O)*Z+X+U*B+(Kt(M)?Z*M:0),S.isRadial||(te=Or(te))),te}toPixels(p,y){return this.translate(this.chart?.time.parse(p)??NaN,!1,!this.horiz,void 0,!0)+(y?0:this.pos)}toValue(p,y){return this.translate(p-(y?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(p){let y=this,b=y.chart,w=y.left,T=y.top,M=p.old,S=p.value,O=p.lineWidth,B=M&&b.oldChartHeight||b.chartHeight,N=M&&b.oldChartWidth||b.chartWidth,U=y.transB,X=p.translatedValue,Z=p.force,te,ne,J,ce,de;function Ae(Le,Ie,ze){return Z!=="pass"&&(Le<Ie||Le>ze)&&(Z?Le=$n(Le,Ie,ze):de=!0),Le}let Ue={value:S,lineWidth:O,old:M,force:Z,acrossPanes:p.acrossPanes,translatedValue:X};return si(this,"getPlotLinePath",Ue,function(Le){te=J=(X=$n(X=gn(X,y.translate(S,void 0,void 0,M)),-1e9,1e9))+U,ne=ce=B-X-U,Kt(X)?y.horiz?(ne=T,ce=B-y.bottom+(y.options.isInternal?0:b.scrollablePixelsY||0),te=J=Ae(te,w,w+y.width)):(te=w,J=N-y.right+(b.scrollablePixelsX||0),ne=ce=Ae(ne,T,T+y.height)):(de=!0,Z=!1),Le.path=de&&!Z?void 0:b.renderer.crispLine([["M",te,ne],["L",J,ce]],O||1)}),Ue.path}getLinearTickPositions(p,y,b){let w,T,M,S=Or(Math.floor(y/p)*p),O=Or(Math.ceil(b/p)*p),B=[];if(Or(S+p)===S&&(M=20),this.single)return[y];for(w=S;w<=O&&(B.push(w),(w=Or(w+p,M))!==T);)T=w;return B}getMinorTickInterval(){let{minorTicks:p,minorTickInterval:y}=this.options;return p===!0?gn(y,"auto"):p!==!1?y:void 0}getMinorTickPositions(){let p=this.options,y=this.tickPositions,b=this.minorTickInterval,w=this.pointRangePadding||0,T=(this.min||0)-w,M=(this.max||0)+w,S=this.brokenAxis?.hasBreaks?this.brokenAxis.unitLength:M-T,O=[],B;if(S&&S/b<this.len/3){let N=this.logarithmic;if(N)this.paddedTicks.forEach(function(U,X,Z){X&&O.push.apply(O,N.getLogTickPositions(b,Z[X-1],Z[X],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")O=O.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(b),T,M,p.startOfWeek));else for(B=T+(y[0]-T)%b;B<=M&&B!==O[0];B+=b)O.push(B)}return O.length!==0&&this.trimTicks(O),O}adjustForMinRange(){let p=this.options,y=this.logarithmic,b=this.chart.time,{max:w,min:T,minRange:M}=this,S,O,B,N;this.isXAxis&&M===void 0&&!y&&(M=mi(p.min)||mi(p.max)||mi(p.floor)||mi(p.ceiling)?null:Math.min(5*(Hh(this.series.map(U=>{let X=U.getColumn("x");return U.xIncrement?X.slice(0,2):X}))||0),this.dataMax-this.dataMin)),Kt(w)&&Kt(T)&&Kt(M)&&w-T<M&&(O=this.dataMax-this.dataMin>=M,S=(M-w+T)/2,B=[T-S,b.parse(p.min)??T-S],O&&(B[2]=y?y.log2lin(this.dataMin):this.dataMin),N=[(T=bu(B))+M,b.parse(p.max)??T+M],O&&(N[2]=y?y.log2lin(this.dataMax):this.dataMax),(w=Ld(N))-T<M&&(B[0]=w-M,B[1]=b.parse(p.min)??w-M,T=bu(B))),this.minRange=M,this.min=T,this.max=w}getClosest(){let p,y;if(this.categories)y=1;else{let b=[];this.series.forEach(function(w){let T=w.closestPointRange,M=w.getColumn("x");M.length===1?b.push(M[0]):w.sorted&&mi(T)&&w.reserveSpace()&&(y=mi(y)?Math.min(y,T):T)}),b.length&&(b.sort((w,T)=>w-T),p=Hh([b]))}return p&&y?Math.min(p,y):p||y}nameToX(p){let y=bl(this.options.categories),b=y?this.categories:this.names,w=p.options.x,T;return p.series.requireSorting=!1,mi(w)||(w=this.uniqueNames&&b?y?b.indexOf(p.name):gn(b.keys[p.name],-1):p.series.autoIncrement()),w===-1?!y&&b&&(T=b.length):Kt(w)&&(T=w),T!==void 0?(this.names[T]=p.name,this.names.keys[p.name]=T):p.x&&(T=p.x),T}updateNames(){let p=this,y=this.names;y.length>0&&(Object.keys(y.keys).forEach(function(b){delete y.keys[b]}),y.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(b=>{b.xIncrement=null,(!b.points||b.isDirtyData)&&(p.max=Math.max(p.max||0,b.dataTable.rowCount-1),b.processData(),b.generatePoints());let w=b.getColumn("x").slice();b.data.forEach((T,M)=>{let S=w[M];T?.options&&T.name!==void 0&&(S=p.nameToX(T))!==void 0&&S!==T.x&&(w[M]=T.x=S)}),b.dataTable.setColumn("x",w)}))}setAxisTranslation(){let p=this,y=p.max-p.min,b=p.linkedParent,w=!!p.categories,T=p.isXAxis,M=p.axisPointRange||0,S,O=0,B=0,N,U=p.transA;(T||w||M)&&(S=p.getClosest(),b?(O=b.minPointOffset,B=b.pointRangePadding):p.series.forEach(function(X){let Z=w?1:T?gn(X.options.pointRange,S,0):p.axisPointRange||0,te=X.options.pointPlacement;if(M=Math.max(M,Z),!p.single||w){let ne=X.is("xrange")?!T:T;O=Math.max(O,ne&&Bd(te)?0:Z/2),B=Math.max(B,ne&&te==="on"?0:Z)}}),N=p.ordinal&&p.ordinal.slope&&S?p.ordinal.slope/S:1,p.minPointOffset=O*=N,p.pointRangePadding=B*=N,p.pointRange=Math.min(M,p.single&&w?1:y),T&&S&&(p.closestPointRange=S)),p.translationSlope=p.transA=U=p.staticScale||p.len/(y+B||1),p.transB=p.horiz?p.left:p.bottom,p.minPixelPadding=U*O,si(this,"afterSetAxisTranslation")}minFromRange(){let{max:p,min:y}=this;return Kt(p)&&Kt(y)&&p-y||void 0}setTickInterval(p){let{categories:y,chart:b,dataMax:w,dataMin:T,dateTime:M,isXAxis:S,logarithmic:O,options:B,softThreshold:N}=this,U=b.time,X=Kt(this.threshold)?this.threshold:void 0,Z=this.minRange||0,{ceiling:te,floor:ne,linkedTo:J,softMax:ce,softMin:de}=B,Ae=Kt(J)&&b[this.coll]?.[J],Ue=B.tickPixelInterval,Le=B.maxPadding,Ie=B.minPadding,ze=0,nt,rt=Kt(B.tickInterval)&&B.tickInterval>=0?B.tickInterval:void 0,ft,Bt,Lt,Vt;if(M||y||Ae||this.getTickAmount(),Lt=gn(this.userMin,U.parse(B.min)),Vt=gn(this.userMax,U.parse(B.max)),Ae?(this.linkedParent=Ae,nt=Ae.getExtremes(),this.min=gn(nt.min,nt.dataMin),this.max=gn(nt.max,nt.dataMax),this.type!==Ae.type&&Nd(11,!0,b)):(N&&mi(X)&&Kt(w)&&Kt(T)&&(T>=X?(ft=X,Ie=0):w<=X&&(Bt=X,Le=0)),this.min=gn(Lt,ft,T),this.max=gn(Vt,Bt,w)),Kt(this.max)&&Kt(this.min)&&(O&&(this.positiveValuesOnly&&!p&&0>=Math.min(this.min,gn(T,this.min))&&Nd(10,!0,b),this.min=Or(O.log2lin(this.min),16),this.max=Or(O.log2lin(this.max),16)),this.range&&Kt(T)&&(this.userMin=this.min=Lt=Math.max(T,this.minFromRange()||0),this.userMax=Vt=this.max,this.range=void 0)),si(this,"foundExtremes"),this.adjustForMinRange(),Kt(this.min)&&Kt(this.max)){if(!Kt(this.userMin)&&Kt(de)&&de<this.min&&(this.min=Lt=de),!Kt(this.userMax)&&Kt(ce)&&ce>this.max&&(this.max=Vt=ce),y||this.axisPointRange||this.stacking?.usePercentage||Ae||!(ze=this.max-this.min)||(!mi(Lt)&&Ie&&(this.min-=ze*Ie),mi(Vt)||!Le||(this.max+=ze*Le)),!Kt(this.userMin)&&Kt(ne)&&(this.min=Math.max(this.min,ne)),!Kt(this.userMax)&&Kt(te)&&(this.max=Math.min(this.max,te)),N&&Kt(T)&&Kt(w)){let zt=X||0;!mi(Lt)&&this.min<zt&&T>=zt?this.min=B.minRange?Math.min(zt,this.max-Z):zt:!mi(Vt)&&this.max>zt&&w<=zt&&(this.max=B.minRange?Math.max(zt,this.min+Z):zt)}!b.polar&&this.min>this.max&&(mi(B.min)?this.max=this.min:mi(B.max)&&(this.min=this.max)),ze=this.max-this.min}if(this.min!==this.max&&Kt(this.min)&&Kt(this.max)?Ae&&!rt&&Ue===Ae.options.tickPixelInterval?this.tickInterval=rt=Ae.tickInterval:this.tickInterval=gn(rt,this.tickAmount?ze/Math.max(this.tickAmount-1,1):void 0,y?1:ze*Ue/Math.max(this.len,Ue)):this.tickInterval=1,S&&!p){let zt=this.min!==this.old?.min||this.max!==this.old?.max;this.series.forEach(function(Tn){Tn.forceCrop=Tn.forceCropping?.(),Tn.processData(zt)}),si(this,"postProcessData",{hasExtremesChanged:zt})}this.setAxisTranslation(),si(this,"initialAxisTranslation"),this.pointRange&&!rt&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Yt=gn(B.minTickInterval,M&&!this.series.some(zt=>!zt.sorted)?this.closestPointRange:0);!rt&&this.tickInterval<Yt&&(this.tickInterval=Yt),M||O||rt||(this.tickInterval=pc(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){let p=this.options,y=p.tickPositions,b=p.tickPositioner,w=this.getMinorTickInterval(),T=!this.isPanning,M=T&&p.startOnTick,S=T&&p.endOnTick,O=[],B;if(this.tickmarkOffset=this.categories&&p.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&mi(this.min)&&!this.tickAmount&&(this.min%1==0||p.allowDecimals!==!1),y)O=y.slice();else if(Kt(this.min)&&Kt(this.max)){if(!this.ordinal?.positions&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))O=[this.min,this.max],Nd(19,!1,this.chart);else if(this.dateTime)O=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,p.units),this.min,this.max,p.startOfWeek,this.ordinal?.positions,this.closestPointRange,!0);else if(this.logarithmic)O=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let N=this.tickInterval,U=N;for(;U<=2*N&&(O=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&O.length>this.tickAmount);)this.tickInterval=pc(this,U*=1.1)}O.length>this.len&&(O=[O[0],O[O.length-1]])[0]===O[1]&&(O.length=1),b&&(this.tickPositions=O,(B=b.apply(this,[this.min,this.max]))&&(O=B))}this.tickPositions=O,this.minorTickInterval=w==="auto"&&this.tickInterval?this.tickInterval/p.minorTicksPerMajor:w,this.paddedTicks=O.slice(0),this.trimTicks(O,M,S),!this.isLinked&&Kt(this.min)&&Kt(this.max)&&(this.single&&O.length<2&&!this.categories&&!this.series.some(N=>N.is("heatmap")&&N.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),y||B||this.adjustTickAmount()),si(this,"afterSetTickPositions")}trimTicks(p,y,b){let w=p[0],T=p[p.length-1],M=!this.isOrdinal&&this.minPointOffset||0;if(si(this,"trimTicks"),!this.isLinked){if(y&&w!==-1/0)this.min=w;else for(;this.min-M>p[0];)p.shift();if(b)this.max=T;else for(;this.max+M<p[p.length-1];)p.pop();p.length===0&&mi(w)&&!this.options.tickPositions&&p.push((T+w)/2)}}alignToOthers(){let p,y=this,b=y.chart,w=[this],T=y.options,M=b.options.chart,S=this.coll==="yAxis"&&M.alignThresholds,O=[];if(y.thresholdAlignment=void 0,(M.alignTicks!==!1&&T.alignTicks||S)&&T.startOnTick!==!1&&T.endOnTick!==!1&&!y.logarithmic){let B=U=>{let{horiz:X,options:Z}=U;return[X?Z.left:Z.top,Z.width,Z.height,Z.pane].join(",")},N=B(this);b[this.coll].forEach(function(U){let{series:X}=U;X.length&&X.some(Z=>Z.visible)&&U!==y&&B(U)===N&&(p=!0,w.push(U))})}if(p&&S){w.forEach(N=>{let U=N.getThresholdAlignment(y);Kt(U)&&O.push(U)});let B=O.length>1?O.reduce((N,U)=>N+=U,0)/O.length:void 0;w.forEach(N=>{N.thresholdAlignment=B})}return p}getThresholdAlignment(p){if((!Kt(this.dataMin)||this!==p&&this.series.some(y=>y.isDirty||y.isDirtyData))&&this.getSeriesExtremes(),Kt(this.threshold)){let y=$n((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(y=1-y),y}}getTickAmount(){let p=this.options,y=p.tickPixelInterval,b=p.tickAmount;mi(p.tickInterval)||b||!(this.len<y)||this.isRadial||this.logarithmic||!p.startOnTick||!p.endOnTick||(b=2),!b&&this.alignToOthers()&&(b=Math.ceil(this.len/y)+1),b<4&&(this.finalTickAmt=b,b=5),this.tickAmount=b}adjustTickAmount(){let p=this,{finalTickAmt:y,max:b,min:w,options:T,tickPositions:M,tickAmount:S,thresholdAlignment:O}=p,B=M?.length,N=gn(p.threshold,p.softThreshold?0:null),U,X,Z=p.tickInterval,te,ne=()=>M.push(Or(M[M.length-1]+Z)),J=()=>M.unshift(Or(M[0]-Z));if(Kt(O)&&(te=O<.5?Math.ceil(O*(S-1)):Math.floor(O*(S-1)),T.reversed&&(te=S-1-te)),p.hasData()&&Kt(w)&&Kt(b)){let ce=()=>{p.transA*=(B-1)/(S-1),p.min=T.startOnTick?M[0]:Math.min(w,M[0]),p.max=T.endOnTick?M[M.length-1]:Math.max(b,M[M.length-1])};if(Kt(te)&&Kt(p.threshold)){for(;M[te]!==N||M.length!==S||M[0]>w||M[M.length-1]<b;){for(M.length=0,M.push(p.threshold);M.length<S;)M[te]===void 0||M[te]>p.threshold?J():ne();if(Z>8*p.tickInterval)break;Z*=2}ce()}else if(B<S){for(;M.length<S;)M.length%2||w===N?ne():J();ce()}if(mi(y)){for(X=U=M.length;X--;)(y===3&&X%2==1||y<=2&&X>0&&X<U-1)&&M.splice(X,1);p.finalTickAmt=void 0}}}setScale(){let{coll:p,stacking:y}=this,b=!1,w=!1;this.series.forEach(M=>{b=b||M.isDirtyData||M.isDirty,w=w||M.xAxis&&M.xAxis.isDirty||!1}),this.setAxisSize();let T=this.len!==(this.old&&this.old.len);T||b||w||this.isLinked||this.forceRedraw||this.userMin!==(this.old&&this.old.userMin)||this.userMax!==(this.old&&this.old.userMax)||this.alignToOthers()?(y&&p==="yAxis"&&y.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),y&&p==="xAxis"&&y.buildStacks(),this.isDirty||(this.isDirty=T||this.min!==this.old?.min||this.max!==this.old?.max)):y&&y.cleanStacks(),b&&delete this.allExtremes,si(this,"afterSetScale")}setExtremes(p,y,b=!0,w,T){let M=this.chart;this.series.forEach(S=>{delete S.kdTree}),p=M.time.parse(p),y=M.time.parse(y),si(this,"setExtremes",T=vl(T,{min:p,max:y}),S=>{this.userMin=S.min,this.userMax=S.max,this.eventArgs=S,b&&M.redraw(w)})}setAxisSize(){let p=this.chart,y=this.options,b=y.offsets||[0,0,0,0],w=this.horiz,T=this.width=Math.round(Rt(gn(y.width,p.plotWidth-b[3]+b[1]),p.plotWidth)),M=this.height=Math.round(Rt(gn(y.height,p.plotHeight-b[0]+b[2]),p.plotHeight)),S=this.top=Math.round(Rt(gn(y.top,p.plotTop+b[0]),p.plotHeight,p.plotTop)),O=this.left=Math.round(Rt(gn(y.left,p.plotLeft+b[3]),p.plotWidth,p.plotLeft));this.bottom=p.chartHeight-M-S,this.right=p.chartWidth-T-O,this.len=Math.max(w?T:M,0),this.pos=w?O:S}getExtremes(){let p=this.logarithmic;return{min:p?Or(p.lin2log(this.min)):this.min,max:p?Or(p.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(p){let y=this.logarithmic,b=y?y.lin2log(this.min):this.min,w=y?y.lin2log(this.max):this.max;return p===null||p===-1/0?p=b:p===1/0?p=w:b>p?p=b:w<p&&(p=w),this.translate(p,0,1,0,1)}autoLabelAlign(p){let y=(gn(p,0)-90*this.side+720)%360,b={align:"center"};return si(this,"autoLabelAlign",b,function(w){y>15&&y<165?w.align="right":y>195&&y<345&&(w.align="left")}),b.align}tickSize(p){let y=this.options,b=gn(y[p==="tick"?"tickWidth":"minorTickWidth"],p==="tick"&&this.isXAxis&&!this.categories?1:0),w=y[p==="tick"?"tickLength":"minorTickLength"],T;b&&w&&(y[p+"Position"]==="inside"&&(w=-w),T=[w,b]);let M={tickSize:T};return si(this,"afterTickSize",M),M.tickSize}labelMetrics(){let p=this.chart.renderer,y=this.ticks,b=y[Object.keys(y)[0]]||{};return this.chart.renderer.fontMetrics(b.label||b.movedLabel||p.box)}unsquish(){let p=this.options.labels,y=p.padding||0,b=this.horiz,w=this.tickInterval,T=this.len/(((this.categories?1:0)+this.max-this.min)/w),M=p.rotation,S=Or(.8*this.labelMetrics().h),O=Math.max(this.max-this.min,0),B=function(te){let ne=(te+2*y)/(T||1);return(ne=ne>1?Math.ceil(ne):1)*w>O&&te!==1/0&&T!==1/0&&O&&(ne=Math.ceil(O/w)),Or(ne*w)},N=w,U,X=Number.MAX_VALUE,Z;if(b){if(!p.staggerLines&&(Kt(M)?Z=[M]:T<p.autoRotationLimit&&(Z=p.autoRotation)),Z){let te,ne;for(let J of Z)(J===M||J&&J>=-90&&J<=90)&&(ne=(te=B(Math.abs(S/Math.sin(fc*J))))+Math.abs(J/360))<X&&(X=ne,U=J,N=te)}}else N=B(.75*S);return this.autoRotation=Z,this.labelRotation=gn(U,Kt(M)?M:0),p.step?w:N}getSlotWidth(p){let y=this.chart,b=this.horiz,w=this.options.labels,T=Math.max(this.tickPositions.length-(this.categories?0:1),1),M=y.margin[3];if(p&&Kt(p.slotWidth))return p.slotWidth;if(b&&w.step<2&&!this.isRadial)return w.rotation?0:(this.staggerLines||1)*this.len/T;if(!b){let S=w.style.width;if(S!==void 0)return parseInt(String(S),10);if(M)return M-y.spacing[3]}return .33*y.chartWidth}renderUnsquish(){let p=this.chart,y=p.renderer,b=this.tickPositions,w=this.ticks,T=this.options.labels,M=T.style,S=this.horiz,O=this.getSlotWidth(),B=Math.max(1,Math.round(O-(S?2*(T.padding||0):T.distance||0))),N={},U=this.labelMetrics(),X=M.lineClamp,Z,te=X??(Math.floor(this.len/(b.length*U.h))||1),ne=0;Bd(T.rotation)||(N.rotation=T.rotation||0),b.forEach(function(J){let ce=w[J];ce.movedLabel&&ce.replaceMovedLabel();let de=ce.label?.textPxLength||0;de>ne&&(ne=de)}),this.maxLabelLength=ne,this.autoRotation?ne>B&&ne>U.h?N.rotation=this.labelRotation:this.labelRotation=0:O&&(Z=B),N.rotation&&(Z=ne>.5*p.chartHeight?.33*p.chartHeight:ne,X||(te=1)),this.labelAlign=T.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(N.align=this.labelAlign),b.forEach(function(J){let ce=w[J],de=ce&&ce.label,Ae=M.width,Ue={};de&&(de.attr(N),ce.shortenLabel?ce.shortenLabel():Z&&!Ae&&M.whiteSpace!=="nowrap"&&(Z<(de.textPxLength||0)||de.element.tagName==="SPAN")?de.css(vl(Ue,{width:`${Z}px`,lineClamp:te})):!de.styles.width||Ue.width||Ae||de.css({width:"auto"}),ce.rotation=N.rotation)},this),this.tickRotCorr=y.rotCorr(U.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(p){return p.hasData()})||this.options.showEmpty&&mi(this.min)&&mi(this.max)}addTitle(p){let y,b=this.chart.renderer,w=this.horiz,T=this.opposite,M=this.options.title,S=this.chart.styledMode;this.axisTitle||((y=M.textAlign)||(y=(w?{low:"left",middle:"center",high:"right"}:{low:T?"right":"left",middle:"center",high:T?"left":"right"})[M.align]),this.axisTitle=b.text(M.text||"",0,0,M.useHTML).attr({zIndex:7,rotation:M.rotation||0,align:y}).addClass("highcharts-axis-title"),S||this.axisTitle.css(Ma(M.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),S||M.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[p?"show":"hide"](p)}generateTick(p){let y=this.ticks;y[p]?y[p].addLabel():y[p]=new ao(this,p)}createGroups(){let{axisParent:p,chart:y,coll:b,options:w}=this,T=y.renderer,M=(S,O,B)=>T.g(S).attr({zIndex:B}).addClass(`highcharts-${b.toLowerCase()}${O} `+(this.isRadial?`highcharts-radial-axis${O} `:"")+(w.className||"")).add(p);this.axisGroup||(this.gridGroup=M("grid","-grid",w.gridZIndex),this.axisGroup=M("axis","",w.zIndex),this.labelGroup=M("axis-labels","-labels",w.labels.zIndex))}getOffset(){let p=this,{chart:y,horiz:b,options:w,side:T,ticks:M,tickPositions:S,coll:O}=p,B=y.inverted&&!p.isZAxis?[1,0,3,2][T]:T,N=p.hasData(),U=w.title,X=w.labels,Z=Kt(w.crossing),te=y.axisOffset,ne=y.clipOffset,J=[-1,1,1,-1][T],ce,de=0,Ae,Ue=0,Le=0,Ie,ze;if(p.showAxis=ce=N||w.showEmpty,p.staggerLines=p.horiz&&X.staggerLines||void 0,p.createGroups(),N||p.isLinked?(S.forEach(function(nt){p.generateTick(nt)}),p.renderUnsquish(),p.reserveSpaceDefault=T===0||T===2||{1:"left",3:"right"}[T]===p.labelAlign,gn(X.reserveSpace,!Z&&null,p.labelAlign==="center"||null,p.reserveSpaceDefault)&&S.forEach(function(nt){Le=Math.max(M[nt].getLabelSize(),Le)}),p.staggerLines&&(Le*=p.staggerLines),p.labelOffset=Le*(p.opposite?-1:1)):xl(M,function(nt,rt){nt.destroy(),delete M[rt]}),U?.text&&U.enabled!==!1&&(p.addTitle(ce),ce&&!Z&&U.reserveSpace!==!1&&(p.titleOffset=de=p.axisTitle.getBBox()[b?"height":"width"],Ue=mi(Ae=U.offset)?0:gn(U.margin,b?5:10))),p.renderLine(),p.offset=J*gn(w.offset,te[T]?te[T]+(w.margin||0):0),p.tickRotCorr=p.tickRotCorr||{x:0,y:0},ze=T===0?-p.labelMetrics().h:T===2?p.tickRotCorr.y:0,Ie=Math.abs(Le)+Ue,Le&&(Ie-=ze,Ie+=J*(b?gn(X.y,p.tickRotCorr.y+J*X.distance):gn(X.x,J*X.distance))),p.axisTitleMargin=gn(Ae,Ie),p.getMaxLabelDimensions&&(p.maxLabelDimensions=p.getMaxLabelDimensions(M,S)),O!=="colorAxis"&&ne){let nt=this.tickSize("tick");te[T]=Math.max(te[T],(p.axisTitleMargin||0)+de+J*p.offset,Ie,S&&S.length&&nt?nt[0]+J*p.offset:0);let rt=!p.axisLine||w.offset?0:p.axisLine.strokeWidth()/2;ne[B]=Math.max(ne[B],rt)}si(this,"afterGetOffset")}getLinePath(p){let y=this.chart,b=this.opposite,w=this.offset,T=this.horiz,M=this.left+(b?this.width:0)+w,S=y.chartHeight-this.bottom-(b?this.height:0)+w;return b&&(p*=-1),y.renderer.crispLine([["M",T?this.left:M,T?S:this.top],["L",T?y.chartWidth-this.right:M,T?S:y.chartHeight-this.bottom]],p)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(p){let y=this.horiz,b=this.left,w=this.top,T=this.len,M=this.options.title,S=y?b:w,O=this.opposite,B=this.offset,N=M.x,U=M.y,X=this.chart.renderer.fontMetrics(p),Z=p?Math.max(p.getBBox(!1,0).height-X.h-1,0):0,te={low:S+(y?0:T),middle:S+T/2,high:S+(y?T:0)}[M.align],ne=(y?w+this.height:b)+(y?1:-1)*(O?-1:1)*(this.axisTitleMargin||0)+[-Z,Z,X.f,-Z][this.side],J={x:y?te+N:ne+(O?this.width:0)+B+N,y:y?ne+U-(O?this.height:0)+B:te+U};return si(this,"afterGetTitlePosition",{titlePosition:J}),J}renderMinorTick(p,y){let b=this.minorTicks;b[p]||(b[p]=new ao(this,p,"minor")),y&&b[p].isNew&&b[p].render(null,!0),b[p].render(null,!1,1)}renderTick(p,y,b){let w=this.isLinked,T=this.ticks;(!w||p>=this.min&&p<=this.max||this.grid&&this.grid.isColumn)&&(T[p]||(T[p]=new ao(this,p)),b&&T[p].isNew&&T[p].render(y,!0,-1),T[p].render(y))}render(){let p,y,b=this,w=b.chart,T=b.logarithmic,M=w.renderer,S=b.options,O=b.isLinked,B=b.tickPositions,N=b.axisTitle,U=b.ticks,X=b.minorTicks,Z=b.alternateBands,te=S.stackLabels,ne=S.alternateGridColor,J=S.crossing,ce=b.tickmarkOffset,de=b.axisLine,Ae=b.showAxis,Ue=Pd(M.globalAnimation);if(b.labelEdge.length=0,b.overlap=!1,[U,X,Z].forEach(function(Le){xl(Le,function(Ie){Ie.isActive=!1})}),Kt(J)){let Le=this.isXAxis?w.yAxis[0]:w.xAxis[0],Ie=[1,-1,-1,1][this.side];if(Le){let ze=Le.toPixels(J,!0);b.horiz&&(ze=Le.len-ze),b.offset=Ie*ze}}if(b.hasData()||O){let Le=b.chart.hasRendered&&b.old&&Kt(b.old.min);b.minorTickInterval&&!b.categories&&b.getMinorTickPositions().forEach(function(Ie){b.renderMinorTick(Ie,Le)}),B.length&&(B.forEach(function(Ie,ze){b.renderTick(Ie,ze,Le)}),ce&&(b.min===0||b.single)&&(U[-1]||(U[-1]=new ao(b,-1,null,!0)),U[-1].render(-1))),ne&&B.forEach(function(Ie,ze){y=B[ze+1]!==void 0?B[ze+1]+ce:b.max-ce,ze%2==0&&Ie<b.max&&y<=b.max+(w.polar?-ce:ce)&&(Z[Ie]||(Z[Ie]=new lt.PlotLineOrBand(b,{})),p=Ie+ce,Z[Ie].options={from:T?T.lin2log(p):p,to:T?T.lin2log(y):y,color:ne,className:"highcharts-alternate-grid"},Z[Ie].render(),Z[Ie].isActive=!0)}),b._addedPlotLB||(b._addedPlotLB=!0,(S.plotLines||[]).concat(S.plotBands||[]).forEach(function(Ie){b.addPlotBandOrLine(Ie)}))}[U,X,Z].forEach(function(Le){let Ie=[],ze=Ue.duration;xl(Le,function(nt,rt){nt.isActive||(nt.render(rt,!1,0),nt.isActive=!1,Ie.push(rt))}),wu(function(){let nt=Ie.length;for(;nt--;)Le[Ie[nt]]&&!Le[Ie[nt]].isActive&&(Le[Ie[nt]].destroy(),delete Le[Ie[nt]])},Le!==Z&&w.hasRendered&&ze?ze:0)}),de&&(de[de.isPlaced?"animate":"attr"]({d:this.getLinePath(de.strokeWidth())}),de.isPlaced=!0,de[Ae?"show":"hide"](Ae)),N&&Ae&&(N[N.isNew?"attr":"animate"](b.getTitlePosition(N)),N.isNew=!1),te&&te.enabled&&b.stacking&&b.stacking.renderStackTotals(),b.old={len:b.len,max:b.max,min:b.min,transA:b.transA,userMax:b.userMax,userMin:b.userMin},b.isDirty=!1,si(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(p){p.render()})),this.series.forEach(function(p){p.isDirty=!0})}getKeepProps(){return this.keepProps||P.keepProps}destroy(p){let y=this,b=y.plotLinesAndBands,w=this.eventOptions;if(si(this,"destroy",{keepEvents:p}),p||Ko(y),[y.ticks,y.minorTicks,y.alternateBands].forEach(function(T){Fd(T)}),b){let T=b.length;for(;T--;)b[T].destroy()}for(let T in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(M){y[M]&&(y[M]=y[M].destroy())}),y.plotLinesAndBandsGroups)y.plotLinesAndBandsGroups[T]=y.plotLinesAndBandsGroups[T].destroy();xl(y,function(T,M){y.getKeepProps().indexOf(M)===-1&&delete y[M]}),this.eventOptions=w}drawCrosshair(p,y){let b=this.crosshair,w=gn(b&&b.snap,!0),T=this.chart,M,S,O,B=this.cross,N;if(si(this,"drawCrosshair",{e:p,point:y}),p||(p=this.cross&&this.cross.e),b&&(mi(y)||!w)!==!1){if(w?mi(y)&&(S=gn(this.coll!=="colorAxis"?y.crosshairPos:null,this.isXAxis?y.plotX:this.len-y.plotY)):S=p&&(this.horiz?p.chartX-this.pos:this.len-p.chartY+this.pos),mi(S)&&(N={value:y&&(this.isXAxis?y.x:gn(y.stackY,y.y)),translatedValue:S},T.polar&&vl(N,{isCrosshair:!0,chartX:p&&p.chartX,chartY:p&&p.chartY,point:y}),M=this.getPlotLinePath(N)||null),!mi(M)){this.hideCrosshair();return}O=this.categories&&!this.isRadial,B||(this.cross=B=T.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(O?"category ":"thin ")+(b.className||"")).attr({zIndex:gn(b.zIndex,2)}).add(),!T.styledMode&&(B.attr({stroke:b.color||(O?re.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":gn(b.width,1)}).css({"pointer-events":"none"}),b.dashStyle&&B.attr({dashstyle:b.dashStyle}))),B.show().attr({d:M}),O&&!b.width&&B.attr({"stroke-width":this.transA}),this.cross.e=p}else this.hideCrosshair();si(this,"afterDrawCrosshair",{e:p,point:y})}hideCrosshair(){this.cross&&this.cross.hide(),si(this,"afterHideCrosshair")}update(p,y){let b=this.chart;p=Ma(this.userOptions,p),this.destroy(!0),this.init(b,p),b.isDirtyBox=!0,gn(y,!0)&&b.redraw()}remove(p){let y=this.chart,b=this.coll,w=this.series,T=w.length;for(;T--;)w[T]&&w[T].remove(!1);_l(y.axes,this),_l(y[b]||[],this),y.orderItems(b),this.destroy(),y.isDirtyBox=!0,gn(p,!0)&&y.redraw()}setTitle(p,y){this.update({title:p},y)}setCategories(p,y){this.update({categories:p},y)}}return P.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"],P})(),{addEvent:Eu,getMagnitude:Vd,normalizeTickInterval:Gh,timeUnits:wl}=Zt;(function(P){function u(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function p(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new y(this))}P.compose=function(b){return b.keepProps.includes("dateTime")||(b.keepProps.push("dateTime"),b.prototype.getTimeTicks=u,Eu(b,"afterSetType",p)),b};class y{constructor(w){this.axis=w}normalizeTimeTickInterval(w,T){let M=T||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],S=M[M.length-1],O=wl[S[0]],B=S[1],N;for(N=0;N<M.length&&(O=wl[(S=M[N])[0]],B=S[1],!M[N+1]||!(w<=(O*B[B.length-1]+wl[M[N+1][0]])/2));N++);O===wl.year&&w<5*O&&(B=[1,2,5]);let U=Gh(w/O,B,S[0]==="year"?Math.max(Vd(w/O),1):1);return{unitRange:O,count:U,unitName:S[0]}}getXDateFormat(w,T){let{axis:M}=this,S=M.chart.time;return M.closestPointRange?S.getDateFormat(M.closestPointRange,w,M.options.startOfWeek,T)||S.resolveDTLFormat(T.year).main:S.resolveDTLFormat(T.day).main}}P.Additions=y})(F||(F={}));let Mp=F,{addEvent:Cu,normalizeTickInterval:mc,pick:Wh}=Zt;(function(P){function u(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new y(this))}function p(){let b=this.logarithmic;b&&(this.lin2val=function(w){return b.lin2log(w)},this.val2lin=function(w){return b.log2lin(w)})}P.compose=function(b){return b.keepProps.includes("logarithmic")||(b.keepProps.push("logarithmic"),Cu(b,"afterSetType",u),Cu(b,"afterInit",p)),b};class y{constructor(w){this.axis=w}getLogTickPositions(w,T,M,S){let O=this.axis,B=O.len,N=O.options,U=[];if(S||(this.minorAutoInterval=void 0),w>=.5)w=Math.round(w),U=O.getLinearTickPositions(w,T,M);else if(w>=.08){let X,Z,te,ne,J,ce,de,Ae=Math.floor(T);for(X=w>.3?[1,2,4]:w>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],Z=Ae;Z<M+1&&!de;Z++)for(te=0,ne=X.length;te<ne&&!de;te++)(J=this.log2lin(this.lin2log(Z)*X[te]))>T&&(!S||ce<=M)&&ce!==void 0&&U.push(ce),ce>M&&(de=!0),ce=J}else{let X=this.lin2log(T),Z=this.lin2log(M),te=S?O.getMinorTickInterval():N.tickInterval,ne=N.tickPixelInterval/(S?5:1),J=S?B/O.tickPositions.length:B;w=mc(w=Wh(te==="auto"?null:te,this.minorAutoInterval,(Z-X)*ne/(J||1))),U=O.getLinearTickPositions(w,X,Z).map(this.log2lin),S||(this.minorAutoInterval=w/5)}return S||(O.tickInterval=w),U}lin2log(w){return Math.pow(10,w)}log2lin(w){return Math.log(w)/Math.LN10}}P.Additions=y})(V||(V={}));let Zg=V,{erase:Ip,extend:gc,isNumber:jd}=Zt;(function(P){let u;function p(O){return this.addPlotBandOrLine(O,"plotBands")}function y(O,B){let N=this.userOptions,U=new u(this,O);if(this.visible&&(U=U.render()),U){if(this._addedPlotLB||(this._addedPlotLB=!0,(N.plotLines||[]).concat(N.plotBands||[]).forEach(X=>{this.addPlotBandOrLine(X)})),B){let X=N[B]||[];X.push(O),N[B]=X}this.plotLinesAndBands.push(U)}return U}function b(O){return this.addPlotBandOrLine(O,"plotLines")}function w(O,B,N){N=N||this.options;let U=this.getPlotLinePath({value:B,force:!0,acrossPanes:N.acrossPanes}),X=[],Z=this.horiz,te=!jd(this.min)||!jd(this.max)||O<this.min&&B<this.min||O>this.max&&B>this.max,ne=this.getPlotLinePath({value:O,force:!0,acrossPanes:N.acrossPanes}),J,ce=1,de;if(ne&&U)for(te&&(de=ne.toString()===U.toString(),ce=0),J=0;J<ne.length;J+=2){let Ae=ne[J],Ue=ne[J+1],Le=U[J],Ie=U[J+1];(Ae[0]==="M"||Ae[0]==="L")&&(Ue[0]==="M"||Ue[0]==="L")&&(Le[0]==="M"||Le[0]==="L")&&(Ie[0]==="M"||Ie[0]==="L")&&(Z&&Le[1]===Ae[1]?(Le[1]+=ce,Ie[1]+=ce):Z||Le[2]!==Ae[2]||(Le[2]+=ce,Ie[2]+=ce),X.push(["M",Ae[1],Ae[2]],["L",Ue[1],Ue[2]],["L",Ie[1],Ie[2]],["L",Le[1],Le[2]],["Z"])),X.isFlat=de}return X}function T(O){this.removePlotBandOrLine(O)}function M(O){let B=this.plotLinesAndBands,N=this.options,U=this.userOptions;if(B){let X=B.length;for(;X--;)B[X].id===O&&B[X].destroy();[N.plotLines||[],U.plotLines||[],N.plotBands||[],U.plotBands||[]].forEach(function(Z){for(X=Z.length;X--;)(Z[X]||{}).id===O&&Ip(Z,Z[X])})}}function S(O){this.removePlotBandOrLine(O)}P.compose=function(O,B){let N=B.prototype;return N.addPlotBand||(u=O,gc(N,{addPlotBand:p,addPlotLine:b,addPlotBandOrLine:y,getPlotBandPath:w,removePlotBand:T,removePlotLine:S,removePlotBandOrLine:M})),B}})(K||(K={}));let qh=K,{addEvent:Zh,arrayMax:Du,arrayMin:yc,defined:lo,destroyObjectProperties:Xh,erase:Sp,fireEvent:Yh,merge:Kh,objectEach:Ia,pick:Ap}=Zt;class Tu{static compose(u,p){return Zh(u,"afterInit",function(){this.labelCollectors.push(()=>{let y=[];for(let b of this.axes)for(let{label:w,options:T}of b.plotLinesAndBands)w&&!T?.label?.allowOverlap&&y.push(w);return y})}),qh.compose(Tu,p)}constructor(u,p){this.axis=u,this.options=p,this.id=p.id}render(){Yh(this,"render");let{axis:u,options:p}=this,{horiz:y,logarithmic:b}=u,{color:w,events:T,zIndex:M=0}=p,{renderer:S,time:O}=u.chart,B={},N=O.parse(p.to),U=O.parse(p.from),X=O.parse(p.value),Z=p.borderWidth,te=p.label,{label:ne,svgElem:J}=this,ce=[],de,Ae=lo(U)&&lo(N),Ue=lo(X),Le=!J,Ie={class:"highcharts-plot-"+(Ae?"band ":"line ")+(p.className||"")},ze=Ae?"bands":"lines";if(!u.chart.styledMode&&(Ue?(Ie.stroke=w||"#999999",Ie["stroke-width"]=Ap(p.width,1),p.dashStyle&&(Ie.dashstyle=p.dashStyle)):Ae&&(Ie.fill=w||"#e6e9ff",Z&&(Ie.stroke=p.borderColor,Ie["stroke-width"]=Z))),B.zIndex=M,ze+="-"+M,(de=u.plotLinesAndBandsGroups[ze])||(u.plotLinesAndBandsGroups[ze]=de=S.g("plot-"+ze).attr(B).add()),J||(this.svgElem=J=S.path().attr(Ie).add(de)),lo(X))ce=u.getPlotLinePath({value:b?.log2lin(X)??X,lineWidth:J.strokeWidth(),acrossPanes:p.acrossPanes});else{if(!(lo(U)&&lo(N)))return;ce=u.getPlotBandPath(b?.log2lin(U)??U,b?.log2lin(N)??N,p)}return!this.eventsAdded&&T&&(Ia(T,(nt,rt)=>{J?.on(rt,ft=>{T[rt].apply(this,[ft])})}),this.eventsAdded=!0),(Le||!J.d)&&ce?.length?J.attr({d:ce}):J&&(ce?(J.show(),J.animate({d:ce})):J.d&&(J.hide(),ne&&(this.label=ne=ne.destroy()))),te&&(lo(te.text)||lo(te.formatter))&&ce?.length&&u.width>0&&u.height>0&&!ce.isFlat?(te=Kh(ht({align:y&&Ae?"center":void 0,x:y?!Ae&&4:10,verticalAlign:!y&&Ae?"middle":void 0,y:y?Ae?16:10:Ae?6:-4,rotation:y&&!Ae?90:0},Ae?{inside:!0}:{}),te),this.renderLabel(te,ce,Ae,M)):ne&&ne.hide(),this}renderLabel(u,p,y,b){let w=this.axis,T=w.chart.renderer,M=u.inside,S=this.label;S||(this.label=S=T.text(this.getLabelText(u),0,0,u.useHTML).attr({align:u.textAlign||u.align,rotation:u.rotation,class:"highcharts-plot-"+(y?"band":"line")+"-label "+(u.className||""),zIndex:b}),w.chart.styledMode||S.css(Kh({fontSize:"0.8em",textOverflow:y&&!M?"":"ellipsis"},u.style)),S.add());let O=p.xBounds||[p[0][1],p[1][1],y?p[2][1]:p[0][1]],B=p.yBounds||[p[0][2],p[1][2],y?p[2][2]:p[0][2]],N=yc(O),U=yc(B),X=Du(O)-N;S.align(u,!1,{x:N,y:U,width:X,height:Du(B)-U}),(!S.alignValue||S.alignValue==="left"||lo(M))&&S.css({width:(u.style?.width||(y&&M?X:S.rotation===90?w.height-(S.alignAttr.y-w.top):(u.clip?w.width:w.chart.chartWidth)-(S.alignAttr.x-w.left)))+"px"}),S.show(!0)}getLabelText(u){return lo(u.formatter)?u.formatter.call(this):u.text}destroy(){Sp(this.axis.plotLinesAndBands,this),delete this.axis,Xh(this)}}let{animObject:Xg}=Rn,{format:Qh}=Dt,{composed:Jh,dateFormats:kp,doc:ef,isSafari:Hr}=lt,{distribute:Yg}=Ur,{addEvent:Rp,clamp:_c,css:Pp,discardElement:Po,extend:Op,fireEvent:Lp,isArray:Qo,isNumber:xs,isObject:El,isString:vc,merge:Ot,pick:Sa,pushUnique:tf,splat:Aa,syncTimeout:Cl}=Zt;class St{constructor(u,p,y){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=u,this.init(u,p),this.pointer=y}bodyFormatter(u){return u.map(p=>{let y=p.series.tooltipOptions,b=p.formatPrefix||"point";return(y[b+"Formatter"]||p.tooltipFormatter).call(p,y[b+"Format"]||"")})}cleanSplit(u){this.chart.series.forEach(function(p){let y=p&&p.tt;y&&(!y.isActive||u?p.tt=y.destroy():y.isActive=!1)})}defaultFormatter(u){let p,y=this.points||Aa(this);return(p=(p=[u.headerFooterFormatter(y[0])]).concat(u.bodyFormatter(y))).push(u.headerFooterFormatter(y[0],!0)),p}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),Po(this.container)),Zt.clearTimeout(this.hideTimer)}getAnchor(u,p){let y,{chart:b,pointer:w}=this,T=b.inverted,M=b.plotTop,S=b.plotLeft;if((u=Aa(u))[0].series&&u[0].series.yAxis&&!u[0].series.yAxis.options.reversedStacks&&(u=u.slice().reverse()),this.followPointer&&p)p.chartX===void 0&&(p=w.normalize(p)),y=[p.chartX-S,p.chartY-M];else if(u[0].tooltipPos)y=u[0].tooltipPos;else{let O=0,B=0;u.forEach(function(N){let U=N.pos(!0);U&&(O+=U[0],B+=U[1])}),O/=u.length,B/=u.length,this.shared&&u.length>1&&p&&(T?O=p.chartX:B=p.chartY),y=[O-S,B-M]}return y.map(Math.round)}getClassName(u,p,y){let b=this.options,w=u.series,T=w.options;return[b.className,"highcharts-label",y&&"highcharts-tooltip-header",p?"highcharts-tooltip-box":"highcharts-tooltip",!y&&"highcharts-color-"+Sa(u.colorIndex,w.colorIndex),T&&T.className].filter(vc).join(" ")}getLabel({anchorX:u,anchorY:p}={anchorX:0,anchorY:0}){let y=this,b=this.chart.styledMode,w=this.options,T=this.split&&this.allowShared,M=this.container,S=this.chart.renderer;if(this.label){let O=!this.label.hasClass("highcharts-label");(!T&&O||T&&!O)&&this.destroy()}if(!this.label){if(this.outside){let O=this.chart,B=O.options.chart.style,N=xn.getRendererType();this.container=M=lt.doc.createElement("div"),M.className="highcharts-tooltip-container "+(O.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),Pp(M,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,(B&&B.zIndex||0)+3)}),this.renderer=S=new N(M,0,0,B,void 0,void 0,S.styledMode)}if(T?this.label=S.g("tooltip"):(this.label=S.label("",u,p,w.shape,void 0,void 0,w.useHTML,void 0,"tooltip").attr({padding:w.padding,r:w.borderRadius}),b||this.label.attr({fill:w.backgroundColor,"stroke-width":w.borderWidth||0}).css(w.style).css({pointerEvents:w.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),y.outside){let O=this.label;[O.xSetter,O.ySetter].forEach((B,N)=>{O[N?"ySetter":"xSetter"]=U=>{B.call(O,y.distance),O[N?"y":"x"]=U,M&&(M.style[N?"top":"left"]=`${U}px`)}})}this.label.attr({zIndex:8}).shadow(w.shadow).add()}return M&&!M.parentElement&&lt.doc.body.appendChild(M),this.label}getPlayingField(){let{body:u,documentElement:p}=ef,{chart:y,distance:b,outside:w}=this;return{width:w?Math.max(u.scrollWidth,p.scrollWidth,u.offsetWidth,p.offsetWidth,p.clientWidth)-2*b-2:y.chartWidth,height:w?Math.max(u.scrollHeight,p.scrollHeight,u.offsetHeight,p.offsetHeight,p.clientHeight):y.chartHeight}}getPosition(u,p,y){let{distance:b,chart:w,outside:T,pointer:M}=this,{inverted:S,plotLeft:O,plotTop:B,polar:N}=w,{plotX:U=0,plotY:X=0}=y,Z={},te=S&&y.h||0,{height:ne,width:J}=this.getPlayingField(),ce=M.getChartPosition(),de=Yt=>Yt*ce.scaleX,Ae=Yt=>Yt*ce.scaleY,Ue=Yt=>{let zt=Yt==="x";return[Yt,zt?J:ne,zt?u:p].concat(T?[zt?de(u):Ae(p),zt?ce.left-b+de(U+O):ce.top-b+Ae(X+B),0,zt?J:ne]:[zt?u:p,zt?U+O:X+B,zt?O:B,zt?O+w.plotWidth:B+w.plotHeight])},Le=Ue("y"),Ie=Ue("x"),ze,nt=!!y.negative;!N&&w.hoverSeries?.yAxis?.reversed&&(nt=!nt);let rt=!this.followPointer&&Sa(y.ttBelow,!N&&!S===nt),ft=function(Yt,zt,Tn,un,dn,Hn,sn){let mr=T?Yt==="y"?Ae(b):de(b):b,Gi=(Tn-un)/2,Yn=un<dn-b,Mn=dn+b+un<zt,xi=dn-mr-Tn+Gi,Ni=dn+mr-Gi;if(rt&&Mn)Z[Yt]=Ni;else if(!rt&&Yn)Z[Yt]=xi;else if(Yn)Z[Yt]=Math.min(sn-un,xi-te<0?xi:xi-te);else{if(!Mn)return!1;Z[Yt]=Math.max(Hn,Ni+te+Tn>zt?Ni:Ni+te)}},Bt=function(Yt,zt,Tn,un,dn){if(dn<b||dn>zt-b)return!1;dn<Tn/2?Z[Yt]=1:dn>zt-un/2?Z[Yt]=zt-un-2:Z[Yt]=dn-Tn/2},Lt=function(Yt){[Le,Ie]=[Ie,Le],ze=Yt},Vt=()=>{ft.apply(0,Le)!==!1?Bt.apply(0,Ie)!==!1||ze||(Lt(!0),Vt()):ze?Z.x=Z.y=0:(Lt(!0),Vt())};return(S&&!N||this.len>1)&&Lt(),Vt(),Z}hide(u){let p=this;Zt.clearTimeout(this.hideTimer),u=Sa(u,this.options.hideDelay),this.isHidden||(this.hideTimer=Cl(function(){let y=p.getLabel();p.getLabel().animate({opacity:0},{duration:u&&150,complete:()=>{y.hide(),p.container&&p.container.remove()}}),p.isHidden=!0},u))}init(u,p){this.chart=u,this.options=p,this.crosshairs=[],this.isHidden=!0,this.split=p.split&&!u.inverted&&!u.polar,this.shared=p.shared||this.split,this.outside=Sa(p.outside,!!(u.scrollablePixelsX||u.scrollablePixelsY))}shouldStickOnContact(u){return!!(!this.followPointer&&this.options.stickOnContact&&(!u||this.pointer.inClass(u.target,"highcharts-tooltip")))}move(u,p,y,b){let w=this,T=Xg(!w.isHidden&&w.options.animation),M=w.followPointer||(w.len||0)>1,S={x:u,y:p};M||(S.anchorX=y,S.anchorY=b),T.step=()=>w.drawTracker(),w.getLabel().animate(S,T)}refresh(u,p){let{chart:y,options:b,pointer:w,shared:T}=this,M=Aa(u),S=M[0],O=b.format,B=b.formatter||this.defaultFormatter,N=y.styledMode,U=this.allowShared;if(!b.enabled||!S.series)return;Zt.clearTimeout(this.hideTimer),this.allowShared=!(!Qo(u)&&u.series&&u.series.noSharedTooltip),U=U&&!this.allowShared,this.followPointer=!this.split&&S.series.tooltipOptions.followPointer;let X=this.getAnchor(u,p),Z=X[0],te=X[1];T&&this.allowShared&&(w.applyInactiveState(M),M.forEach(ce=>ce.setState("hover")),S.points=M),this.len=M.length;let ne=vc(O)?Qh(O,S,y):B.call(S,this);S.points=void 0;let J=S.series;if(this.distance=Sa(J.tooltipOptions.distance,16),ne===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(ne,M);else{let ce=Z,de=te;if(p&&w.isDirectTouch&&(ce=p.chartX-y.plotLeft,de=p.chartY-y.plotTop),y.polar||J.options.clip===!1||M.some(Ae=>w.isDirectTouch||Ae.series.shouldShowTooltip(ce,de))){let Ae=this.getLabel(U&&this.tt||{});(!b.style.width||N)&&Ae.css({width:(this.outside?this.getPlayingField():y.spacingBox).width+"px"}),Ae.attr({class:this.getClassName(S),text:ne&&ne.join?ne.join(""):ne}),this.outside&&Ae.attr({x:_c(Ae.x||0,0,this.getPlayingField().width-(Ae.width||0)-1)}),N||Ae.attr({stroke:b.borderColor||S.color||J.color||"#666666"}),this.updatePosition({plotX:Z,plotY:te,negative:S.negative,ttBelow:S.ttBelow,h:X[2]||0})}else{this.hide();return}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}Lp(this,"refresh")}renderSplit(u,p){let y=this,{chart:b,chart:{chartWidth:w,chartHeight:T,plotHeight:M,plotLeft:S,plotTop:O,scrollablePixelsY:B=0,scrollablePixelsX:N,styledMode:U},distance:X,options:Z,options:{positioner:te},pointer:ne}=y,{scrollLeft:J=0,scrollTop:ce=0}=b.scrollablePlotArea?.scrollingContainer||{},de=y.outside&&typeof N!="number"?ef.documentElement.getBoundingClientRect():{left:J,right:J+w,top:ce,bottom:ce+T},Ae=y.getLabel(),Ue=this.renderer||b.renderer,Le=!!(b.xAxis[0]&&b.xAxis[0].opposite),{left:Ie,top:ze}=ne.getChartPosition(),nt=O+ce,rt=0,ft=M-B;function Bt(un,dn,Hn,sn,mr=!0){let Gi,Yn;return Hn?(Gi=Le?0:ft,Yn=_c(un-sn/2,de.left,de.right-sn-(y.outside?Ie:0))):(Gi=dn-nt,Yn=_c(Yn=mr?un-sn-X:un+X,mr?Yn:de.left,de.right)),{x:Yn,y:Gi}}vc(u)&&(u=[!1,u]);let Lt=u.slice(0,p.length+1).reduce(function(un,dn,Hn){if(dn!==!1&&dn!==""){let sn=p[Hn-1]||{isHeader:!0,plotX:p[0].plotX,plotY:M,series:{}},mr=sn.isHeader,Gi=mr?y:sn.series,Yn=Gi.tt=function(Wi,To,La){let Is=Wi,{isHeader:Af,series:gm}=To;if(!Is){let Uu={padding:Z.padding,r:Z.borderRadius};U||(Uu.fill=Z.backgroundColor,Uu["stroke-width"]=Z.borderWidth??1),Is=Ue.label("",0,0,Z[Af?"headerShape":"shape"],void 0,void 0,Z.useHTML).addClass(y.getClassName(To,!0,Af)).attr(Uu).add(Ae)}return Is.isActive=!0,Is.attr({text:La}),U||Is.css(Z.style).attr({stroke:Z.borderColor||To.color||gm.color||"#333333"}),Is}(Gi.tt,sn,dn.toString()),Mn=Yn.getBBox(),xi=Mn.width+Yn.strokeWidth();mr&&(rt=Mn.height,ft+=rt,Le&&(nt-=rt));let{anchorX:Ni,anchorY:kr}=function(Wi){let To,La,{isHeader:Is,plotX:Af=0,plotY:gm=0,series:Uu}=Wi;if(Is)To=Math.max(S+Af,S),La=O+M/2;else{let{xAxis:Ry,yAxis:Py}=Uu;To=Ry.pos+_c(Af,-X,Ry.len+X),Uu.shouldShowTooltip(0,Py.pos-O+gm,{ignoreX:!0})&&(La=Py.pos+gm)}return{anchorX:To=_c(To,de.left-X,de.right+X),anchorY:La}}(sn);if(typeof kr=="number"){let Wi=Mn.height+1,To=te?te.call(y,xi,Wi,sn):Bt(Ni,kr,mr,xi);un.push({align:te?0:void 0,anchorX:Ni,anchorY:kr,boxWidth:xi,point:sn,rank:Sa(To.rank,mr?1:0),size:Wi,target:To.y,tt:Yn,x:To.x})}else Yn.isActive=!1}return un},[]);!te&&Lt.some(un=>{let{outside:dn}=y,Hn=(dn?Ie:0)+un.anchorX;return Hn<de.left&&Hn+un.boxWidth<de.right||Hn<Ie-de.left+un.boxWidth&&de.right-Hn>Hn})&&(Lt=Lt.map(un=>{let{x:dn,y:Hn}=Bt(un.anchorX,un.anchorY,un.point.isHeader,un.boxWidth,!1);return Op(un,{target:Hn,x:dn})})),y.cleanSplit(),Yg(Lt,ft);let Vt={left:Ie,right:Ie};Lt.forEach(function(un){let{x:dn,boxWidth:Hn,isHeader:sn}=un;!sn&&(y.outside&&Ie+dn<Vt.left&&(Vt.left=Ie+dn),!sn&&y.outside&&Vt.left+Hn>Vt.right&&(Vt.right=Ie+dn))}),Lt.forEach(function(un){let{x:dn,anchorX:Hn,anchorY:sn,pos:mr,point:{isHeader:Gi}}=un,Yn={visibility:mr===void 0?"hidden":"inherit",x:dn,y:(mr||0)+nt,anchorX:Hn,anchorY:sn};if(y.outside&&dn<Hn){let Mn=Ie-Vt.left;Mn>0&&(Gi||(Yn.x=dn+Mn,Yn.anchorX=Hn+Mn),Gi&&(Yn.x=(Vt.right-Vt.left)/2,Yn.anchorX=Hn+Mn))}un.tt.attr(Yn)});let{container:Yt,outside:zt,renderer:Tn}=y;if(zt&&Yt&&Tn){let{width:un,height:dn,x:Hn,y:sn}=Ae.getBBox();Tn.setSize(un+Hn,dn+sn,!1),Yt.style.left=Vt.left+"px",Yt.style.top=ze+"px"}Hr&&Ae.attr({opacity:Ae.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let u=this.chart,p=this.label,y=this.shared?u.hoverPoints:u.hoverPoint;if(!p||!y)return;let b={x:0,y:0,width:0,height:0},w=this.getAnchor(y),T=p.getBBox();w[0]+=u.plotLeft-(p.translateX||0),w[1]+=u.plotTop-(p.translateY||0),b.x=Math.min(0,w[0]),b.y=Math.min(0,w[1]),b.width=w[0]<0?Math.max(Math.abs(w[0]),T.width-w[0]):Math.max(Math.abs(w[0]),T.width),b.height=w[1]<0?Math.max(Math.abs(w[1]),T.height-Math.abs(w[1])):Math.max(Math.abs(w[1]),T.height),this.tracker?this.tracker.attr(b):(this.tracker=p.renderer.rect(b).addClass("highcharts-tracker").add(p),u.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(u){return u.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(u,p){let y=u.series,b=y.tooltipOptions,w=y.xAxis,T=w&&w.dateTime,M={isFooter:p,point:u},S=b.xDateFormat||"",O=b[p?"footerFormat":"headerFormat"];return Lp(this,"headerFormatter",M,function(B){if(T&&!S&&xs(u.key)&&(S=T.getXDateFormat(u.key,b.dateTimeLabelFormats)),T&&S){if(El(S)){let N=S;kp[0]=U=>y.chart.time.dateFormat(N,U),S="%0"}(u.tooltipDateKeys||["key"]).forEach(N=>{O=O.replace(RegExp("point\\."+N+"([ \\)}])",""),`(point.${N}:${S})$1`)})}y.chart.styledMode&&(O=this.styledModeFormat(O)),B.text=Qh(O,u,this.chart)}),M.text||""}update(u){this.destroy(),this.init(this.chart,Ot(!0,this.options,u))}updatePosition(u){let{chart:p,container:y,distance:b,options:w,pointer:T,renderer:M}=this,{height:S=0,width:O=0}=this.getLabel(),{left:B,top:N,scaleX:U,scaleY:X}=T.getChartPosition(),Z=(w.positioner||this.getPosition).call(this,O,S,u),te=lt.doc,ne=(u.plotX||0)+p.plotLeft,J=(u.plotY||0)+p.plotTop,ce;M&&y&&(w.positioner&&(Z.x+=B-b,Z.y+=N-b),ce=(w.borderWidth||0)+2*b+2,M.setSize(_c(O+ce,0,te.documentElement.clientWidth)-1,S+ce,!1),(U!==1||X!==1)&&(Pp(y,{transform:`scale(${U}, ${X})`}),ne*=U,J*=X),ne+=B-Z.x,J+=N-Z.y),this.move(Math.round(Z.x),Math.round(Z.y||0),ne,J)}}(function(P){P.compose=function(u){tf(Jh,"Core.Tooltip")&&Rp(u,"afterInit",function(){let p=this.chart;p.options.tooltip&&(p.tooltip=new P(p,p.options.tooltip,this))})}})(St||(St={}));let Ud=St,{animObject:Kg}=Rn,{defaultOptions:Fp}=Mr,{format:nf}=Dt,{addEvent:Np,crisp:zp,erase:Qg,extend:$d,fireEvent:Mu,getNestedProperty:rf,isArray:of,isFunction:bc,isNumber:m,isObject:l,merge:d,pick:_,syncTimeout:x,removeEvent:D,uniqueKey:k}=Zt;class R{animateBeforeDestroy(){let u=this,p={x:u.startXPos,opacity:0},y=u.getGraphicalProps();y.singular.forEach(function(b){u[b]=u[b].animate(b==="dataLabel"?{x:u[b].startXPos,y:u[b].startYPos,opacity:0}:p)}),y.plural.forEach(function(b){u[b].forEach(function(w){w.element&&w.animate($d({x:u.startXPos},w.startYPos?{x:w.startXPos,y:w.startYPos}:{}))})})}applyOptions(u,p){let y=this.series,b=y.options.pointValKey||y.pointValKey;return $d(this,u=R.prototype.optionsToObject.call(this,u)),this.options=this.options?$d(this.options,u):u,u.group&&delete this.group,u.dataLabels&&delete this.dataLabels,b&&(this.y=R.prototype.getNestedProperty.call(this,b)),this.selected&&(this.state="select"),"name"in this&&p===void 0&&y.xAxis&&y.xAxis.hasNames&&(this.x=y.xAxis.nameToX(this)),this.x===void 0&&y?this.x=p??y.autoIncrement():m(u.x)&&y.options.relativeXValue?this.x=y.autoIncrement(u.x):typeof this.x=="string"&&(p??(p=y.chart.time.parse(this.x)),m(p)&&(this.x=p)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let u=this,p=u.series,y=p.chart,b=p.options.dataSorting,w=y.hoverPoints,T=Kg(u.series.chart.renderer.globalAnimation),M=()=>{for(let S in(u.graphic||u.graphics||u.dataLabel||u.dataLabels)&&(D(u),u.destroyElements()),u)delete u[S]};u.legendItem&&y.legend.destroyItem(u),w&&(u.setState(),Qg(w,u),w.length||(y.hoverPoints=null)),u===y.hoverPoint&&u.onMouseOut(),b&&b.enabled?(this.animateBeforeDestroy(),x(M,T.duration)):M(),y.pointCount--}this.destroyed=!0}destroyElements(u){let p=this,y=p.getGraphicalProps(u);y.singular.forEach(function(b){p[b]=p[b].destroy()}),y.plural.forEach(function(b){p[b].forEach(function(w){w&&w.element&&w.destroy()}),delete p[b]})}firePointEvent(u,p,y){let b=this,w=this.series.options;b.manageEvent(u),u==="click"&&w.allowPointSelect&&(y=function(T){!b.destroyed&&b.select&&b.select(null,T.ctrlKey||T.metaKey||T.shiftKey)}),Mu(b,u,p,y)}getClassName(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(u){let p,y,b=this,w=[],T={singular:[],plural:[]};for((u=u||{graphic:1,dataLabel:1}).graphic&&w.push("graphic","connector"),u.dataLabel&&w.push("dataLabel","dataLabelPath","dataLabelUpper"),y=w.length;y--;)b[p=w[y]]&&T.singular.push(p);return["graphic","dataLabel"].forEach(function(M){let S=M+"s";u[M]&&b[S]&&T.plural.push(S)}),T}getNestedProperty(u){return u?u.indexOf("custom.")===0?rf(u,this.options):this[u]:void 0}getZone(){let u=this.series,p=u.zones,y=u.zoneAxis||"y",b,w=0;for(b=p[0];this[y]>=b.value;)b=p[++w];return this.nonZonedColor||(this.nonZonedColor=this.color),b&&b.color&&!this.options.color?this.color=b.color:this.color=this.nonZonedColor,b}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(u,p,y){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=u,this.applyOptions(p,y),this.id??(this.id=k()),this.resolveColor(),u.chart.pointCount++,Mu(this,"afterInit")}isValid(){return(m(this.x)||this.x instanceof Date)&&m(this.y)}optionsToObject(u){let p=this.series,y=p.options.keys,b=y||p.pointArrayMap||["y"],w=b.length,T={},M,S=0,O=0;if(m(u)||u===null)T[b[0]]=u;else if(of(u))for(!y&&u.length>w&&((M=typeof u[0])=="string"?p.xAxis?.dateTime?T.x=p.chart.time.parse(u[0]):T.name=u[0]:M==="number"&&(T.x=u[0]),S++);O<w;)y&&u[S]===void 0||(b[O].indexOf(".")>0?R.prototype.setNestedProperty(T,u[S],b[O]):T[b[O]]=u[S]),S++,O++;else typeof u=="object"&&(T=u,u.dataLabels&&(p.hasDataLabels=()=>!0),u.marker&&(p._hasPointMarkers=!0));return T}pos(u,p=this.plotY){if(!this.destroyed){let{plotX:y,series:b}=this,{chart:w,xAxis:T,yAxis:M}=b,S=0,O=0;if(m(y)&&m(p))return u&&(S=T?T.pos:w.plotLeft,O=M?M.pos:w.plotTop),w.inverted&&T&&M?[M.len-p+O,T.len-y+S]:[y+S,p+O]}}resolveColor(){let u=this.series,p=u.chart.options.chart,y=u.chart.styledMode,b,w,T=p.colorCount,M;delete this.nonZonedColor,u.options.colorByPoint?(y||(b=(w=u.options.colors||u.chart.options.colors)[u.colorCounter],T=w.length),M=u.colorCounter,u.colorCounter++,u.colorCounter===T&&(u.colorCounter=0)):(y||(b=u.color),M=u.colorIndex),this.colorIndex=_(this.options.colorIndex,M),this.color=_(this.options.color,b)}setNestedProperty(u,p,y){return y.split(".").reduce(function(b,w,T,M){let S=M.length-1===T;return b[w]=S?p:l(b[w],!0)?b[w]:{},b[w]},u),u}shouldDraw(){return!this.isNull}tooltipFormatter(u){let{chart:p,pointArrayMap:y=["y"],tooltipOptions:b}=this.series,{valueDecimals:w="",valuePrefix:T="",valueSuffix:M=""}=b;return p.styledMode&&(u=p.tooltip?.styledModeFormat(u)||u),y.forEach(S=>{S="{point."+S,(T||M)&&(u=u.replace(RegExp(S+"}","g"),T+S+"}"+M)),u=u.replace(RegExp(S+"}","g"),S+":,."+w+"f}")}),nf(u,this,p)}update(u,p,y,b){let w,T=this,M=T.series,S=T.graphic,O=M.chart,B=M.options;function N(){T.applyOptions(u);let U=S&&T.hasMockGraphic,X=T.y===null?!U:U;S&&X&&(T.graphic=S.destroy(),delete T.hasMockGraphic),l(u,!0)&&(S&&S.element&&u&&u.marker&&u.marker.symbol!==void 0&&(T.graphic=S.destroy()),u?.dataLabels&&T.dataLabel&&(T.dataLabel=T.dataLabel.destroy())),w=T.index;let Z={};for(let te of M.dataColumnKeys())Z[te]=T[te];M.dataTable.setRow(Z,w),B.data[w]=l(B.data[w],!0)||l(u,!0)?T.options:_(u,B.data[w]),M.isDirty=M.isDirtyData=!0,!M.fixedBox&&M.hasCartesianSeries&&(O.isDirtyBox=!0),B.legendType==="point"&&(O.isDirtyLegend=!0),p&&O.redraw(y)}p=_(p,!0),b===!1?N():T.firePointEvent("update",{options:u},N)}remove(u,p){this.series.removePoint(this.series.data.indexOf(this),u,p)}select(u,p){let y=this,b=y.series,w=b.chart;u=_(u,!y.selected),this.selectedStaging=u,y.firePointEvent(u?"select":"unselect",{accumulate:p},function(){y.selected=y.options.selected=u,b.options.data[b.data.indexOf(y)]=y.options,y.setState(u&&"select"),p||w.getSelectedPoints().forEach(function(T){let M=T.series;T.selected&&T!==y&&(T.selected=T.options.selected=!1,M.options.data[M.data.indexOf(T)]=T.options,T.setState(w.hoverPoints&&M.options.inactiveOtherPoints?"inactive":""),T.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(u){let{inverted:p,pointer:y}=this.series.chart;y&&(u=u?y.normalize(u):y.getChartCoordinatesFromPoint(this,p),y.runPointActions(u,this))}onMouseOut(){let u=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(u.hoverPoints||[]).forEach(function(p){p.setState()}),u.hoverPoints=u.hoverPoint=null}manageEvent(u){let p=d(this.series.options.point,this.options),y=p.events?.[u];bc(y)&&(!this.hcEvents?.[u]||this.hcEvents?.[u]?.map(b=>b.fn).indexOf(y)===-1)?(this.importedUserEvent?.(),this.importedUserEvent=Np(this,u,y),this.hcEvents&&(this.hcEvents[u].userEvent=!0)):this.importedUserEvent&&!y&&this.hcEvents?.[u]&&this.hcEvents?.[u].userEvent&&(D(this,u),delete this.hcEvents[u],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(u,p){let y=this.series,b=this.state,w=y.options.states[u||"normal"]||{},T=Fp.plotOptions[y.type].marker&&y.options.marker,M=T&&T.enabled===!1,S=T&&T.states&&T.states[u||"normal"]||{},O=S.enabled===!1,B=this.marker||{},N=y.chart,U=T&&y.markerAttribs,X=y.halo,Z,te,ne,J=y.stateMarkerGraphic,ce;if((u=u||"")===this.state&&!p||this.selected&&u!=="select"||w.enabled===!1||u&&(O||M&&S.enabled===!1)||u&&B.states&&B.states[u]&&B.states[u].enabled===!1)return;if(this.state=u,U&&(Z=y.markerAttribs(this,u)),this.graphic&&!this.hasMockGraphic){if(b&&this.graphic.removeClass("highcharts-point-"+b),u&&this.graphic.addClass("highcharts-point-"+u),!N.styledMode){te=y.pointAttribs(this,u),ne=_(N.options.chart.animation,w.animation);let Le=te.opacity;y.options.inactiveOtherPoints&&m(Le)&&(this.dataLabels||[]).forEach(function(Ie){Ie&&!Ie.hasClass("highcharts-data-label-hidden")&&(Ie.animate({opacity:Le},ne),Ie.connector&&Ie.connector.animate({opacity:Le},ne))}),this.graphic.animate(te,ne)}Z&&this.graphic.animate(Z,_(N.options.chart.animation,S.animation,T.animation)),J&&J.hide()}else u&&S&&(ce=B.symbol||y.symbol,J&&J.currentSymbol!==ce&&(J=J.destroy()),Z&&(J?J[p?"animate":"attr"]({x:Z.x,y:Z.y}):ce&&(y.stateMarkerGraphic=J=N.renderer.symbol(ce,Z.x,Z.y,Z.width,Z.height,d(T,S)).add(y.markerGroup),J.currentSymbol=ce)),!N.styledMode&&J&&this.state!=="inactive"&&J.attr(y.pointAttribs(this,u))),J&&(J[u&&this.isInside?"show":"hide"](),J.element.point=this,J.addClass(this.getClassName(),!0));let de=w.halo,Ae=this.graphic||J,Ue=Ae&&Ae.visibility||"inherit";de&&de.size&&Ae&&Ue!=="hidden"&&!this.isCluster?(X||(y.halo=X=N.renderer.path().add(Ae.parentGroup)),X.show()[p?"animate":"attr"]({d:this.haloPath(de.size)}),X.attr({class:"highcharts-halo highcharts-color-"+_(this.colorIndex,y.colorIndex)+(this.className?" "+this.className:""),visibility:Ue,zIndex:-1}),X.point=this,N.styledMode||X.attr($d({fill:this.color||y.color,"fill-opacity":de.opacity},vi.filterUserAttributes(de.attributes||{})))):X?.point?.haloPath&&!X.point.destroyed&&X.animate({d:X.point.haloPath(0)},null,X.hide),Mu(this,"afterSetState",{state:u})}haloPath(u){let p=this.pos();return p?this.series.chart.renderer.symbols.circle(zp(p[0],1)-u,p[1]-u,2*u,2*u):[]}}let z=R,{parse:G}=re,{charts:H,composed:Y,isTouchDevice:se}=lt,{addEvent:le,attr:fe,css:he,extend:pe,find:Q,fireEvent:ue,isNumber:ye,isObject:_e,objectEach:Se,offset:ke,pick:De,pushUnique:Be,splat:Fe}=Zt;class Ve{applyInactiveState(u){let p=[],y;(u||[]).forEach(function(b){y=b.series,p.push(y),y.linkedParent&&p.push(y.linkedParent),y.linkedSeries&&(p=p.concat(y.linkedSeries)),y.navigatorSeries&&p.push(y.navigatorSeries)}),this.chart.series.forEach(function(b){p.indexOf(b)===-1?b.setState("inactive",!0):b.options.inactiveOtherPoints&&b.setAllPointsToState("inactive")})}destroy(){let u=this;this.eventsToUnbind.forEach(p=>p()),this.eventsToUnbind=[],!lt.chartCount&&(Ve.unbindDocumentMouseUp.forEach(p=>p.unbind()),Ve.unbindDocumentMouseUp.length=0,Ve.unbindDocumentTouchEnd&&(Ve.unbindDocumentTouchEnd=Ve.unbindDocumentTouchEnd())),clearInterval(u.tooltipTimeout),Se(u,function(p,y){u[y]=void 0})}getSelectionMarkerAttrs(u,p){let y={args:{chartX:u,chartY:p},attrs:{},shapeType:"rect"};return ue(this,"getSelectionMarkerAttrs",y,b=>{let w,{chart:T,zoomHor:M,zoomVert:S}=this,{mouseDownX:O=0,mouseDownY:B=0}=T,N=b.attrs;N.x=T.plotLeft,N.y=T.plotTop,N.width=M?1:T.plotWidth,N.height=S?1:T.plotHeight,M&&(w=u-O,N.width=Math.max(1,Math.abs(w)),N.x=(w>0?0:w)+O),S&&(w=p-B,N.height=Math.max(1,Math.abs(w)),N.y=(w>0?0:w)+B)}),y}drag(u){let{chart:p}=this,{mouseDownX:y=0,mouseDownY:b=0}=p,{panning:w,panKey:T,selectionMarkerFill:M}=p.options.chart,S=p.plotLeft,O=p.plotTop,B=p.plotWidth,N=p.plotHeight,U=_e(w)?w.enabled:w,X=T&&u[`${T}Key`],Z=u.chartX,te=u.chartY,ne,J=this.selectionMarker;if((!J||!J.touch)&&(Z<S?Z=S:Z>S+B&&(Z=S+B),te<O?te=O:te>O+N&&(te=O+N),this.hasDragged=Math.sqrt(Math.pow(y-Z,2)+Math.pow(b-te,2)),this.hasDragged>10)){ne=p.isInsidePlot(y-S,b-O,{visiblePlotOnly:!0});let{shapeType:ce,attrs:de}=this.getSelectionMarkerAttrs(Z,te);(p.hasCartesianSeries||p.mapView)&&this.hasZoom&&ne&&!X&&!J&&(this.selectionMarker=J=p.renderer[ce](),J.attr({class:"highcharts-selection-marker",zIndex:7}).add(),p.styledMode||J.attr({fill:M||G("#334eff").setOpacity(.25).get()})),J&&J.attr(de),ne&&!J&&U&&p.pan(u,w)}}dragStart(u){let p=this.chart;p.mouseIsDown=u.type,p.cancelClick=!1,p.mouseDownX=u.chartX,p.mouseDownY=u.chartY}getSelectionBox(u){let p={args:{marker:u},result:u.getBBox()};return ue(this,"getSelectionBox",p),p.result}drop(u){let p,{chart:y,selectionMarker:b}=this;for(let w of y.axes)w.isPanning&&(w.isPanning=!1,(w.options.startOnTick||w.options.endOnTick||w.series.some(T=>T.boosted))&&(w.forceRedraw=!0,w.setExtremes(w.userMin,w.userMax,!1),p=!0));if(p&&y.redraw(),b&&u){if(this.hasDragged){let w=this.getSelectionBox(b);y.transform({axes:y.axes.filter(T=>T.zoomEnabled&&(T.coll==="xAxis"&&this.zoomX||T.coll==="yAxis"&&this.zoomY)),selection:ht({originalEvent:u,xAxis:[],yAxis:[]},w),from:w})}ye(y.index)&&(this.selectionMarker=b.destroy())}y&&ye(y.index)&&(he(y.container,{cursor:y._cursor}),y.cancelClick=this.hasDragged>10,y.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(u,p,y){let b;return u.forEach(function(w){let T=!(w.noSharedTooltip&&p)&&0>w.options.findNearestPointBy.indexOf("y"),M=w.searchPoint(y,T);_e(M,!0)&&M.series&&(!_e(b,!0)||function(S,O){let B=S.distX-O.distX,N=S.dist-O.dist,U=O.series.group?.zIndex-S.series.group?.zIndex;return B!==0&&p?B:N!==0?N:U!==0?U:S.series.index>O.series.index?-1:1}(b,M)>0)&&(b=M)}),b}getChartCoordinatesFromPoint(u,p){let{xAxis:y,yAxis:b}=u.series,w=u.shapeArgs;if(y&&b){let T=u.clientX??u.plotX??0,M=u.plotY||0;return u.isNode&&w&&ye(w.x)&&ye(w.y)&&(T=w.x,M=w.y),p?{chartX:b.len+b.pos-M,chartY:y.len+y.pos-T}:{chartX:T+y.pos,chartY:M+b.pos}}if(w&&w.x&&w.y)return{chartX:w.x,chartY:w.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:u}=this.chart,p=ke(u);this.chartPosition={left:p.left,top:p.top,scaleX:1,scaleY:1};let{offsetHeight:y,offsetWidth:b}=u;return b>2&&y>2&&(this.chartPosition.scaleX=p.width/b,this.chartPosition.scaleY=p.height/y),this.chartPosition}getCoordinates(u){let p={xAxis:[],yAxis:[]};for(let y of this.chart.axes)p[y.isXAxis?"xAxis":"yAxis"].push({axis:y,value:y.toValue(u[y.horiz?"chartX":"chartY"])});return p}getHoverData(u,p,y,b,w,T){let M=[],S=function(X){return X.visible&&!(!w&&X.directTouch)&&De(X.options.enableMouseTracking,!0)},O=p,B,N={chartX:T?T.chartX:void 0,chartY:T?T.chartY:void 0,shared:w};ue(this,"beforeGetHoverData",N),B=O&&!O.stickyTracking?[O]:y.filter(X=>X.stickyTracking&&(N.filter||S)(X));let U=b&&u||!T?u:this.findNearestKDPoint(B,w,T);return O=U&&U.series,U&&(w&&!O.noSharedTooltip?(B=y.filter(function(X){return N.filter?N.filter(X):S(X)&&!X.noSharedTooltip})).forEach(function(X){let Z=Q(X.points,function(te){return te.x===U.x&&!te.isNull});_e(Z)&&(X.boosted&&X.boost&&(Z=X.boost.getPoint(Z)),M.push(Z))}):M.push(U)),ue(this,"afterGetHoverData",N={hoverPoint:U}),{hoverPoint:N.hoverPoint,hoverSeries:O,hoverPoints:M}}getPointFromEvent(u){let p=u.target,y;for(;p&&!y;)y=p.point,p=p.parentNode;return y}onTrackerMouseOut(u){let p=this.chart,y=u.relatedTarget,b=p.hoverSeries;this.isDirectTouch=!1,!b||!y||b.stickyTracking||this.inClass(y,"highcharts-tooltip")||this.inClass(y,"highcharts-series-"+b.index)&&this.inClass(y,"highcharts-tracker")||b.onMouseOut()}inClass(u,p){let y=u,b;for(;y;){if(b=fe(y,"class")){if(b.indexOf(p)!==-1)return!0;if(b.indexOf("highcharts-container")!==-1)return!1}y=y.parentElement}}constructor(u,p){this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=p,this.chart=u,this.runChartClick=!!p.chart.events?.click,this.pinchDown=[],this.setDOMEvents(),ue(this,"afterInit")}normalize(u,p){let y=u.touches,b=y?y.length?y.item(0):De(y.changedTouches,u.changedTouches)[0]:u;p||(p=this.getChartPosition());let w=b.pageX-p.left,T=b.pageY-p.top;return pe(u,{chartX:Math.round(w/=p.scaleX),chartY:Math.round(T/=p.scaleY)})}onContainerClick(u){let p=this.chart,y=p.hoverPoint,b=this.normalize(u),w=p.plotLeft,T=p.plotTop;!p.cancelClick&&(y&&this.inClass(b.target,"highcharts-tracker")?(ue(y.series,"click",pe(b,{point:y})),p.hoverPoint&&y.firePointEvent("click",b)):(pe(b,this.getCoordinates(b)),p.isInsidePlot(b.chartX-w,b.chartY-T,{visiblePlotOnly:!0})&&ue(p,"click",b)))}onContainerMouseDown(u){let p=(1&(u.buttons||u.button))==1;u=this.normalize(u),lt.isFirefox&&u.button!==0&&this.onContainerMouseMove(u),(u.button===void 0||p)&&(this.zoomOption(u),p&&u.preventDefault?.(),this.dragStart(u))}onContainerMouseLeave(u){let{pointer:p}=H[De(Ve.hoverChartIndex,-1)]||{};u=this.normalize(u),this.onContainerMouseMove(u),p&&!this.inClass(u.relatedTarget,"highcharts-tooltip")&&(p.reset(),p.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(u){let p=this.chart,y=p.tooltip,b=this.normalize(u);this.setHoverChartIndex(u),(p.mouseIsDown==="mousedown"||this.touchSelect(b))&&this.drag(b),!p.openMenu&&(this.inClass(b.target,"highcharts-tracker")||p.isInsidePlot(b.chartX-p.plotLeft,b.chartY-p.plotTop,{visiblePlotOnly:!0}))&&!(y&&y.shouldStickOnContact(b))&&(this.inClass(b.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(b))}onDocumentTouchEnd(u){this.onDocumentMouseUp(u)}onContainerTouchMove(u){this.touchSelect(u)?this.onContainerMouseMove(u):this.touch(u)}onContainerTouchStart(u){this.touchSelect(u)?this.onContainerMouseDown(u):(this.zoomOption(u),this.touch(u,!0))}onDocumentMouseMove(u){let p=this.chart,y=p.tooltip,b=this.chartPosition,w=this.normalize(u,b);!b||p.isInsidePlot(w.chartX-p.plotLeft,w.chartY-p.plotTop,{visiblePlotOnly:!0})||y&&y.shouldStickOnContact(w)||w.target!==p.container.ownerDocument&&this.inClass(w.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(u){H[De(Ve.hoverChartIndex,-1)]?.pointer?.drop(u)}pinch(u){let p=this,{chart:y,hasZoom:b,lastTouches:w}=p,T=[].map.call(u.touches||[],N=>p.normalize(N)),M=T.length,S=M===1&&(p.inClass(u.target,"highcharts-tracker")&&y.runTrackerClick||p.runChartClick),O=y.tooltip,B=M===1&&De(O?.options.followTouchMove,!0);M>1?p.initiated=!0:B&&(p.initiated=!1),b&&p.initiated&&!S&&u.cancelable!==!1&&u.preventDefault(),u.type==="touchstart"?(p.pinchDown=T,p.res=!0,y.mouseDownX=u.chartX):B?this.runPointActions(p.normalize(u)):w&&(ue(y,"touchpan",{originalEvent:u,touches:T},()=>{let N=U=>{let X=U[0],Z=U[1]||X;return{x:X.chartX,y:X.chartY,width:Z.chartX-X.chartX,height:Z.chartY-X.chartY}};y.transform({axes:y.axes.filter(U=>U.zoomEnabled&&(this.zoomHor&&U.horiz||this.zoomVert&&!U.horiz)),to:N(T),from:N(w),trigger:u.type})}),p.res&&(p.res=!1,this.reset(!1,0))),p.lastTouches=T}reset(u,p){let y=this.chart,b=y.hoverSeries,w=y.hoverPoint,T=y.hoverPoints,M=y.tooltip,S=M&&M.shared?T:w;u&&S&&Fe(S).forEach(function(O){O.series.isCartesian&&O.plotX===void 0&&(u=!1)}),u?M&&S&&Fe(S).length&&(M.refresh(S),M.shared&&T?T.forEach(function(O){O.setState(O.state,!0),O.series.isCartesian&&(O.series.xAxis.crosshair&&O.series.xAxis.drawCrosshair(null,O),O.series.yAxis.crosshair&&O.series.yAxis.drawCrosshair(null,O))}):w&&(w.setState(w.state,!0),y.axes.forEach(function(O){O.crosshair&&w.series[O.coll]===O&&O.drawCrosshair(null,w)}))):(w&&w.onMouseOut(),T&&T.forEach(function(O){O.setState()}),b&&b.onMouseOut(),M&&M.hide(p),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),y.axes.forEach(function(O){O.hideCrosshair()}),y.hoverPoints=y.hoverPoint=void 0)}runPointActions(u,p,y){let b=this.chart,w=b.series,T=b.tooltip&&b.tooltip.options.enabled?b.tooltip:void 0,M=!!T&&T.shared,S=p||b.hoverPoint,O=S&&S.series||b.hoverSeries,B=(!u||u.type!=="touchmove")&&(!!p||O&&O.directTouch&&this.isDirectTouch),N=this.getHoverData(S,O,w,B,M,u);S=N.hoverPoint,O=N.hoverSeries;let U=N.hoverPoints,X=O&&O.tooltipOptions.followPointer&&!O.tooltipOptions.split,Z=M&&O&&!O.noSharedTooltip;if(S&&(y||S!==b.hoverPoint||T&&T.isHidden)){if((b.hoverPoints||[]).forEach(function(te){U.indexOf(te)===-1&&te.setState()}),b.hoverSeries!==O&&O.onMouseOver(),this.applyInactiveState(U),(U||[]).forEach(function(te){te.setState("hover")}),b.hoverPoint&&b.hoverPoint.firePointEvent("mouseOut"),!S.series)return;b.hoverPoints=U,b.hoverPoint=S,S.firePointEvent("mouseOver",void 0,()=>{T&&S&&T.refresh(Z?U:S,u)})}else if(X&&T&&!T.isHidden){let te=T.getAnchor([{}],u);b.isInsidePlot(te[0],te[1],{visiblePlotOnly:!0})&&T.updatePosition({plotX:te[0],plotY:te[1]})}this.unDocMouseMove||(this.unDocMouseMove=le(b.container.ownerDocument,"mousemove",te=>H[Ve.hoverChartIndex??-1]?.pointer?.onDocumentMouseMove(te)),this.eventsToUnbind.push(this.unDocMouseMove)),b.axes.forEach(function(te){let ne,J=De((te.crosshair||{}).snap,!0);!J||(ne=b.hoverPoint)&&ne.series[te.coll]===te||(ne=Q(U,ce=>ce.series&&ce.series[te.coll]===te)),ne||!J?te.drawCrosshair(u,ne):te.hideCrosshair()})}setDOMEvents(){let u=this.chart.container,p=u.ownerDocument;u.onmousedown=this.onContainerMouseDown.bind(this),u.onmousemove=this.onContainerMouseMove.bind(this),u.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(le(u,"mouseenter",this.onContainerMouseEnter.bind(this)),le(u,"mouseleave",this.onContainerMouseLeave.bind(this))),Ve.unbindDocumentMouseUp.some(b=>b.doc===p)||Ve.unbindDocumentMouseUp.push({doc:p,unbind:le(p,"mouseup",this.onDocumentMouseUp.bind(this))});let y=this.chart.renderTo.parentElement;for(;y&&y.tagName!=="BODY";)this.eventsToUnbind.push(le(y,"scroll",()=>{delete this.chartPosition})),y=y.parentElement;this.eventsToUnbind.push(le(u,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),le(u,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),Ve.unbindDocumentTouchEnd||(Ve.unbindDocumentTouchEnd=le(p,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),le(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){if(!se)return;let u=this.pointerCaptureEventsToUnbind,p=this.chart,y=p.container,b=De(p.options.tooltip?.followTouchMove,!0)&&p.series.some(w=>w.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&b?(u.push(le(y,"pointerdown",w=>{w.target?.hasPointerCapture(w.pointerId)&&w.target?.releasePointerCapture(w.pointerId)}),le(y,"pointermove",w=>{p.pointer?.getPointFromEvent(w)?.onMouseOver(w)})),p.styledMode||he(y,{"touch-action":"none"}),y.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!b&&(u.forEach(w=>w()),u.length=0,p.styledMode||he(y,{"touch-action":De(p.options.chart.style?.["touch-action"],"manipulation")}),y.className=y.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(u){let p=this.chart,y=lt.charts[De(Ve.hoverChartIndex,-1)];if(y&&y!==p){let b={relatedTarget:p.container};u&&!u?.relatedTarget&&Object.assign({},u,b),y.pointer?.onContainerMouseLeave(u||b)}y&&y.mouseIsDown||(Ve.hoverChartIndex=p.index)}touch(u,p){let y,{chart:b,pinchDown:w=[]}=this;this.setHoverChartIndex(),(u=this.normalize(u)).touches.length===1?b.isInsidePlot(u.chartX-b.plotLeft,u.chartY-b.plotTop,{visiblePlotOnly:!0})&&!b.openMenu?(p&&this.runPointActions(u),u.type==="touchmove"&&(y=!!w[0]&&Math.pow(w[0].chartX-u.chartX,2)+Math.pow(w[0].chartY-u.chartY,2)>=16),De(y,!0)&&this.pinch(u)):p&&this.reset():u.touches.length===2&&this.pinch(u)}touchSelect(u){return!!(this.chart.zooming.singleTouch&&u.touches&&u.touches.length===1)}zoomOption(u){let p=this.chart,y=p.inverted,b=p.zooming.type||"",w,T;/touch/.test(u.type)&&(b=De(p.zooming.pinchType,b)),this.zoomX=w=/x/.test(b),this.zoomY=T=/y/.test(b),this.zoomHor=w&&!y||T&&y,this.zoomVert=T&&!y||w&&y,this.hasZoom=w||T}}Ve.unbindDocumentMouseUp=[],function(P){P.compose=function(u){Be(Y,"Core.Pointer")&&le(u,"beforeRender",function(){this.pointer=new P(this,this.options)})}}(Ve||(Ve={}));let mt=Ve,{fireEvent:He,isArray:it,objectEach:Ze,uniqueKey:ut}=Zt,Ge=class{constructor(P={}){this.autoId=!P.id,this.columns={},this.id=P.id||ut(),this.modified=this,this.rowCount=0,this.versionTag=ut();let u=0;Ze(P.columns||{},(p,y)=>{this.columns[y]=p.slice(),u=Math.max(u,p.length)}),this.applyRowCount(u)}applyRowCount(P){this.rowCount=P,Ze(this.columns,u=>{it(u)&&(u.length=P)})}getColumn(P,u){return this.columns[P]}getColumns(P,u){return(P||Object.keys(this.columns)).reduce((p,y)=>(p[y]=this.columns[y],p),{})}getRow(P,u){return(u||Object.keys(this.columns)).map(p=>this.columns[p]?.[P])}setColumn(P,u=[],p=0,y){this.setColumns({[P]:u},p,y)}setColumns(P,u,p){let y=this.rowCount;Ze(P,(b,w)=>{this.columns[w]=b.slice(),y=b.length}),this.applyRowCount(y),p?.silent||(He(this,"afterSetColumns"),this.versionTag=ut())}setRow(P,u=this.rowCount,p,y){let{columns:b}=this,w=p?this.rowCount+1:u+1;Ze(P,(T,M)=>{let S=b[M]||y?.addColumns!==!1&&Array(w);S&&(p?S.splice(u,0,T):S[u]=T,b[M]=S)}),w>this.rowCount&&this.applyRowCount(w),y?.silent||(He(this,"afterSetRows"),this.versionTag=ut())}},{extend:tt,merge:gt,pick:at}=Zt;(function(P){function u(p,y,b){let w=this.legendItem=this.legendItem||{},{chart:T,options:M}=this,{baseline:S=0,symbolWidth:O,symbolHeight:B}=p,N=this.symbol||"circle",U=B/2,X=T.renderer,Z=w.group,te=S-Math.round((p.fontMetrics?.b||B)*(b?.4:.3)),ne={},J,ce=M.marker,de=0;if(T.styledMode||(ne["stroke-width"]=Math.min(M.lineWidth||0,24),M.dashStyle?ne.dashstyle=M.dashStyle:M.linecap==="square"||(ne["stroke-linecap"]="round")),w.line=X.path().addClass("highcharts-graph").attr(ne).add(Z),b&&(w.area=X.path().addClass("highcharts-area").add(Z)),ne["stroke-linecap"]&&(de=Math.min(w.line.strokeWidth(),O)/2),O){let Ae=[["M",de,te],["L",O-de,te]];w.line.attr({d:Ae}),w.area?.attr({d:[...Ae,["L",O-de,S],["L",de,S]]})}if(ce&&ce.enabled!==!1&&O){let Ae=Math.min(at(ce.radius,U),U);N.indexOf("url")===0&&(ce=gt(ce,{width:B,height:B}),Ae=0),w.symbol=J=X.symbol(N,O/2-Ae,te-Ae,2*Ae,2*Ae,tt({context:"legend"},ce)).addClass("highcharts-point").add(Z),J.isMarker=!0}}P.areaMarker=function(p,y){u.call(this,p,y,!0)},P.lineMarker=u,P.rectangle=function(p,y){let b=y.legendItem||{},w=p.options,T=p.symbolHeight,M=w.squareSymbol,S=M?T:p.symbolWidth;b.symbol=this.chart.renderer.rect(M?(p.symbolWidth-T)/2:0,p.baseline-T+1,S,T,at(p.options.symbolRadius,T/2)).addClass("highcharts-point").attr({zIndex:3}).add(b.group)}})(oe||(oe={}));let _t=oe,{defaultOptions:$t}=Mr,{extend:on,extendClass:Ft,merge:Xt}=Zt;(function(P){function u(p,y){let b=$t.plotOptions||{},w=y.defaultOptions,T=y.prototype;return T.type=p,T.pointClass||(T.pointClass=z),!P.seriesTypes[p]&&(w&&(b[p]=w),P.seriesTypes[p]=y,!0)}P.seriesTypes=lt.seriesTypes,P.registerSeriesType=u,P.seriesType=function(p,y,b,w,T){let M=$t.plotOptions||{};if(y=y||"",M[p]=Xt(M[y],b),delete P.seriesTypes[p],u(p,Ft(P.seriesTypes[y]||function(){},w)),P.seriesTypes[p].prototype.type=p,T){class S extends z{}on(S.prototype,T),P.seriesTypes[p].prototype.pointClass=S}return P.seriesTypes[p]}})(Ee||(Ee={}));let Ht=Ee,{animObject:En,setAnimation:jt}=Rn,{defaultOptions:Xn}=Mr,{registerEventOptions:ui}=ml,{svg:di,win:hi}=lt,{seriesTypes:ar}=Ht,{arrayMax:pr,arrayMin:Co,clamp:Jo,correctFloat:Ii,crisp:fi,defined:rn,destroyObjectProperties:lr,diffObjects:eo,erase:bi,error:Lr,extend:ea,find:Dl,fireEvent:gi,getClosestDistance:ta,getNestedProperty:na,insertItem:ka,isArray:Iu,isNumber:Ji,isString:sf,merge:Su,objectEach:Bp,pick:Ui,removeEvent:Jg,syncTimeout:af}=Zt;class Au{constructor(){this.zoneAxis="y"}init(u,p){let y;gi(this,"init",{options:p}),this.dataTable??(this.dataTable=new Ge);let b=u.series;this.eventsToUnbind=[],this.chart=u,this.options=this.setOptions(p);let w=this.options,T=w.visible!==!1;this.linkedSeries=[],this.bindAxes(),ea(this,{name:w.name,state:"",visible:T,selected:w.selected===!0}),ui(this,w);let M=w.events;(M&&M.click||w.point&&w.point.events&&w.point.events.click||w.allowPointSelect)&&(u.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(u.hasCartesianSeries=!0),b.length&&(y=b[b.length-1]),this._i=Ui(y&&y._i,-1)+1,this.opacity=this.options.opacity,u.orderItems("series",ka(this,b)),w.dataSorting&&w.dataSorting.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(w.data,!1),gi(this,"afterInit")}is(u){return ar[u]&&this instanceof ar[u]}bindAxes(){let u,p=this,y=p.options,b=p.chart;gi(this,"bindAxes",null,function(){(p.axisTypes||[]).forEach(function(w){(b[w]||[]).forEach(function(T){u=T.options,(Ui(y[w],0)===T.index||y[w]!==void 0&&y[w]===u.id)&&(ka(p,T.series),p[w]=T,T.isDirty=!0)}),p[w]||p.optionalAxis===w||Lr(18,!0,b)})}),gi(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(u,p){let y=u.marker,b=p.marker||{};return y&&(b.enabled&&!y.enabled||b.symbol!==y.symbol||b.height!==y.height||b.width!==y.width)}autoIncrement(u){let p,y=this.options,{pointIntervalUnit:b,relativeXValue:w}=this.options,T=this.chart.time,M=this.xIncrement??T.parse(y.pointStart)??0;if(this.pointInterval=p=Ui(this.pointInterval,y.pointInterval,1),w&&Ji(u)&&(p*=u),b){let S=T.toParts(M);b==="day"?S[2]+=p:b==="month"?S[1]+=p:b==="year"&&(S[0]+=p),p=T.makeTime.apply(T,S)-M}return w&&Ji(u)?M+p:(this.xIncrement=M+p,M)}setDataSortingOptions(){let u=this.options;ea(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),rn(u.pointRange)||(u.pointRange=1)}setOptions(u){let p,y=this.chart,b=y.options.plotOptions,w=y.userOptions||{},T=Su(u),M=y.styledMode,S={plotOptions:b,userOptions:T};gi(this,"setOptions",S);let O=S.plotOptions[this.type],B=w.plotOptions||{},N=B.series||{},U=Xn.plotOptions[this.type]||{},X=B[this.type]||{};this.userOptions=S.userOptions;let Z=Su(O,b.series,X,T);this.tooltipOptions=Su(Xn.tooltip,Xn.plotOptions.series?.tooltip,U?.tooltip,y.userOptions.tooltip,B.series?.tooltip,X.tooltip,T.tooltip),this.stickyTracking=Ui(T.stickyTracking,X.stickyTracking,N.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||Z.stickyTracking),O.marker===null&&delete Z.marker,this.zoneAxis=Z.zoneAxis||"y";let te=this.zones=(Z.zones||[]).map(ne=>ht({},ne));return(Z.negativeColor||Z.negativeFillColor)&&!Z.zones&&(p={value:Z[this.zoneAxis+"Threshold"]||Z.threshold||0,className:"highcharts-negative"},M||(p.color=Z.negativeColor,p.fillColor=Z.negativeFillColor),te.push(p)),te.length&&rn(te[te.length-1].value)&&te.push(M?{}:{color:this.color,fillColor:this.fillColor}),gi(this,"afterSetOptions",{options:Z}),Z}getName(){return Ui(this.options.name,"Series "+(this.index+1))}getCyclic(u,p,y){let b,w,T=this.chart,M=`${u}Index`,S=`${u}Counter`,O=y?.length||T.options.chart.colorCount;!p&&(rn(w=Ui(u==="color"?this.options.colorIndex:void 0,this[M]))?b=w:(T.series.length||(T[S]=0),b=T[S]%O,T[S]+=1),y&&(p=y[b])),b!==void 0&&(this[M]=b),this[u]=p}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||Xn.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let u=this.options.marker;this.getCyclic("symbol",u.symbol,this.chart.options.symbols)}getColumn(u,p){return(p?this.dataTable.modified:this.dataTable).getColumn(u,!0)||[]}findPointIndex(u,p){let y,b,w,T=u.id,M=u.x,S=this.points,O=this.options.dataSorting;if(T){let B=this.chart.get(T);B instanceof z&&(y=B)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let B=N=>!N.touched&&N.index===u.index;if(O&&O.matchByName?B=N=>!N.touched&&N.name===u.name:this.options.relativeXValue&&(B=N=>!N.touched&&N.options.x===u.x),!(y=Dl(S,B)))return}return y&&(w=y&&y.index)!==void 0&&(b=!0),w===void 0&&Ji(M)&&(w=this.getColumn("x").indexOf(M,p)),w!==-1&&w!==void 0&&this.cropped&&(w=w>=this.cropStart?w-this.cropStart:w),!b&&Ji(w)&&S[w]&&S[w].touched&&(w=void 0),w}updateData(u,p){let y=this.options,b=y.dataSorting,w=this.points,T=[],M=this.requireSorting,S=u.length===w.length,O,B,N,U,X=!0;if(this.xIncrement=null,u.forEach(function(te,ne){let J,ce=rn(te)&&this.pointClass.prototype.optionsToObject.call({series:this},te)||{},de=ce.x;ce.id||Ji(de)?((J=this.findPointIndex(ce,U))===-1||J===void 0?T.push(te):w[J]&&te!==y.data[J]?(w[J].update(te,!1,null,!1),w[J].touched=!0,M&&(U=J+1)):w[J]&&(w[J].touched=!0),(!S||ne!==J||b&&b.enabled||this.hasDerivedData)&&(O=!0)):T.push(te)},this),O)for(B=w.length;B--;)(N=w[B])&&!N.touched&&N.remove&&N.remove(!1,p);else!S||b&&b.enabled?X=!1:(u.forEach(function(te,ne){te===w[ne].y||w[ne].destroyed||w[ne].update(te,!1,null,!1)}),T.length=0);if(w.forEach(function(te){te&&(te.touched=!1)}),!X)return!1;T.forEach(function(te){this.addPoint(te,!1,null,null,!1)},this);let Z=this.getColumn("x");return this.xIncrement===null&&Z.length&&(this.xIncrement=pr(Z),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(u,p=!0,y,b){let w=this.points,T=w&&w.length||0,M=this.options,S=this.chart,O=M.dataSorting,B=this.xAxis,N=M.turboThreshold,U=this.dataTable,X=this.dataColumnKeys(),Z=this.pointValKey||"y",te=(this.pointArrayMap||[]).length,ne=M.keys,J,ce,de=0,Ae=1,Ue;S.options.chart.allowMutatingData||(M.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,Ue=Su(!0,u));let Le=(u=Ue||u||[]).length;if(O&&O.enabled&&(u=this.sortData(u)),S.options.chart.allowMutatingData&&b!==!1&&Le&&T&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(ce=this.updateData(u,y)),!ce){this.xIncrement=null,this.colorCounter=0;let Ie=N&&Le>N;if(Ie){let ze=this.getFirstValidPoint(u),nt=this.getFirstValidPoint(u,Le-1,-1),rt=ft=>!!(Iu(ft)&&(ne||Ji(ft[0])));if(Ji(ze)&&Ji(nt)){let ft=[],Bt=[];for(let Lt of u)ft.push(this.autoIncrement()),Bt.push(Lt);U.setColumns({x:ft,[Z]:Bt})}else if(rt(ze)&&rt(nt))if(te){let ft=ze.length===te?1:0,Bt=Array(X.length).fill(0).map(()=>[]);for(let Lt of u){ft&&Bt[0].push(this.autoIncrement());for(let Vt=ft;Vt<=te;Vt++)Bt[Vt]?.push(Lt[Vt-ft])}U.setColumns(X.reduce((Lt,Vt,Yt)=>(Lt[Vt]=Bt[Yt],Lt),{}))}else{ne&&(de=ne.indexOf("x"),Ae=ne.indexOf("y"),de=de>=0?de:0,Ae=Ae>=0?Ae:1),ze.length===1&&(Ae=0);let ft=[],Bt=[];if(de===Ae)for(let Lt of u)ft.push(this.autoIncrement()),Bt.push(Lt[Ae]);else for(let Lt of u)ft.push(Lt[de]),Bt.push(Lt[Ae]);U.setColumns({x:ft,[Z]:Bt})}else Ie=!1}if(!Ie){let ze=X.reduce((nt,rt)=>(nt[rt]=[],nt),{});for(J=0;J<Le;J++){let nt=this.pointClass.prototype.applyOptions.apply({series:this},[u[J]]);for(let rt of X)ze[rt][J]=nt[rt]}U.setColumns(ze)}for(sf(this.getColumn("y")[0])&&Lr(14,!0,S),this.data=[],this.options.data=this.userOptions.data=u,J=T;J--;)w[J]?.destroy();B&&(B.minRange=B.userMinRange),this.isDirty=S.isDirtyBox=!0,this.isDirtyData=!!w,y=!1}M.legendType==="point"&&(this.processData(),this.generatePoints()),p&&S.redraw(y)}sortData(u){let p=this,y=p.options.dataSorting.sortKey||"y",b=function(w,T){return rn(T)&&w.pointClass.prototype.optionsToObject.call({series:w},T)||{}};return u.forEach(function(w,T){u[T]=b(p,w),u[T].index=T},this),u.concat().sort((w,T)=>{let M=na(y,w),S=na(y,T);return S<M?-1:S>M?1:0}).forEach(function(w,T){w.x=T},this),p.linkedSeries&&p.linkedSeries.forEach(function(w){let T=w.options,M=T.data;T.dataSorting&&T.dataSorting.enabled||!M||(M.forEach(function(S,O){M[O]=b(w,S),u[O]&&(M[O].x=u[O].x,M[O].index=O)}),w.setData(M,!1))}),u}getProcessedData(u){let p=this,{dataTable:y,isCartesian:b,options:w,xAxis:T}=p,M=w.cropThreshold,S=u||p.getExtremesFromAll,O=T?.logarithmic,B=y.rowCount,N,U,X=0,Z,te,ne,J=p.getColumn("x"),ce=y,de=!1;return T&&(te=(Z=T.getExtremes()).min,ne=Z.max,de=!!(T.categories&&!T.names.length),b&&p.sorted&&!S&&(!M||B>M||p.forceCrop)&&(J[B-1]<te||J[0]>ne?ce=new Ge:p.getColumn(p.pointValKey||"y").length&&(J[0]<te||J[B-1]>ne)&&(ce=(N=this.cropData(y,te,ne)).modified,X=N.start,U=!0))),J=ce.getColumn("x")||[],{modified:ce,cropped:U,cropStart:X,closestPointRange:ta([O?J.map(O.log2lin):J],()=>p.requireSorting&&!de&&Lr(15,!1,p.chart))}}processData(u){let p=this.xAxis,y=this.dataTable;if(this.isCartesian&&!this.isDirty&&!p.isDirty&&!this.yAxis.isDirty&&!u)return!1;let b=this.getProcessedData();y.modified=b.modified,this.cropped=b.cropped,this.cropStart=b.cropStart,this.closestPointRange=this.basePointRange=b.closestPointRange,gi(this,"afterProcessData")}cropData(u,p,y){let b=u.getColumn("x",!0)||[],w=b.length,T={},M,S,O=0,B=w;for(M=0;M<w;M++)if(b[M]>=p){O=Math.max(0,M-1);break}for(S=M;S<w;S++)if(b[S]>y){B=S+1;break}for(let N of this.dataColumnKeys()){let U=u.getColumn(N,!0);U&&(T[N]=U.slice(O,B))}return{modified:new Ge({columns:T}),start:O,end:B}}generatePoints(){let u=this.options,p=this.processedData||u.data,y=this.dataTable.modified,b=this.getColumn("x",!0),w=this.pointClass,T=y.rowCount,M=this.cropStart||0,S=this.hasGroupedData,O=u.keys,B=[],N=u.dataGrouping&&u.dataGrouping.groupAll?M:0,U=this.xAxis?.categories,X=this.pointArrayMap||["y"],Z=this.dataColumnKeys(),te,ne,J,ce,de=this.data,Ae;if(!de&&!S){let Ue=[];Ue.length=p?.length||0,de=this.data=Ue}for(O&&S&&(this.options.keys=!1),ce=0;ce<T;ce++)ne=M+ce,S?((J=new w(this,y.getRow(ce,Z)||[])).dataGroup=this.groupMap[N+ce],J.dataGroup?.options&&(J.options=J.dataGroup.options,ea(J,J.dataGroup.options),delete J.dataLabels)):(J=de[ne],Ae=p?p[ne]:y.getRow(ce,X),J||Ae===void 0||(de[ne]=J=new w(this,Ae,b[ce]))),J&&(J.index=S?N+ce:ne,B[ce]=J,J.category=U?.[J.x]??J.x,J.key=J.name??J.category);if(this.options.keys=O,de&&(T!==(te=de.length)||S))for(ce=0;ce<te;ce++)ce!==M||S||(ce+=T),de[ce]&&(de[ce].destroyElements(),de[ce].plotX=void 0);this.data=de,this.points=B,gi(this,"afterGeneratePoints")}getXExtremes(u){return{min:Co(u),max:pr(u)}}getExtremes(u,p){let{xAxis:y,yAxis:b}=this,w=p||this.getExtremesFromAll||this.options.getExtremesFromAll,T=w&&this.cropped?this.dataTable:this.dataTable.modified,M=T.rowCount,S=u||this.stackedYData,O=S?[S]:(this.keysAffectYAxis||this.pointArrayMap||["y"])?.map(Ue=>T.getColumn(Ue,!0)||[])||[],B=this.getColumn("x",!0),N=[],U=this.requireSorting&&!this.is("column")?1:0,X=!!b&&b.positiveValuesOnly,Z=w||this.cropped||!y,te,ne,J,ce=0,de=0;for(y&&(ce=(te=y.getExtremes()).min,de=te.max),J=0;J<M;J++)if(ne=B[J],Z||(B[J+U]||ne)>=ce&&(B[J-U]||ne)<=de)for(let Ue of O){let Le=Ue[J];Ji(Le)&&(Le>0||!X)&&N.push(Le)}let Ae={activeYData:N,dataMin:Co(N),dataMax:pr(N)};return gi(this,"afterGetExtremes",{dataExtremes:Ae}),Ae}applyExtremes(){let u=this.getExtremes();return this.dataMin=u.dataMin,this.dataMax=u.dataMax,u}getFirstValidPoint(u,p=0,y=1){let b=u.length,w=p;for(;w>=0&&w<b;){if(rn(u[w]))return u[w];w+=y}}translate(){this.generatePoints();let u=this.options,p=u.stacking,y=this.xAxis,b=this.enabledDataSorting,w=this.yAxis,T=this.points,M=T.length,S=this.pointPlacementToXValue(),O=!!S,B=u.threshold,N=u.startFromThreshold?B:0,U,X,Z,te,ne=Number.MAX_VALUE;function J(ce){return Jo(ce,-1e9,1e9)}for(U=0;U<M;U++){let ce,de=T[U],Ae=de.x,Ue,Le,Ie=de.y,ze=de.low,nt=p&&w.stacking?.stacks[(this.negStacks&&Ie<(N?0:B)?"-":"")+this.stackKey];X=y.translate(Ae,!1,!1,!1,!0,S),de.plotX=Ji(X)?Ii(J(X)):void 0,p&&this.visible&&nt&&nt[Ae]&&(te=this.getStackIndicator(te,Ae,this.index),!de.isNull&&te.key&&(Le=(Ue=nt[Ae]).points[te.key]),Ue&&Iu(Le)&&(ze=Le[0],Ie=Le[1],ze===N&&te.key===nt[Ae].base&&(ze=Ui(Ji(B)?B:w.min)),w.positiveValuesOnly&&rn(ze)&&ze<=0&&(ze=void 0),de.total=de.stackTotal=Ui(Ue.total),de.percentage=rn(de.y)&&Ue.total?de.y/Ue.total*100:void 0,de.stackY=Ie,this.irregularWidths||Ue.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),de.yBottom=rn(ze)?J(w.translate(ze,!1,!0,!1,!0)):void 0,this.dataModify&&(Ie=this.dataModify.modifyValue(Ie,U)),Ji(Ie)&&de.plotX!==void 0&&(ce=Ji(ce=w.translate(Ie,!1,!0,!1,!0))?J(ce):void 0),de.plotY=ce,de.isInside=this.isPointInside(de),de.clientX=O?Ii(y.translate(Ae,!1,!1,!1,!0,S)):X,de.negative=(de.y||0)<(B||0),de.isNull||de.visible===!1||(Z!==void 0&&(ne=Math.min(ne,Math.abs(X-Z))),Z=X),de.zone=this.zones.length?de.getZone():void 0,!de.graphic&&this.group&&b&&(de.isNew=!0)}this.closestPointRangePx=ne,gi(this,"afterTranslate")}getValidPoints(u,p,y){let b=this.chart;return(u||this.points||[]).filter(function(w){let{plotX:T,plotY:M}=w;return!!((y||!w.isNull&&Ji(M))&&(!p||b.isInsidePlot(T,M,{inverted:b.inverted})))&&w.visible!==!1})}getClipBox(){let{chart:u,xAxis:p,yAxis:y}=this,{x:b,y:w,width:T,height:M}=Su(u.clipBox);return p&&p.len!==u.plotSizeX&&(T=p.len),y&&y.len!==u.plotSizeY&&(M=y.len),u.inverted&&!this.invertible&&([T,M]=[M,T]),{x:b,y:w,width:T,height:M}}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:u,group:p,markerGroup:y}=this,b=u.sharedClips,w=u.renderer,T=this.getClipBox(),M=this.getSharedClipKey(),S=b[M];S?S.animate(T):b[M]=S=w.clipRect(T),p&&p.clip(this.options.clip===!1?void 0:S),y&&y.clip()}animate(u){let{chart:p,group:y,markerGroup:b}=this,w=p.inverted,T=En(this.options.animation),M=[this.getSharedClipKey(),T.duration,T.easing,T.defer].join(","),S=p.sharedClips[M],O=p.sharedClips[M+"m"];if(u&&y){let B=this.getClipBox();if(S)S.attr("height",B.height);else{B.width=0,w&&(B.x=p.plotHeight),S=p.renderer.clipRect(B),p.sharedClips[M]=S;let N={x:-99,y:-99,width:w?p.plotWidth+199:99,height:w?99:p.plotHeight+199};O=p.renderer.clipRect(N),p.sharedClips[M+"m"]=O}y.clip(S),b?.clip(O)}else if(S&&!S.hasClass("highcharts-animating")){let B=this.getClipBox(),N=T.step;(b?.element.childNodes.length||p.series.length>1)&&(T.step=function(U,X){N&&N.apply(X,arguments),X.prop==="width"&&O?.element&&O.attr(w?"height":"width",U+99)}),S.addClass("highcharts-animating").animate(B,T)}}afterAnimate(){this.setClip(),Bp(this.chart.sharedClips,(u,p,y)=>{u&&!this.chart.container.querySelector(`[clip-path="url(#${u.id})"]`)&&(u.destroy(),delete y[p])}),this.finishedAnimating=!0,gi(this,"afterAnimate")}drawPoints(u=this.points){let p,y,b,w,T,M,S,O=this.chart,B=O.styledMode,{colorAxis:N,options:U}=this,X=U.marker,Z=this[this.specialGroup||"markerGroup"],te=this.xAxis,ne=Ui(X.enabled,!te||!!te.isRadial||null,this.closestPointRangePx>=X.enabledThreshold*X.radius);if(X.enabled!==!1||this._hasPointMarkers)for(p=0;p<u.length;p++)if(w=(b=(y=u[p]).graphic)?"animate":"attr",T=y.marker||{},M=!!y.marker,(ne&&T.enabled===void 0||T.enabled)&&!y.isNull&&y.visible!==!1){let J=Ui(T.symbol,this.symbol,"rect");S=this.markerAttribs(y,y.selected&&"select"),this.enabledDataSorting&&(y.startXPos=te.reversed?-(S.width||0):te.width);let ce=y.isInside!==!1;if(!b&&ce&&((S.width||0)>0||y.hasImage)&&(y.graphic=b=O.renderer.symbol(J,S.x,S.y,S.width,S.height,M?T:X).add(Z),this.enabledDataSorting&&O.hasRendered&&(b.attr({x:y.startXPos}),w="animate")),b&&w==="animate"&&b[ce?"show":"hide"](ce).animate(S),b){let de=this.pointAttribs(y,B||!y.selected?void 0:"select");B?N&&b.css({fill:de.fill}):b[w](de)}b&&b.addClass(y.getClassName(),!0)}else b&&(y.graphic=b.destroy())}markerAttribs(u,p){let y=this.options,b=y.marker,w=u.marker||{},T=w.symbol||b.symbol,M={},S,O,B=Ui(w.radius,b&&b.radius);p&&(S=b.states[p],B=Ui((O=w.states&&w.states[p])&&O.radius,S&&S.radius,B&&B+(S&&S.radiusPlus||0))),u.hasImage=T&&T.indexOf("url")===0,u.hasImage&&(B=0);let N=u.pos();return Ji(B)&&N&&(y.crisp&&(N[0]=fi(N[0],u.hasImage?0:T==="rect"?b?.lineWidth||0:1)),M.x=N[0]-B,M.y=N[1]-B),B&&(M.width=M.height=2*B),M}pointAttribs(u,p){let y=this.options.marker,b=u&&u.options,w=b&&b.marker||{},T=b&&b.color,M=u&&u.color,S=u&&u.zone&&u.zone.color,O,B,N=this.color,U,X,Z=Ui(w.lineWidth,y.lineWidth),te=1;return N=T||S||M||N,U=w.fillColor||y.fillColor||N,X=w.lineColor||y.lineColor||N,p=p||"normal",O=y.states[p]||{},Z=Ui((B=w.states&&w.states[p]||{}).lineWidth,O.lineWidth,Z+Ui(B.lineWidthPlus,O.lineWidthPlus,0)),U=B.fillColor||O.fillColor||U,{stroke:X=B.lineColor||O.lineColor||X,"stroke-width":Z,fill:U,opacity:te=Ui(B.opacity,O.opacity,te)}}destroy(u){let p,y,b,w=this,T=w.chart,M=/AppleWebKit\/533/.test(hi.navigator.userAgent),S=w.data||[];for(gi(w,"destroy",{keepEventsForUpdate:u}),this.removeEvents(u),(w.axisTypes||[]).forEach(function(O){(b=w[O])&&b.series&&(bi(b.series,w),b.isDirty=b.forceRedraw=!0)}),w.legendItem&&w.chart.legend.destroyItem(w),p=S.length;p--;)(y=S[p])&&y.destroy&&y.destroy();for(let O of w.zones)lr(O,void 0,!0);Zt.clearTimeout(w.animationTimeout),Bp(w,function(O,B){O instanceof ko&&!O.survive&&O[M&&B==="group"?"hide":"destroy"]()}),T.hoverSeries===w&&(T.hoverSeries=void 0),bi(T.series,w),T.orderItems("series"),Bp(w,function(O,B){u&&B==="hcEvents"||delete w[B]})}applyZones(){let{area:u,chart:p,graph:y,zones:b,points:w,xAxis:T,yAxis:M,zoneAxis:S}=this,{inverted:O,renderer:B}=p,N=this[`${S}Axis`],{isXAxis:U,len:X=0,minPointOffset:Z=0}=N||{},te=(y?.strokeWidth()||0)/2+1,ne=(J,ce=0,de=0)=>{O&&(de=X-de);let{translated:Ae=0,lineClip:Ue}=J,Le=de-Ae;Ue?.push(["L",ce,Math.abs(Le)<te?de-te*(Le<=0?-1:1):Ae])};if(b.length&&(y||u)&&N&&Ji(N.min)){let J=N.getExtremes().max+Z,ce=Ue=>{Ue.forEach((Le,Ie)=>{(Le[0]==="M"||Le[0]==="L")&&(Ue[Ie]=[Le[0],U?X-Le[1]:Le[1],U?Le[2]:X-Le[2]])})};if(b.forEach(Ue=>{Ue.lineClip=[],Ue.translated=Jo(N.toPixels(Ui(Ue.value,J),!0)||0,0,X)}),y&&!this.showLine&&y.hide(),u&&u.hide(),S==="y"&&w.length<T.len)for(let Ue of w){let{plotX:Le,plotY:Ie,zone:ze}=Ue,nt=ze&&b[b.indexOf(ze)-1];ze&&ne(ze,Le,Ie),nt&&ne(nt,Le,Ie)}let de=[],Ae=N.toPixels(N.getExtremes().min-Z,!0);b.forEach(Ue=>{let Le=Ue.lineClip||[],Ie=Math.round(Ue.translated||0);T.reversed&&Le.reverse();let{clip:ze,simpleClip:nt}=Ue,rt=0,ft=0,Bt=T.len,Lt=M.len;U?(rt=Ie,Bt=Ae):(ft=Ie,Lt=Ae);let Vt=[["M",rt,ft],["L",Bt,ft],["L",Bt,Lt],["L",rt,Lt],["Z"]],Yt=[Vt[0],...Le,Vt[1],Vt[2],...de,Vt[3],Vt[4]];de=Le.reverse(),Ae=Ie,O&&(ce(Yt),u&&ce(Vt)),ze?(ze.animate({d:Yt}),nt?.animate({d:Vt})):(ze=Ue.clip=B.path(Yt),u&&(nt=Ue.simpleClip=B.path(Vt))),y&&Ue.graph?.clip(ze),u&&Ue.area?.clip(nt)})}else this.visible&&(y&&y.show(),u&&u.show())}plotGroup(u,p,y,b,w){let T=this[u],M=!T,S={visibility:y,zIndex:b||.1};return rn(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(S.opacity=this.opacity),T||(this[u]=T=this.chart.renderer.g().add(w)),T.addClass("highcharts-"+p+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(rn(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(T.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),T.attr(S)[M?"attr":"animate"](this.getPlotBox(p)),T}getPlotBox(u){let p=this.xAxis,y=this.yAxis,b=this.chart,w=b.inverted&&!b.polar&&p&&this.invertible&&u==="series";return b.inverted&&(p=y,y=this.xAxis),{translateX:p?p.left:b.plotLeft,translateY:y?y.top:b.plotTop,rotation:w?90:0,rotationOriginX:w?(p.len-y.len)/2:0,rotationOriginY:w?(p.len+y.len)/2:0,scaleX:w?-1:1,scaleY:1}}removeEvents(u){let{eventsToUnbind:p}=this;u||Jg(this),p.length&&(p.forEach(y=>{y()}),p.length=0)}render(){let u=this,{chart:p,options:y,hasRendered:b}=u,w=En(y.animation),T=u.visible?"inherit":"hidden",M=y.zIndex,S=p.seriesGroup,O=u.finishedAnimating?0:w.duration;gi(this,"render"),u.plotGroup("group","series",T,M,S),u.markerGroup=u.plotGroup("markerGroup","markers",T,M,S),y.clip!==!1&&u.setClip(),O&&u.animate?.(!0),u.drawGraph&&(u.drawGraph(),u.applyZones()),u.visible&&u.drawPoints(),u.drawDataLabels?.(),u.redrawPoints?.(),y.enableMouseTracking&&u.drawTracker?.(),O&&u.animate?.(),b||(O&&w.defer&&(O+=w.defer),u.animationTimeout=af(()=>{u.afterAnimate()},O||0)),u.isDirty=!1,u.hasRendered=!0,gi(u,"afterRender")}redraw(){let u=this.isDirty||this.isDirtyData;this.translate(),this.render(),u&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(u,p){let{xAxis:y,yAxis:b}=this,w=this.chart.inverted;return this.searchKDTree({clientX:w?y.len-u.chartY+y.pos:u.chartX-y.pos,plotY:w?b.len-u.chartX+b.pos:u.chartY-b.pos},p,u)}buildKDTree(u){this.buildingKdTree=!0;let p=this,y=p.options.findNearestPointBy.indexOf("y")>-1?2:1;delete p.kdTree,af(function(){p.kdTree=function b(w,T,M){let S,O,B=w?.length;if(B)return S=p.kdAxisArray[T%M],w.sort((N,U)=>(N[S]||0)-(U[S]||0)),{point:w[O=Math.floor(B/2)],left:b(w.slice(0,O),T+1,M),right:b(w.slice(O+1),T+1,M)}}(p.getValidPoints(void 0,!p.directTouch),y,y),p.buildingKdTree=!1},p.options.kdNow||u?.type==="touchstart"?0:1)}searchKDTree(u,p,y,b,w){let T=this,[M,S]=this.kdAxisArray,O=p?"distX":"dist",B=(T.options.findNearestPointBy||"").indexOf("y")>-1?2:1,N=!!T.isBubble,U=b||((Z,te,ne)=>[(Z[ne]||0)<(te[ne]||0)?Z:te,!1]),X=w||((Z,te)=>Z<te);if(this.kdTree||this.buildingKdTree||this.buildKDTree(y),this.kdTree)return function Z(te,ne,J,ce){let de=ne.point,Ae=T.kdAxisArray[J%ce],Ue=de,Le=!1;(function(rt,ft){let Bt=rt[M],Lt=ft[M],Vt=rn(Bt)&&rn(Lt)?Bt-Lt:null,Yt=rt[S],zt=ft[S],Tn=rn(Yt)&&rn(zt)?Yt-zt:0,un=N&&ft.marker?.radius||0;ft.dist=Math.sqrt((Vt&&Vt*Vt||0)+Tn*Tn)-un,ft.distX=rn(Vt)?Math.abs(Vt)-un:Number.MAX_VALUE})(te,de);let Ie=(te[Ae]||0)-(de[Ae]||0)+(N&&de.marker?.radius||0),ze=Ie<0?"left":"right",nt=Ie<0?"right":"left";return ne[ze]&&([Ue,Le]=U(de,Z(te,ne[ze],J+1,ce),O)),ne[nt]&&X(Math.sqrt(Ie*Ie),Ue[O],Le)&&(Ue=U(Ue,Z(te,ne[nt],J+1,ce),O)[0]),Ue}(u,this.kdTree,B,B)}pointPlacementToXValue(){let{options:u,xAxis:p}=this,y=u.pointPlacement;return y==="between"&&(y=p.reversed?-.5:.5),Ji(y)?y*(u.pointRange||p.pointRange):0}isPointInside(u){let{chart:p,xAxis:y,yAxis:b}=this,{plotX:w=-1,plotY:T=-1}=u;return T>=0&&T<=(b?b.len:p.plotHeight)&&w>=0&&w<=(y?y.len:p.plotWidth)}drawTracker(){let u=this,p=u.options,y=p.trackByArea,b=[].concat((y?u.areaPath:u.graphPath)||[]),w=u.chart,T=w.pointer,M=w.renderer,S=w.options.tooltip?.snap||0,O=()=>{p.enableMouseTracking&&w.hoverSeries!==u&&u.onMouseOver()},B="rgba(192,192,192,"+(di?1e-4:.002)+")",N=u.tracker;N?N.attr({d:b}):u.graph&&(u.tracker=N=M.path(b).attr({visibility:u.visible?"inherit":"hidden",zIndex:2}).addClass(y?"highcharts-tracker-area":"highcharts-tracker-line").add(u.group),w.styledMode||N.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:B,fill:y?B:"none","stroke-width":u.graph.strokeWidth()+(y?0:2*S)}),[u.tracker,u.markerGroup,u.dataLabelsGroup].forEach(U=>{U&&(U.addClass("highcharts-tracker").on("mouseover",O).on("mouseout",X=>{T?.onTrackerMouseOut(X)}),p.cursor&&!w.styledMode&&U.css({cursor:p.cursor}),U.on("touchstart",O))})),gi(this,"afterDrawTracker")}addPoint(u,p,y,b,w){let T,M,S=this.options,{chart:O,data:B,dataTable:N,xAxis:U}=this,X=U&&U.hasNames&&U.names,Z=S.data,te=this.getColumn("x");p=Ui(p,!0);let ne={series:this};this.pointClass.prototype.applyOptions.apply(ne,[u]);let J=ne.x;if(M=te.length,this.requireSorting&&J<te[M-1])for(T=!0;M&&te[M-1]>J;)M--;N.setRow(ne,M,!0,{addColumns:!1}),X&&ne.name&&(X[J]=ne.name),Z?.splice(M,0,u),(T||this.processedData)&&(this.data.splice(M,0,null),this.processData()),S.legendType==="point"&&this.generatePoints(),y&&(B[0]&&B[0].remove?B[0].remove(!1):([B,Z,...Object.values(N.getColumns())].filter(rn).forEach(ce=>{ce.shift()}),N.rowCount-=1,gi(N,"afterDeleteRows"))),w!==!1&&gi(this,"addPoint",{point:ne}),this.isDirty=!0,this.isDirtyData=!0,p&&O.redraw(b)}removePoint(u,p,y){let b=this,{chart:w,data:T,points:M,dataTable:S}=b,O=T[u],B=function(){[M?.length===T.length?M:void 0,T,b.options.data,...Object.values(S.getColumns())].filter(rn).forEach(N=>{N.splice(u,1)}),S.rowCount-=1,gi(S,"afterDeleteRows"),O?.destroy(),b.isDirty=!0,b.isDirtyData=!0,p&&w.redraw()};jt(y,w),p=Ui(p,!0),O?O.firePointEvent("remove",null,B):B()}remove(u,p,y,b){let w=this,T=w.chart;function M(){w.destroy(b),T.isDirtyLegend=T.isDirtyBox=!0,T.linkSeries(b),Ui(u,!0)&&T.redraw(p)}y!==!1?gi(w,"remove",null,M):M()}update(u,p){gi(this,"update",{options:u=eo(u,this.userOptions)});let y=this,b=y.chart,w=y.userOptions,T=y.initialType||y.type,M=b.options.plotOptions,S=ar[T].prototype,O=y.finishedAnimating&&{animation:!1},B={},N,U,X=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],Z=u.type||w.type||b.options.chart.type,te=!(this.hasDerivedData||Z&&Z!==this.type||u.keys!==void 0||u.pointStart!==void 0||u.pointInterval!==void 0||u.relativeXValue!==void 0||u.joinBy||u.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(J=>y.hasOptionChanged(J)));Z=Z||T,te?(X.push("data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"),u.visible!==!1&&X.push("area","graph"),y.parallelArrays.forEach(function(J){X.push(J+"Data")}),u.data&&(u.dataSorting&&ea(y.options.dataSorting,u.dataSorting),this.setData(u.data,!1))):this.dataTable.modified=this.dataTable,u=Su(w,{index:w.index===void 0?y.index:w.index,pointStart:M?.series?.pointStart??w.pointStart??y.getColumn("x")[0]},!te&&{data:y.options.data},u,O),te&&u.data&&(u.data=y.options.data),(X=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(X)).forEach(function(J){X[J]=y[J],delete y[J]});let ne=!1;if(ar[Z]){if(ne=Z!==y.type,y.remove(!1,!1,!1,!0),ne)if(b.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(y,ar[Z].prototype);else{let J=Object.hasOwnProperty.call(y,"hcEvents")&&y.hcEvents;for(U in S)y[U]=void 0;ea(y,ar[Z].prototype),J?y.hcEvents=J:delete y.hcEvents}}else Lr(17,!0,b,{missingModuleFor:Z});if(X.forEach(function(J){y[J]=X[J]}),y.init(b,u),te&&this.points)for(let J of((N=y.options).visible===!1?(B.graphic=1,B.dataLabel=1):(this.hasMarkerChanged(N,w)&&(B.graphic=1),y.hasDataLabels?.()||(B.dataLabel=1)),this.points))J&&J.series&&(J.resolveColor(),Object.keys(B).length&&J.destroyElements(B),N.showInLegend===!1&&J.legendItem&&b.legend.destroyItem(J));y.initialType=T,b.linkSeries(),b.setSortedData(),ne&&y.linkedSeries.length&&(y.isDirtyData=!0),gi(this,"afterUpdate"),Ui(p,!0)&&b.redraw(!!te&&void 0)}setName(u){this.name=this.options.name=this.userOptions.name=u,this.chart.isDirtyLegend=!0}hasOptionChanged(u){let p=this.chart,y=this.options[u],b=p.options.plotOptions,w=this.userOptions[u],T=Ui(b?.[this.type]?.[u],b?.series?.[u]);return w&&!rn(T)?y!==w:y!==Ui(T,y)}onMouseOver(){let u=this.chart,p=u.hoverSeries;u.pointer?.setHoverChartIndex(),p&&p!==this&&p.onMouseOut(),this.options.events.mouseOver&&gi(this,"mouseOver"),this.setState("hover"),u.hoverSeries=this}onMouseOut(){let u=this.options,p=this.chart,y=p.tooltip,b=p.hoverPoint;p.hoverSeries=null,b&&b.onMouseOut(),this&&u.events.mouseOut&&gi(this,"mouseOut"),y&&!this.stickyTracking&&(!y.shared||this.noSharedTooltip)&&y.hide(),p.series.forEach(function(w){w.setState("",!0)})}setState(u,p){let y=this,b=y.options,w=y.graph,T=b.inactiveOtherPoints,M=b.states,S=Ui(M[u||"normal"]&&M[u||"normal"].animation,y.chart.options.chart.animation),O=b.lineWidth,B=b.opacity;if(u=u||"",y.state!==u&&([y.group,y.markerGroup,y.dataLabelsGroup].forEach(function(N){N&&(y.state&&N.removeClass("highcharts-series-"+y.state),u&&N.addClass("highcharts-series-"+u))}),y.state=u,!y.chart.styledMode)){if(M[u]&&M[u].enabled===!1)return;if(u&&(O=M[u].lineWidth||O+(M[u].lineWidthPlus||0),B=Ui(M[u].opacity,B)),w&&!w.dashstyle&&Ji(O))for(let N of[w,...this.zones.map(U=>U.graph)])N?.animate({"stroke-width":O},S);T||[y.group,y.markerGroup,y.dataLabelsGroup,y.labelBySeries].forEach(function(N){N&&N.animate({opacity:B},S)})}p&&T&&y.points&&y.setAllPointsToState(u||void 0)}setAllPointsToState(u){this.points.forEach(function(p){p.setState&&p.setState(u)})}setVisible(u,p){let y=this,b=y.chart,w=b.options.chart.ignoreHiddenSeries,T=y.visible;y.visible=u=y.options.visible=y.userOptions.visible=u===void 0?!T:u;let M=u?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(S=>{y[S]?.[M]()}),(b.hoverSeries===y||b.hoverPoint?.series===y)&&y.onMouseOut(),y.legendItem&&b.legend.colorizeItem(y,u),y.isDirty=!0,y.options.stacking&&b.series.forEach(S=>{S.options.stacking&&S.visible&&(S.isDirty=!0)}),y.linkedSeries.forEach(S=>{S.setVisible(u,!1)}),w&&(b.isDirtyBox=!0),gi(y,M),p!==!1&&b.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(u){this.selected=u=this.options.selected=u===void 0?!this.selected:u,this.checkbox&&(this.checkbox.checked=u),gi(this,u?"select":"unselect")}shouldShowTooltip(u,p,y={}){return y.series=this,y.visiblePlotOnly=!0,this.chart.isInsidePlot(u,p,y)}drawLegendSymbol(u,p){_t[this.options.legendSymbol||"rectangle"]?.call(this,u,p)}}Au.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:P}=this.series.chart;return typeof this.y!="number"?"":P(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},Au.types=Ht.seriesTypes,Au.registerType=Ht.registerSeriesType,ea(Au.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:z,requireSorting:!0,sorted:!0}),Ht.series=Au;let Do=Au,{animObject:Vp,setAnimation:Tl}=Rn,{registerEventOptions:lf}=ml,{composed:mv,marginNames:ey}=lt,{distribute:dw}=Ur,{format:hw}=Dt,{addEvent:jp,createElement:ty,css:cf,defined:xc,discardElement:Ml,find:ia,fireEvent:co,isNumber:Il,merge:es,pick:ws,pushUnique:fw,relativeLength:pw,stableSort:mw,syncTimeout:gv}=Zt;class Up{constructor(u,p){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=u,this.setOptions(p),p.enabled&&(this.render(),lf(this,p),jp(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),jp(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(u){let p=ws(u.padding,8);this.options=u,this.chart.styledMode||(this.itemStyle=u.itemStyle,this.itemHiddenStyle=es(this.itemStyle,u.itemHiddenStyle)),this.itemMarginTop=u.itemMarginTop,this.itemMarginBottom=u.itemMarginBottom,this.padding=p,this.initialItemY=p-5,this.symbolWidth=ws(u.symbolWidth,16),this.pages=[],this.proximate=u.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(u,p){let y=this.chart;this.setOptions(es(!0,this.options,u)),"events"in this.options&&lf(this,this.options),this.destroy(),y.isDirtyLegend=y.isDirtyBox=!0,ws(p,!0)&&y.redraw(),co(this,"afterUpdate",{redraw:p})}colorizeItem(u,p){let y=u.color,{area:b,group:w,label:T,line:M,symbol:S}=u.legendItem||{};if((u instanceof Do||u instanceof z)&&(u.color=u.options?.legendSymbolColor||y),w?.[p?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:O={}}=this,B=O.color,{fillColor:N,fillOpacity:U,lineColor:X,marker:Z}=u.options,te=ne=>(!p&&(ne.fill&&(ne.fill=B),ne.stroke&&(ne.stroke=B)),ne);T?.css(es(p?this.itemStyle:O)),M?.attr(te({stroke:X||u.color})),S&&S.attr(te(Z&&S.isMarker?u.pointAttribs():{fill:u.color})),b?.attr(te({fill:N||u.color,"fill-opacity":N?1:U??.75}))}u.color=y,co(this,"afterColorizeItem",{item:u,visible:p})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(u){let{group:p,x:y=0,y:b=0}=u.legendItem||{},w=this.options,T=w.symbolPadding,M=!w.rtl,S=u.checkbox;if(p&&p.element){let O={translateX:M?y:this.legendWidth-y-2*T-4,translateY:b};p[xc(p.translateY)?"animate":"attr"](O,void 0,()=>{co(this,"afterPositionItem",{item:u})})}S&&(S.x=y,S.y=b)}destroyItem(u){let p=u.checkbox,y=u.legendItem||{};for(let b of["group","label","line","symbol"])y[b]&&(y[b]=y[b].destroy());p&&Ml(p),u.legendItem=void 0}destroy(){for(let u of this.getAllItems())this.destroyItem(u);for(let u of["clipRect","up","down","pager","nav","box","title","group"])this[u]&&(this[u]=this[u].destroy());this.display=null}positionCheckboxes(){let u,p=this.group&&this.group.alignAttr,y=this.clipHeight||this.legendHeight,b=this.titleHeight;p&&(u=p.translateY,this.allItems.forEach(function(w){let T,M=w.checkbox;M&&(T=u+b+M.y+(this.scrollOffset||0)+3,cf(M,{left:p.translateX+w.checkboxOffset+M.x-20+"px",top:T+"px",display:this.proximate||T>u-6&&T<u+y-6?"":"none"}))},this))}renderTitle(){let u=this.options,p=this.padding,y=u.title,b,w=0;y.text&&(this.title||(this.title=this.chart.renderer.label(y.text,p-3,p-4,void 0,void 0,void 0,u.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(y.style),this.title.add(this.group)),y.width||this.title.css({width:this.maxLegendWidth+"px"}),w=(b=this.title.getBBox()).height,this.offsetWidth=b.width,this.contentGroup.attr({translateY:w})),this.titleHeight=w}setText(u){let p=this.options;u.legendItem.label.attr({text:p.labelFormat?hw(p.labelFormat,u,this.chart):p.labelFormatter.call(u)})}renderItem(u){let p=u.legendItem=u.legendItem||{},y=this.chart,b=y.renderer,w=this.options,T=w.layout==="horizontal",M=this.symbolWidth,S=w.symbolPadding||0,O=this.itemStyle,B=this.itemHiddenStyle,N=T?ws(w.itemDistance,20):0,U=!w.rtl,X=!u.series,Z=!X&&u.series.drawLegendSymbol?u.series:u,te=Z.options,ne=!!this.createCheckboxForItem&&te&&te.showCheckbox,J=w.useHTML,ce=u.options.className,de=p.label,Ae=M+S+N+(ne?20:0);!de&&(p.group=b.g("legend-item").addClass("highcharts-"+Z.type+"-series highcharts-color-"+u.colorIndex+(ce?" "+ce:"")+(X?" highcharts-series-"+u.index:"")).attr({zIndex:1}).add(this.scrollGroup),p.label=de=b.text("",U?M+S:-S,this.baseline||0,J),y.styledMode||de.css(es(u.visible?O:B)),de.attr({align:U?"left":"right",zIndex:2}).add(p.group),!this.baseline&&(this.fontMetrics=b.fontMetrics(de),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,de.attr("y",this.baseline),this.symbolHeight=ws(w.symbolHeight,this.fontMetrics.f),w.squareSymbol&&(this.symbolWidth=ws(w.symbolWidth,Math.max(this.symbolHeight,16)),Ae=this.symbolWidth+S+N+(ne?20:0),U&&de.attr("x",this.symbolWidth+S))),Z.drawLegendSymbol(this,u),this.setItemEvents&&this.setItemEvents(u,de,J)),ne&&!u.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(u),this.colorizeItem(u,u.visible),(y.styledMode||!O.width)&&de.css({width:(w.itemWidth||this.widthOption||y.spacingBox.width)-Ae+"px"}),this.setText(u);let Ue=de.getBBox(),Le=this.fontMetrics&&this.fontMetrics.h||0;u.itemWidth=u.checkboxOffset=w.itemWidth||p.labelWidth||Ue.width+Ae,this.maxItemWidth=Math.max(this.maxItemWidth,u.itemWidth),this.totalItemWidth+=u.itemWidth,this.itemHeight=u.itemHeight=Math.round(p.labelHeight||(Ue.height>1.5*Le?Ue.height:Le))}layoutItem(u){let p=this.options,y=this.padding,b=p.layout==="horizontal",w=u.itemHeight,T=this.itemMarginBottom,M=this.itemMarginTop,S=b?ws(p.itemDistance,20):0,O=this.maxLegendWidth,B=p.alignColumns&&this.totalItemWidth>O?this.maxItemWidth:u.itemWidth,N=u.legendItem||{};b&&this.itemX-y+B>O&&(this.itemX=y,this.lastLineHeight&&(this.itemY+=M+this.lastLineHeight+T),this.lastLineHeight=0),this.lastItemY=M+this.itemY+T,this.lastLineHeight=Math.max(w,this.lastLineHeight),N.x=this.itemX,N.y=this.itemY,b?this.itemX+=B:(this.itemY+=M+w+T,this.lastLineHeight=w),this.offsetWidth=this.widthOption||Math.max((b?this.itemX-y-(u.checkbox?0:S):B)+y,this.offsetWidth)}getAllItems(){let u=[];return this.chart.series.forEach(function(p){let y=p&&p.options;p&&ws(y.showInLegend,!xc(y.linkedTo)&&void 0,!0)&&(u=u.concat((p.legendItem||{}).labels||(y.legendType==="point"?p.data:p)))}),co(this,"afterGetAllItems",{allItems:u}),u}getAlignment(){let u=this.options;return this.proximate?u.align.charAt(0)+"tv":u.floating?"":u.align.charAt(0)+u.verticalAlign.charAt(0)+u.layout.charAt(0)}adjustMargins(u,p){let y=this.chart,b=this.options,w=this.getAlignment();w&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(T,M){T.test(w)&&!xc(u[M])&&(y[ey[M]]=Math.max(y[ey[M]],y.legend[(M+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][M]*b[M%2?"x":"y"]+ws(b.margin,12)+p[M]+(y.titleOffset[M]||0)))})}proximatePositions(){let u,p=this.chart,y=[],b=this.options.align==="left";for(let w of(this.allItems.forEach(function(T){let M,S,O=b,B,N;T.yAxis&&(T.xAxis.options.reversed&&(O=!O),T.points&&(M=ia(O?T.points:T.points.slice(0).reverse(),function(U){return Il(U.plotY)})),S=this.itemMarginTop+T.legendItem.label.getBBox().height+this.itemMarginBottom,N=T.yAxis.top-p.plotTop,B=T.visible?(M?M.plotY:T.yAxis.height)+(N-.3*S):N+T.yAxis.height,y.push({target:B,size:S,item:T}))},this),dw(y,p.plotHeight)))u=w.item.legendItem||{},Il(w.pos)&&(u.y=p.plotTop-p.spacing[0]+w.pos)}render(){let u=this.chart,p=u.renderer,y=this.options,b=this.padding,w=this.getAllItems(),T,M,S,O=this.group,B,N=this.box;this.itemX=b,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=pw(y.width,u.spacingBox.width-b),B=u.spacingBox.width-2*b-y.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(B/=2),this.maxLegendWidth=this.widthOption||B,O||(this.group=O=p.g("legend").addClass(y.className||"").attr({zIndex:7}).add(),this.contentGroup=p.g().attr({zIndex:1}).add(O),this.scrollGroup=p.g().add(this.contentGroup)),this.renderTitle(),mw(w,(U,X)=>(U.options&&U.options.legendIndex||0)-(X.options&&X.options.legendIndex||0)),y.reversed&&w.reverse(),this.allItems=w,this.display=T=!!w.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,w.forEach(this.renderItem,this),w.forEach(this.layoutItem,this),M=(this.widthOption||this.offsetWidth)+b,S=this.lastItemY+this.lastLineHeight+this.titleHeight,S=this.handleOverflow(S)+b,N||(this.box=N=p.rect().addClass("highcharts-legend-box").attr({r:y.borderRadius}).add(O)),u.styledMode||N.attr({stroke:y.borderColor,"stroke-width":y.borderWidth||0,fill:y.backgroundColor||"none"}).shadow(y.shadow),M>0&&S>0&&N[N.placed?"animate":"attr"](N.crisp.call({},{x:0,y:0,width:M,height:S},N.strokeWidth())),O[T?"show":"hide"](),u.styledMode&&O.getStyle("display")==="none"&&(M=S=0),this.legendWidth=M,this.legendHeight=S,T&&this.align(),this.proximate||this.positionItems(),co(this,"afterRender")}align(u=this.chart.spacingBox){let p=this.chart,y=this.options,b=u.y;/(lth|ct|rth)/.test(this.getAlignment())&&p.titleOffset[0]>0?b+=p.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&p.titleOffset[2]>0&&(b-=p.titleOffset[2]),b!==u.y&&(u=es(u,{y:b})),p.hasRendered||(this.group.placed=!1),this.group.align(es(y,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":y.verticalAlign}),!0,u)}handleOverflow(u){let p=this,y=this.chart,b=y.renderer,w=this.options,T=w.y,M=w.verticalAlign==="top",S=this.padding,O=w.maxHeight,B=w.navigation,N=ws(B.animation,!0),U=B.arrowSize||12,X=this.pages,Z=this.allItems,te=function(Ie){typeof Ie=="number"?Le.attr({height:Ie}):Le&&(p.clipRect=Le.destroy(),p.contentGroup.clip()),p.contentGroup.div&&(p.contentGroup.div.style.clip=Ie?"rect("+S+"px,9999px,"+(S+Ie)+"px,0)":"auto")},ne=function(Ie){return p[Ie]=b.circle(0,0,1.3*U).translate(U/2,U/2).add(Ue),y.styledMode||p[Ie].attr("fill","rgba(0,0,0,0.0001)"),p[Ie]},J,ce,de,Ae=y.spacingBox.height+(M?-T:T)-S,Ue=this.nav,Le=this.clipRect;return w.layout!=="horizontal"||w.verticalAlign==="middle"||w.floating||(Ae/=2),O&&(Ae=Math.min(Ae,O)),X.length=0,u&&Ae>0&&u>Ae&&B.enabled!==!1?(this.clipHeight=J=Math.max(Ae-20-this.titleHeight-S,0),this.currentPage=ws(this.currentPage,1),this.fullHeight=u,Z.forEach((Ie,ze)=>{let nt=(de=Ie.legendItem||{}).y||0,rt=Math.round(de.label.getBBox().height),ft=X.length;(!ft||nt-X[ft-1]>J&&(ce||nt)!==X[ft-1])&&(X.push(ce||nt),ft++),de.pageIx=ft-1,ce&&((Z[ze-1].legendItem||{}).pageIx=ft-1),ze===Z.length-1&&nt+rt-X[ft-1]>J&&nt>X[ft-1]&&(X.push(nt),de.pageIx=ft),nt!==ce&&(ce=nt)}),Le||(Le=p.clipRect=b.clipRect(0,S-2,9999,0),p.contentGroup.clip(Le)),te(J),Ue||(this.nav=Ue=b.g().attr({zIndex:1}).add(this.group),this.up=b.symbol("triangle",0,0,U,U).add(Ue),ne("upTracker").on("click",function(){p.scroll(-1,N)}),this.pager=b.text("",15,10).addClass("highcharts-legend-navigation"),!y.styledMode&&B.style&&this.pager.css(B.style),this.pager.add(Ue),this.down=b.symbol("triangle-down",0,0,U,U).add(Ue),ne("downTracker").on("click",function(){p.scroll(1,N)})),p.scroll(0),u=Ae):Ue&&(te(),this.nav=Ue.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),u}scroll(u,p){let y=this.chart,b=this.pages,w=b.length,T=this.clipHeight,M=this.options.navigation,S=this.pager,O=this.padding,B=this.currentPage+u;B>w&&(B=w),B>0&&(p!==void 0&&Tl(p,y),this.nav.attr({translateX:O,translateY:T+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(N){N.attr({class:B===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),S.attr({text:B+"/"+w}),[this.down,this.downTracker].forEach(function(N){N.attr({x:18+this.pager.getBBox().width,class:B===w?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),y.styledMode||(this.up.attr({fill:B===1?M.inactiveColor:M.activeColor}),this.upTracker.css({cursor:B===1?"default":"pointer"}),this.down.attr({fill:B===w?M.inactiveColor:M.activeColor}),this.downTracker.css({cursor:B===w?"default":"pointer"})),this.scrollOffset=-b[B-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=B,this.positionCheckboxes(),gv(()=>{co(this,"afterScroll",{currentPage:B})},Vp(ws(p,y.renderer.globalAnimation,!0)).duration))}setItemEvents(u,p,y){let b=this,w=u.legendItem||{},T=b.chart.renderer.boxWrapper,M=u instanceof z,S=u instanceof Do,O="highcharts-legend-"+(M?"point":"series")+"-active",B=b.chart.styledMode,N=y?[p,w.symbol]:[w.group],U=X=>{b.allItems.forEach(Z=>{u!==Z&&[Z].concat(Z.linkedSeries||[]).forEach(te=>{te.setState(X,!M)})})};for(let X of N)X&&X.on("mouseover",function(){u.visible&&U("inactive"),u.setState("hover"),u.visible&&T.addClass(O),B||p.css(b.options.itemHoverStyle)}).on("mouseout",function(){b.chart.styledMode||p.css(es(u.visible?b.itemStyle:b.itemHiddenStyle)),U(""),T.removeClass(O),u.setState()}).on("click",function(Z){let te=function(){u.setVisible&&u.setVisible(),U(u.visible?"inactive":"")};T.removeClass(O),co(b,"itemClick",{browserEvent:Z,legendItem:u},te),M?u.firePointEvent("legendItemClick",{browserEvent:Z}):S&&co(u,"legendItemClick",{browserEvent:Z})})}createCheckboxForItem(u){u.checkbox=ty("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:u.selected,defaultChecked:u.selected},this.options.itemCheckboxStyle,this.chart.container),jp(u.checkbox,"click",function(p){let y=p.target;co(u.series||u,"checkboxClick",{checked:y.checked,item:u},function(){u.select()})})}}(function(P){P.compose=function(u){fw(mv,"Core.Legend")&&jp(u,"beforeMargins",function(){this.legend=new P(this,this.options.legend)})}})(Up||(Up={}));let Es=Up,{animate:ny,animObject:gw,setAnimation:$i}=Rn,{defaultOptions:Gt}=Mr,{numberFormat:wc}=Dt,{registerEventOptions:uf}=ml,{charts:Ar,doc:Hd,marginNames:iy,svg:ra,win:$p}=lt,{seriesTypes:Sl}=Ht,{addEvent:ku,attr:Ec,createElement:df,css:Oo,defined:Al,diffObjects:ry,discardElement:yw,erase:oy,error:Hp,extend:Cs,find:Cc,fireEvent:On,getAlignFactor:sy,getStyle:Gp,isArray:hf,isNumber:Ra,isObject:ts,isString:Dc,merge:er,objectEach:Lo,pick:Fr,pInt:tr,relativeLength:ay,removeEvent:Gd,splat:Fo,syncTimeout:_w,uniqueKey:vw}=Zt;class kl{static chart(u,p,y){return new kl(u,p,y)}constructor(u,p,y){this.sharedClips={};let b=[...arguments];(Dc(u)||u.nodeName)&&(this.renderTo=b.shift()),this.init(b[0],b[1])}setZoomOptions(){let u=this.options.chart,p=u.zooming;this.zooming=vn(ht({},p),{type:Fr(u.zoomType,p.type),key:Fr(u.zoomKey,p.key),pinchType:Fr(u.pinchType,p.pinchType),singleTouch:Fr(u.zoomBySingleTouch,p.singleTouch,!1),resetButton:er(p.resetButton,u.resetZoomButton)})}init(u,p){On(this,"init",{args:arguments},function(){let y=er(Gt,u),b=y.chart,w=this.renderTo||b.renderTo;this.userOptions=Cs({},u),(this.renderTo=Dc(w)?Hd.getElementById(w):w)||Hp(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=p,this.isResizing=0,this.options=y,this.axes=[],this.series=[],this.locale=y.lang.locale??this.renderTo.closest("[lang]")?.lang,this.time=new Hs(Cs(y.time||{},{locale:this.locale})),y.time=this.time.options,this.numberFormatter=(b.numberFormatter||wc).bind(this),this.styledMode=b.styledMode,this.hasCartesianSeries=b.showAxes,this.index=Ar.length,Ar.push(this),lt.chartCount++,uf(this,b),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),On(this,"afterInit"),this.firstRender()})}initSeries(u){let p=this.options.chart,y=u.type||p.type,b=Sl[y];b||Hp(17,!0,this,{missingModuleFor:y});let w=new b;return typeof w.init=="function"&&w.init(this,u),w}setSortedData(){this.getSeriesOrderByLinks().forEach(function(u){u.points||u.data||!u.enabledDataSorting||u.setData(u.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(u,p){return u.linkedSeries.length||p.linkedSeries.length?p.linkedSeries.length-u.linkedSeries.length:0})}orderItems(u,p=0){let y=this[u],b=this.options[u]=Fo(this.options[u]).slice(),w=this.userOptions[u]=this.userOptions[u]?Fo(this.userOptions[u]).slice():[];if(this.hasRendered&&(b.splice(p),w.splice(p)),y)for(let T=p,M=y.length;T<M;++T){let S=y[T];S&&(S.index=T,S instanceof Do&&(S.name=S.getName()),S.options.isInternal||(b[T]=S.options,w[T]=S.userOptions))}}isInsidePlot(u,p,y={}){let{inverted:b,plotBox:w,plotLeft:T,plotTop:M,scrollablePlotBox:S}=this,{scrollLeft:O=0,scrollTop:B=0}=y.visiblePlotOnly&&this.scrollablePlotArea?.scrollingContainer||{},N=y.series,U=y.visiblePlotOnly&&S||w,X=y.inverted?p:u,Z=y.inverted?u:p,te={x:X,y:Z,isInsidePlot:!0,options:y};if(!y.ignoreX){let ne=N&&(b&&!this.polar?N.yAxis:N.xAxis)||{pos:T,len:1/0},J=y.paneCoordinates?ne.pos+X:T+X;J>=Math.max(O+T,ne.pos)&&J<=Math.min(O+T+U.width,ne.pos+ne.len)||(te.isInsidePlot=!1)}if(!y.ignoreY&&te.isInsidePlot){let ne=!b&&y.axis&&!y.axis.isXAxis&&y.axis||N&&(b?N.xAxis:N.yAxis)||{pos:M,len:1/0},J=y.paneCoordinates?ne.pos+Z:M+Z;J>=Math.max(B+M,ne.pos)&&J<=Math.min(B+M+U.height,ne.pos+ne.len)||(te.isInsidePlot=!1)}return On(this,"afterIsInsidePlot",te),te.isInsidePlot}redraw(u){On(this,"beforeRedraw");let p=this.hasCartesianSeries?this.axes:this.colorAxis||[],y=this.series,b=this.pointer,w=this.legend,T=this.userOptions.legend,M=this.renderer,S=M.isHidden(),O=[],B,N,U,X=this.isDirtyBox,Z=this.isDirtyLegend,te;for(M.rootFontSize=M.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),$i(!!this.hasRendered&&u,this),S&&this.temporaryDisplay(),this.layOutTitles(!1),U=y.length;U--;)if(((te=y[U]).options.stacking||te.options.centerInCategory)&&(N=!0,te.isDirty)){B=!0;break}if(B)for(U=y.length;U--;)(te=y[U]).options.stacking&&(te.isDirty=!0);y.forEach(function(ne){ne.isDirty&&(ne.options.legendType==="point"?(typeof ne.updateTotals=="function"&&ne.updateTotals(),Z=!0):T&&(T.labelFormatter||T.labelFormat)&&(Z=!0)),ne.isDirtyData&&On(ne,"updatedData")}),Z&&w&&w.options.enabled&&(w.render(),this.isDirtyLegend=!1),N&&this.getStacks(),p.forEach(function(ne){ne.updateNames(),ne.setScale()}),this.getMargins(),p.forEach(function(ne){ne.isDirty&&(X=!0)}),p.forEach(function(ne){let J=ne.min+","+ne.max;ne.extKey!==J&&(ne.extKey=J,O.push(function(){On(ne,"afterSetExtremes",Cs(ne.eventArgs,ne.getExtremes())),delete ne.eventArgs})),(X||N)&&ne.redraw()}),X&&this.drawChartBox(),On(this,"predraw"),y.forEach(function(ne){(X||ne.isDirty)&&ne.visible&&ne.redraw(),ne.isDirtyData=!1}),b&&b.reset(!0),M.draw(),On(this,"redraw"),On(this,"render"),S&&this.temporaryDisplay(!0),O.forEach(function(ne){ne.call()})}get(u){let p=this.series;function y(w){return w.id===u||w.options&&w.options.id===u}let b=Cc(this.axes,y)||Cc(this.series,y);for(let w=0;!b&&w<p.length;w++)b=Cc(p[w].points||[],y);return b}createAxes(){let u=this.userOptions;for(let p of(On(this,"createAxes"),["xAxis","yAxis"]))for(let y of u[p]=Fo(u[p]||{}))new fr(this,y,p);On(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((u,p)=>(p.getPointsCollection().forEach(y=>{Fr(y.selectedStaging,y.selected)&&u.push(y)}),u),[])}getSelectedSeries(){return this.series.filter(u=>u.selected)}setTitle(u,p,y){this.applyDescription("title",u),this.applyDescription("subtitle",p),this.applyDescription("caption",void 0),this.layOutTitles(y)}applyDescription(u,p){let y=this,b=this.options[u]=er(this.options[u],p),w=this[u];w&&p&&(this[u]=w=w.destroy()),b&&!w&&((w=this.renderer.text(b.text,0,0,b.useHTML).attr({align:b.align,class:"highcharts-"+u,zIndex:b.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(T,M){y.applyDescription(u,T),y.layOutTitles(M)},this.styledMode||w.css(Cs(u==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},b.style)),w.textPxLength=w.getBBox().width,w.css({whiteSpace:b.style?.whiteSpace}),this[u]=w)}layOutTitles(u=!0){let p=[0,0,0],{options:y,renderer:b,spacingBox:w}=this;["title","subtitle","caption"].forEach(M=>{let S=this[M],O=this.options[M],B=er(w),N=S?.textPxLength||0;if(S&&O){On(this,"layOutTitle",{alignTo:B,key:M,textPxLength:N});let U=b.fontMetrics(S),X=U.b,Z=U.h,te=O.verticalAlign||"top",ne=te==="top",J=ne&&O.minScale||1,ce=M==="title"?ne?-3:0:ne?p[0]+2:0,de=Math.min(B.width/N,1),Ae=Math.max(J,de),Ue=er({y:te==="bottom"?X:ce+X},{align:M==="title"?de<J?"left":"center":this.title?.alignValue},O),Le=O.width||(de>J?this.chartWidth:B.width)/Ae;S.alignValue!==Ue.align&&(S.placed=!1);let Ie=Math.round(S.css({width:`${Le}px`}).getBBox(O.useHTML).height);if(Ue.height=Ie,S.align(Ue,!1,B).attr({align:Ue.align,scaleX:Ae,scaleY:Ae,"transform-origin":`${B.x+N*Ae*sy(Ue.align)} ${Z}`}),!O.floating){let ze=Ie*(Ie<1.2*Z?1:Ae);te==="top"?p[0]=Math.ceil(p[0]+ze):te==="bottom"&&(p[2]=Math.ceil(p[2]+ze))}}},this),p[0]&&(y.title?.verticalAlign||"top")==="top"&&(p[0]+=y.title?.margin||0),p[2]&&y.caption?.verticalAlign==="bottom"&&(p[2]+=y.caption?.margin||0);let T=!this.titleOffset||this.titleOffset.join(",")!==p.join(",");this.titleOffset=p,On(this,"afterLayOutTitles"),!this.isDirtyBox&&T&&(this.isDirtyBox=this.isDirtyLegend=T,this.hasRendered&&u&&this.isDirtyBox&&this.redraw())}getContainerBox(){let u=[].map.call(this.renderTo.children,y=>{if(y!==this.container){let b=y.style.display;return y.style.display="none",[y,b]}}),p={width:Gp(this.renderTo,"width",!0)||0,height:Gp(this.renderTo,"height",!0)||0};return u.filter(Boolean).forEach(([y,b])=>{y.style.display=b}),p}getChartSize(){let u=this.options.chart,p=u.width,y=u.height,b=this.getContainerBox(),w=b.height<=1||!this.renderTo.parentElement?.style.height&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,p||b.width||600),this.chartHeight=Math.max(0,ay(y,this.chartWidth)||(w?400:b.height)),this.containerBox=b}temporaryDisplay(u){let p=this.renderTo,y;if(u)for(;p&&p.style;)p.hcOrigStyle&&(Oo(p,p.hcOrigStyle),delete p.hcOrigStyle),p.hcOrigDetached&&(Hd.body.removeChild(p),p.hcOrigDetached=!1),p=p.parentNode;else for(;p&&p.style&&(Hd.body.contains(p)||p.parentNode||(p.hcOrigDetached=!0,Hd.body.appendChild(p)),(Gp(p,"display",!1)==="none"||p.hcOricDetached)&&(p.hcOrigStyle={display:p.style.display,height:p.style.height,overflow:p.style.overflow},y={display:"block",overflow:"hidden"},p!==this.renderTo&&(y.height=0),Oo(p,y),p.offsetWidth||p.style.setProperty("display","block","important")),(p=p.parentNode)!==Hd.body););}setClassName(u){this.container.className="highcharts-container "+(u||"")}getContainer(){let u,p=this.options,y=p.chart,b="data-highcharts-chart",w=vw(),T=this.renderTo,M=tr(Ec(T,b));Ra(M)&&Ar[M]&&Ar[M].hasRendered&&Ar[M].destroy(),Ec(T,b,this.index),T.innerHTML=vi.emptyHTML,y.skipClone||T.offsetWidth||this.temporaryDisplay(),this.getChartSize();let S=this.chartHeight,O=this.chartWidth;Oo(T,{overflow:"hidden"}),this.styledMode||(u=Cs({position:"relative",overflow:"hidden",width:O+"px",height:S+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},y.style||{}));let B=df("div",{id:w},u,T);this.container=B,this.getChartSize(),O===this.chartWidth||(O=this.chartWidth,this.styledMode||Oo(B,{width:Fr(y.style?.width,O+"px")})),this.containerBox=this.getContainerBox(),this._cursor=B.style.cursor;let N=y.renderer||!ra?xn.getRendererType(y.renderer):cc;if(this.renderer=new N(B,O,S,void 0,y.forExport,p.exporting&&p.exporting.allowHTML,this.styledMode),$i(void 0,this),this.setClassName(y.className),this.styledMode)for(let U in p.defs)this.renderer.definition(p.defs[U]);else this.renderer.setStyle(y.style);this.renderer.chartIndex=this.index,On(this,"afterGetContainer")}getMargins(u){let{spacing:p,margin:y,titleOffset:b}=this;this.resetMargins(),b[0]&&!Al(y[0])&&(this.plotTop=Math.max(this.plotTop,b[0]+p[0])),b[2]&&!Al(y[2])&&(this.marginBottom=Math.max(this.marginBottom,b[2]+p[2])),this.legend&&this.legend.display&&this.legend.adjustMargins(y,p),On(this,"getMargins"),u||this.getAxisMargins()}getAxisMargins(){let u=this,p=u.axisOffset=[0,0,0,0],y=u.colorAxis,b=u.margin,w=function(T){T.forEach(function(M){M.visible&&M.getOffset()})};u.hasCartesianSeries?w(u.axes):y&&y.length&&w(y),iy.forEach(function(T,M){Al(b[M])||(u[T]+=p[M])}),u.setChartSize()}getOptions(){return ry(this.userOptions,Gt)}reflow(u){let p=this,y=p.containerBox,b=p.getContainerBox();delete p.pointer?.chartPosition,!p.isPrinting&&!p.isResizing&&y&&b.width&&((b.width!==y.width||b.height!==y.height)&&(Zt.clearTimeout(p.reflowTimeout),p.reflowTimeout=_w(function(){p.container&&p.setSize(void 0,void 0,!1)},u?100:0)),p.containerBox=b)}setReflow(){let u=this,p=y=>{u.options?.chart.reflow&&u.hasLoaded&&u.reflow(y)};if(typeof ResizeObserver=="function")new ResizeObserver(p).observe(u.renderTo);else{let y=ku($p,"resize",p);ku(this,"destroy",y)}}setSize(u,p,y){let b=this,w=b.renderer;b.isResizing+=1,$i(y,b);let T=w.globalAnimation;b.oldChartHeight=b.chartHeight,b.oldChartWidth=b.chartWidth,u!==void 0&&(b.options.chart.width=u),p!==void 0&&(b.options.chart.height=p),b.getChartSize();let{chartWidth:M,chartHeight:S,scrollablePixelsX:O=0,scrollablePixelsY:B=0}=b;(b.isDirtyBox||M!==b.oldChartWidth||S!==b.oldChartHeight)&&(b.styledMode||(T?ny:Oo)(b.container,{width:`${M+O}px`,height:`${S+B}px`},T),b.setChartSize(!0),w.setSize(M,S,T),b.axes.forEach(function(N){N.isDirty=!0,N.setScale()}),b.isDirtyLegend=!0,b.isDirtyBox=!0,b.layOutTitles(),b.getMargins(),b.redraw(T),b.oldChartHeight=void 0,On(b,"resize"),setTimeout(()=>{b&&On(b,"endResize")},gw(T).duration)),b.isResizing-=1}setChartSize(u){let p,y,b,w,{chartHeight:T,chartWidth:M,inverted:S,spacing:O,renderer:B}=this,N=this.clipOffset,U=Math[S?"floor":"round"];this.plotLeft=p=Math.round(this.plotLeft),this.plotTop=y=Math.round(this.plotTop),this.plotWidth=b=Math.max(0,Math.round(M-p-this.marginRight)),this.plotHeight=w=Math.max(0,Math.round(T-y-this.marginBottom)),this.plotSizeX=S?w:b,this.plotSizeY=S?b:w,this.spacingBox=B.spacingBox={x:O[3],y:O[0],width:M-O[3]-O[1],height:T-O[0]-O[2]},this.plotBox=B.plotBox={x:p,y,width:b,height:w},N&&(this.clipBox={x:U(N[3]),y:U(N[0]),width:U(this.plotSizeX-N[1]-N[3]),height:U(this.plotSizeY-N[0]-N[2])}),u||(this.axes.forEach(function(X){X.setAxisSize(),X.setAxisTranslation()}),B.alignElements()),On(this,"afterSetChartSize",{skipAxes:u})}resetMargins(){On(this,"resetMargins");let u=this,p=u.options.chart,y=p.plotBorderWidth||0,b=y/2;["margin","spacing"].forEach(function(w){let T=p[w],M=ts(T)?T:[T,T,T,T];["Top","Right","Bottom","Left"].forEach(function(S,O){u[w][O]=Fr(p[w+S],M[O])})}),iy.forEach(function(w,T){u[w]=Fr(u.margin[T],u.spacing[T])}),u.axisOffset=[0,0,0,0],u.clipOffset=[b,b,b,b],u.plotBorderWidth=y}drawChartBox(){let u=this.options.chart,p=this.renderer,y=this.chartWidth,b=this.chartHeight,w=this.styledMode,T=this.plotBGImage,M=u.backgroundColor,S=u.plotBackgroundColor,O=u.plotBackgroundImage,B=this.plotLeft,N=this.plotTop,U=this.plotWidth,X=this.plotHeight,Z=this.plotBox,te=this.clipRect,ne=this.clipBox,J=this.chartBackground,ce=this.plotBackground,de=this.plotBorder,Ae,Ue,Le,Ie="animate";J||(this.chartBackground=J=p.rect().addClass("highcharts-background").add(),Ie="attr"),w?Ae=Ue=J.strokeWidth():(Ue=(Ae=u.borderWidth||0)+(u.shadow?8:0),Le={fill:M||"none"},(Ae||J["stroke-width"])&&(Le.stroke=u.borderColor,Le["stroke-width"]=Ae),J.attr(Le).shadow(u.shadow)),J[Ie]({x:Ue/2,y:Ue/2,width:y-Ue-Ae%2,height:b-Ue-Ae%2,r:u.borderRadius}),Ie="animate",ce||(Ie="attr",this.plotBackground=ce=p.rect().addClass("highcharts-plot-background").add()),ce[Ie](Z),!w&&(ce.attr({fill:S||"none"}).shadow(u.plotShadow),O&&(T?(O!==T.attr("href")&&T.attr("href",O),T.animate(Z)):this.plotBGImage=p.image(O,B,N,U,X).add())),te?te.animate({width:ne.width,height:ne.height}):this.clipRect=p.clipRect(ne),Ie="animate",de||(Ie="attr",this.plotBorder=de=p.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),w||de.attr({stroke:u.plotBorderColor,"stroke-width":u.plotBorderWidth||0,fill:"none"}),de[Ie](de.crisp({x:B,y:N,width:U,height:X},-de.strokeWidth())),this.isDirtyBox=!1,On(this,"afterDrawChartBox")}propFromSeries(){let u,p,y,b=this,w=b.options.chart,T=b.options.series;["inverted","angular","polar"].forEach(function(M){for(p=Sl[w.type],y=w[M]||p&&p.prototype[M],u=T&&T.length;!y&&u--;)(p=Sl[T[u].type])&&p.prototype[M]&&(y=!0);b[M]=y})}linkSeries(u){let p=this,y=p.series;y.forEach(function(b){b.linkedSeries.length=0}),y.forEach(function(b){let{linkedTo:w}=b.options;if(Dc(w)){let T;(T=w===":previous"?p.series[b.index-1]:p.get(w))&&T.linkedParent!==b&&(T.linkedSeries.push(b),b.linkedParent=T,T.enabledDataSorting&&b.setDataSortingOptions(),b.visible=Fr(b.options.visible,T.options.visible,b.visible))}}),On(this,"afterLinkSeries",{isUpdating:u})}renderSeries(){this.series.forEach(function(u){u.translate(),u.render()})}render(){let u=this.axes,p=this.colorAxis,y=this.renderer,b=this.options.chart.axisLayoutRuns||2,w=B=>{B.forEach(N=>{N.visible&&N.render()})},T=0,M=!0,S,O=0;for(let B of(this.setTitle(),On(this,"beforeMargins"),this.getStacks?.(),this.getMargins(!0),this.setChartSize(),u)){let{options:N}=B,{labels:U}=N;if(this.hasCartesianSeries&&B.horiz&&B.visible&&U.enabled&&B.series.length&&B.coll!=="colorAxis"&&!this.polar){T=N.tickLength,B.createGroups();let X=new ao(B,0,"",!0),Z=X.createLabel("x",U);if(X.destroy(),Z&&Fr(U.reserveSpace,!Ra(N.crossing))&&(T=Z.getBBox().height+U.distance+Math.max(N.offset||0,0)),T){Z?.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-T,0);(M||S||b>1)&&O<b;){let B=this.plotWidth,N=this.plotHeight;for(let U of u)O===0?U.setScale():(U.horiz&&M||!U.horiz&&S)&&U.setTickInterval(!0);O===0?this.getAxisMargins():this.getMargins(),M=B/this.plotWidth>(O?1:1.1),S=N/this.plotHeight>(O?1:1.05),O++}this.drawChartBox(),this.hasCartesianSeries?w(u):p&&p.length&&w(p),this.seriesGroup||(this.seriesGroup=y.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(u){let p=this,y=er(!0,this.options.credits,u);y.enabled&&!this.credits&&(this.credits=this.renderer.text(y.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){y.href&&($p.location.href=y.href)}).attr({align:y.position.align,zIndex:8}),p.styledMode||this.credits.css(y.style),this.credits.add().align(y.position),this.credits.update=function(b){p.credits=p.credits.destroy(),p.addCredits(b)})}destroy(){let u,p=this,y=p.axes,b=p.series,w=p.container,T=w&&w.parentNode;for(On(p,"destroy"),p.renderer.forExport?oy(Ar,p):Ar[p.index]=void 0,lt.chartCount--,p.renderTo.removeAttribute("data-highcharts-chart"),Gd(p),u=y.length;u--;)y[u]=y[u].destroy();for(this.scroller&&this.scroller.destroy&&this.scroller.destroy(),u=b.length;u--;)b[u]=b[u].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(function(M){let S=p[M];S&&S.destroy&&(p[M]=S.destroy())}),w&&(w.innerHTML=vi.emptyHTML,Gd(w),T&&yw(w)),Lo(p,function(M,S){delete p[S]})}firstRender(){let u=this,p=u.options;u.getContainer(),u.resetMargins(),u.setChartSize(),u.propFromSeries(),u.createAxes();let y=hf(p.series)?p.series:[];p.series=[],y.forEach(function(b){u.initSeries(b)}),u.linkSeries(),u.setSortedData(),On(u,"beforeRender"),u.render(),u.pointer?.getChartPosition(),u.renderer.imgCount||u.hasLoaded||u.onload(),u.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(u){u&&this.index!==void 0&&u.apply(this,[this])},this),On(this,"load"),On(this,"render"),Al(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:u,title:p}=this;!u||this.accessibility||(this.renderer.boxWrapper.attr({role:"img","aria-label":(p&&p.element.textContent||"").replace(/</g,"&lt;")}),u.accessibility&&u.accessibility.enabled===!1||Hp('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(u,p,y){let b,w=this;return u&&(p=Fr(p,!0),On(w,"addSeries",{options:u},function(){b=w.initSeries(u),w.isDirtyLegend=!0,w.linkSeries(),b.enabledDataSorting&&b.setData(u.data,!1),On(w,"afterAddSeries",{series:b}),p&&w.redraw(y)})),b}addAxis(u,p,y,b){return this.createAxis(p?"xAxis":"yAxis",{axis:u,redraw:y,animation:b})}addColorAxis(u,p,y){return this.createAxis("colorAxis",{axis:u,redraw:p,animation:y})}createAxis(u,p){let y=new fr(this,p.axis,u);return Fr(p.redraw,!0)&&this.redraw(p.animation),y}showLoading(u){let p=this,y=p.options,b=y.loading,w=function(){T&&Oo(T,{left:p.plotLeft+"px",top:p.plotTop+"px",width:p.plotWidth+"px",height:p.plotHeight+"px"})},T=p.loadingDiv,M=p.loadingSpan;T||(p.loadingDiv=T=df("div",{className:"highcharts-loading highcharts-loading-hidden"},null,p.container)),M||(p.loadingSpan=M=df("span",{className:"highcharts-loading-inner"},null,T),ku(p,"redraw",w)),T.className="highcharts-loading",vi.setElementHTML(M,Fr(u,y.lang.loading,"")),p.styledMode||(Oo(T,Cs(b.style,{zIndex:10})),Oo(M,b.labelStyle),p.loadingShown||(Oo(T,{opacity:0,display:""}),ny(T,{opacity:b.style.opacity||.5},{duration:b.showDuration||0}))),p.loadingShown=!0,w()}hideLoading(){let u=this.options,p=this.loadingDiv;p&&(p.className="highcharts-loading highcharts-loading-hidden",this.styledMode||ny(p,{opacity:0},{duration:u.loading.hideDuration||100,complete:function(){Oo(p,{display:"none"})}})),this.loadingShown=!1}update(u,p,y,b){let w,T,M,S=this,O={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},B=u.isResponsiveOptions,N=[];On(S,"update",{options:u}),B||S.setResponsive(!1,!0),u=ry(u,S.options),S.userOptions=er(S.userOptions,u);let U=u.chart;U&&(er(!0,S.options.chart,U),this.setZoomOptions(),"className"in U&&S.setClassName(U.className),("inverted"in U||"polar"in U||"type"in U)&&(S.propFromSeries(),w=!0),"alignTicks"in U&&(w=!0),"events"in U&&uf(this,U),Lo(U,function(te,ne){S.propsRequireUpdateSeries.indexOf("chart."+ne)!==-1&&(T=!0),S.propsRequireDirtyBox.indexOf(ne)!==-1&&(S.isDirtyBox=!0),S.propsRequireReflow.indexOf(ne)===-1||(S.isDirtyBox=!0,B||(M=!0))}),!S.styledMode&&U.style&&S.renderer.setStyle(S.options.chart.style||{})),!S.styledMode&&u.colors&&(this.options.colors=u.colors),Lo(u,function(te,ne){S[ne]&&typeof S[ne].update=="function"?S[ne].update(te,!1):typeof S[O[ne]]=="function"?S[O[ne]](te):ne!=="colors"&&S.collectionsWithUpdate.indexOf(ne)===-1&&er(!0,S.options[ne],u[ne]),ne!=="chart"&&S.propsRequireUpdateSeries.indexOf(ne)!==-1&&(T=!0)}),this.collectionsWithUpdate.forEach(function(te){u[te]&&(Fo(u[te]).forEach(function(ne,J){let ce,de=Al(ne.id);de&&(ce=S.get(ne.id)),!ce&&S[te]&&(ce=S[te][Fr(ne.index,J)])&&(de&&Al(ce.options.id)||ce.options.isInternal)&&(ce=void 0),ce&&ce.coll===te&&(ce.update(ne,!1),y&&(ce.touched=!0)),!ce&&y&&S.collectionsWithInit[te]&&(S.collectionsWithInit[te][0].apply(S,[ne].concat(S.collectionsWithInit[te][1]||[]).concat([!1])).touched=!0)}),y&&S[te].forEach(function(ne){ne.touched||ne.options.isInternal?delete ne.touched:N.push(ne)}))}),N.forEach(function(te){te.chart&&te.remove&&te.remove(!1)}),w&&S.axes.forEach(function(te){te.update({},!1)}),T&&S.getSeriesOrderByLinks().forEach(function(te){te.chart&&te.update({},!1)},this);let X=U&&U.width,Z=U&&(Dc(U.height)?ay(U.height,X||S.chartWidth):U.height);M||Ra(X)&&X!==S.chartWidth||Ra(Z)&&Z!==S.chartHeight?S.setSize(X,Z,b):Fr(p,!0)&&S.redraw(b),On(S,"afterUpdate",{options:u,redraw:p,animation:b})}setSubtitle(u,p){this.applyDescription("subtitle",u),this.layOutTitles(p)}setCaption(u,p){this.applyDescription("caption",u),this.layOutTitles(p)}showResetZoom(){let u=this,p=Gt.lang,y=u.zooming.resetButton,b=y.theme,w=y.relativeTo==="chart"||y.relativeTo==="spacingBox"?null:"plotBox";function T(){u.zoomOut()}On(this,"beforeShowResetZoom",null,function(){u.resetZoomButton=u.renderer.button(p.resetZoom,null,null,T,b).attr({align:y.position.align,title:p.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(y.position,!1,w)}),On(this,"afterShowResetZoom")}zoomOut(){On(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(u,p){let y=this,b=typeof p=="object"?p:{enabled:p,type:"x"},w=b.type,T=w&&y[{x:"xAxis",xy:"axes",y:"yAxis"}[w]].filter(S=>S.options.panningEnabled&&!S.options.isInternal),M=y.options.chart;M?.panning&&(M.panning=b),On(this,"pan",{originalEvent:u},()=>{y.transform({axes:T,event:u,to:{x:u.chartX-(y.mouseDownX||0),y:u.chartY-(y.mouseDownY||0)},trigger:"pan"}),Oo(y.container,{cursor:"move"})})}transform(u){let{axes:p=this.axes,event:y,from:b={},reset:w,selection:T,to:M={},trigger:S}=u,{inverted:O,time:B}=this,N=!1,U,X;for(let Z of(this.hoverPoints?.forEach(te=>te.setState()),p)){let{horiz:te,len:ne,minPointOffset:J=0,options:ce,reversed:de}=Z,Ae=te?"width":"height",Ue=te?"x":"y",Le=Fr(M[Ae],Z.len),Ie=Fr(b[Ae],Z.len),ze=10>Math.abs(Le)?1:Le/Ie,nt=(b[Ue]||0)+Ie/2-Z.pos,rt=nt-((M[Ue]??Z.pos)+Le/2-Z.pos)/ze,ft=de&&!O||!de&&O?-1:1;if(!w&&(nt<0||nt>Z.len))continue;let Bt=Z.toValue(rt,!0)+(T||Z.isOrdinal?0:J*ft),Lt=Z.toValue(rt+ne/ze,!0)-(T||Z.isOrdinal?0:J*ft||0),Vt=Z.allExtremes;if(Bt>Lt&&([Bt,Lt]=[Lt,Bt]),ze===1&&!w&&Z.coll==="yAxis"&&!Vt){for(let To of Z.series){let La=To.getExtremes(To.getProcessedData(!0).modified.getColumn("y")||[],!0);Vt??(Vt={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),Ra(La.dataMin)&&Ra(La.dataMax)&&(Vt.dataMin=Math.min(La.dataMin,Vt.dataMin),Vt.dataMax=Math.max(La.dataMax,Vt.dataMax))}Z.allExtremes=Vt}let{dataMin:Yt,dataMax:zt,min:Tn,max:un}=Cs(Z.getExtremes(),Vt||{}),dn=B.parse(ce.min),Hn=B.parse(ce.max),sn=Yt??dn,mr=zt??Hn,Gi=Lt-Bt,Yn=Z.categories?0:Math.min(Gi,mr-sn),Mn=sn-Yn*(Al(dn)?0:ce.minPadding),xi=mr+Yn*(Al(Hn)?0:ce.maxPadding),Ni=Z.allowZoomOutside||ze===1||S!=="zoom"&&ze>1,kr=Math.min(dn??Mn,Mn,Ni?Tn:Mn),Wi=Math.max(Hn??xi,xi,Ni?un:xi);(!Z.isOrdinal||Z.options.overscroll||ze!==1||w)&&(Bt<kr&&(Bt=kr,ze>=1&&(Lt=Bt+Gi)),Lt>Wi&&(Lt=Wi,ze>=1&&(Bt=Lt-Gi)),(w||Z.series.length&&(Bt!==Tn||Lt!==un)&&Bt>=kr&&Lt<=Wi)&&(T?T[Z.coll].push({axis:Z,min:Bt,max:Lt}):(Z.isPanning=S!=="zoom",Z.isPanning&&(X=!0),Z.setExtremes(w?void 0:Bt,w?void 0:Lt,!1,!1,{move:rt,trigger:S,scale:ze}),!w&&(Bt>kr||Lt<Wi)&&S!=="mousewheel"&&(U=!0)),N=!0),y&&(this[te?"mouseDownX":"mouseDownY"]=y[te?"chartX":"chartY"]))}return N&&(T?On(this,"selection",T,()=>{delete u.selection,u.trigger="zoom",this.transform(u)}):(!U||X||this.resetZoomButton?!U&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(S==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),N}}Cs(kl.prototype,{callbacks:[],collectionsWithInit:{xAxis:[kl.prototype.addAxis,[!0]],yAxis:[kl.prototype.addAxis,[!1]],series:[kl.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:yv}=Rn,{composed:Ru}=lt,{addEvent:Rl,createElement:ff,css:Wp,defined:qp,erase:bw,merge:_v,pushUnique:ly}=Zt;function vv(){let P=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!P&&(this.scrollablePlotArea=P=new Zp(this)),P?.applyFixed()}function Wd(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}let Zp=(()=>{class P{static compose(p,y,b){ly(Ru,this.compose)&&(Rl(p,"afterInit",Wd),Rl(y,"afterSetChartSize",w=>this.afterSetSize(w.target,w)),Rl(y,"render",vv),Rl(b,"show",Wd))}static afterSetSize(p,y){let b,w,T,{minWidth:M,minHeight:S}=p.options.chart.scrollablePlotArea||{},{clipBox:O,plotBox:B,inverted:N,renderer:U}=p;if(!U.forExport&&(M?(p.scrollablePixelsX=b=Math.max(0,M-p.chartWidth),b&&(p.scrollablePlotBox=_v(p.plotBox),B.width=p.plotWidth+=b,O[N?"height":"width"]+=b,T=!0)):S&&(p.scrollablePixelsY=w=Math.max(0,S-p.chartHeight),qp(w)&&(p.scrollablePlotBox=_v(p.plotBox),B.height=p.plotHeight+=w,O[N?"width":"height"]+=w,T=!1)),qp(T)&&!y.skipAxes))for(let X of p.axes)(X.horiz===T||p.hasParallelCoordinates&&X.coll==="yAxis")&&(X.setAxisSize(),X.setAxisTranslation())}constructor(p){let y,b=p.options.chart,w=xn.getRendererType(),T=b.scrollablePlotArea||{},M=this.moveFixedElements.bind(this),S={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};p.scrollablePixelsX&&(S.overflowX="auto"),p.scrollablePixelsY&&(S.overflowY="auto"),this.chart=p;let O=this.parentDiv=ff("div",{className:"highcharts-scrolling-parent"},{position:"relative"},p.renderTo),B=this.scrollingContainer=ff("div",{className:"highcharts-scrolling"},S,O),N=this.innerContainer=ff("div",{className:"highcharts-inner-container"},void 0,B),U=this.fixedDiv=ff("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(b.style?.zIndex||0)+2,top:0},void 0,!0),X=this.fixedRenderer=new w(U,p.chartWidth,p.chartHeight,b.style);this.mask=X.path().attr({fill:b.backgroundColor||"#fff","fill-opacity":T.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),B.parentNode.insertBefore(U,B),Wp(p.renderTo,{overflow:"visible"}),Rl(p,"afterShowResetZoom",M),Rl(p,"afterApplyDrilldown",M),Rl(p,"afterLayOutTitles",M),Rl(B,"scroll",()=>{let{pointer:Z,hoverPoint:te}=p;Z&&(delete Z.chartPosition,te&&(y=te),Z.runPointActions(void 0,y,!0))}),N.appendChild(p.container)}applyFixed(){let{chart:p,fixedRenderer:y,isDirty:b,scrollingContainer:w}=this,{axisOffset:T,chartWidth:M,chartHeight:S,container:O,plotHeight:B,plotLeft:N,plotTop:U,plotWidth:X,scrollablePixelsX:Z=0,scrollablePixelsY:te=0}=p,{scrollPositionX:ne=0,scrollPositionY:J=0}=p.options.chart.scrollablePlotArea||{},ce=M+Z,de=S+te;y.setSize(M,S),(b??!0)&&(this.isDirty=!1,this.moveFixedElements()),yv(p.container),Wp(O,{width:`${ce}px`,height:`${de}px`}),p.renderer.boxWrapper.attr({width:ce,height:de,viewBox:[0,0,ce,de].join(" ")}),p.chartBackground?.attr({width:ce,height:de}),Wp(w,{width:`${M}px`,height:`${S}px`}),qp(b)||(w.scrollLeft=Z*ne,w.scrollTop=te*J);let Ae=U-T[0]-1,Ue=N-T[3]-1,Le=U+B+T[2]+1,Ie=N+X+T[1]+1,ze=N+X-Z,nt=U+B-te,rt=[["M",0,0]];Z?rt=[["M",0,Ae],["L",N-1,Ae],["L",N-1,Le],["L",0,Le],["Z"],["M",ze,Ae],["L",M,Ae],["L",M,Le],["L",ze,Le],["Z"]]:te&&(rt=[["M",Ue,0],["L",Ue,U-1],["L",Ie,U-1],["L",Ie,0],["Z"],["M",Ue,nt],["L",Ue,S],["L",Ie,S],["L",Ie,nt],["Z"]]),p.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:rt})}moveFixedElements(){let p,{container:y,inverted:b,scrollablePixelsX:w,scrollablePixelsY:T}=this.chart,M=this.fixedRenderer,S=P.fixedSelectors;if(w&&!b?p=".highcharts-yaxis":w&&b||T&&!b?p=".highcharts-xaxis":T&&b&&(p=".highcharts-yaxis"),p&&!(this.chart.hasParallelCoordinates&&p===".highcharts-yaxis"))for(let O of[`${p}:not(.highcharts-radial-axis)`,`${p}-labels:not(.highcharts-radial-axis-labels)`])ly(S,O);else for(let O of[".highcharts-xaxis",".highcharts-yaxis"])for(let B of[`${O}:not(.highcharts-radial-axis)`,`${O}-labels:not(.highcharts-radial-axis-labels)`])bw(S,B);for(let O of S)[].forEach.call(y.querySelectorAll(O),B=>{(B.namespaceURI===M.SVG_NS?M.box:M.box.parentNode).appendChild(B),B.style.pointerEvents="auto"})}}return P.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"],P})(),{format:cy}=Dt,{series:uy}=Ht,{destroyObjectProperties:uo,fireEvent:Xp,getAlignFactor:Yp,isNumber:Ds,pick:pf}=Zt,Tc=class{constructor(P,u,p,y,b){let w=P.chart.inverted,T=P.reversed;this.axis=P;let M=this.isNegative=!!p!=!!T;this.options=u=u||{},this.x=y,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=b,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:u.align||(w?M?"left":"right":"center"),verticalAlign:u.verticalAlign||(w?"middle":M?"bottom":"top"),y:u.y,x:u.x},this.textAlign=u.textAlign||(w?M?"right":"left":"center")}destroy(){uo(this,this.axis)}render(P){let u=this.axis.chart,p=this.options,y=p.format,b=y?cy(y,this,u):p.formatter.call(this);if(this.label)this.label.attr({text:b,visibility:"hidden"});else{this.label=u.renderer.label(b,null,void 0,p.shape,void 0,void 0,p.useHTML,!1,"stack-labels");let w={r:p.borderRadius||0,text:b,padding:pf(p.padding,5),visibility:"hidden"};u.styledMode||(w.fill=p.backgroundColor,w.stroke=p.borderColor,w["stroke-width"]=p.borderWidth,this.label.css(p.style||{})),this.label.attr(w),this.label.added||this.label.add(P)}this.label.labelrank=u.plotSizeY,Xp(this,"afterRender")}setOffset(P,u,p,y,b,w){let{alignOptions:T,axis:M,label:S,options:O,textAlign:B}=this,N=M.chart,U=this.getStackBox({xOffset:P,width:u,boxBottom:p,boxTop:y,defaultX:b,xAxis:w}),{verticalAlign:X}=T;if(S&&U){let Z=S.getBBox(void 0,0),te=S.padding,ne=pf(O.overflow,"justify")==="justify",J;T.x=O.x||0,T.y=O.y||0;let{x:ce,y:de}=this.adjustStackPosition({labelBox:Z,verticalAlign:X,textAlign:B});U.x-=ce,U.y-=de,S.align(T,!1,U),(J=N.isInsidePlot(S.alignAttr.x+T.x+ce,S.alignAttr.y+T.y+de))||(ne=!1),ne&&uy.prototype.justifyDataLabel.call(M,S,T,S.alignAttr,Z,U),S.attr({x:S.alignAttr.x,y:S.alignAttr.y,rotation:O.rotation,rotationOriginX:Z.width*Yp(O.textAlign||"center"),rotationOriginY:Z.height/2}),pf(!ne&&O.crop,!0)&&(J=Ds(S.x)&&Ds(S.y)&&N.isInsidePlot(S.x-te+(S.width||0),S.y)&&N.isInsidePlot(S.x+te,S.y)),S[J?"show":"hide"]()}Xp(this,"afterSetOffset",{xOffset:P,width:u})}adjustStackPosition({labelBox:P,verticalAlign:u,textAlign:p}){return{x:P.width/2+P.width/2*(2*Yp(p)-1),y:P.height/2*2*(1-Yp(u))}}getStackBox(P){let u=this.axis,p=u.chart,{boxTop:y,defaultX:b,xOffset:w,width:T,boxBottom:M}=P,S=u.stacking.usePercentage?100:pf(y,this.total,0),O=u.toPixels(S),B=P.xAxis||p.xAxis[0],N=pf(b,B.translate(this.x))+w,U=Math.abs(O-u.toPixels(M||Ds(u.min)&&u.logarithmic&&u.logarithmic.lin2log(u.min)||0)),X=p.inverted,Z=this.isNegative;return X?{x:(Z?O:O-U)-p.plotLeft,y:B.height-N-T+B.top-p.plotTop,width:U,height:T}:{x:N+B.transB-p.plotLeft,y:(Z?O-U:O)-p.plotTop,width:T,height:U}}},{getDeferredAnimation:mf}=Rn,{series:{prototype:Ts}}=Ht,{addEvent:ns,correctFloat:gf,defined:yf,destroyObjectProperties:bv,fireEvent:xw,isNumber:_f,objectEach:ho,pick:Pl}=Zt;function xv(){let P=this.inverted;this.axes.forEach(u=>{u.stacking&&u.stacking.stacks&&u.hasVisibleSeries&&(u.stacking.oldStacks=u.stacking.stacks)}),this.series.forEach(u=>{let p=u.xAxis&&u.xAxis.options||{};u.options.stacking&&u.reserveSpace()&&(u.stackKey=[u.type,Pl(u.options.stack,""),P?p.top:p.left,P?p.height:p.width].join(","))})}function wv(){let P=this.stacking;if(P){let u=P.stacks;ho(u,(p,y)=>{bv(p),delete u[y]}),P.stackTotalGroup?.destroy()}}function ww(){this.stacking||(this.stacking=new Qp(this))}function Kp(P,u,p,y){return!yf(P)||P.x!==u||y&&P.stackKey!==y?P={x:u,index:0,key:y,stackKey:y}:P.index++,P.key=[p,u,P.index].join(","),P}function dy(){let P,u=this,p=u.yAxis,y=u.stackKey||"",b=p.stacking.stacks,w=u.getColumn("x",!0),T=u.options.stacking,M=u[T+"Stacker"];M&&[y,"-"+y].forEach(S=>{let O=w.length,B,N,U;for(;O--;)B=w[O],P=u.getStackIndicator(P,B,u.index,S),N=b[S]?.[B],(U=N?.points[P.key||""])&&M.call(u,U,N,O)})}function qd(P,u,p){let y=u.total?100/u.total:0;P[0]=gf(P[0]*y),P[1]=gf(P[1]*y),this.stackedYData[p]=P[1]}function Zd(P){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?Ts.setStackedPoints.call(this,P,"group"):P.stacking.resetStacks())}function vf(P,u){let p,y,b,w,T,M,S,O=u||this.options.stacking;if(!O||!this.reserveSpace()||({group:"xAxis"}[O]||"yAxis")!==P.coll)return;let B=this.getColumn("x",!0),N=this.getColumn(this.pointValKey||"y",!0),U=[],X=N.length,Z=this.options,te=Z.threshold||0,ne=Z.startFromThreshold?te:0,J=Z.stack,ce=u?`${this.type},${O}`:this.stackKey||"",de="-"+ce,Ae=this.negStacks,Ue=P.stacking,Le=Ue.stacks,Ie=Ue.oldStacks;for(Ue.stacksTouched+=1,S=0;S<X;S++){let ze=B[S]||0,nt=N[S],rt=_f(nt)&&nt||0;M=(p=this.getStackIndicator(p,ze,this.index)).key||"",Le[T=(y=Ae&&rt<(ne?0:te))?de:ce]||(Le[T]={}),Le[T][ze]||(Ie[T]?.[ze]?(Le[T][ze]=Ie[T][ze],Le[T][ze].total=null):Le[T][ze]=new Tc(P,P.options.stackLabels,!!y,ze,J)),b=Le[T][ze],nt!==null?(b.points[M]=b.points[this.index]=[Pl(b.cumulative,ne)],yf(b.cumulative)||(b.base=M),b.touched=Ue.stacksTouched,p.index>0&&this.singleStacks===!1&&(b.points[M][0]=b.points[this.index+","+ze+",0"][0])):(delete b.points[M],delete b.points[this.index]);let ft=b.total||0;O==="percent"?(w=y?ce:de,ft=Ae&&Le[w]?.[ze]?(w=Le[w][ze]).total=Math.max(w.total||0,ft)+Math.abs(rt):gf(ft+Math.abs(rt))):O==="group"?_f(nt)&&ft++:ft=gf(ft+rt),O==="group"?b.cumulative=(ft||1)-1:b.cumulative=gf(Pl(b.cumulative,ne)+rt),b.total=ft,nt!==null&&(b.points[M].push(b.cumulative),U[S]=b.cumulative,b.hasValidPoints=!0)}O==="percent"&&(Ue.usePercentage=!0),O!=="group"&&(this.stackedYData=U),Ue.oldStacks={}}class Qp{constructor(u){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=u}buildStacks(){let u,p,y=this.axis,b=y.series,w=y.coll==="xAxis",T=y.options.reversedStacks,M=b.length;for(this.resetStacks(),this.usePercentage=!1,p=M;p--;)u=b[T?p:M-p-1],w&&u.setGroupedPoints(y),u.setStackedPoints(y);if(!w)for(p=0;p<M;p++)b[p].modifyStacks();xw(y,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,ho(this.stacks,u=>{ho(u,p=>{p.cumulative=p.total})}))}resetStacks(){ho(this.stacks,u=>{ho(u,(p,y)=>{_f(p.touched)&&p.touched<this.stacksTouched?(p.destroy(),delete u[y]):(p.total=null,p.cumulative=null)})})}renderStackTotals(){let u=this.axis,p=u.chart,y=p.renderer,b=this.stacks,w=mf(p,u.options.stackLabels?.animation||!1),T=this.stackTotalGroup=this.stackTotalGroup||y.g("stack-labels").attr({zIndex:6,opacity:0}).add();T.translate(p.plotLeft,p.plotTop),ho(b,M=>{ho(M,S=>{S.render(T)})}),T.animate({opacity:1},w)}}(Ye||(Ye={})).compose=function(P,u,p){let y=u.prototype,b=p.prototype;y.getStacks||(ns(P,"init",ww),ns(P,"destroy",wv),y.getStacks=xv,b.getStackIndicator=Kp,b.modifyStacks=dy,b.percentStacker=qd,b.setGroupedPoints=Zd,b.setStackedPoints=vf)};let Ev=Ye,{defined:bf,merge:Jp,isObject:Cv}=Zt;class Pu extends Do{drawGraph(){let u=this.options,p=(this.gappedPath||this.getGraphPath).call(this),y=this.chart.styledMode;[this,...this.zones].forEach((b,w)=>{let T,M=b.graph,S=M?"animate":"attr",O=b.dashStyle||u.dashStyle;M?(M.endX=this.preventGraphAnimation?null:p.xMap,M.animate({d:p})):p.length&&(b.graph=M=this.chart.renderer.path(p).addClass("highcharts-graph"+(w?` highcharts-zone-graph-${w-1} `:" ")+(w&&b.className||"")).attr({zIndex:1}).add(this.group)),M&&!y&&(T={stroke:!w&&u.lineColor||b.color||this.color||"#cccccc","stroke-width":u.lineWidth||0,fill:this.fillGraph&&this.color||"none"},O?T.dashstyle=O:u.linecap!=="square"&&(T["stroke-linecap"]=T["stroke-linejoin"]="round"),M[S](T).shadow(u.shadow&&Jp({filterUnits:"userSpaceOnUse"},Cv(u.shadow)?u.shadow:{}))),M&&(M.startX=p.xMap,M.isArea=p.isArea)})}getGraphPath(u,p,y){let b=this,w=b.options,T=[],M=[],S,O=w.step,B=(u=u||b.points).reversed;return B&&u.reverse(),(O={right:1,center:2}[O]||O&&3)&&B&&(O=4-O),(u=this.getValidPoints(u,!1,!(w.connectNulls&&!p&&!y))).forEach(function(N,U){let X,Z=N.plotX,te=N.plotY,ne=u[U-1],J=N.isNull||typeof te!="number";(N.leftCliff||ne&&ne.rightCliff)&&!y&&(S=!0),J&&!bf(p)&&U>0?S=!w.connectNulls:J&&!p?S=!0:(U===0||S?X=[["M",N.plotX,N.plotY]]:b.getPointSpline?X=[b.getPointSpline(u,N,U)]:O?(X=O===1?[["L",ne.plotX,te]]:O===2?[["L",(ne.plotX+Z)/2,ne.plotY],["L",(ne.plotX+Z)/2,te]]:[["L",Z,ne.plotY]]).push(["L",Z,te]):X=[["L",Z,te]],M.push(N.x),O&&(M.push(N.x),O===2&&M.push(N.x)),T.push.apply(T,X),S=!1)}),T.xMap=M,b.graphPath=T,T}}Pu.defaultOptions=Jp(Do.defaultOptions,{legendSymbol:"lineMarker"}),Ht.registerSeriesType("line",Pu);let{seriesTypes:{line:em}}=Ht,{extend:hy,merge:Dv,objectEach:Ew,pick:tm}=Zt;class Ou extends em{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:u,options:p}=this;[this,...this.zones].forEach((y,b)=>{let w={},T=y.fillColor||p.fillColor,M=y.area,S=M?"animate":"attr";M?(M.endX=this.preventGraphAnimation?null:u.xMap,M.animate({d:u})):(w.zIndex=0,(M=y.area=this.chart.renderer.path(u).addClass("highcharts-area"+(b?` highcharts-zone-area-${b-1} `:" ")+(b&&y.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(w.fill=T||y.color||this.color,w["fill-opacity"]=T?1:p.fillOpacity??.75,M.css({pointerEvents:this.stickyTracking?"none":"auto"})),M[S](w),M.startX=u.xMap,M.shiftUnit=p.step?2:1})}getGraphPath(u){let p,y,b,w=em.prototype.getGraphPath,T=this.options,M=T.stacking,S=this.yAxis,O=[],B=[],N=this.index,U=S.stacking.stacks[this.stackKey],X=T.threshold,Z=Math.round(S.getThreshold(T.threshold)),te=tm(T.connectNulls,M==="percent"),ne=function(Le,Ie,ze){let nt=u[Le],rt=M&&U[nt.x].points[N],ft=nt[ze+"Null"]||0,Bt=nt[ze+"Cliff"]||0,Lt,Vt,Yt=!0;Bt||ft?(Lt=(ft?rt[0]:rt[1])+Bt,Vt=rt[0]+Bt,Yt=!!ft):!M&&u[Ie]&&u[Ie].isNull&&(Lt=Vt=X),Lt!==void 0&&(B.push({plotX:p,plotY:Lt===null?Z:S.getThreshold(Lt),isNull:Yt,isCliff:!0}),O.push({plotX:p,plotY:Vt===null?Z:S.getThreshold(Vt),doCurve:!1}))};u=u||this.points,M&&(u=this.getStackPoints(u));for(let Le=0,Ie=u.length;Le<Ie;++Le)M||(u[Le].leftCliff=u[Le].rightCliff=u[Le].leftNull=u[Le].rightNull=void 0),y=u[Le].isNull,p=tm(u[Le].rectPlotX,u[Le].plotX),b=M?tm(u[Le].yBottom,Z):Z,y&&!te||(te||ne(Le,Le-1,"left"),y&&!M&&te||(B.push(u[Le]),O.push({x:Le,plotX:p,plotY:b})),te||ne(Le,Le+1,"right"));let J=w.call(this,B,!0,!0);O.reversed=!0;let ce=w.call(this,O,!0,!0),de=ce[0];de&&de[0]==="M"&&(ce[0]=["L",de[1],de[2]]);let Ae=J.concat(ce);Ae.length&&Ae.push(["Z"]);let Ue=w.call(this,B,!1,te);return this.chart.series.length>1&&M&&B.some(Le=>Le.isCliff)&&(Ae.hasStackedCliffs=Ue.hasStackedCliffs=!0),Ae.xMap=J.xMap,this.areaPath=Ae,Ue}getStackPoints(u){let p=this,y=[],b=[],w=this.xAxis,T=this.yAxis,M=T.stacking.stacks[this.stackKey],S={},O=T.series,B=O.length,N=T.options.reversedStacks?1:-1,U=O.indexOf(p);if(u=u||this.points,this.options.stacking){for(let Z=0;Z<u.length;Z++)u[Z].leftNull=u[Z].rightNull=void 0,S[u[Z].x]=u[Z];Ew(M,function(Z,te){Z.total!==null&&b.push(te)}),b.sort(function(Z,te){return Z-te});let X=O.map(Z=>Z.visible);b.forEach(function(Z,te){let ne=0,J,ce;if(S[Z]&&!S[Z].isNull)y.push(S[Z]),[-1,1].forEach(function(de){let Ae=de===1?"rightNull":"leftNull",Ue=M[b[te+de]],Le=0;if(Ue){let Ie=U;for(;Ie>=0&&Ie<B;){let ze=O[Ie].index;!(J=Ue.points[ze])&&(ze===p.index?S[Z][Ae]=!0:X[Ie]&&(ce=M[Z].points[ze])&&(Le-=ce[1]-ce[0])),Ie+=N}}S[Z][de===1?"rightCliff":"leftCliff"]=Le});else{let de=U;for(;de>=0&&de<B;){let Ae=O[de].index;if(J=M[Z].points[Ae]){ne=J[1];break}de+=N}ne=tm(ne,0),ne=T.translate(ne,0,1,0,1),y.push({isNull:!0,plotX:w.translate(Z,0,0,0,1),x:Z,plotY:ne,yBottom:ne})}})}return y}}Ou.defaultOptions=Dv(em.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),hy(Ou.prototype,{singleStacks:!1}),Ht.registerSeriesType("area",Ou);let{line:fy}=Ht.seriesTypes,{merge:Mc,pick:ii}=Zt;class xf extends fy{getPointSpline(u,p,y){let b,w,T,M,S=p.plotX||0,O=p.plotY||0,B=u[y-1],N=u[y+1];function U(Z){return Z&&!Z.isNull&&Z.doCurve!==!1&&!p.isCliff}if(U(B)&&U(N)){let Z=B.plotX||0,te=B.plotY||0,ne=N.plotX||0,J=N.plotY||0,ce=0;b=(1.5*S+Z)/2.5,w=(1.5*O+te)/2.5,T=(1.5*S+ne)/2.5,M=(1.5*O+J)/2.5,T!==b&&(ce=(M-w)*(T-S)/(T-b)+O-M),w+=ce,M+=ce,w>te&&w>O?(w=Math.max(te,O),M=2*O-w):w<te&&w<O&&(w=Math.min(te,O),M=2*O-w),M>J&&M>O?(M=Math.max(J,O),w=2*O-M):M<J&&M<O&&(M=Math.min(J,O),w=2*O-M),p.rightContX=T,p.rightContY=M,p.controlPoints={low:[b,w],high:[T,M]}}let X=["C",ii(B.rightContX,B.plotX,0),ii(B.rightContY,B.plotY,0),ii(b,S,0),ii(w,O,0),S,O];return B.rightContX=B.rightContY=void 0,X}}xf.defaultOptions=Mc(fy.defaultOptions),Ht.registerSeriesType("spline",xf);let oa=xf,{area:Pa,area:{prototype:is}}=Ht.seriesTypes,{extend:rs,merge:Gr}=Zt;class nm extends oa{}nm.defaultOptions=Gr(oa.defaultOptions,Pa.defaultOptions),rs(nm.prototype,{getGraphPath:is.getGraphPath,getStackPoints:is.getStackPoints,drawGraph:is.drawGraph}),Ht.registerSeriesType("areaspline",nm);let{animObject:Wr}=Rn,{parse:Tv}=re,{noop:Xd}=lt,{clamp:Yd,crisp:wf,defined:im,extend:Mv,fireEvent:rm,isArray:py,isNumber:om,merge:sa,pick:Ms,objectEach:sm}=Zt;class Lu extends Do{animate(u){let p,y,b=this,w=this.yAxis,T=w.pos,M=w.reversed,S=b.options,{clipOffset:O,inverted:B}=this.chart,N={},U=B?"translateX":"translateY";u&&O?(N.scaleY=.001,y=Yd(w.toPixels(S.threshold||0),T,T+w.len),B?(y+=M?-Math.floor(O[0]):Math.ceil(O[2]),N.translateX=y-w.len):(y+=M?Math.ceil(O[0]):-Math.floor(O[2]),N.translateY=y),b.clipBox&&b.setClip(),b.group.attr(N)):(p=Number(b.group.attr(U)),b.group.animate({scaleY:1},Mv(Wr(b.options.animation),{step:function(X,Z){b.group&&(N[U]=p+Z.pos*(T-p),b.group.attr(N))}})))}init(u,p){super.init.apply(this,arguments);let y=this;(u=y.chart).hasRendered&&u.series.forEach(function(b){b.type===y.type&&(b.isDirty=!0)})}getColumnMetrics(){let u=this,p=u.options,y=u.xAxis,b=u.yAxis,w=y.options.reversedStacks,T=y.reversed&&!w||!y.reversed&&w,M={},S,O=0;p.grouping===!1?O=1:u.chart.series.forEach(function(te){let ne,J=te.yAxis,ce=te.options;te.type===u.type&&te.reserveSpace()&&b.len===J.len&&b.pos===J.pos&&(ce.stacking&&ce.stacking!=="group"?(M[S=te.stackKey]===void 0&&(M[S]=O++),ne=M[S]):ce.grouping!==!1&&(ne=O++),te.columnIndex=ne)});let B=Math.min(Math.abs(y.transA)*(!y.brokenAxis?.hasBreaks&&y.ordinal?.slope||p.pointRange||y.closestPointRange||y.tickInterval||1),y.len),N=B*p.groupPadding,U=(B-2*N)/(O||1),X=Math.min(p.maxPointWidth||y.len,Ms(p.pointWidth,U*(1-2*p.pointPadding))),Z=(u.columnIndex||0)+(T?1:0);return u.columnMetrics={width:X,offset:(U-X)/2+(N+Z*U-B/2)*(T?-1:1),paddedWidth:U,columnCount:O},u.columnMetrics}crispCol(u,p,y,b){let w=this.borderWidth,T=this.chart.inverted;return b=wf(p+b,w,T)-(p=wf(p,w,T)),this.options.crisp&&(y=wf(u+y,w)-(u=wf(u,w))),{x:u,y:p,width:y,height:b}}adjustForMissingColumns(u,p,y,b){if(!y.isNull&&b.columnCount>1){let w=this.xAxis.series.filter(O=>O.visible).map(O=>O.index),T=0,M=0;sm(this.xAxis.stacking?.stacks,O=>{let B=typeof y.x=="number"?O[y.x.toString()]?.points:void 0,N=B?.[this.index],U={};if(B&&py(N)){let X=this.index,Z=Object.keys(B).filter(te=>!te.match(",")&&B[te]&&B[te].length>1).map(parseFloat).filter(te=>w.indexOf(te)!==-1).filter(te=>{let ne=this.chart.series[te].options,J=ne.stacking&&ne.stack;if(im(J)){if(om(U[J]))return X===te&&(X=U[J]),!1;U[J]=te}return!0}).sort((te,ne)=>ne-te);T=Z.indexOf(X),M=Z.length}}),T=this.xAxis.reversed?M-1-T:T;let S=(M-1)*b.paddedWidth+p;u=(y.plotX||0)+S/2-p-T*b.paddedWidth}return u}translate(){let u=this,p=u.chart,y=u.options,b=u.dense=u.closestPointRange*u.xAxis.transA<2,w=u.borderWidth=Ms(y.borderWidth,b?0:1),T=u.xAxis,M=u.yAxis,S=y.threshold,O=Ms(y.minPointLength,5),B=u.getColumnMetrics(),N=B.width,U=u.pointXOffset=B.offset,X=u.dataMin,Z=u.dataMax,te=u.translatedThreshold=M.getThreshold(S),ne=u.barW=Math.max(N,1+2*w);y.pointPadding&&y.crisp&&(ne=Math.ceil(ne)),Do.prototype.translate.apply(u),u.points.forEach(function(J){let ce=Ms(J.yBottom,te),de=999+Math.abs(ce),Ae=J.plotX||0,Ue=Yd(J.plotY,-de,M.len+de),Le,Ie=Math.min(Ue,ce),ze=Math.max(Ue,ce)-Ie,nt=N,rt=Ae+U,ft=ne;O&&Math.abs(ze)<O&&(ze=O,Le=!M.reversed&&!J.negative||M.reversed&&J.negative,om(S)&&om(Z)&&J.y===S&&Z<=S&&(M.min||0)<S&&(X!==Z||(M.max||0)<=S)&&(Le=!Le,J.negative=!J.negative),Ie=Math.abs(Ie-te)>O?ce-O:te-(Le?O:0)),im(J.options.pointWidth)&&(rt-=Math.round(((nt=ft=Math.ceil(J.options.pointWidth))-N)/2)),y.centerInCategory&&(rt=u.adjustForMissingColumns(rt,nt,J,B)),J.barX=rt,J.pointWidth=nt,J.tooltipPos=p.inverted?[Yd(M.len+M.pos-p.plotLeft-Ue,M.pos-p.plotLeft,M.len+M.pos-p.plotLeft),T.len+T.pos-p.plotTop-rt-ft/2,ze]:[T.left-p.plotLeft+rt+ft/2,Yd(Ue+M.pos-p.plotTop,M.pos-p.plotTop,M.len+M.pos-p.plotTop),ze],J.shapeType=u.pointClass.prototype.shapeType||"roundedRect",J.shapeArgs=u.crispCol(rt,J.isNull?te:Ie,ft,J.isNull?0:ze)}),rm(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(u,p){let y=this.options,b=this.pointAttrToOptions||{},w=b.stroke||"borderColor",T=b["stroke-width"]||"borderWidth",M,S,O,B=u&&u.color||this.color,N=u&&u[w]||y[w]||B,U=u&&u.options.dashStyle||y.dashStyle,X=u&&u[T]||y[T]||this[T]||0,Z=Ms(u&&u.opacity,y.opacity,1);u&&this.zones.length&&(S=u.getZone(),B=u.options.color||S&&(S.color||u.nonZonedColor)||this.color,S&&(N=S.borderColor||N,U=S.dashStyle||U,X=S.borderWidth||X)),p&&u&&(O=(M=sa(y.states[p],u.options.states&&u.options.states[p]||{})).brightness,B=M.color||O!==void 0&&Tv(B).brighten(M.brightness).get()||B,N=M[w]||N,X=M[T]||X,U=M.dashStyle||U,Z=Ms(M.opacity,Z));let te={fill:B,stroke:N,"stroke-width":X,opacity:Z};return U&&(te.dashstyle=U),te}drawPoints(u=this.points){let p,y=this,b=this.chart,w=y.options,T=b.renderer,M=w.animationLimit||250;u.forEach(function(S){let O=S.plotY,B=S.graphic,N=!!B,U=B&&b.pointCount<M?"animate":"attr";om(O)&&S.y!==null?(p=S.shapeArgs,B&&S.hasNewShapeType()&&(B=B.destroy()),y.enabledDataSorting&&(S.startXPos=y.xAxis.reversed?-(p&&p.width||0):y.xAxis.width),!B&&(S.graphic=B=T[S.shapeType](p).add(S.group||y.group),B&&y.enabledDataSorting&&b.hasRendered&&b.pointCount<M&&(B.attr({x:S.startXPos}),N=!0,U="animate")),B&&N&&B[U](sa(p)),b.styledMode||B[U](y.pointAttribs(S,S.selected&&"select")).shadow(S.allowShadow!==!1&&w.shadow),B&&(B.addClass(S.getClassName(),!0),B.attr({visibility:S.visible?"inherit":"hidden"}))):B&&(S.graphic=B.destroy())})}drawTracker(u=this.points){let p,y=this,b=y.chart,w=b.pointer,T=function(M){w?.normalize(M);let S=w?.getPointFromEvent(M),O=!b.scrollablePlotArea||b.isInsidePlot(M.chartX-b.plotLeft,M.chartY-b.plotTop,{visiblePlotOnly:!0});w&&S&&y.options.enableMouseTracking&&O&&(w.isDirectTouch=!0,S.onMouseOver(M))};u.forEach(function(M){p=py(M.dataLabels)?M.dataLabels:M.dataLabel?[M.dataLabel]:[],M.graphic&&(M.graphic.element.point=M),p.forEach(function(S){(S.div||S.element).point=M})}),y._hasTracking||(y.trackerGroups.forEach(function(M){y[M]&&(y[M].addClass("highcharts-tracker").on("mouseover",T).on("mouseout",function(S){w?.onTrackerMouseOut(S)}).on("touchstart",T),!b.styledMode&&y.options.cursor&&y[M].css({cursor:y.options.cursor}))}),y._hasTracking=!0),rm(this,"afterDrawTracker")}remove(){let u=this,p=u.chart;p.hasRendered&&p.series.forEach(function(y){y.type===u.type&&(y.isDirty=!0)}),Do.prototype.remove.apply(u,arguments)}}Lu.defaultOptions=sa(Do.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),Mv(Lu.prototype,{directTouch:!0,getSymbol:Xd,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),Ht.registerSeriesType("column",Lu);let Kd=Lu,{getDeferredAnimation:Iv}=Rn,{format:Cw}=Dt,{defined:Ic,extend:Sv,fireEvent:Ef,getAlignFactor:Av,isArray:Oa,isString:am,merge:Qd,objectEach:Fu,pick:Jd,pInt:Dw,splat:Nu}=Zt;(function(P){function u(){return S(this).some(B=>B?.enabled)}function p(B,N,U,X,Z){let{chart:te,enabledDataSorting:ne}=this,J=this.isCartesian&&te.inverted,ce=B.plotX,de=B.plotY,Ae=U.rotation||0,Ue=Ic(ce)&&Ic(de)&&te.isInsidePlot(ce,Math.round(de),{inverted:J,paneCoordinates:!0,series:this}),Le=Ae===0&&Jd(U.overflow,ne?"none":"justify")==="justify",Ie=this.visible&&B.visible!==!1&&Ic(ce)&&(B.series.forceDL||ne&&!Le||Ue||Jd(U.inside,!!this.options.stacking)&&X&&te.isInsidePlot(ce,J?X.x+1:X.y+X.height-1,{inverted:J,paneCoordinates:!0,series:this})),ze=B.pos();if(Ie&&ze){var nt;let rt=N.getBBox(),ft=N.getBBox(void 0,0);if(X=Sv({x:ze[0],y:Math.round(ze[1]),width:0,height:0},X||{}),U.alignTo==="plotEdges"&&this.isCartesian&&(X[J?"x":"y"]=0,X[J?"width":"height"]=this.yAxis?.len||0),Sv(U,{width:rt.width,height:rt.height}),nt=X,ne&&this.xAxis&&!Le&&this.setDataLabelStartPos(B,N,Z,Ue,nt),N.align(Qd(U,{width:ft.width,height:ft.height}),!1,X,!1),N.alignAttr.x+=Av(U.align)*(ft.width-rt.width),N.alignAttr.y+=Av(U.verticalAlign)*(ft.height-rt.height),N[N.placed?"animate":"attr"]({"text-align":N.alignAttr["text-align"]||"center",x:N.alignAttr.x+(rt.width-ft.width)/2,y:N.alignAttr.y+(rt.height-ft.height)/2,rotationOriginX:(N.width||0)/2,rotationOriginY:(N.height||0)/2}),Le&&X.height>=0)this.justifyDataLabel(N,U,N.alignAttr,rt,X,Z);else if(Jd(U.crop,!0)){let{x:Bt,y:Lt}=N.alignAttr;Ie=te.isInsidePlot(Bt,Lt,{paneCoordinates:!0,series:this})&&te.isInsidePlot(Bt+rt.width-1,Lt+rt.height-1,{paneCoordinates:!0,series:this})}U.shape&&!Ae&&N[Z?"attr":"animate"]({anchorX:ze[0],anchorY:ze[1]})}Z&&ne&&(N.placed=!1),Ie||ne&&!Le?(N.show(),N.placed=!0):(N.hide(),N.placed=!1)}function y(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function b(B){let N=this.hasRendered||0,U=this.initDataLabelsGroup().attr({opacity:+N});return!N&&U&&(this.visible&&U.show(),this.options.animation?U.animate({opacity:1},B):U.attr({opacity:1})),U}function w(B){let N;B=B||this.points;let U=this,X=U.chart,Z=U.options,te=X.renderer,{backgroundColor:ne,plotBackgroundColor:J}=X.options.chart,ce=te.getContrast(am(J)&&J||am(ne)&&ne||"#000000"),de=S(U),{animation:Ae,defer:Ue}=de[0],Le=Ue?Iv(X,Ae,U):{defer:0,duration:0};Ef(this,"drawDataLabels"),U.hasDataLabels?.()&&(N=this.initDataLabels(Le),B.forEach(Ie=>{let ze=Ie.dataLabels||[];Nu(M(de,Ie.dlOptions||Ie.options?.dataLabels)).forEach((rt,ft)=>{let Bt=rt.enabled&&(Ie.visible||Ie.dataLabelOnHidden)&&(!Ie.isNull||Ie.dataLabelOnNull)&&function(Yn,Mn){let xi=Mn.filter;if(xi){let Ni=xi.operator,kr=Yn[xi.property],Wi=xi.value;return Ni===">"&&kr>Wi||Ni==="<"&&kr<Wi||Ni===">="&&kr>=Wi||Ni==="<="&&kr<=Wi||Ni==="=="&&kr==Wi||Ni==="==="&&kr===Wi||Ni==="!="&&kr!=Wi||Ni==="!=="&&kr!==Wi}return!0}(Ie,rt),{backgroundColor:Lt,borderColor:Vt,distance:Yt,style:zt={}}=rt,Tn,un,dn,Hn={},sn=ze[ft],mr=!sn,Gi;Bt&&(un=Ic(Tn=Jd(rt[Ie.formatPrefix+"Format"],rt.format))?Cw(Tn,Ie,X):(rt[Ie.formatPrefix+"Formatter"]||rt.formatter).call(Ie,rt),dn=rt.rotation,!X.styledMode&&(zt.color=Jd(rt.color,zt.color,am(U.color)?U.color:void 0,"#000000"),zt.color==="contrast"?(Lt!=="none"&&(Gi=Lt),Ie.contrastColor=te.getContrast(Gi!=="auto"&&Gi||Ie.color||U.color),zt.color=Gi||!Ic(Yt)&&rt.inside||0>Dw(Yt||0)||Z.stacking?Ie.contrastColor:ce):delete Ie.contrastColor,Z.cursor&&(zt.cursor=Z.cursor)),Hn={r:rt.borderRadius||0,rotation:dn,padding:rt.padding,zIndex:1},X.styledMode||(Hn.fill=Lt==="auto"?Ie.color:Lt,Hn.stroke=Vt==="auto"?Ie.color:Vt,Hn["stroke-width"]=rt.borderWidth),Fu(Hn,(Yn,Mn)=>{Yn===void 0&&delete Hn[Mn]})),!sn||Bt&&Ic(un)&&!!sn.div==!!rt.useHTML&&(sn.rotation&&rt.rotation||sn.rotation===rt.rotation)||(sn=void 0,mr=!0),Bt&&Ic(un)&&(sn?Hn.text=un:(sn=te.label(un,0,0,rt.shape,void 0,void 0,rt.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+Ie.colorIndex+" "+(rt.className||"")+(rt.useHTML?" highcharts-tracker":"")),sn&&(sn.options=rt,sn.attr(Hn),X.styledMode?zt.width&&sn.css({width:zt.width,textOverflow:zt.textOverflow,whiteSpace:zt.whiteSpace}):sn.css(zt).shadow(rt.shadow),Ef(sn,"beforeAddingDataLabel",{labelOptions:rt,point:Ie}),sn.added||sn.add(N),U.alignDataLabel(Ie,sn,rt,void 0,mr),sn.isActive=!0,ze[ft]&&ze[ft]!==sn&&ze[ft].destroy(),ze[ft]=sn))});let nt=ze.length;for(;nt--;)ze[nt]&&ze[nt].isActive?ze[nt].isActive=!1:(ze[nt]?.destroy(),ze.splice(nt,1));Ie.dataLabel=ze[0],Ie.dataLabels=ze})),Ef(this,"afterDrawDataLabels")}function T(B,N,U,X,Z,te){let ne=this.chart,J=N.align,ce=N.verticalAlign,de=B.box?0:B.padding||0,Ae=ne.inverted?this.yAxis:this.xAxis,Ue=Ae?Ae.left-ne.plotLeft:0,Le=ne.inverted?this.xAxis:this.yAxis,Ie=Le?Le.top-ne.plotTop:0,{x:ze=0,y:nt=0}=N,rt,ft;return(rt=(U.x||0)+de+Ue)<0&&(J==="right"&&ze>=0?(N.align="left",N.inside=!0):ze-=rt,ft=!0),(rt=(U.x||0)+X.width-de+Ue)>ne.plotWidth&&(J==="left"&&ze<=0?(N.align="right",N.inside=!0):ze+=ne.plotWidth-rt,ft=!0),(rt=U.y+de+Ie)<0&&(ce==="bottom"&&nt>=0?(N.verticalAlign="top",N.inside=!0):nt-=rt,ft=!0),(rt=(U.y||0)+X.height-de+Ie)>ne.plotHeight&&(ce==="top"&&nt<=0?(N.verticalAlign="bottom",N.inside=!0):nt+=ne.plotHeight-rt,ft=!0),ft&&(N.x=ze,N.y=nt,B.placed=!te,B.align(N,void 0,Z)),ft}function M(B,N){let U=[],X;if(Oa(B)&&!Oa(N))U=B.map(function(Z){return Qd(Z,N)});else if(Oa(N)&&!Oa(B))U=N.map(function(Z){return Qd(B,Z)});else if(Oa(B)||Oa(N)){if(Oa(B)&&Oa(N))for(X=Math.max(B.length,N.length);X--;)U[X]=Qd(B[X],N[X])}else U=Qd(B,N);return U}function S(B){let N=B.chart.options.plotOptions;return Nu(M(M(N?.series?.dataLabels,N?.[B.type]?.dataLabels),B.options.dataLabels))}function O(B,N,U,X,Z){let te=this.chart,ne=te.inverted,J=this.xAxis,ce=J.reversed,de=((ne?N.height:N.width)||0)/2,Ae=B.pointWidth,Ue=Ae?Ae/2:0;N.startXPos=ne?Z.x:ce?-de-Ue:J.width-de+Ue,N.startYPos=ne?ce?this.yAxis.height-de+Ue:-de-Ue:Z.y,X?N.visibility==="hidden"&&(N.show(),N.attr({opacity:0}).animate({opacity:1})):N.attr({opacity:1}).animate({opacity:0},void 0,N.hide),te.hasRendered&&(U&&N.attr({x:N.startXPos,y:N.startYPos}),N.placed=!0)}P.compose=function(B){let N=B.prototype;N.initDataLabels||(N.initDataLabels=b,N.initDataLabelsGroup=y,N.alignDataLabel=p,N.drawDataLabels=w,N.justifyDataLabel=T,N.setDataLabelStartPos=O,N.hasDataLabels=u)}})(Ne||(Ne={}));let zu=Ne,{composed:kv}=lt,{series:my}=Ht,{merge:Tw,pick:Cf,pushUnique:Rv}=Zt;(function(P){function u(p,y,b,w,T){let M=this.chart.inverted,S=p.series,O=(S.xAxis?S.xAxis.len:this.chart.plotSizeX)||0,B=(S.yAxis?S.yAxis.len:this.chart.plotSizeY)||0,N=p.dlBox||p.shapeArgs,U=Cf(p.below,p.plotY>Cf(this.translatedThreshold,B)),X=Cf(b.inside,!!this.options.stacking);if(N){if(w=Tw(N),!(b.overflow==="allow"&&b.crop===!1)){w.y<0&&(w.height+=w.y,w.y=0);let Z=w.y+w.height-B;Z>0&&Z<w.height-1&&(w.height-=Z)}M&&(w={x:B-w.y-w.height,y:O-w.x-w.width,width:w.height,height:w.width}),X||(M?(w.x+=U?0:w.width,w.width=0):(w.y+=U?w.height:0,w.height=0))}b.align=Cf(b.align,!M||X?"center":U?"right":"left"),b.verticalAlign=Cf(b.verticalAlign,M||X?"middle":U?"top":"bottom"),my.prototype.alignDataLabel.call(this,p,y,b,w,T),b.inside&&p.contrastColor&&y.css({color:p.contrastColor})}P.compose=function(p){zu.compose(my),Rv(kv,"ColumnDataLabel")&&(p.prototype.alignDataLabel=u)}})(ct||(ct={}));let Mw=ct,{extend:Pv,merge:Iw}=Zt;class gy extends Kd{}gy.defaultOptions=Iw(Kd.defaultOptions,{}),Pv(gy.prototype,{inverted:!0}),Ht.registerSeriesType("bar",gy);let{column:Ov,line:yy}=Ht.seriesTypes,{addEvent:Lv,extend:_y,merge:Ol}=Zt;class to extends yy{applyJitter(){let u=this,p=this.options.jitter,y=this.points.length;p&&this.points.forEach(function(b,w){["x","y"].forEach(function(T,M){if(p[T]&&!b.isNull){let S=`plot${T.toUpperCase()}`,O=u[`${T}Axis`],B=p[T]*O.transA;if(O&&!O.logarithmic){let N=Math.max(0,(b[S]||0)-B),U=Math.min(O.len,(b[S]||0)+B);b[S]=N+(U-N)*function(X){let Z=1e4*Math.sin(X);return Z-Math.floor(Z)}(w+M*y),T==="x"&&(b.clientX=b.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}to.defaultOptions=Ol(yy.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">\u25CF</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),_y(to.prototype,{drawTracker:Ov.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),Lv(to,"afterTranslate",function(){this.applyJitter()}),Ht.registerSeriesType("scatter",to);let{deg2rad:Fv}=lt,{fireEvent:vy,isNumber:by,pick:lm,relativeLength:Sw}=Zt;(function(P){P.getCenter=function(){let u=this.options,p=this.chart,y=2*(u.slicedOffset||0),b=p.plotWidth-2*y,w=p.plotHeight-2*y,T=u.center,M=Math.min(b,w),S=u.thickness,O,B=u.size,N=u.innerSize||0,U,X;typeof B=="string"&&(B=parseFloat(B)),typeof N=="string"&&(N=parseFloat(N));let Z=[lm(T?.[0],"50%"),lm(T?.[1],"50%"),lm(B&&B<0?void 0:u.size,"100%"),lm(N&&N<0?void 0:u.innerSize||0,"0%")];for(!p.angular||this instanceof Do||(Z[3]=0),U=0;U<4;++U)X=Z[U],O=U<2||U===2&&/%$/.test(X),Z[U]=Sw(X,[b,w,M,Z[2]][U])+(O?y:0);return Z[3]>Z[2]&&(Z[3]=Z[2]),by(S)&&2*S<Z[2]&&S>0&&(Z[3]=Z[2]-2*S),vy(this,"afterGetCenter",{positions:Z}),Z},P.getStartAndEndRadians=function(u,p){let y=by(u)?u:0,b=by(p)&&p>y&&p-y<360?p:y+360;return{start:Fv*(y+-90),end:Fv*(b+-90)}}})(bt||(bt={}));let cm=bt,{setAnimation:um}=Rn,{addEvent:xy,defined:Bu,extend:Df,isNumber:Aw,pick:kw,relativeLength:Rw}=Zt;class Nv extends z{getConnectorPath(u){let p=u.dataLabelPosition,y=u.options||{},b=y.connectorShape,w=this.connectorShapes[b]||b;return p&&w.call(this,vn(ht({},p.computed),{alignment:p.alignment}),p.connectorPosition,y)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(u){let p=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(p.x,p.y,p.r+u,p.r+u,{innerR:p.r-1,start:p.start,end:p.end,borderRadius:p.borderRadius})}constructor(u,p,y){super(u,p,y),this.half=0,this.name??(this.name="Slice");let b=w=>{this.slice(w.type==="select")};xy(this,"select",b),xy(this,"unselect",b)}isValid(){return Aw(this.y)&&this.y>=0}setVisible(u,p=!0){u!==this.visible&&this.update({visible:u??!this.visible},p,void 0,!1)}slice(u,p,y){let b=this.series;um(y,b.chart),p=kw(p,!0),this.sliced=this.options.sliced=u=Bu(u)?u:!this.sliced,b.options.data[b.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}Df(Nv.prototype,{connectorShapes:{fixedOffset:function(P,u,p){let y=u.breakAt,b=u.touchingSliceAt,w=p.softConnector?["C",P.x+(P.alignment==="left"?-5:5),P.y,2*y.x-b.x,2*y.y-b.y,y.x,y.y]:["L",y.x,y.y];return[["M",P.x,P.y],w,["L",b.x,b.y]]},straight:function(P,u){let p=u.touchingSliceAt;return[["M",P.x,P.y],["L",p.x,p.y]]},crookedLine:function(P,u,p){let{angle:y=this.angle||0,breakAt:b,touchingSliceAt:w}=u,{series:T}=this,[M,S,O]=T.center,B=O/2,{plotLeft:N,plotWidth:U}=T.chart,X=P.alignment==="left",{x:Z,y:te}=P,ne=b.x;if(p.crookDistance){let ce=Rw(p.crookDistance,1);ne=X?M+B+(U+N-M-B)*(1-ce):N+(M-B)*ce}else ne=M+(S-te)*Math.tan(y-Math.PI/2);let J=[["M",Z,te]];return(X?ne<=Z&&ne>=b.x:ne>=Z&&ne<=b.x)&&J.push(["L",ne,te]),J.push(["L",b.x,b.y],["L",w.x,w.y]),J}}});let{getStartAndEndRadians:Pw}=cm,{noop:zv}=lt,{clamp:Ow,extend:wy,fireEvent:Bv,merge:Sc,pick:Lw}=Zt;class Hi extends Do{animate(u){let p=this,y=p.points,b=p.startAngleRad;u||y.forEach(function(w){let T=w.graphic,M=w.shapeArgs;T&&M&&(T.attr({r:Lw(w.startR,p.center&&p.center[3]/2),start:b,end:b}),T.animate({r:M.r,start:M.start,end:M.end},p.options.animation))})}drawEmpty(){let u,p,y=this.startAngleRad,b=this.endAngleRad,w=this.options;this.total===0&&this.center?(u=this.center[0],p=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(u,p,this.center[1]/2,0,y,b).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:ll.arc(u,p,this.center[2]/2,0,{start:y,end:b,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":w.borderWidth,fill:w.fillColor||"none",stroke:w.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let u=this.chart.renderer;this.points.forEach(function(p){p.graphic&&p.hasNewShapeType()&&(p.graphic=p.graphic.destroy()),p.graphic||(p.graphic=u[p.shapeType](p.shapeArgs).add(p.series.group),p.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(u,p,y,b){let w=this.center,T=this.radii?this.radii[y.index]||0:w[2]/2,M=b.dataLabelPosition,S=M?.distance||0,O=Math.asin(Ow((u-w[1])/(T+S),-1,1));return w[0]+Math.cos(O)*(T+S)*(p?-1:1)+(S>0?(p?-1:1)*(b.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let u,p,y,b,w=this,T=w.chart;this.drawEmpty(),w.group&&!T.styledMode&&w.group.shadow(w.options.shadow),w.points.forEach(function(M){let S={};p=M.graphic,!M.isNull&&p?(b=M.shapeArgs,u=M.getTranslate(),T.styledMode||(y=w.pointAttribs(M,M.selected&&"select")),M.delayedRendering?(p.setRadialReference(w.center).attr(b).attr(u),T.styledMode||p.attr(y).attr({"stroke-linejoin":"round"}),M.delayedRendering=!1):(p.setRadialReference(w.center),T.styledMode||Sc(!0,S,y),Sc(!0,S,b,u),p.animate(S)),p.attr({visibility:M.visible?"inherit":"hidden"}),p.addClass(M.getClassName(),!0)):p&&(M.graphic=p.destroy())})}sortByAngle(u,p){u.sort(function(y,b){return y.angle!==void 0&&(b.angle-y.angle)*p})}translate(u){Bv(this,"translate"),this.generatePoints();let p=this.options,y=p.slicedOffset,b=Pw(p.startAngle,p.endAngle),w=this.startAngleRad=b.start,T=(this.endAngleRad=b.end)-w,M=this.points,S=p.ignoreHiddenPoint,O=M.length,B,N,U,X,Z,te,ne,J=0;for(u||(this.center=u=this.getCenter()),te=0;te<O;te++){ne=M[te],B=w+J*T,ne.isValid()&&(!S||ne.visible)&&(J+=ne.percentage/100),N=w+J*T;let ce={x:u[0],y:u[1],r:u[2]/2,innerR:u[3]/2,start:Math.round(1e3*B)/1e3,end:Math.round(1e3*N)/1e3};ne.shapeType="arc",ne.shapeArgs=ce,(U=(N+B)/2)>1.5*Math.PI?U-=2*Math.PI:U<-Math.PI/2&&(U+=2*Math.PI),ne.slicedTranslation={translateX:Math.round(Math.cos(U)*y),translateY:Math.round(Math.sin(U)*y)},X=Math.cos(U)*u[2]/2,Z=Math.sin(U)*u[2]/2,ne.tooltipPos=[u[0]+.7*X,u[1]+.7*Z],ne.half=U<-Math.PI/2||U>Math.PI/2?1:0,ne.angle=U}Bv(this,"afterTranslate")}updateTotals(){let u=this.points,p=u.length,y=this.options.ignoreHiddenPoint,b,w,T=0;for(b=0;b<p;b++)(w=u[b]).isValid()&&(!y||w.visible)&&(T+=w.y);for(b=0,this.total=T;b<p;b++)(w=u[b]).percentage=T>0&&(w.visible||!y)?w.y/T*100:0,w.total=T}}Hi.defaultOptions=Sc(Do.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),wy(Hi.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Kd.prototype.drawTracker,getCenter:cm.getCenter,getSymbol:zv,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Kd.prototype.pointAttribs,pointClass:Nv,requireSorting:!1,searchPoint:zv,trackerGroups:["group","dataLabelsGroup"]}),Ht.registerSeriesType("pie",Hi);let{composed:dm,noop:Vv}=lt,{distribute:hm}=Ur,{series:Tf}=Ht,{arrayMax:Mf,clamp:Ey,defined:Cy,pick:If,pushUnique:Dy,relativeLength:fm}=Zt;(function(P){let u={radialDistributionY:function(T,M){return(M.dataLabelPosition?.top||0)+T.distributeBox.pos},radialDistributionX:function(T,M,S,O,B){let N=B.dataLabelPosition;return T.getX(S<(N?.top||0)+2||S>(N?.bottom||0)-2?O:S,M.half,M,B)},justify:function(T,M,S,O){return O[0]+(T.half?-1:1)*(S+(M.dataLabelPosition?.distance||0))},alignToPlotEdges:function(T,M,S,O){let B=T.getBBox().width;return M?B+O:S-B-O},alignToConnectors:function(T,M,S,O){let B=0,N;return T.forEach(function(U){(N=U.dataLabel.getBBox().width)>B&&(B=N)}),M?B+O:S-B-O}};function p(T,M){let S=Math.PI/2,{start:O=0,end:B=0}=T.shapeArgs||{},N=T.angle||0;M>0&&O<S&&B>S&&N>S/2&&N<1.5*S&&(N=N<=S?Math.max(S/2,(O+S)/2):Math.min(1.5*S,(S+B)/2));let{center:U,options:X}=this,Z=U[2]/2,te=Math.cos(N),ne=Math.sin(N),J=U[0]+te*Z,ce=U[1]+ne*Z,de=Math.min((X.slicedOffset||0)+(X.borderWidth||0),M/5);return{natural:{x:J+te*M,y:ce+ne*M},computed:{},alignment:M<0?"center":T.half?"right":"left",connectorPosition:{angle:N,breakAt:{x:J+te*de,y:ce+ne*de},touchingSliceAt:{x:J,y:ce}},distance:M}}function y(){let T=this,M=T.points,S=T.chart,O=S.plotWidth,B=S.plotHeight,N=S.plotLeft,U=Math.round(S.chartWidth/3),X=T.center,Z=X[2]/2,te=X[1],ne=[[],[]],J=[0,0,0,0],ce=T.dataLabelPositioners,de,Ae,Ue,Le=0;T.visible&&T.hasDataLabels?.()&&(M.forEach(Ie=>{(Ie.dataLabels||[]).forEach(ze=>{ze.shortened&&(ze.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),ze.shortened=!1)})}),Tf.prototype.drawDataLabels.apply(T),M.forEach(Ie=>{(Ie.dataLabels||[]).forEach((ze,nt)=>{let rt=X[2]/2,ft=ze.options,Bt=fm(ft?.distance||0,rt);nt===0&&ne[Ie.half].push(Ie),!Cy(ft?.style?.width)&&ze.getBBox().width>U&&(ze.css({width:Math.round(.7*U)+"px"}),ze.shortened=!0),ze.dataLabelPosition=this.getDataLabelPosition(Ie,Bt),Le=Math.max(Le,Bt)})}),ne.forEach((Ie,ze)=>{let nt=Ie.length,rt=[],ft,Bt,Lt=0,Vt;nt&&(T.sortByAngle(Ie,ze-.5),Le>0&&(ft=Math.max(0,te-Z-Le),Bt=Math.min(te+Z+Le,S.plotHeight),Ie.forEach(Yt=>{(Yt.dataLabels||[]).forEach(zt=>{let Tn=zt.dataLabelPosition;Tn&&Tn.distance>0&&(Tn.top=Math.max(0,te-Z-Tn.distance),Tn.bottom=Math.min(te+Z+Tn.distance,S.plotHeight),Lt=zt.getBBox().height||21,zt.lineHeight=S.renderer.fontMetrics(zt.text||zt).h+2*zt.padding,Yt.distributeBox={target:(zt.dataLabelPosition?.natural.y||0)-Tn.top+zt.lineHeight/2,size:Lt,rank:Yt.y},rt.push(Yt.distributeBox))})}),hm(rt,Vt=Bt+Lt-ft,Vt/5)),Ie.forEach(Yt=>{(Yt.dataLabels||[]).forEach(zt=>{let Tn=zt.options||{},un=Yt.distributeBox,dn=zt.dataLabelPosition,Hn=dn?.natural.y||0,sn=Tn.connectorPadding||0,mr=zt.lineHeight||21,Gi=(mr-zt.getBBox().height)/2,Yn=0,Mn=Hn,xi="inherit";if(dn){if(rt&&Cy(un)&&dn.distance>0&&(un.pos===void 0?xi="hidden":(Ue=un.size,Mn=ce.radialDistributionY(Yt,zt))),Tn.justify)Yn=ce.justify(Yt,zt,Z,X);else switch(Tn.alignTo){case"connectors":Yn=ce.alignToConnectors(Ie,ze,O,N);break;case"plotEdges":Yn=ce.alignToPlotEdges(zt,ze,O,N);break;default:Yn=ce.radialDistributionX(T,Yt,Mn-Gi,Hn,zt)}if(dn.attribs={visibility:xi,align:dn.alignment},dn.posAttribs={x:Yn+(Tn.x||0)+({left:sn,right:-sn}[dn.alignment]||0),y:Mn+(Tn.y||0)-mr/2},dn.computed.x=Yn,dn.computed.y=Mn-Gi,If(Tn.crop,!0)){let Ni;Yn-(Ae=zt.getBBox().width)<sn&&ze===1?(Ni=Math.round(Ae-Yn+sn),J[3]=Math.max(Ni,J[3])):Yn+Ae>O-sn&&ze===0&&(Ni=Math.round(Yn+Ae-O+sn),J[1]=Math.max(Ni,J[1])),Mn-Ue/2<0?J[0]=Math.max(Math.round(-Mn+Ue/2),J[0]):Mn+Ue/2>B&&(J[2]=Math.max(Math.round(Mn+Ue/2-B),J[2])),dn.sideOverflow=Ni}}})}))}),(Mf(J)===0||this.verifyDataLabelOverflow(J))&&(this.placeDataLabels(),this.points.forEach(Ie=>{(Ie.dataLabels||[]).forEach(ze=>{let{connectorColor:nt,connectorWidth:rt=1}=ze.options||{},ft=ze.dataLabelPosition;if(rt){let Bt;de=ze.connector,ft&&ft.distance>0?(Bt=!de,de||(ze.connector=de=S.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+Ie.colorIndex+(Ie.className?" "+Ie.className:"")).add(T.dataLabelsGroup)),S.styledMode||de.attr({"stroke-width":rt,stroke:nt||Ie.color||"#666666"}),de[Bt?"attr":"animate"]({d:Ie.getConnectorPath(ze)}),de.attr({visibility:ft.attribs?.visibility})):de&&(ze.connector=de.destroy())}})})))}function b(){this.points.forEach(T=>{(T.dataLabels||[]).forEach(M=>{let S=M.dataLabelPosition;S?(S.sideOverflow&&(M.css({width:Math.max(M.getBBox().width-S.sideOverflow,0)+"px",textOverflow:(M.options?.style||{}).textOverflow||"ellipsis"}),M.shortened=!0),M.attr(S.attribs),M[M.moved?"animate":"attr"](S.posAttribs),M.moved=!0):M&&M.attr({y:-9999})}),delete T.distributeBox},this)}function w(T){let M=this.center,S=this.options,O=S.center,B=S.minSize||80,N=B,U=S.size!==null;return!U&&(O[0]!==null?N=Math.max(M[2]-Math.max(T[1],T[3]),B):(N=Math.max(M[2]-T[1]-T[3],B),M[0]+=(T[3]-T[1])/2),O[1]!==null?N=Ey(N,B,M[2]-Math.max(T[0],T[2])):(N=Ey(N,B,M[2]-T[0]-T[2]),M[1]+=(T[0]-T[2])/2),N<M[2]?(M[2]=N,M[3]=Math.min(S.thickness?Math.max(0,N-2*S.thickness):Math.max(0,fm(S.innerSize||0,N)),N),this.translate(M),this.drawDataLabels&&this.drawDataLabels()):U=!0),U}P.compose=function(T){if(zu.compose(Tf),Dy(dm,"PieDataLabel")){let M=T.prototype;M.dataLabelPositioners=u,M.alignDataLabel=Vv,M.drawDataLabels=y,M.getDataLabelPosition=p,M.placeDataLabels=b,M.verifyDataLabelOverflow=w}}})(Ut||(Ut={}));let Ty=Ut;(function(P){P.getCenterOfPoints=function(u){let p=u.reduce((y,b)=>(y.x+=b.x,y.y+=b.y,y),{x:0,y:0});return{x:p.x/u.length,y:p.y/u.length}},P.getDistanceBetweenPoints=function(u,p){return Math.sqrt(Math.pow(p.x-u.x,2)+Math.pow(p.y-u.y,2))},P.getAngleBetweenPoints=function(u,p){return Math.atan2(p.x-u.x,p.y-u.y)},P.pointInPolygon=function({x:u,y:p},y){let b=y.length,w,T,M=!1;for(w=0,T=b-1;w<b;T=w++){let[S,O]=y[w],[B,N]=y[T];O>p!=N>p&&u<(B-S)*(p-O)/(N-O)+S&&(M=!M)}return M}})(Qt||(Qt={}));let{pointInPolygon:Fw}=Qt,{addEvent:jv,fireEvent:eh,objectEach:Uv,pick:My}=Zt;function Nw(P){let u=P.length,p=(B,N)=>!(N.x>=B.x+B.width||N.x+N.width<=B.x||N.y>=B.y+B.height||N.y+N.height<=B.y),y=(B,N)=>{for(let U of B)if(Fw({x:U[0],y:U[1]},N))return!0;return!1},b,w,T,M,S,O=!1;for(let B=0;B<u;B++)(b=P[B])&&(b.oldOpacity=b.opacity,b.newOpacity=1,b.absoluteBox=function(N){if(N&&(!N.alignAttr||N.placed)){let U=N.box?0:N.padding||0,X=N.alignAttr||{x:N.attr("x"),y:N.attr("y")},Z=N.getBBox();return N.width=Z.width,N.height=Z.height,{x:X.x+(N.parentGroup?.translateX||0)+U,y:X.y+(N.parentGroup?.translateY||0)+U,width:(N.width||0)-2*U,height:(N.height||0)-2*U,polygon:Z?.polygon}}}(b));P.sort((B,N)=>(N.labelrank||0)-(B.labelrank||0));for(let B=0;B<u;++B){M=(w=P[B])&&w.absoluteBox;let N=M?.polygon;for(let U=B+1;U<u;++U){S=(T=P[U])&&T.absoluteBox;let X=!1;if(M&&S&&w!==T&&w.newOpacity!==0&&T.newOpacity!==0&&w.visibility!=="hidden"&&T.visibility!=="hidden"){let Z=S.polygon;if(N&&Z&&N!==Z?y(N,Z)&&(X=!0):p(M,S)&&(X=!0),X){let te=w.labelrank<T.labelrank?w:T,ne=te.text;te.newOpacity=0,ne?.element.querySelector("textPath")&&ne.hide()}}}}for(let B of P)pm(B,this)&&(O=!0);O&&eh(this,"afterHideAllOverlappingLabels")}function pm(P,u){let p,y,b=!1;return P&&(y=P.newOpacity,P.oldOpacity!==y&&(P.hasClass("highcharts-data-label")?(P[y?"removeClass":"addClass"]("highcharts-data-label-hidden"),p=function(){u.styledMode||P.css({pointerEvents:y?"auto":"none"})},b=!0,P[P.isOld?"animate":"attr"]({opacity:y},void 0,p),eh(u,"afterHideOverlappingLabel")):P.attr({opacity:y})),P.isOld=!0),b}function Iy(){let P=this,u=[];for(let p of P.labelCollectors||[])u=u.concat(p());for(let p of P.yAxis||[])p.stacking&&p.options.stackLabels&&!p.options.stackLabels.allowOverlap&&Uv(p.stacking.stacks,y=>{Uv(y,b=>{b.label&&u.push(b.label)})});for(let p of P.series||[])if(p.visible&&p.hasDataLabels?.()){let y=b=>{for(let w of b)w.visible&&(w.dataLabels||[]).forEach(T=>{let M=T.options||{};T.labelrank=My(M.labelrank,w.labelrank,w.shapeArgs?.height),M.allowOverlap??Number(M.distance)>0?(T.oldOpacity=T.opacity,T.newOpacity=1,pm(T,P)):u.push(T)})};y(p.nodes||[]),y(p.points)}this.hideOverlappingLabels(u)}let Sf={compose:function(P){let u=P.prototype;u.hideOverlappingLabels||(u.hideOverlappingLabels=Nw,jv(P,"render",Iy))}},{defaultOptions:zw}=Mr,{noop:$v}=lt,{addEvent:Hv,extend:Bw,isObject:Gv,merge:Vw,relativeLength:th}=Zt,jw={radius:0,scope:"stack",where:void 0},Sy=$v,Vu=$v;function Uw(P,u,p,y,b={}){let w=Sy(P,u,p,y,b),{innerR:T=0,r:M=p,start:S=0,end:O=0}=b;if(b.open||!b.borderRadius)return w;let B=O-S,N=Math.sin(B/2),U=Math.max(Math.min(th(b.borderRadius||0,M-T),(M-T)/2,M*N/(1+N)),0),X=Math.min(U,B/Math.PI*2*T),Z=w.length-1;for(;Z--;)(function(te,ne,J){let ce,de,Ae,Ue=te[ne],Le=te[ne+1];if(Le[0]==="Z"&&(Le=te[0]),(Ue[0]==="M"||Ue[0]==="L")&&Le[0]==="A"?(ce=Ue,de=Le,Ae=!0):Ue[0]==="A"&&(Le[0]==="M"||Le[0]==="L")&&(ce=Le,de=Ue),ce&&de&&de.params){let Ie=de[1],ze=de[5],nt=de.params,{start:rt,end:ft,cx:Bt,cy:Lt}=nt,Vt=ze?Ie-J:Ie+J,Yt=Vt?Math.asin(J/Vt):0,zt=ze?Yt:-Yt,Tn=Math.cos(Yt)*Vt;Ae?(nt.start=rt+zt,ce[1]=Bt+Tn*Math.cos(rt),ce[2]=Lt+Tn*Math.sin(rt),te.splice(ne+1,0,["A",J,J,0,0,1,Bt+Ie*Math.cos(nt.start),Lt+Ie*Math.sin(nt.start)])):(nt.end=ft-zt,de[6]=Bt+Ie*Math.cos(nt.end),de[7]=Lt+Ie*Math.sin(nt.end),te.splice(ne+1,0,["A",J,J,0,0,1,Bt+Tn*Math.cos(ft),Lt+Tn*Math.sin(ft)])),de[4]=Math.abs(nt.end-nt.start)<Math.PI?0:1}})(w,Z,Z>1?X:U);return w}function $w(){if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:P,yAxis:u}=this,p=P.stacking==="percent",y=zw.plotOptions?.[this.type]?.borderRadius,b=Ay(P.borderRadius,Gv(y)?y:{}),w=u.options.reversed;for(let T of this.points){let{shapeArgs:M}=T;if(T.shapeType==="roundedRect"&&M){let{width:S=0,height:O=0,y:B=0}=M,N=B,U=O;if(b.scope==="stack"&&T.stackTotal){let ne=u.translate(p?100:T.stackTotal,!1,!0,!1,!0),J=u.translate(P.threshold||0,!1,!0,!1,!0),ce=this.crispCol(0,Math.min(ne,J),0,Math.abs(ne-J));N=ce.y,U=ce.height}let X=(T.negative?-1:1)*(w?-1:1)==-1,Z=b.where;!Z&&this.is("waterfall")&&Math.abs((T.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(Z="all"),Z||(Z="end");let te=Math.min(th(b.radius,S),S/2,Z==="all"?O/2:1/0)||0;Z==="end"&&(X&&(N-=te),U+=te),Bw(M,{brBoxHeight:U,brBoxY:N,r:te})}}}}function Ay(P,u){return Gv(P)||(P={radius:P||0}),Vw(jw,u,P)}function Wv(){let P=Ay(this.options.borderRadius);for(let u of this.points){let p=u.shapeArgs;p&&(p.borderRadius=th(P.radius,(p.r||0)-(p.innerR||0)))}}function qv(P,u,p,y,b={}){let w=Vu(P,u,p,y,b),{r:T=0,brBoxHeight:M=y,brBoxY:S=u}=b,O=u-S,B=S+M-(u+y),N=O-T>-.1?0:T,U=B-T>-.1?0:T,X=Math.max(N&&O,0),Z=Math.max(U&&B,0),te=[P+N,u],ne=[P+p-N,u],J=[P+p,u+N],ce=[P+p,u+y-U],de=[P+p-U,u+y],Ae=[P+U,u+y],Ue=[P,u+y-U],Le=[P,u+N],Ie=(ze,nt)=>Math.sqrt(Math.pow(ze,2)-Math.pow(nt,2));if(X){let ze=Ie(N,N-X);te[0]-=ze,ne[0]+=ze,J[1]=Le[1]=u+N-X}if(y<N-X){let ze=Ie(N,N-X-y);J[0]=ce[0]=P+p-N+ze,de[0]=Math.min(J[0],de[0]),Ae[0]=Math.max(ce[0],Ae[0]),Ue[0]=Le[0]=P+N-ze,J[1]=Le[1]=u+y}if(Z){let ze=Ie(U,U-Z);de[0]+=ze,Ae[0]-=ze,ce[1]=Ue[1]=u+y-U+Z}if(y<U-Z){let ze=Ie(U,U-Z-y);J[0]=ce[0]=P+p-U+ze,ne[0]=Math.min(J[0],ne[0]),te[0]=Math.max(ce[0],te[0]),Ue[0]=Le[0]=P+U-ze,ce[1]=Ue[1]=u}return w.length=0,w.push(["M",...te],["L",...ne],["A",N,N,0,0,1,...J],["L",...ce],["A",U,U,0,0,1,...de],["L",...Ae],["A",U,U,0,0,1,...Ue],["L",...Le],["A",N,N,0,0,1,...te],["Z"]),w}let{diffObjects:Hw,extend:Gw,find:Ww,merge:ky,pick:ju,uniqueKey:mm}=Zt;(function(P){function u(y,b){let w=y.condition;(w.callback||function(){return this.chartWidth<=ju(w.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=ju(w.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=ju(w.minWidth,0)&&this.chartHeight>=ju(w.minHeight,0)}).call(this)&&b.push(y._id)}function p(y,b){let w=this.options.responsive,T=this.currentResponsive,M=[],S;!b&&w&&w.rules&&w.rules.forEach(N=>{N._id===void 0&&(N._id=mm()),this.matchResponsiveRule(N,M)},this);let O=ky(...M.map(N=>Ww((w||{}).rules||[],U=>U._id===N)).map(N=>N&&N.chartOptions));O.isResponsiveOptions=!0,M=M.toString()||void 0;let B=T&&T.ruleIds;M===B||(T&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(T.undoOptions,y,!0),this.updatingResponsive=!1),M?((S=Hw(O,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:M,mergedOptions:O,undoOptions:S},this.updatingResponsive||this.update(O,y,!0)):this.currentResponsive=void 0)}P.compose=function(y){let b=y.prototype;return b.matchResponsiveRule||Gw(b,{matchResponsiveRule:u,setResponsive:p}),y}})(yi||(yi={}));let qw=yi;lt.AST=vi,lt.Axis=fr,lt.Chart=kl,lt.Color=re,lt.DataLabel=zu,lt.DataTableCore=Ge,lt.Fx=je,lt.HTMLElement=uc,lt.Legend=Es,lt.LegendSymbol=_t,lt.OverlappingDataLabels=lt.OverlappingDataLabels||Sf,lt.PlotLineOrBand=Tu,lt.Point=z,lt.Pointer=mt,lt.RendererRegistry=xn,lt.Series=Do,lt.SeriesRegistry=Ht,lt.StackItem=Tc,lt.SVGElement=ko,lt.SVGRenderer=cc,lt.Templating=Dt,lt.Tick=ao,lt.Time=Hs,lt.Tooltip=Ud,lt.animate=Rn.animate,lt.animObject=Rn.animObject,lt.chart=kl.chart,lt.color=re.parse,lt.dateFormat=Dt.dateFormat,lt.defaultOptions=Mr.defaultOptions,lt.distribute=Ur.distribute,lt.format=Dt.format,lt.getDeferredAnimation=Rn.getDeferredAnimation,lt.getOptions=Mr.getOptions,lt.numberFormat=Dt.numberFormat,lt.seriesType=Ht.seriesType,lt.setAnimation=Rn.setAnimation,lt.setOptions=Mr.setOptions,lt.stop=Rn.stop,lt.time=Mr.defaultTime,lt.timers=je.timers,{compose:function(P,u,p){let y=P.types.pie;if(!u.symbolCustomAttribs.includes("borderRadius")){let b=p.prototype.symbols;Hv(P,"afterColumnTranslate",$w,{order:9}),Hv(y,"afterTranslate",Wv),u.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),Sy=b.arc,Vu=b.roundedRect,b.arc=Uw,b.roundedRect=qv}},optionsToObject:Ay}.compose(lt.Series,lt.SVGElement,lt.SVGRenderer),Mw.compose(lt.Series.types.column),zu.compose(lt.Series),Mp.compose(lt.Axis),uc.compose(lt.SVGRenderer),Es.compose(lt.Chart),Zg.compose(lt.Axis),Sf.compose(lt.Chart),Ty.compose(lt.Series.types.pie),Tu.compose(lt.Chart,lt.Axis),mt.compose(lt.Chart),qw.compose(lt.Chart),Zp.compose(lt.Axis,lt.Chart,lt.Series),Ev.compose(lt.Axis,lt.Chart,lt.Series),Ud.compose(lt.Pointer),Zt.extend(lt,Zt);let Zw=lt;return Io.default})())});function II(n,r){return Object.is(n,r)}var io=null,ub=!1,M1=1,Na=Symbol("SIGNAL");function ni(n){let r=io;return io=n,r}function SI(){return io}var Im={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function hb(n){if(ub)throw new Error("");if(io===null)return;io.consumerOnSignalRead(n);let r=io.nextProducerIndex++;if(gb(io),r<io.producerNode.length&&io.producerNode[r]!==n&&qy(io)){let t=io.producerNode[r];mb(t,io.producerIndexOfThis[r])}io.producerNode[r]!==n&&(io.producerNode[r]=n,io.producerIndexOfThis[r]=qy(io)?PI(n,io,r):0),io.producerLastReadVersion[r]=n.version}function NF(){M1++}function AI(n){if(!(qy(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===M1)){if(!n.producerMustRecompute(n)&&!pb(n)){MI(n);return}n.producerRecomputeValue(n),MI(n)}}function kI(n){if(n.liveConsumerNode===void 0)return;let r=ub;ub=!0;try{for(let t of n.liveConsumerNode)t.dirty||zF(t)}finally{ub=r}}function RI(){return io?.consumerAllowSignalWrites!==!1}function zF(n){n.dirty=!0,kI(n),n.consumerMarkedDirty?.(n)}function MI(n){n.dirty=!1,n.lastCleanEpoch=M1}function Zy(n){return n&&(n.nextProducerIndex=0),ni(n)}function fb(n,r){if(ni(r),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(qy(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)mb(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function pb(n){gb(n);for(let r=0;r<n.producerNode.length;r++){let t=n.producerNode[r],a=n.producerLastReadVersion[r];if(a!==t.version||(AI(t),a!==t.version))return!0}return!1}function Xy(n){if(gb(n),qy(n))for(let r=0;r<n.producerNode.length;r++)mb(n.producerNode[r],n.producerIndexOfThis[r]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function PI(n,r,t){if(OI(n),n.liveConsumerNode.length===0&&LI(n))for(let a=0;a<n.producerNode.length;a++)n.producerIndexOfThis[a]=PI(n.producerNode[a],n,a);return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(r)-1}function mb(n,r){if(OI(n),n.liveConsumerNode.length===1&&LI(n))for(let a=0;a<n.producerNode.length;a++)mb(n.producerNode[a],n.producerIndexOfThis[a]);let t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[r]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[r]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,r<n.liveConsumerNode.length){let a=n.liveConsumerIndexOfThis[r],h=n.liveConsumerNode[r];gb(h),h.producerIndexOfThis[a]=r}}function qy(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function gb(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function OI(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function LI(n){return n.producerNode!==void 0}function FI(n){let r=Object.create(BF);r.computation=n;let t=()=>{if(AI(r),hb(r),r.value===db)throw r.error;return r.value};return t[Na]=r,t}var D1=Symbol("UNSET"),T1=Symbol("COMPUTING"),db=Symbol("ERRORED"),BF=vn(ht({},Im),{value:D1,dirty:!0,error:null,equal:II,kind:"computed",producerMustRecompute(n){return n.value===D1||n.value===T1},producerRecomputeValue(n){if(n.value===T1)throw new Error("Detected cycle in computations.");let r=n.value;n.value=T1;let t=Zy(n),a,h=!1;try{a=n.computation(),ni(null),h=r!==D1&&r!==db&&a!==db&&n.equal(r,a)}catch(i){a=db,n.error=i}finally{fb(n,t)}if(h){n.value=r;return}n.value=a,n.version++}});function VF(){throw new Error}var NI=VF;function zI(n){NI(n)}function BI(n){NI=n}var jF=null;function VI(n){let r=Object.create(I1);r.value=n;let t=()=>(hb(r),r.value);return t[Na]=r,t}function yb(n,r){RI()||zI(n),n.equal(n.value,r)||(n.value=r,UF(n))}function jI(n,r){RI()||zI(n),yb(n,r(n.value))}var I1=vn(ht({},Im),{equal:II,value:void 0,kind:"signal"});function UF(n){n.version++,NF(),kI(n),jF?.()}var S1;function Yy(){return S1}function Gu(n){let r=S1;return S1=n,r}var A1=Symbol("NotFound");function Bn(n){return typeof n=="function"}function Sm(n){let t=n(a=>{Error.call(a),a.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var _b=Sm(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((a,h)=>`${h+1}) ${a.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Lf(n,r){if(n){let t=n.indexOf(r);0<=t&&n.splice(t,1)}}var Pi=class n{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let i of t)i.remove(this);else t.remove(this);let{initialTeardown:a}=this;if(Bn(a))try{a()}catch(i){r=i instanceof _b?i.errors:[i]}let{_finalizers:h}=this;if(h){this._finalizers=null;for(let i of h)try{UI(i)}catch(C){r=r??[],C instanceof _b?r=[...r,...C.errors]:r.push(C)}}if(r)throw new _b(r)}}add(r){var t;if(r&&r!==this)if(this.closed)UI(r);else{if(r instanceof n){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(r)}}_hasParent(r){let{_parentage:t}=this;return t===r||Array.isArray(t)&&t.includes(r)}_addParent(r){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(r),t):t?[t,r]:r}_removeParent(r){let{_parentage:t}=this;t===r?this._parentage=null:Array.isArray(t)&&Lf(t,r)}remove(r){let{_finalizers:t}=this;t&&Lf(t,r),r instanceof n&&r._removeParent(this)}};Pi.EMPTY=(()=>{let n=new Pi;return n.closed=!0,n})();var k1=Pi.EMPTY;function vb(n){return n instanceof Pi||n&&"closed"in n&&Bn(n.remove)&&Bn(n.add)&&Bn(n.unsubscribe)}function UI(n){Bn(n)?n():n.unsubscribe()}var zl={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Am={setTimeout(n,r,...t){let{delegate:a}=Am;return a?.setTimeout?a.setTimeout(n,r,...t):setTimeout(n,r,...t)},clearTimeout(n){let{delegate:r}=Am;return(r?.clearTimeout||clearTimeout)(n)},delegate:void 0};function bb(n){Am.setTimeout(()=>{let{onUnhandledError:r}=zl;if(r)r(n);else throw n})}function Ff(){}var $I=R1("C",void 0,void 0);function HI(n){return R1("E",void 0,n)}function GI(n){return R1("N",n,void 0)}function R1(n,r,t){return{kind:n,value:r,error:t}}var Nf=null;function km(n){if(zl.useDeprecatedSynchronousErrorHandling){let r=!Nf;if(r&&(Nf={errorThrown:!1,error:null}),n(),r){let{errorThrown:t,error:a}=Nf;if(Nf=null,t)throw a}}else n()}function WI(n){zl.useDeprecatedSynchronousErrorHandling&&Nf&&(Nf.errorThrown=!0,Nf.error=n)}var zf=class extends Pi{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,vb(r)&&r.add(this)):this.destination=GF}static create(r,t,a){return new Wu(r,t,a)}next(r){this.isStopped?O1(GI(r),this):this._next(r)}error(r){this.isStopped?O1(HI(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?O1($I,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},$F=Function.prototype.bind;function P1(n,r){return $F.call(n,r)}var L1=class{constructor(r){this.partialObserver=r}next(r){let{partialObserver:t}=this;if(t.next)try{t.next(r)}catch(a){xb(a)}}error(r){let{partialObserver:t}=this;if(t.error)try{t.error(r)}catch(a){xb(a)}else xb(r)}complete(){let{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(t){xb(t)}}},Wu=class extends zf{constructor(r,t,a){super();let h;if(Bn(r)||!r)h={next:r??void 0,error:t??void 0,complete:a??void 0};else{let i;this&&zl.useDeprecatedNextContext?(i=Object.create(r),i.unsubscribe=()=>this.unsubscribe(),h={next:r.next&&P1(r.next,i),error:r.error&&P1(r.error,i),complete:r.complete&&P1(r.complete,i)}):h=r}this.destination=new L1(h)}};function xb(n){zl.useDeprecatedSynchronousErrorHandling?WI(n):bb(n)}function HF(n){throw n}function O1(n,r){let{onStoppedNotification:t}=zl;t&&Am.setTimeout(()=>t(n,r))}var GF={closed:!0,next:Ff,error:HF,complete:Ff};var Rm=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Mo(n){return n}function F1(...n){return N1(n)}function N1(n){return n.length===0?Mo:n.length===1?n[0]:function(t){return n.reduce((a,h)=>h(a),t)}}var Vn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let a=new n;return a.source=this,a.operator=t,a}subscribe(t,a,h){let i=qF(t)?t:new Wu(t,a,h);return km(()=>{let{operator:C,source:F}=this;i.add(C?C.call(i,F):F?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(t){try{return this._subscribe(t)}catch(a){t.error(a)}}forEach(t,a){return a=qI(a),new a((h,i)=>{let C=new Wu({next:F=>{try{t(F)}catch(V){i(V),C.unsubscribe()}},error:i,complete:h});this.subscribe(C)})}_subscribe(t){var a;return(a=this.source)===null||a===void 0?void 0:a.subscribe(t)}[Rm](){return this}pipe(...t){return N1(t)(this)}toPromise(t){return t=qI(t),new t((a,h)=>{let i;this.subscribe(C=>i=C,C=>h(C),()=>a(i))})}}return n.create=r=>new n(r),n})();function qI(n){var r;return(r=n??zl.Promise)!==null&&r!==void 0?r:Promise}function WF(n){return n&&Bn(n.next)&&Bn(n.error)&&Bn(n.complete)}function qF(n){return n&&n instanceof zf||WF(n)&&vb(n)}function z1(n){return Bn(n?.lift)}function zn(n){return r=>{if(z1(r))return r.lift(function(t){try{return n(t,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function Sn(n,r,t,a,h){return new B1(n,r,t,a,h)}var B1=class extends zf{constructor(r,t,a,h,i,C){super(r),this.onFinalize=i,this.shouldUnsubscribe=C,this._next=t?function(F){try{t(F)}catch(V){r.error(V)}}:super._next,this._error=h?function(F){try{h(F)}catch(V){r.error(V)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(F){r.error(F)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((r=this.onFinalize)===null||r===void 0||r.call(this))}}};function Pm(){return zn((n,r)=>{let t=null;n._refCount++;let a=Sn(r,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let h=n._connection,i=t;t=null,h&&(!i||h===i)&&h.unsubscribe(),r.unsubscribe()});n.subscribe(a),a.closed||(t=n.connect())})}var Om=class extends Vn{constructor(r,t){super(),this.source=r,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,z1(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){let r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new Pi;let t=this.getSubject();r.add(this.source.subscribe(Sn(t,void 0,()=>{this._teardown(),t.complete()},a=>{this._teardown(),t.error(a)},()=>this._teardown()))),r.closed&&(this._connection=null,r=Pi.EMPTY)}return r}refCount(){return Pm()(this)}};var ZI=Sm(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var jn=(()=>{class n extends Vn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let a=new wb(this,this);return a.operator=t,a}_throwIfClosed(){if(this.closed)throw new ZI}next(t){km(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let a of this.currentObservers)a.next(t)}})}error(t){km(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:a}=this;for(;a.length;)a.shift().error(t)}})}complete(){km(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:a,isStopped:h,observers:i}=this;return a||h?k1:(this.currentObservers=null,i.push(t),new Pi(()=>{this.currentObservers=null,Lf(i,t)}))}_checkFinalizedStatuses(t){let{hasError:a,thrownError:h,isStopped:i}=this;a?t.error(h):i&&t.complete()}asObservable(){let t=new Vn;return t.source=this,t}}return n.create=(r,t)=>new wb(r,t),n})(),wb=class extends jn{constructor(r,t){super(),this.destination=r,this.source=t}next(r){var t,a;(a=(t=this.destination)===null||t===void 0?void 0:t.next)===null||a===void 0||a.call(t,r)}error(r){var t,a;(a=(t=this.destination)===null||t===void 0?void 0:t.error)===null||a===void 0||a.call(t,r)}complete(){var r,t;(t=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||t===void 0||t.call(r)}_subscribe(r){var t,a;return(a=(t=this.source)===null||t===void 0?void 0:t.subscribe(r))!==null&&a!==void 0?a:k1}};var Dr=class extends jn{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){let t=super._subscribe(r);return!t.closed&&r.next(this._value),t}getValue(){let{hasError:r,thrownError:t,_value:a}=this;if(r)throw t;return this._throwIfClosed(),a}next(r){super.next(this._value=r)}};var V1={now(){return(V1.delegate||Date).now()},delegate:void 0};var Lm=class extends jn{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(r){let{hasError:t,_hasValue:a,_value:h,thrownError:i,isStopped:C,_isComplete:F}=this;t?r.error(i):(C||F)&&(a&&r.next(h),r.complete())}next(r){this.isStopped||(this._value=r,this._hasValue=!0)}complete(){let{_hasValue:r,_value:t,_isComplete:a}=this;a||(this._isComplete=!0,r&&super.next(t),super.complete())}};var Eb=class extends Pi{constructor(r,t){super()}schedule(r,t=0){return this}};var Ky={setInterval(n,r,...t){let{delegate:a}=Ky;return a?.setInterval?a.setInterval(n,r,...t):setInterval(n,r,...t)},clearInterval(n){let{delegate:r}=Ky;return(r?.clearInterval||clearInterval)(n)},delegate:void 0};var Fm=class extends Eb{constructor(r,t){super(r,t),this.scheduler=r,this.work=t,this.pending=!1}schedule(r,t=0){var a;if(this.closed)return this;this.state=r;let h=this.id,i=this.scheduler;return h!=null&&(this.id=this.recycleAsyncId(i,h,t)),this.pending=!0,this.delay=t,this.id=(a=this.id)!==null&&a!==void 0?a:this.requestAsyncId(i,this.id,t),this}requestAsyncId(r,t,a=0){return Ky.setInterval(r.flush.bind(r,this),a)}recycleAsyncId(r,t,a=0){if(a!=null&&this.delay===a&&this.pending===!1)return t;t!=null&&Ky.clearInterval(t)}execute(r,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let a=this._execute(r,t);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(r,t){let a=!1,h;try{this.work(r)}catch(i){a=!0,h=i||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){let{id:r,scheduler:t}=this,{actions:a}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Lf(a,this),r!=null&&(this.id=this.recycleAsyncId(t,r,null)),this.delay=null,super.unsubscribe()}}};var Nm=class n{constructor(r,t=n.now){this.schedulerActionCtor=r,this.now=t}schedule(r,t=0,a){return new this.schedulerActionCtor(this,r).schedule(a,t)}};Nm.now=V1.now;var zm=class extends Nm{constructor(r,t=Nm.now){super(r,t),this.actions=[],this._active=!1}flush(r){let{actions:t}=this;if(this._active){t.push(r);return}let a;this._active=!0;do if(a=r.execute(r.state,r.delay))break;while(r=t.shift());if(this._active=!1,a){for(;r=t.shift();)r.unsubscribe();throw a}}};var Qy=new zm(Fm),XI=Qy;var Cb=class extends Fm{constructor(r,t){super(r,t),this.scheduler=r,this.work=t}schedule(r,t=0){return t>0?super.schedule(r,t):(this.delay=t,this.state=r,this.scheduler.flush(this),this)}execute(r,t){return t>0||this.closed?super.execute(r,t):this._execute(r,t)}requestAsyncId(r,t,a=0){return a!=null&&a>0||a==null&&this.delay>0?super.requestAsyncId(r,t,a):(r.flush(this),0)}};var Db=class extends zm{};var j1=new Db(Cb);var Bo=new Vn(n=>n.complete());function Tb(n){return n&&Bn(n.schedule)}function U1(n){return n[n.length-1]}function Bm(n){return Bn(U1(n))?n.pop():void 0}function Oc(n){return Tb(U1(n))?n.pop():void 0}function YI(n,r){return typeof U1(n)=="number"?n.pop():r}function QI(n,r,t,a){function h(i){return i instanceof t?i:new t(function(C){C(i)})}return new(t||(t=Promise))(function(i,C){function F(oe){try{K(a.next(oe))}catch(Ee){C(Ee)}}function V(oe){try{K(a.throw(oe))}catch(Ee){C(Ee)}}function K(oe){oe.done?i(oe.value):h(oe.value).then(F,V)}K((a=a.apply(n,r||[])).next())})}function KI(n){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&n[r],a=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bf(n){return this instanceof Bf?(this.v=n,this):new Bf(n)}function JI(n,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=t.apply(n,r||[]),h,i=[];return h=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),F("next"),F("throw"),F("return",C),h[Symbol.asyncIterator]=function(){return this},h;function C(Ne){return function(ct){return Promise.resolve(ct).then(Ne,Ee)}}function F(Ne,ct){a[Ne]&&(h[Ne]=function(bt){return new Promise(function(Ut,Qt){i.push([Ne,bt,Ut,Qt])>1||V(Ne,bt)})},ct&&(h[Ne]=ct(h[Ne])))}function V(Ne,ct){try{K(a[Ne](ct))}catch(bt){Ye(i[0][3],bt)}}function K(Ne){Ne.value instanceof Bf?Promise.resolve(Ne.value.v).then(oe,Ee):Ye(i[0][2],Ne)}function oe(Ne){V("next",Ne)}function Ee(Ne){V("throw",Ne)}function Ye(Ne,ct){Ne(ct),i.shift(),i.length&&V(i[0][0],i[0][1])}}function eS(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n[Symbol.asyncIterator],t;return r?r.call(n):(n=typeof KI=="function"?KI(n):n[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(i){t[i]=n[i]&&function(C){return new Promise(function(F,V){C=n[i](C),h(F,V,C.done,C.value)})}}function h(i,C,F,V){Promise.resolve(V).then(function(K){i({value:K,done:F})},C)}}var Mb=n=>n&&typeof n.length=="number"&&typeof n!="function";function Ib(n){return Bn(n?.then)}function Sb(n){return Bn(n[Rm])}function Ab(n){return Symbol.asyncIterator&&Bn(n?.[Symbol.asyncIterator])}function kb(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function ZF(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Rb=ZF();function Pb(n){return Bn(n?.[Rb])}function Ob(n){return JI(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:a,done:h}=yield Bf(t.read());if(h)return yield Bf(void 0);yield yield Bf(a)}}finally{t.releaseLock()}})}function Lb(n){return Bn(n?.getReader)}function zi(n){if(n instanceof Vn)return n;if(n!=null){if(Sb(n))return XF(n);if(Mb(n))return YF(n);if(Ib(n))return KF(n);if(Ab(n))return tS(n);if(Pb(n))return QF(n);if(Lb(n))return JF(n)}throw kb(n)}function XF(n){return new Vn(r=>{let t=n[Rm]();if(Bn(t.subscribe))return t.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function YF(n){return new Vn(r=>{for(let t=0;t<n.length&&!r.closed;t++)r.next(n[t]);r.complete()})}function KF(n){return new Vn(r=>{n.then(t=>{r.closed||(r.next(t),r.complete())},t=>r.error(t)).then(null,bb)})}function QF(n){return new Vn(r=>{for(let t of n)if(r.next(t),r.closed)return;r.complete()})}function tS(n){return new Vn(r=>{eN(n,r).catch(t=>r.error(t))})}function JF(n){return tS(Ob(n))}function eN(n,r){var t,a,h,i;return QI(this,void 0,void 0,function*(){try{for(t=eS(n);a=yield t.next(),!a.done;){let C=a.value;if(r.next(C),r.closed)return}}catch(C){h={error:C}}finally{try{a&&!a.done&&(i=t.return)&&(yield i.call(t))}finally{if(h)throw h.error}}r.complete()})}function ks(n,r,t,a=0,h=!1){let i=r.schedule(function(){t(),h?n.add(this.schedule(null,a)):this.unsubscribe()},a);if(n.add(i),!h)return i}function Vf(n,r=0){return zn((t,a)=>{t.subscribe(Sn(a,h=>ks(a,n,()=>a.next(h),r),()=>ks(a,n,()=>a.complete(),r),h=>ks(a,n,()=>a.error(h),r)))})}function Fb(n,r=0){return zn((t,a)=>{a.add(n.schedule(()=>t.subscribe(a),r))})}function nS(n,r){return zi(n).pipe(Fb(r),Vf(r))}function iS(n,r){return zi(n).pipe(Fb(r),Vf(r))}function rS(n,r){return new Vn(t=>{let a=0;return r.schedule(function(){a===n.length?t.complete():(t.next(n[a++]),t.closed||this.schedule())})})}function oS(n,r){return new Vn(t=>{let a;return ks(t,r,()=>{a=n[Rb](),ks(t,r,()=>{let h,i;try{({value:h,done:i}=a.next())}catch(C){t.error(C);return}i?t.complete():t.next(h)},0,!0)}),()=>Bn(a?.return)&&a.return()})}function Nb(n,r){if(!n)throw new Error("Iterable cannot be null");return new Vn(t=>{ks(t,r,()=>{let a=n[Symbol.asyncIterator]();ks(t,r,()=>{a.next().then(h=>{h.done?t.complete():t.next(h.value)})},0,!0)})})}function sS(n,r){return Nb(Ob(n),r)}function aS(n,r){if(n!=null){if(Sb(n))return nS(n,r);if(Mb(n))return rS(n,r);if(Ib(n))return iS(n,r);if(Ab(n))return Nb(n,r);if(Pb(n))return oS(n,r);if(Lb(n))return sS(n,r)}throw kb(n)}function ur(n,r){return r?aS(n,r):zi(n)}function nn(...n){let r=Oc(n);return ur(n,r)}function ch(n,r){let t=Bn(n)?n:()=>n,a=h=>h.error(t());return new Vn(r?h=>r.schedule(a,0,h):a)}function Jy(n){return!!n&&(n instanceof Vn||Bn(n.lift)&&Bn(n.subscribe))}var Bl=Sm(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function $1(n,r){let t=typeof r=="object";return new Promise((a,h)=>{let i=!1,C;n.subscribe({next:F=>{C=F,i=!0},error:h,complete:()=>{i?a(C):t?a(r.defaultValue):h(new Bl)}})})}function lS(n){return n instanceof Date&&!isNaN(n)}function ln(n,r){return zn((t,a)=>{let h=0;t.subscribe(Sn(a,i=>{a.next(n.call(r,i,h++))}))})}var{isArray:tN}=Array;function nN(n,r){return tN(r)?n(...r):n(r)}function zb(n){return ln(r=>nN(n,r))}var{isArray:iN}=Array,{getPrototypeOf:rN,prototype:oN,keys:sN}=Object;function Bb(n){if(n.length===1){let r=n[0];if(iN(r))return{args:r,keys:null};if(aN(r)){let t=sN(r);return{args:t.map(a=>r[a]),keys:t}}}return{args:n,keys:null}}function aN(n){return n&&typeof n=="object"&&rN(n)===oN}function Vb(n,r){return n.reduce((t,a,h)=>(t[a]=r[h],t),{})}function jf(...n){let r=Oc(n),t=Bm(n),{args:a,keys:h}=Bb(n);if(a.length===0)return ur([],r);let i=new Vn(lN(a,r,h?C=>Vb(h,C):Mo));return t?i.pipe(zb(t)):i}function lN(n,r,t=Mo){return a=>{cS(r,()=>{let{length:h}=n,i=new Array(h),C=h,F=h;for(let V=0;V<h;V++)cS(r,()=>{let K=ur(n[V],r),oe=!1;K.subscribe(Sn(a,Ee=>{i[V]=Ee,oe||(oe=!0,F--),F||a.next(t(i.slice()))},()=>{--C||a.complete()}))},a)},a)}}function cS(n,r,t){n?ks(t,n,r):r()}function uS(n,r,t,a,h,i,C,F){let V=[],K=0,oe=0,Ee=!1,Ye=()=>{Ee&&!V.length&&!K&&r.complete()},Ne=bt=>K<a?ct(bt):V.push(bt),ct=bt=>{i&&r.next(bt),K++;let Ut=!1;zi(t(bt,oe++)).subscribe(Sn(r,Qt=>{h?.(Qt),i?Ne(Qt):r.next(Qt)},()=>{Ut=!0},void 0,()=>{if(Ut)try{for(K--;V.length&&K<a;){let Qt=V.shift();C?ks(r,C,()=>ct(Qt)):ct(Qt)}Ye()}catch(Qt){r.error(Qt)}}))};return n.subscribe(Sn(r,Ne,()=>{Ee=!0,Ye()})),()=>{F?.()}}function Xr(n,r,t=1/0){return Bn(r)?Xr((a,h)=>ln((i,C)=>r(a,i,h,C))(zi(n(a,h))),t):(typeof r=="number"&&(t=r),zn((a,h)=>uS(a,h,n,t)))}function uh(n=1/0){return Xr(Mo,n)}function dS(){return uh(1)}function dh(...n){return dS()(ur(n,Oc(n)))}function jb(n){return new Vn(r=>{zi(n()).subscribe(r)})}function H1(...n){let r=Bm(n),{args:t,keys:a}=Bb(n),h=new Vn(i=>{let{length:C}=t;if(!C){i.complete();return}let F=new Array(C),V=C,K=C;for(let oe=0;oe<C;oe++){let Ee=!1;zi(t[oe]).subscribe(Sn(i,Ye=>{Ee||(Ee=!0,K--),F[oe]=Ye},()=>V--,void 0,()=>{(!V||!Ee)&&(K||i.next(a?Vb(a,F):F),i.complete())}))}});return r?h.pipe(zb(r)):h}function hS(n=0,r,t=XI){let a=-1;return r!=null&&(Tb(r)?t=r:a=r),new Vn(h=>{let i=lS(n)?+n-t.now():n;i<0&&(i=0);let C=0;return t.schedule(function(){h.closed||(h.next(C++),0<=a?this.schedule(void 0,a):h.complete())},i)})}function Ub(...n){let r=Oc(n),t=YI(n,1/0),a=n;return a.length?a.length===1?zi(a[0]):uh(t)(ur(a,r)):Bo}function Pr(n,r){return zn((t,a)=>{let h=0;t.subscribe(Sn(a,i=>n.call(r,i,h++)&&a.next(i)))})}function fS(n){return zn((r,t)=>{let a=!1,h=null,i=null,C=!1,F=()=>{if(i?.unsubscribe(),i=null,a){a=!1;let K=h;h=null,t.next(K)}C&&t.complete()},V=()=>{i=null,C&&t.complete()};r.subscribe(Sn(t,K=>{a=!0,h=K,i||zi(n(K)).subscribe(i=Sn(t,F,V))},()=>{C=!0,(!a||!i||i.closed)&&t.complete()}))})}function $b(n,r=Qy){return fS(()=>hS(n,r))}function Lc(n){return zn((r,t)=>{let a=null,h=!1,i;a=r.subscribe(Sn(t,void 0,void 0,C=>{i=zi(n(C,Lc(n)(r))),a?(a.unsubscribe(),a=null,i.subscribe(t)):h=!0})),h&&(a.unsubscribe(),a=null,i.subscribe(t))})}function pS(n,r,t,a,h){return(i,C)=>{let F=t,V=r,K=0;i.subscribe(Sn(C,oe=>{let Ee=K++;V=F?n(V,oe,Ee):(F=!0,oe),a&&C.next(V)},h&&(()=>{F&&C.next(V),C.complete()})))}}function qu(n,r){return Bn(r)?Xr(n,r,1):Xr(n,1)}function e_(n,r=Qy){return zn((t,a)=>{let h=null,i=null,C=null,F=()=>{if(h){h.unsubscribe(),h=null;let K=i;i=null,a.next(K)}};function V(){let K=C+n,oe=r.now();if(oe<K){h=this.schedule(void 0,K-oe),a.add(h);return}F()}t.subscribe(Sn(a,K=>{i=K,C=r.now(),h||(h=r.schedule(V,n),a.add(h))},()=>{F(),a.complete()},void 0,()=>{i=h=null}))})}function hh(n){return zn((r,t)=>{let a=!1;r.subscribe(Sn(t,h=>{a=!0,t.next(h)},()=>{a||t.next(n),t.complete()}))})}function ss(n){return n<=0?()=>Bo:zn((r,t)=>{let a=0;r.subscribe(Sn(t,h=>{++a<=n&&(t.next(h),n<=a&&t.complete())}))})}function Vm(n,r=Mo){return n=n??cN,zn((t,a)=>{let h,i=!0;t.subscribe(Sn(a,C=>{let F=r(C);(i||!n(h,F))&&(i=!1,h=F,a.next(C))}))})}function cN(n,r){return n===r}function Hb(n=uN){return zn((r,t)=>{let a=!1;r.subscribe(Sn(t,h=>{a=!0,t.next(h)},()=>a?t.complete():t.error(n())))})}function uN(){return new Bl}function Fc(n){return zn((r,t)=>{try{r.subscribe(t)}finally{t.add(n)}})}function Vl(n,r){let t=arguments.length>=2;return a=>a.pipe(n?Pr((h,i)=>n(h,i,a)):Mo,ss(1),t?hh(r):Hb(()=>new Bl))}function jm(n){return n<=0?()=>Bo:zn((r,t)=>{let a=[];r.subscribe(Sn(t,h=>{a.push(h),n<a.length&&a.shift()},()=>{for(let h of a)t.next(h);t.complete()},void 0,()=>{a=null}))})}function G1(n,r){let t=arguments.length>=2;return a=>a.pipe(n?Pr((h,i)=>n(h,i,a)):Mo,jm(1),t?hh(r):Hb(()=>new Bl))}function W1(...n){let r=n.length;if(r===0)throw new Error("list of properties cannot be empty.");return ln(t=>{let a=t;for(let h=0;h<r;h++){let i=a?.[n[h]];if(typeof i<"u")a=i;else return}return a})}function t_(n,r){return zn(pS(n,r,arguments.length>=2,!0))}function Z1(n={}){let{connector:r=()=>new jn,resetOnError:t=!0,resetOnComplete:a=!0,resetOnRefCountZero:h=!0}=n;return i=>{let C,F,V,K=0,oe=!1,Ee=!1,Ye=()=>{F?.unsubscribe(),F=void 0},Ne=()=>{Ye(),C=V=void 0,oe=Ee=!1},ct=()=>{let bt=C;Ne(),bt?.unsubscribe()};return zn((bt,Ut)=>{K++,!Ee&&!oe&&Ye();let Qt=V=V??r();Ut.add(()=>{K--,K===0&&!Ee&&!oe&&(F=q1(ct,h))}),Qt.subscribe(Ut),!C&&K>0&&(C=new Wu({next:yi=>Qt.next(yi),error:yi=>{Ee=!0,Ye(),F=q1(Ne,t,yi),Qt.error(yi)},complete:()=>{oe=!0,Ye(),F=q1(Ne,a),Qt.complete()}}),zi(bt).subscribe(C))})(i)}}function q1(n,r,...t){if(r===!0){n();return}if(r===!1)return;let a=new Wu({next:()=>{a.unsubscribe(),n()}});return zi(r(...t)).subscribe(a)}function n_(n){return Pr((r,t)=>n<=t)}function Uf(...n){let r=Oc(n);return zn((t,a)=>{(r?dh(n,t,r):dh(n,t)).subscribe(a)})}function Vo(n,r){return zn((t,a)=>{let h=null,i=0,C=!1,F=()=>C&&!h&&a.complete();t.subscribe(Sn(a,V=>{h?.unsubscribe();let K=0,oe=i++;zi(n(V,oe)).subscribe(h=Sn(a,Ee=>a.next(r?r(V,Ee,oe,K++):Ee),()=>{h=null,F()}))},()=>{C=!0,F()}))})}function ro(n){return zn((r,t)=>{zi(n).subscribe(Sn(t,()=>t.complete(),Ff)),!t.closed&&r.subscribe(t)})}function gr(n,r,t){let a=Bn(n)||r||t?{next:n,error:r,complete:t}:n;return a?zn((h,i)=>{var C;(C=a.subscribe)===null||C===void 0||C.call(a);let F=!0;h.subscribe(Sn(i,V=>{var K;(K=a.next)===null||K===void 0||K.call(a,V),i.next(V)},()=>{var V;F=!1,(V=a.complete)===null||V===void 0||V.call(a),i.complete()},V=>{var K;F=!1,(K=a.error)===null||K===void 0||K.call(a,V),i.error(V)},()=>{var V,K;F&&((V=a.unsubscribe)===null||V===void 0||V.call(a)),(K=a.finalize)===null||K===void 0||K.call(a)}))}):Mo}function X1(...n){let r=Bm(n);return zn((t,a)=>{let h=n.length,i=new Array(h),C=n.map(()=>!1),F=!1;for(let V=0;V<h;V++)zi(n[V]).subscribe(Sn(a,K=>{i[V]=K,!F&&!C[V]&&(C[V]=!0,(F=C.every(Mo))&&(C=null))},Ff));t.subscribe(Sn(a,V=>{if(F){let K=[V,...i];a.next(r?r(...K):K)}}))})}var iA="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",Wt=class extends Error{code;constructor(r,t){super(g_(r,t)),this.code=r}};function g_(n,r){return`${`NG0${Math.abs(n)}`}${r?": "+r:""}`}var rA=Symbol("InputSignalNode#UNSET"),dN=vn(ht({},I1),{transformFn:void 0,applyValueToInputSignal(n,r){yb(n,r)}});function oA(n,r){let t=Object.create(dN);t.value=n,t.transformFn=r?.transform;function a(){if(hb(t),t.value===rA)throw new Wt(-950,!1);return t.value}return a[Na]=t,a}function y_(n){return{toString:n}.toString()}var Gb="__parameters__";function hN(n){return function(...t){if(n){let a=n(...t);for(let h in a)this[h]=a[h]}}}function fN(n,r,t){return y_(()=>{let a=hN(r);function h(...i){if(this instanceof h)return a.apply(this,i),this;let C=new h(...i);return F.annotation=C,F;function F(V,K,oe){let Ee=V.hasOwnProperty(Gb)?V[Gb]:Object.defineProperty(V,Gb,{value:[]})[Gb];for(;Ee.length<=oe;)Ee.push(null);return(Ee[oe]=Ee[oe]||[]).push(C),V}}return h.prototype.ngMetadataName=n,h.annotationCls=h,h})}var $l=globalThis;function Zi(n){for(let r in n)if(n[r]===Zi)return r;throw Error("Could not find renamed property on target object.")}function Rs(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(Rs).join(", ")}]`;if(n==null)return""+n;let r=n.overriddenName||n.name;if(r)return`${r}`;let t=n.toString();if(t==null)return""+t;let a=t.indexOf(`
`);return a>=0?t.slice(0,a):t}function lE(n,r){return n?r?`${n} ${r}`:n:r||""}var pN=Zi({__forward_ref__:Zi});function tp(n){return n.__forward_ref__=tp,n.toString=function(){return Rs(this())},n}function as(n){return sA(n)?n():n}function sA(n){return typeof n=="function"&&n.hasOwnProperty(pN)&&n.__forward_ref__===tp}function Ct(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function en(n){return{providers:n.providers||[],imports:n.imports||[]}}function k0(n){return mS(n,lA)||mS(n,cA)}function aA(n){return k0(n)!==null}function mS(n,r){return n.hasOwnProperty(r)?n[r]:null}function mN(n){let r=n&&(n[lA]||n[cA]);return r||null}function gS(n){return n&&(n.hasOwnProperty(yS)||n.hasOwnProperty(gN))?n[yS]:null}var lA=Zi({\u0275prov:Zi}),yS=Zi({\u0275inj:Zi}),cA=Zi({ngInjectableDef:Zi}),gN=Zi({ngInjectorDef:Zi}),pt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(r,t){this._desc=r,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=Ct({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function uA(n){return n&&!!n.\u0275providers}var yN=Zi({\u0275cmp:Zi}),_N=Zi({\u0275dir:Zi}),vN=Zi({\u0275pipe:Zi}),bN=Zi({\u0275mod:Zi}),t0=Zi({\u0275fac:Zi}),s_=Zi({__NG_ELEMENT_ID__:Zi}),_S=Zi({__NG_ENV_ID__:Zi});function Zm(n){return typeof n=="string"?n:n==null?"":String(n)}function xN(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Zm(n)}function dA(n,r){throw new Wt(-200,n)}function rC(n,r){throw new Wt(-201,!1)}var Kn=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Kn||{}),cE;function hA(){return cE}function za(n){let r=cE;return cE=n,r}function fA(n,r,t){let a=k0(n);if(a&&a.providedIn=="root")return a.value===void 0?a.value=a.factory():a.value;if(t&Kn.Optional)return null;if(r!==void 0)return r;rC(n,"Injector")}var wN={},$f=wN,uE="__NG_DI_FLAG__",n0=class{injector;constructor(r){this.injector=r}retrieve(r,t){let a=t;return this.injector.get(r,a.optional?A1:$f,a)}},i0="ngTempTokenPath",EN="ngTokenPath",CN=/\n/gm,DN="\u0275",vS="__source";function TN(n,r=Kn.Default){if(Yy()===void 0)throw new Wt(-203,!1);if(Yy()===null)return fA(n,void 0,r);{let t=Yy(),a;return t instanceof n0?a=t.injector:a=t,a.get(n,r&Kn.Optional?null:void 0,r)}}function kt(n,r=Kn.Default){return(hA()||TN)(as(n),r)}function Re(n,r=Kn.Default){return kt(n,R0(r))}function R0(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function dE(n){let r=[];for(let t=0;t<n.length;t++){let a=as(n[t]);if(Array.isArray(a)){if(a.length===0)throw new Wt(900,!1);let h,i=Kn.Default;for(let C=0;C<a.length;C++){let F=a[C],V=IN(F);typeof V=="number"?V===-1?h=F.token:i|=V:h=F}r.push(kt(h,i))}else r.push(kt(a))}return r}function MN(n,r){return n[uE]=r,n.prototype[uE]=r,n}function IN(n){return n[uE]}function SN(n,r,t,a){let h=n[i0];throw r[vS]&&h.unshift(r[vS]),n.message=AN(`
`+n.message,h,t,a),n[EN]=h,n[i0]=null,n}function AN(n,r,t,a=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==DN?n.slice(2):n;let h=Rs(r);if(Array.isArray(r))h=r.map(Rs).join(" -> ");else if(typeof r=="object"){let i=[];for(let C in r)if(r.hasOwnProperty(C)){let F=r[C];i.push(C+":"+(typeof F=="string"?JSON.stringify(F):Rs(F)))}h=`{${i.join(", ")}}`}return`${t}${a?"("+a+")":""}[${h}]: ${n.replace(CN,`
  `)}`}var P0=MN(fN("Inject",n=>({token:n})),-1);function Xm(n,r){let t=n.hasOwnProperty(t0);return t?n[t0]:null}function kN(n,r,t){if(n.length!==r.length)return!1;for(let a=0;a<n.length;a++){let h=n[a],i=r[a];if(t&&(h=t(h),i=t(i)),i!==h)return!1}return!0}function RN(n){return n.flat(Number.POSITIVE_INFINITY)}function oC(n,r){n.forEach(t=>Array.isArray(t)?oC(t,r):r(t))}function pA(n,r,t){r>=n.length?n.push(t):n.splice(r,0,t)}function r0(n,r){return r>=n.length-1?n.pop():n.splice(r,1)[0]}function PN(n,r){let t=[];for(let a=0;a<n;a++)t.push(r);return t}function ON(n,r,t,a){let h=n.length;if(h==r)n.push(t,a);else if(h===1)n.push(a,n[0]),n[0]=t;else{for(h--,n.push(n[h-1],n[h]);h>r;){let i=h-2;n[h]=n[i],h--}n[r]=t,n[r+1]=a}}function O0(n,r,t){let a=__(n,r);return a>=0?n[a|1]=t:(a=~a,ON(n,a,r,t)),a}function Y1(n,r){let t=__(n,r);if(t>=0)return n[t|1]}function __(n,r){return LN(n,r,1)}function LN(n,r,t){let a=0,h=n.length>>t;for(;h!==a;){let i=a+(h-a>>1),C=n[i<<t];if(r===C)return i<<t;C>r?h=i:a=i+1}return~(h<<t)}var Ym={},la=[],Gf=new pt(""),mA=new pt("",-1),gA=new pt(""),o0=class{get(r,t=$f){if(t===$f){let a=new Error(`NullInjectorError: No provider for ${Rs(r)}!`);throw a.name="NullInjectorError",a}return t}};function yA(n,r){let t=n[bN]||null;if(!t&&r===!0)throw new Error(`Type ${Rs(n)} does not have '\u0275mod' property.`);return t}function mh(n){return n[yN]||null}function FN(n){return n[_N]||null}function NN(n){return n[vN]||null}function v_(n){return{\u0275providers:n}}function zN(...n){return{\u0275providers:_A(!0,n),\u0275fromNgModule:!0}}function _A(n,...r){let t=[],a=new Set,h,i=C=>{t.push(C)};return oC(r,C=>{let F=C;hE(F,i,[],a)&&(h||=[],h.push(F))}),h!==void 0&&vA(h,i),t}function vA(n,r){for(let t=0;t<n.length;t++){let{ngModule:a,providers:h}=n[t];sC(h,i=>{r(i,a)})}}function hE(n,r,t,a){if(n=as(n),!n)return!1;let h=null,i=gS(n),C=!i&&mh(n);if(!i&&!C){let V=n.ngModule;if(i=gS(V),i)h=V;else return!1}else{if(C&&!C.standalone)return!1;h=n}let F=a.has(h);if(C){if(F)return!1;if(a.add(h),C.dependencies){let V=typeof C.dependencies=="function"?C.dependencies():C.dependencies;for(let K of V)hE(K,r,t,a)}}else if(i){if(i.imports!=null&&!F){a.add(h);let K;try{oC(i.imports,oe=>{hE(oe,r,t,a)&&(K||=[],K.push(oe))})}finally{}K!==void 0&&vA(K,r)}if(!F){let K=Xm(h)||(()=>new h);r({provide:h,useFactory:K,deps:la},h),r({provide:gA,useValue:h,multi:!0},h),r({provide:Gf,useValue:()=>kt(h),multi:!0},h)}let V=i.providers;if(V!=null&&!F){let K=n;sC(V,oe=>{r(oe,K)})}}else return!1;return h!==n&&n.providers!==void 0}function sC(n,r){for(let t of n)uA(t)&&(t=t.\u0275providers),Array.isArray(t)?sC(t,r):r(t)}var BN=Zi({provide:String,useValue:Zi});function bA(n){return n!==null&&typeof n=="object"&&BN in n}function VN(n){return!!(n&&n.useExisting)}function jN(n){return!!(n&&n.useFactory)}function Km(n){return typeof n=="function"}function UN(n){return!!n.useClass}var L0=new pt(""),Yb={},bS={},K1;function F0(){return K1===void 0&&(K1=new o0),K1}var Nr=class{},l_=class extends Nr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(r,t,a,h){super(),this.parent=t,this.source=a,this.scopes=h,pE(r,C=>this.processProvider(C)),this.records.set(mA,Um(void 0,this)),h.has("environment")&&this.records.set(Nr,Um(void 0,this));let i=this.records.get(L0);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(gA,la,Kn.Self))}retrieve(r,t){let a=t;return this.get(r,a.optional?A1:$f,a)}destroy(){r_(this),this._destroyed=!0;let r=ni(null);try{for(let a of this._ngOnDestroyHooks)a.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let a of t)a()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ni(r)}}onDestroy(r){return r_(this),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){r_(this);let t=Gu(this),a=za(void 0),h;try{return r()}finally{Gu(t),za(a)}}get(r,t=$f,a=Kn.Default){if(r_(this),r.hasOwnProperty(_S))return r[_S](this);a=R0(a);let h,i=Gu(this),C=za(void 0);try{if(!(a&Kn.SkipSelf)){let V=this.records.get(r);if(V===void 0){let K=qN(r)&&k0(r);K&&this.injectableDefInScope(K)?V=Um(fE(r),Yb):V=null,this.records.set(r,V)}if(V!=null)return this.hydrate(r,V)}let F=a&Kn.Self?F0():this.parent;return t=a&Kn.Optional&&t===$f?null:t,F.get(r,t)}catch(F){if(F.name==="NullInjectorError"){if((F[i0]=F[i0]||[]).unshift(Rs(r)),i)throw F;return SN(F,r,"R3InjectorError",this.source)}else throw F}finally{za(C),Gu(i)}}resolveInjectorInitializers(){let r=ni(null),t=Gu(this),a=za(void 0),h;try{let i=this.get(Gf,la,Kn.Self);for(let C of i)C()}finally{Gu(t),za(a),ni(r)}}toString(){let r=[],t=this.records;for(let a of t.keys())r.push(Rs(a));return`R3Injector[${r.join(", ")}]`}processProvider(r){r=as(r);let t=Km(r)?r:as(r&&r.provide),a=HN(r);if(!Km(r)&&r.multi===!0){let h=this.records.get(t);h||(h=Um(void 0,Yb,!0),h.factory=()=>dE(h.multi),this.records.set(t,h)),t=r,h.multi.push(r)}this.records.set(t,a)}hydrate(r,t){let a=ni(null);try{return t.value===bS?dA(Rs(r)):t.value===Yb&&(t.value=bS,t.value=t.factory()),typeof t.value=="object"&&t.value&&WN(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{ni(a)}}injectableDefInScope(r){if(!r.providedIn)return!1;let t=as(r.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(r){let t=this._onDestroyHooks.indexOf(r);t!==-1&&this._onDestroyHooks.splice(t,1)}};function fE(n){let r=k0(n),t=r!==null?r.factory:Xm(n);if(t!==null)return t;if(n instanceof pt)throw new Wt(204,!1);if(n instanceof Function)return $N(n);throw new Wt(204,!1)}function $N(n){if(n.length>0)throw new Wt(204,!1);let t=mN(n);return t!==null?()=>t.factory(n):()=>new n}function HN(n){if(bA(n))return Um(void 0,n.useValue);{let r=xA(n);return Um(r,Yb)}}function xA(n,r,t){let a;if(Km(n)){let h=as(n);return Xm(h)||fE(h)}else if(bA(n))a=()=>as(n.useValue);else if(jN(n))a=()=>n.useFactory(...dE(n.deps||[]));else if(VN(n))a=()=>kt(as(n.useExisting));else{let h=as(n&&(n.useClass||n.provide));if(GN(n))a=()=>new h(...dE(n.deps));else return Xm(h)||fE(h)}return a}function r_(n){if(n.destroyed)throw new Wt(205,!1)}function Um(n,r,t=!1){return{factory:n,value:r,multi:t?[]:void 0}}function GN(n){return!!n.deps}function WN(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function qN(n){return typeof n=="function"||typeof n=="object"&&n instanceof pt}function pE(n,r){for(let t of n)Array.isArray(t)?pE(t,r):t&&uA(t)?pE(t.\u0275providers,r):r(t)}function Ns(n,r){let t;n instanceof l_?(r_(n),t=n):t=new n0(n);let a,h=Gu(t),i=za(void 0);try{return r()}finally{Gu(h),za(i)}}function wA(){return hA()!==void 0||Yy()!=null}function ng(n){if(!wA())throw new Wt(-203,!1)}function ZN(n){let r=$l.ng;if(r&&r.\u0275compilerFacade)return r.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function XN(n){return typeof n=="function"}var Ju=0,Qn=1,Ln=2,jo=3,Ul=4,zs=5,c_=6,s0=7,ls=8,u_=9,Zu=10,Yr=11,d_=12,xS=13,ig=14,Va=15,Wf=16,$m=17,Xu=18,N0=19,EA=20,fh=21,Q1=22,qf=23,Ba=24,Wm=25,Os=26,CA=1;var Zf=7,a0=8,Qm=9,Ps=10;function ph(n){return Array.isArray(n)&&typeof n[CA]=="object"}function ed(n){return Array.isArray(n)&&n[CA]===!0}function DA(n){return(n.flags&4)!==0}function rg(n){return n.componentOffset>-1}function aC(n){return(n.flags&1)===1}function _h(n){return!!n.template}function l0(n){return(n[Ln]&512)!==0}function b_(n){return(n[Ln]&256)===256}var mE=class{previousValue;currentValue;firstChange;constructor(r,t,a){this.previousValue=r,this.currentValue=t,this.firstChange=a}isFirstChange(){return this.firstChange}};function TA(n,r,t,a){r!==null?r.applyValueToInputSignal(r,a):n[t]=a}var cs=(()=>{let n=()=>MA;return n.ngInherit=!0,n})();function MA(n){return n.type.prototype.ngOnChanges&&(n.setInput=KN),YN}function YN(){let n=SA(this),r=n?.current;if(r){let t=n.previous;if(t===Ym)n.previous=r;else for(let a in r)t[a]=r[a];n.current=null,this.ngOnChanges(r)}}function KN(n,r,t,a,h){let i=this.declaredInputs[a],C=SA(n)||QN(n,{previous:Ym,current:null}),F=C.current||(C.current={}),V=C.previous,K=V[i];F[i]=new mE(K&&K.currentValue,t,V===Ym),TA(n,r,h,t)}var IA="__ngSimpleChanges__";function SA(n){return n[IA]||null}function QN(n,r){return n[IA]=r}var wS=null;var ir=function(n,r=null,t){wS?.(n,r,t)},AA="svg",JN="math";function zc(n){for(;Array.isArray(n);)n=n[Ju];return n}function kA(n,r){return zc(r[n])}function Uc(n,r){return zc(r[n.index])}function lC(n,r){return n.data[r]}function ez(n,r){return n[r]}function Bc(n,r){let t=r[n];return ph(t)?t:t[Ju]}function tz(n){return(n[Ln]&4)===4}function cC(n){return(n[Ln]&128)===128}function nz(n){return ed(n[jo])}function c0(n,r){return r==null?null:n[r]}function RA(n){n[$m]=0}function PA(n){n[Ln]&1024||(n[Ln]|=1024,cC(n)&&og(n))}function iz(n,r){for(;n>0;)r=r[ig],n--;return r}function z0(n){return!!(n[Ln]&9216||n[Ba]?.dirty)}function gE(n){n[Zu].changeDetectionScheduler?.notify(8),n[Ln]&64&&(n[Ln]|=1024),z0(n)&&og(n)}function og(n){n[Zu].changeDetectionScheduler?.notify(0);let r=Xf(n);for(;r!==null&&!(r[Ln]&8192||(r[Ln]|=8192,!cC(r)));)r=Xf(r)}function OA(n,r){if(b_(n))throw new Wt(911,!1);n[fh]===null&&(n[fh]=[]),n[fh].push(r)}function rz(n,r){if(n[fh]===null)return;let t=n[fh].indexOf(r);t!==-1&&n[fh].splice(t,1)}function Xf(n){let r=n[jo];return ed(r)?r[jo]:r}function LA(n){return n[s0]??=[]}function FA(n){return n.cleanup??=[]}function oz(n,r,t,a){let h=LA(r);h.push(t),n.firstCreatePass&&FA(n).push(a,h.length-1)}var Gn={lFrame:WA(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var yE=!1;function sz(){return Gn.lFrame.elementDepthCount}function az(){Gn.lFrame.elementDepthCount++}function lz(){Gn.lFrame.elementDepthCount--}function NA(){return Gn.bindingsEnabled}function zA(){return Gn.skipHydrationRootTNode!==null}function cz(n){return Gn.skipHydrationRootTNode===n}function uz(){Gn.skipHydrationRootTNode=null}function li(){return Gn.lFrame.lView}function $o(){return Gn.lFrame.tView}function sg(n){return Gn.lFrame.contextLView=n,n[ls]}function ag(n){return Gn.lFrame.contextLView=null,n}function ca(){let n=BA();for(;n!==null&&n.type===64;)n=n.parent;return n}function BA(){return Gn.lFrame.currentTNode}function dz(){let n=Gn.lFrame,r=n.currentTNode;return n.isParent?r:r.parent}function x_(n,r){let t=Gn.lFrame;t.currentTNode=n,t.isParent=r}function VA(){return Gn.lFrame.isParent}function jA(){Gn.lFrame.isParent=!1}function hz(){return Gn.lFrame.contextLView}function UA(){return yE}function u0(n){let r=yE;return yE=n,r}function uC(){let n=Gn.lFrame,r=n.bindingRootIndex;return r===-1&&(r=n.bindingRootIndex=n.tView.bindingStartIndex),r}function fz(){return Gn.lFrame.bindingIndex}function pz(n){return Gn.lFrame.bindingIndex=n}function w_(){return Gn.lFrame.bindingIndex++}function dC(n){let r=Gn.lFrame,t=r.bindingIndex;return r.bindingIndex=r.bindingIndex+n,t}function mz(){return Gn.lFrame.inI18n}function gz(n,r){let t=Gn.lFrame;t.bindingIndex=t.bindingRootIndex=n,_E(r)}function yz(){return Gn.lFrame.currentDirectiveIndex}function _E(n){Gn.lFrame.currentDirectiveIndex=n}function _z(n){let r=Gn.lFrame.currentDirectiveIndex;return r===-1?null:n[r]}function $A(){return Gn.lFrame.currentQueryIndex}function hC(n){Gn.lFrame.currentQueryIndex=n}function vz(n){let r=n[Qn];return r.type===2?r.declTNode:r.type===1?n[zs]:null}function HA(n,r,t){if(t&Kn.SkipSelf){let h=r,i=n;for(;h=h.parent,h===null&&!(t&Kn.Host);)if(h=vz(i),h===null||(i=i[ig],h.type&10))break;if(h===null)return!1;r=h,n=i}let a=Gn.lFrame=GA();return a.currentTNode=r,a.lView=n,!0}function fC(n){let r=GA(),t=n[Qn];Gn.lFrame=r,r.currentTNode=t.firstChild,r.lView=n,r.tView=t,r.contextLView=n,r.bindingIndex=t.bindingStartIndex,r.inI18n=!1}function GA(){let n=Gn.lFrame,r=n===null?null:n.child;return r===null?WA(n):r}function WA(n){let r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=r),r}function qA(){let n=Gn.lFrame;return Gn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var ZA=qA;function pC(){let n=qA();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function bz(n){return(Gn.lFrame.contextLView=iz(n,Gn.lFrame.contextLView))[ls]}function vh(){return Gn.lFrame.selectedIndex}function Yf(n){Gn.lFrame.selectedIndex=n}function mC(){let n=Gn.lFrame;return lC(n.tView,n.selectedIndex)}function XA(){Gn.lFrame.currentNamespace=AA}function xz(){return Gn.lFrame.currentNamespace}var YA=!0;function gC(){return YA}function yC(n){YA=n}function wz(n,r,t){let{ngOnChanges:a,ngOnInit:h,ngDoCheck:i}=r.type.prototype;if(a){let C=MA(r);(t.preOrderHooks??=[]).push(n,C),(t.preOrderCheckHooks??=[]).push(n,C)}h&&(t.preOrderHooks??=[]).push(0-n,h),i&&((t.preOrderHooks??=[]).push(n,i),(t.preOrderCheckHooks??=[]).push(n,i))}function KA(n,r){for(let t=r.directiveStart,a=r.directiveEnd;t<a;t++){let i=n.data[t].type.prototype,{ngAfterContentInit:C,ngAfterContentChecked:F,ngAfterViewInit:V,ngAfterViewChecked:K,ngOnDestroy:oe}=i;C&&(n.contentHooks??=[]).push(-t,C),F&&((n.contentHooks??=[]).push(t,F),(n.contentCheckHooks??=[]).push(t,F)),V&&(n.viewHooks??=[]).push(-t,V),K&&((n.viewHooks??=[]).push(t,K),(n.viewCheckHooks??=[]).push(t,K)),oe!=null&&(n.destroyHooks??=[]).push(t,oe)}}function Kb(n,r,t){QA(n,r,3,t)}function Qb(n,r,t,a){(n[Ln]&3)===t&&QA(n,r,t,a)}function J1(n,r){let t=n[Ln];(t&3)===r&&(t&=16383,t+=1,n[Ln]=t)}function QA(n,r,t,a){let h=a!==void 0?n[$m]&65535:0,i=a??-1,C=r.length-1,F=0;for(let V=h;V<C;V++)if(typeof r[V+1]=="number"){if(F=r[V],a!=null&&F>=a)break}else r[V]<0&&(n[$m]+=65536),(F<i||i==-1)&&(Ez(n,t,r,V),n[$m]=(n[$m]&4294901760)+V+2),V++}function ES(n,r){ir(4,n,r);let t=ni(null);try{r.call(n)}finally{ni(t),ir(5,n,r)}}function Ez(n,r,t,a){let h=t[a]<0,i=t[a+1],C=h?-t[a]:t[a],F=n[C];h?n[Ln]>>14<n[$m]>>16&&(n[Ln]&3)===r&&(n[Ln]+=16384,ES(F,i)):ES(F,i)}var qm=-1,Kf=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(r,t,a){this.factory=r,this.canSeeViewProviders=t,this.injectImpl=a}};function Cz(n){return(n.flags&8)!==0}function Dz(n){return(n.flags&16)!==0}function Tz(n,r,t){let a=0;for(;a<t.length;){let h=t[a];if(typeof h=="number"){if(h!==0)break;a++;let i=t[a++],C=t[a++],F=t[a++];n.setAttribute(r,C,F,i)}else{let i=h,C=t[++a];Mz(i)?n.setProperty(r,i,C):n.setAttribute(r,i,C),a++}}return a}function JA(n){return n===3||n===4||n===6}function Mz(n){return n.charCodeAt(0)===64}function _C(n,r){if(!(r===null||r.length===0))if(n===null||n.length===0)n=r.slice();else{let t=-1;for(let a=0;a<r.length;a++){let h=r[a];typeof h=="number"?t=h:t===0||(t===-1||t===2?CS(n,t,h,null,r[++a]):CS(n,t,h,null,null))}}return n}function CS(n,r,t,a,h){let i=0,C=n.length;if(r===-1)C=-1;else for(;i<n.length;){let F=n[i++];if(typeof F=="number"){if(F===r){C=-1;break}else if(F>r){C=i-1;break}}}for(;i<n.length;){let F=n[i];if(typeof F=="number")break;if(F===t){h!==null&&(n[i+1]=h);return}i++,h!==null&&i++}C!==-1&&(n.splice(C,0,r),i=C+1),n.splice(i++,0,t),h!==null&&n.splice(i++,0,h)}var eE={},vE=class{injector;parentInjector;constructor(r,t){this.injector=r,this.parentInjector=t}get(r,t,a){a=R0(a);let h=this.injector.get(r,eE,a);return h!==eE||t===eE?h:this.parentInjector.get(r,t,a)}};function ek(n){return n!==qm}function d0(n){return n&32767}function Iz(n){return n>>16}function h0(n,r){let t=Iz(n),a=r;for(;t>0;)a=a[ig],t--;return a}var bE=!0;function DS(n){let r=bE;return bE=n,r}var Sz=256,tk=Sz-1,nk=5,Az=0,Nc={};function kz(n,r,t){let a;typeof t=="string"?a=t.charCodeAt(0)||0:t.hasOwnProperty(s_)&&(a=t[s_]),a==null&&(a=t[s_]=Az++);let h=a&tk,i=1<<h;r.data[n+(h>>nk)]|=i}function f0(n,r){let t=ik(n,r);if(t!==-1)return t;let a=r[Qn];a.firstCreatePass&&(n.injectorIndex=r.length,tE(a.data,n),tE(r,null),tE(a.blueprint,null));let h=vC(n,r),i=n.injectorIndex;if(ek(h)){let C=d0(h),F=h0(h,r),V=F[Qn].data;for(let K=0;K<8;K++)r[i+K]=F[C+K]|V[C+K]}return r[i+8]=h,i}function tE(n,r){n.push(0,0,0,0,0,0,0,0,r)}function ik(n,r){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||r[n.injectorIndex+8]===null?-1:n.injectorIndex}function vC(n,r){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,a=null,h=r;for(;h!==null;){if(a=lk(h),a===null)return qm;if(t++,h=h[ig],a.injectorIndex!==-1)return a.injectorIndex|t<<16}return qm}function xE(n,r,t){kz(n,r,t)}function Rz(n,r){if(r==="class")return n.classes;if(r==="style")return n.styles;let t=n.attrs;if(t){let a=t.length,h=0;for(;h<a;){let i=t[h];if(JA(i))break;if(i===0)h=h+2;else if(typeof i=="number")for(h++;h<a&&typeof t[h]=="string";)h++;else{if(i===r)return t[h+1];h=h+2}}}return null}function rk(n,r,t){if(t&Kn.Optional||n!==void 0)return n;rC(r,"NodeInjector")}function ok(n,r,t,a){if(t&Kn.Optional&&a===void 0&&(a=null),(t&(Kn.Self|Kn.Host))===0){let h=n[u_],i=za(void 0);try{return h?h.get(r,a,t&Kn.Optional):fA(r,a,t&Kn.Optional)}finally{za(i)}}return rk(a,r,t)}function sk(n,r,t,a=Kn.Default,h){if(n!==null){if(r[Ln]&2048&&!(a&Kn.Self)){let C=Fz(n,r,t,a,Nc);if(C!==Nc)return C}let i=ak(n,r,t,a,Nc);if(i!==Nc)return i}return ok(r,t,a,h)}function ak(n,r,t,a,h){let i=Oz(t);if(typeof i=="function"){if(!HA(r,n,a))return a&Kn.Host?rk(h,t,a):ok(r,t,a,h);try{let C;if(C=i(a),C==null&&!(a&Kn.Optional))rC(t);else return C}finally{ZA()}}else if(typeof i=="number"){let C=null,F=ik(n,r),V=qm,K=a&Kn.Host?r[Va][zs]:null;for((F===-1||a&Kn.SkipSelf)&&(V=F===-1?vC(n,r):r[F+8],V===qm||!MS(a,!1)?F=-1:(C=r[Qn],F=d0(V),r=h0(V,r)));F!==-1;){let oe=r[Qn];if(TS(i,F,oe.data)){let Ee=Pz(F,r,t,C,a,K);if(Ee!==Nc)return Ee}V=r[F+8],V!==qm&&MS(a,r[Qn].data[F+8]===K)&&TS(i,F,r)?(C=oe,F=d0(V),r=h0(V,r)):F=-1}}return h}function Pz(n,r,t,a,h,i){let C=r[Qn],F=C.data[n+8],V=a==null?rg(F)&&bE:a!=C&&(F.type&3)!==0,K=h&Kn.Host&&i===F,oe=Jb(F,C,t,V,K);return oe!==null?h_(r,C,oe,F):Nc}function Jb(n,r,t,a,h){let i=n.providerIndexes,C=r.data,F=i&1048575,V=n.directiveStart,K=n.directiveEnd,oe=i>>20,Ee=a?F:F+oe,Ye=h?F+oe:K;for(let Ne=Ee;Ne<Ye;Ne++){let ct=C[Ne];if(Ne<V&&t===ct||Ne>=V&&ct.type===t)return Ne}if(h){let Ne=C[V];if(Ne&&_h(Ne)&&Ne.type===t)return V}return null}function h_(n,r,t,a){let h=n[t],i=r.data;if(h instanceof Kf){let C=h;C.resolving&&dA(xN(i[t]));let F=DS(C.canSeeViewProviders);C.resolving=!0;let V,K=C.injectImpl?za(C.injectImpl):null,oe=HA(n,a,Kn.Default);try{h=n[t]=C.factory(void 0,i,n,a),r.firstCreatePass&&t>=a.directiveStart&&wz(t,i[t],r)}finally{K!==null&&za(K),DS(F),C.resolving=!1,ZA()}}return h}function Oz(n){if(typeof n=="string")return n.charCodeAt(0)||0;let r=n.hasOwnProperty(s_)?n[s_]:void 0;return typeof r=="number"?r>=0?r&tk:Lz:r}function TS(n,r,t){let a=1<<n;return!!(t[r+(n>>nk)]&a)}function MS(n,r){return!(n&Kn.Self)&&!(n&Kn.Host&&r)}var Hf=class{_tNode;_lView;constructor(r,t){this._tNode=r,this._lView=t}get(r,t,a){return sk(this._tNode,this._lView,r,R0(a),t)}};function Lz(){return new Hf(ca(),li())}function ja(n){return y_(()=>{let r=n.prototype.constructor,t=r[t0]||wE(r),a=Object.prototype,h=Object.getPrototypeOf(n.prototype).constructor;for(;h&&h!==a;){let i=h[t0]||wE(h);if(i&&i!==t)return i;h=Object.getPrototypeOf(h)}return i=>new i})}function wE(n){return sA(n)?()=>{let r=wE(as(n));return r&&r()}:Xm(n)}function Fz(n,r,t,a,h){let i=n,C=r;for(;i!==null&&C!==null&&C[Ln]&2048&&!l0(C);){let F=ak(i,C,t,a|Kn.Self,Nc);if(F!==Nc)return F;let V=i.parent;if(!V){let K=C[EA];if(K){let oe=K.get(t,Nc,a);if(oe!==Nc)return oe}V=lk(C),C=C[ig]}i=V}return h}function lk(n){let r=n[Qn],t=r.type;return t===2?r.declTNode:t===1?n[zs]:null}function bC(n){return Rz(ca(),n)}function IS(n,r=null,t=null,a){let h=ck(n,r,t,a);return h.resolveInjectorInitializers(),h}function ck(n,r=null,t=null,a,h=new Set){let i=[t||la,zN(n)];return a=a||(typeof n=="object"?void 0:Rs(n)),new l_(i,r||F0(),a||null,h)}var ci=class n{static THROW_IF_NOT_FOUND=$f;static NULL=new o0;static create(r,t){if(Array.isArray(r))return IS({name:""},t,r,"");{let a=r.name??"";return IS({name:a},r.parent,r.providers,a)}}static \u0275prov=Ct({token:n,providedIn:"any",factory:()=>kt(mA)});static __NG_ELEMENT_ID__=-1};var Jm=class{attributeName;constructor(r){this.attributeName=r}__NG_ELEMENT_ID__=()=>bC(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},Nz=new pt("");Nz.__NG_ELEMENT_ID__=n=>{let r=ca();if(r===null)throw new Wt(204,!1);if(r.type&2)return r.value;if(n&Kn.Optional)return null;throw new Wt(204,!1)};var uk=!1,$c=(()=>{class n{static __NG_ELEMENT_ID__=zz;static __NG_ENV_ID__=t=>t}return n})(),p0=class extends $c{_lView;constructor(r){super(),this._lView=r}onDestroy(r){return OA(this._lView,r),()=>rz(this._lView,r)}};function zz(){return new p0(li())}var Qf=class{},xC=new pt("",{providedIn:"root",factory:()=>!1});var dk=new pt(""),hk=new pt(""),td=(()=>{class n{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new Dr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Ct({token:n,providedIn:"root",factory:()=>new n})}return n})();var EE=class extends jn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(r=!1){super(),this.__isAsync=r,wA()&&(this.destroyRef=Re($c,{optional:!0})??void 0,this.pendingTasks=Re(td,{optional:!0})??void 0)}emit(r){let t=ni(null);try{super.next(r)}finally{ni(t)}}subscribe(r,t,a){let h=r,i=t||(()=>null),C=a;if(r&&typeof r=="object"){let V=r;h=V.next?.bind(V),i=V.error?.bind(V),C=V.complete?.bind(V)}this.__isAsync&&(i=this.wrapInTimeout(i),h&&(h=this.wrapInTimeout(h)),C&&(C=this.wrapInTimeout(C)));let F=super.subscribe({next:h,error:i,complete:C});return r instanceof Pi&&r.add(F),F}wrapInTimeout(r){return t=>{let a=this.pendingTasks?.add();setTimeout(()=>{r(t),a!==void 0&&this.pendingTasks?.remove(a)})}}},Tt=EE;function f_(...n){}function fk(n){let r,t;function a(){n=f_;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),r!==void 0&&clearTimeout(r)}catch{}}return r=setTimeout(()=>{n(),a()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),a()})),()=>a()}function SS(n){return queueMicrotask(()=>n()),()=>{n=f_}}var wC="isAngularZone",m0=wC+"_ID",Bz=0,bn=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Tt(!1);onMicrotaskEmpty=new Tt(!1);onStable=new Tt(!1);onError=new Tt(!1);constructor(r){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:h=!1,scheduleInRootZone:i=uk}=r;if(typeof Zone>"u")throw new Wt(908,!1);Zone.assertZonePatched();let C=this;C._nesting=0,C._outer=C._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(C._inner=C._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(C._inner=C._inner.fork(Zone.longStackTraceZoneSpec)),C.shouldCoalesceEventChangeDetection=!h&&a,C.shouldCoalesceRunChangeDetection=h,C.callbackScheduled=!1,C.scheduleInRootZone=i,Uz(C)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(wC)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new Wt(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new Wt(909,!1)}run(r,t,a){return this._inner.run(r,t,a)}runTask(r,t,a,h){let i=this._inner,C=i.scheduleEventTask("NgZoneEvent: "+h,r,Vz,f_,f_);try{return i.runTask(C,t,a)}finally{i.cancelTask(C)}}runGuarded(r,t,a){return this._inner.runGuarded(r,t,a)}runOutsideAngular(r){return this._outer.run(r)}},Vz={};function EC(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function jz(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function r(){fk(()=>{n.callbackScheduled=!1,CE(n),n.isCheckStableRunning=!0,EC(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{r()}):n._outer.run(()=>{r()}),CE(n)}function Uz(n){let r=()=>{jz(n)},t=Bz++;n._inner=n._inner.fork({name:"angular",properties:{[wC]:!0,[m0]:t,[m0+t]:!0},onInvokeTask:(a,h,i,C,F,V)=>{if($z(V))return a.invokeTask(i,C,F,V);try{return AS(n),a.invokeTask(i,C,F,V)}finally{(n.shouldCoalesceEventChangeDetection&&C.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&r(),kS(n)}},onInvoke:(a,h,i,C,F,V,K)=>{try{return AS(n),a.invoke(i,C,F,V,K)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!Hz(V)&&r(),kS(n)}},onHasTask:(a,h,i,C)=>{a.hasTask(i,C),h===i&&(C.change=="microTask"?(n._hasPendingMicrotasks=C.microTask,CE(n),EC(n)):C.change=="macroTask"&&(n.hasPendingMacrotasks=C.macroTask))},onHandleError:(a,h,i,C)=>(a.handleError(i,C),n.runOutsideAngular(()=>n.onError.emit(C)),!1)})}function CE(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function AS(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function kS(n){n._nesting--,EC(n)}var g0=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Tt;onMicrotaskEmpty=new Tt;onStable=new Tt;onError=new Tt;run(r,t,a){return r.apply(t,a)}runGuarded(r,t,a){return r.apply(t,a)}runOutsideAngular(r){return r()}runTask(r,t,a,h){return r.apply(t,a)}};function $z(n){return pk(n,"__ignore_ng_zone__")}function Hz(n){return pk(n,"__scheduler_tick__")}function pk(n,r){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[r]===!0}function Gz(n="zone.js",r){return n==="noop"?new g0:n==="zone.js"?new bn(r):n}var Ls=class{_console=console;handleError(r){this._console.error("ERROR",r)}},Wz=new pt("",{providedIn:"root",factory:()=>{let n=Re(bn),r=Re(Ls);return t=>n.runOutsideAngular(()=>r.handleError(t))}}),DE=class{destroyed=!1;listeners=null;errorHandler=Re(Ls,{optional:!0});destroyRef=Re($c);constructor(){this.destroyRef.onDestroy(()=>{this.destroyed=!0,this.listeners=null})}subscribe(r){if(this.destroyed)throw new Wt(953,!1);return(this.listeners??=[]).push(r),{unsubscribe:()=>{let t=this.listeners?.indexOf(r);t!==void 0&&t!==-1&&this.listeners?.splice(t,1)}}}emit(r){if(this.destroyed){console.warn(g_(953,!1));return}if(this.listeners===null)return;let t=ni(null);try{for(let a of this.listeners)try{a(r)}catch(h){this.errorHandler?.handleError(h)}}finally{ni(t)}}};function B0(n){return new DE}function RS(n,r){return oA(n,r)}function qz(n){return oA(rA,n)}var E_=(RS.required=qz,RS);function Zz(){return lg(ca(),li())}function lg(n,r){return new Bi(Uc(n,r))}var Bi=(()=>{class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=Zz}return n})();function Xz(n){return n instanceof Bi?n.nativeElement:n}function us(n,r){let t=VI(n),a=t[Na];return r?.equal&&(a.equal=r.equal),t.set=h=>yb(a,h),t.update=h=>jI(a,h),t.asReadonly=Yz.bind(t),t}function Yz(){let n=this[Na];if(n.readonlyFn===void 0){let r=()=>this();r[Na]=n,n.readonlyFn=r}return n.readonlyFn}function Kz(){return this._results[Symbol.iterator]()}var y0=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new jn}constructor(r=!1){this._emitDistinctChangesOnly=r}get(r){return this._results[r]}map(r){return this._results.map(r)}filter(r){return this._results.filter(r)}find(r){return this._results.find(r)}reduce(r,t){return this._results.reduce(r,t)}forEach(r){this._results.forEach(r)}some(r){return this._results.some(r)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(r,t){this.dirty=!1;let a=RN(r);(this._changesDetected=!kN(this._results,a,t))&&(this._results=a,this.length=a.length,this.last=a[this.length-1],this.first=a[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(r){this._onDirty=r}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=Kz};function mk(n){return(n.flags&128)===128}var gk=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(gk||{}),yk=new Map,Qz=0;function Jz(){return Qz++}function eB(n){yk.set(n[N0],n)}function TE(n){yk.delete(n[N0])}var PS="__ngContext__";function C_(n,r){ph(r)?(n[PS]=r[N0],eB(r)):n[PS]=r}function _k(n){return bk(n[d_])}function vk(n){return bk(n[Ul])}function bk(n){for(;n!==null&&!ed(n);)n=n[Ul];return n}var ME;function xk(n){ME=n}function tB(){if(ME!==void 0)return ME;if(typeof document<"u")return document;throw new Wt(210,!1)}var cg=new pt("",{providedIn:"root",factory:()=>nB}),nB="ng",CC=new pt(""),nd=new pt("",{providedIn:"platform",factory:()=>"unknown"});var bh=new pt(""),D_=new pt("",{providedIn:"root",factory:()=>tB().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var iB="h",rB="b";var wk=!1,oB=new pt("",{providedIn:"root",factory:()=>wk});var DC=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(DC||{}),ug=new pt(""),OS=new Set;function dg(n){OS.has(n)||(OS.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var TC=(()=>{class n{view;node;constructor(t,a){this.view=t,this.node=a}static __NG_ELEMENT_ID__=sB}return n})();function sB(){return new TC(li(),ca())}var Hm=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(Hm||{}),Ek=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=Ct({token:n,providedIn:"root",factory:()=>new n})}return n})(),aB=[Hm.EarlyRead,Hm.Write,Hm.MixedReadWrite,Hm.Read],lB=(()=>{class n{ngZone=Re(bn);scheduler=Re(Qf);errorHandler=Re(Ls,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Re(ug,{optional:!0})}execute(){let t=this.sequences.size>0;t&&ir(16),this.executing=!0;for(let a of aB)for(let h of this.sequences)if(!(h.erroredOrDestroyed||!h.hooks[a]))try{h.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let i=h.hooks[a];return i(h.pipelinedValue)},h.snapshot))}catch(i){h.erroredOrDestroyed=!0,this.errorHandler?.handleError(i)}this.executing=!1;for(let a of this.sequences)a.afterRun(),a.once&&(this.sequences.delete(a),a.destroy());for(let a of this.deferredRegistrations)this.sequences.add(a);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),t&&ir(17)}register(t){let{view:a}=t;a!==void 0?((a[Wm]??=[]).push(t),og(a),a[Ln]|=8192):this.executing?this.deferredRegistrations.add(t):this.addSequence(t)}addSequence(t){this.sequences.add(t),this.scheduler.notify(7)}unregister(t){this.executing&&this.sequences.has(t)?(t.erroredOrDestroyed=!0,t.pipelinedValue=void 0,t.once=!0):(this.sequences.delete(t),this.deferredRegistrations.delete(t))}maybeTrace(t,a){return a?a.run(DC.AFTER_NEXT_RENDER,t):t()}static \u0275prov=Ct({token:n,providedIn:"root",factory:()=>new n})}return n})(),IE=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(r,t,a,h,i,C=null){this.impl=r,this.hooks=t,this.view=a,this.once=h,this.snapshot=C,this.unregisterOnDestroy=i?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let r=this.view?.[Wm];r&&(this.view[Wm]=r.filter(t=>t!==this))}};function MC(n,r){!r?.injector&&ng(MC);let t=r?.injector??Re(ci);return dg("NgAfterRender"),Ck(n,t,r,!1)}function Hc(n,r){!r?.injector&&ng(Hc);let t=r?.injector??Re(ci);return dg("NgAfterNextRender"),Ck(n,t,r,!0)}function cB(n,r){if(n instanceof Function){let t=[void 0,void 0,void 0,void 0];return t[r]=n,t}else return[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function Ck(n,r,t,a){let h=r.get(Ek);h.impl??=r.get(lB);let i=r.get(ug,null,{optional:!0}),C=t?.phase??Hm.MixedReadWrite,F=t?.manualCleanup!==!0?r.get($c):null,V=r.get(TC,null,{optional:!0}),K=new IE(h.impl,cB(n,C),V?.view,a,F,i?.snapshot(null));return h.impl.register(K),K}var uB=()=>null;function Dk(n,r,t=!1){return uB(n,r,t)}function Tk(n,r){let t=n.contentQueries;if(t!==null){let a=ni(null);try{for(let h=0;h<t.length;h+=2){let i=t[h],C=t[h+1];if(C!==-1){let F=n.data[C];hC(i),F.contentQueries(2,r[C],C)}}}finally{ni(a)}}}function SE(n,r,t){hC(0);let a=ni(null);try{r(n,t)}finally{ni(a)}}function Mk(n,r,t){if(DA(r)){let a=ni(null);try{let h=r.directiveStart,i=r.directiveEnd;for(let C=h;C<i;C++){let F=n.data[C];if(F.contentQueries){let V=t[C];F.contentQueries(1,V,C)}}}finally{ni(a)}}}var Vc=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Vc||{}),Wb;function dB(){if(Wb===void 0&&(Wb=null,$l.trustedTypes))try{Wb=$l.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Wb}function V0(n){return dB()?.createHTML(n)||n}var Yu=class{changingThisBreaksApplicationSecurity;constructor(r){this.changingThisBreaksApplicationSecurity=r}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${iA})`}},AE=class extends Yu{getTypeName(){return"HTML"}},kE=class extends Yu{getTypeName(){return"Style"}},RE=class extends Yu{getTypeName(){return"Script"}},PE=class extends Yu{getTypeName(){return"URL"}},OE=class extends Yu{getTypeName(){return"ResourceURL"}};function Hl(n){return n instanceof Yu?n.changingThisBreaksApplicationSecurity:n}function np(n,r){let t=hB(n);if(t!=null&&t!==r){if(t==="ResourceURL"&&r==="URL")return!0;throw new Error(`Required a safe ${r}, got a ${t} (see ${iA})`)}return t===r}function hB(n){return n instanceof Yu&&n.getTypeName()||null}function Ik(n){return new AE(n)}function Sk(n){return new kE(n)}function Ak(n){return new RE(n)}function kk(n){return new PE(n)}function Rk(n){return new OE(n)}function fB(n){let r=new FE(n);return pB()?new LE(r):r}var LE=class{inertDocumentHelper;constructor(r){this.inertDocumentHelper=r}getInertBodyElement(r){r="<body><remove></remove>"+r;try{let t=new window.DOMParser().parseFromString(V0(r),"text/html").body;return t===null?this.inertDocumentHelper.getInertBodyElement(r):(t.firstChild?.remove(),t)}catch{return null}}},FE=class{defaultDoc;inertDocument;constructor(r){this.defaultDoc=r,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(r){let t=this.inertDocument.createElement("template");return t.innerHTML=V0(r),t}};function pB(){try{return!!new window.DOMParser().parseFromString(V0(""),"text/html")}catch{return!1}}var mB=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function j0(n){return n=String(n),n.match(mB)?n:"unsafe:"+n}function id(n){let r={};for(let t of n.split(","))r[t]=!0;return r}function T_(...n){let r={};for(let t of n)for(let a in t)t.hasOwnProperty(a)&&(r[a]=!0);return r}var Pk=id("area,br,col,hr,img,wbr"),Ok=id("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Lk=id("rp,rt"),gB=T_(Lk,Ok),yB=T_(Ok,id("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),_B=T_(Lk,id("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),LS=T_(Pk,yB,_B,gB),Fk=id("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),vB=id("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),bB=id("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),xB=T_(Fk,vB,bB),wB=id("script,style,template"),NE=class{sanitizedSomething=!1;buf=[];sanitizeChildren(r){let t=r.firstChild,a=!0,h=[];for(;t;){if(t.nodeType===Node.ELEMENT_NODE?a=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,a&&t.firstChild){h.push(t),t=DB(t);continue}for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let i=CB(t);if(i){t=i;break}t=h.pop()}}return this.buf.join("")}startElement(r){let t=FS(r).toLowerCase();if(!LS.hasOwnProperty(t))return this.sanitizedSomething=!0,!wB.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);let a=r.attributes;for(let h=0;h<a.length;h++){let i=a.item(h),C=i.name,F=C.toLowerCase();if(!xB.hasOwnProperty(F)){this.sanitizedSomething=!0;continue}let V=i.value;Fk[F]&&(V=j0(V)),this.buf.push(" ",C,'="',NS(V),'"')}return this.buf.push(">"),!0}endElement(r){let t=FS(r).toLowerCase();LS.hasOwnProperty(t)&&!Pk.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(r){this.buf.push(NS(r))}};function EB(n,r){return(n.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function CB(n){let r=n.nextSibling;if(r&&n!==r.previousSibling)throw Nk(r);return r}function DB(n){let r=n.firstChild;if(r&&EB(n,r))throw Nk(r);return r}function FS(n){let r=n.nodeName;return typeof r=="string"?r:"FORM"}function Nk(n){return new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`)}var TB=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,MB=/([^\#-~ |!])/g;function NS(n){return n.replace(/&/g,"&amp;").replace(TB,function(r){let t=r.charCodeAt(0),a=r.charCodeAt(1);return"&#"+((t-55296)*1024+(a-56320)+65536)+";"}).replace(MB,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var qb;function zk(n,r){let t=null;try{qb=qb||fB(n);let a=r?String(r):"";t=qb.getInertBodyElement(a);let h=5,i=a;do{if(h===0)throw new Error("Failed to sanitize html because the input is unstable");h--,a=i,i=t.innerHTML,t=qb.getInertBodyElement(a)}while(a!==i);let F=new NE().sanitizeChildren(zS(t)||t);return V0(F)}finally{if(t){let a=zS(t)||t;for(;a.firstChild;)a.firstChild.remove()}}}function zS(n){return"content"in n&&IB(n)?n.content:null}function IB(n){return n.nodeType===Node.ELEMENT_NODE&&n.nodeName==="TEMPLATE"}var ds=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(ds||{});function Bk(n){let r=SB();return r?r.sanitize(ds.URL,n)||"":np(n,"URL")?Hl(n):j0(Zm(n))}function SB(){let n=li();return n&&n[Zu].sanitizer}function Vk(n){return n instanceof Function?n():n}function AB(n,r,t){let a=n.length;for(;;){let h=n.indexOf(r,t);if(h===-1)return h;if(h===0||n.charCodeAt(h-1)<=32){let i=r.length;if(h+i===a||n.charCodeAt(h+i)<=32)return h}t=h+1}}var jk="ng-template";function kB(n,r,t,a){let h=0;if(a){for(;h<r.length&&typeof r[h]=="string";h+=2)if(r[h]==="class"&&AB(r[h+1].toLowerCase(),t,0)!==-1)return!0}else if(IC(n))return!1;if(h=r.indexOf(1,h),h>-1){let i;for(;++h<r.length&&typeof(i=r[h])=="string";)if(i.toLowerCase()===t)return!0}return!1}function IC(n){return n.type===4&&n.value!==jk}function RB(n,r,t){let a=n.type===4&&!t?jk:n.value;return r===a}function PB(n,r,t){let a=4,h=n.attrs,i=h!==null?FB(h):0,C=!1;for(let F=0;F<r.length;F++){let V=r[F];if(typeof V=="number"){if(!C&&!jl(a)&&!jl(V))return!1;if(C&&jl(V))continue;C=!1,a=V|a&1;continue}if(!C)if(a&4){if(a=2|a&1,V!==""&&!RB(n,V,t)||V===""&&r.length===1){if(jl(a))return!1;C=!0}}else if(a&8){if(h===null||!kB(n,h,V,t)){if(jl(a))return!1;C=!0}}else{let K=r[++F],oe=OB(V,h,IC(n),t);if(oe===-1){if(jl(a))return!1;C=!0;continue}if(K!==""){let Ee;if(oe>i?Ee="":Ee=h[oe+1].toLowerCase(),a&2&&K!==Ee){if(jl(a))return!1;C=!0}}}}return jl(a)||C}function jl(n){return(n&1)===0}function OB(n,r,t,a){if(r===null)return-1;let h=0;if(a||!t){let i=!1;for(;h<r.length;){let C=r[h];if(C===n)return h;if(C===3||C===6)i=!0;else if(C===1||C===2){let F=r[++h];for(;typeof F=="string";)F=r[++h];continue}else{if(C===4)break;if(C===0){h+=4;continue}}h+=i?1:2}return-1}else return NB(r,n)}function Uk(n,r,t=!1){for(let a=0;a<r.length;a++)if(PB(n,r[a],t))return!0;return!1}function LB(n){let r=n.attrs;if(r!=null){let t=r.indexOf(5);if((t&1)===0)return r[t+1]}return null}function FB(n){for(let r=0;r<n.length;r++){let t=n[r];if(JA(t))return r}return n.length}function NB(n,r){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let a=n[t];if(typeof a=="number")return-1;if(a===r)return t;t++}return-1}function zB(n,r){e:for(let t=0;t<r.length;t++){let a=r[t];if(n.length===a.length){for(let h=0;h<n.length;h++)if(n[h]!==a[h])continue e;return!0}}return!1}function BS(n,r){return n?":not("+r.trim()+")":r}function BB(n){let r=n[0],t=1,a=2,h="",i=!1;for(;t<n.length;){let C=n[t];if(typeof C=="string")if(a&2){let F=n[++t];h+="["+C+(F.length>0?'="'+F+'"':"")+"]"}else a&8?h+="."+C:a&4&&(h+=" "+C);else h!==""&&!jl(C)&&(r+=BS(i,h),h=""),a=C,i=i||!jl(a);t++}return h!==""&&(r+=BS(i,h)),r}function VB(n){return n.map(BB).join(",")}function jB(n){let r=[],t=[],a=1,h=2;for(;a<n.length;){let i=n[a];if(typeof i=="string")h===2?i!==""&&r.push(i,n[++a]):h===8&&t.push(i);else{if(!jl(h))break;h=i}a++}return t.length&&r.push(1,...t),r}var ua={};function UB(n,r){return n.createText(r)}function $B(n,r,t){n.setValue(r,t)}function $k(n,r,t){return n.createElement(r,t)}function _0(n,r,t,a,h){n.insertBefore(r,t,a,h)}function Hk(n,r,t){n.appendChild(r,t)}function VS(n,r,t,a,h){a!==null?_0(n,r,t,a,h):Hk(n,r,t)}function HB(n,r,t){n.removeChild(null,r,t)}function GB(n,r,t){n.setAttribute(r,"style",t)}function WB(n,r,t){t===""?n.removeAttribute(r,"class"):n.setAttribute(r,"class",t)}function Gk(n,r,t){let{mergedAttrs:a,classes:h,styles:i}=t;a!==null&&Tz(n,r,a),h!==null&&WB(n,r,h),i!==null&&GB(n,r,i)}function SC(n,r,t,a,h,i,C,F,V,K,oe){let Ee=Os+a,Ye=Ee+h,Ne=qB(Ee,Ye),ct=typeof K=="function"?K():K;return Ne[Qn]={type:n,blueprint:Ne,template:t,queries:null,viewQuery:F,declTNode:r,data:Ne.slice().fill(null,Ee),bindingStartIndex:Ee,expandoStartIndex:Ye,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof C=="function"?C():C,firstChild:null,schemas:V,consts:ct,incompleteFirstPass:!1,ssrId:oe}}function qB(n,r){let t=[];for(let a=0;a<r;a++)t.push(a<n?null:ua);return t}function ZB(n){let r=n.tView;return r===null||r.incompleteFirstPass?n.tView=SC(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):r}function AC(n,r,t,a,h,i,C,F,V,K,oe){let Ee=r.blueprint.slice();return Ee[Ju]=h,Ee[Ln]=a|4|128|8|64|1024,(K!==null||n&&n[Ln]&2048)&&(Ee[Ln]|=2048),RA(Ee),Ee[jo]=Ee[ig]=n,Ee[ls]=t,Ee[Zu]=C||n&&n[Zu],Ee[Yr]=F||n&&n[Yr],Ee[u_]=V||n&&n[u_]||null,Ee[zs]=i,Ee[N0]=Jz(),Ee[c_]=oe,Ee[EA]=K,Ee[Va]=r.type==2?n[Va]:Ee,Ee}function XB(n,r,t){let a=Uc(r,n),h=ZB(t),i=n[Zu].rendererFactory,C=kC(n,AC(n,h,null,Wk(t),a,r,null,i.createRenderer(a,t),null,null,null));return n[r.index]=C}function Wk(n){let r=16;return n.signals?r=4096:n.onPush&&(r=64),r}function qk(n,r,t,a){if(t===0)return-1;let h=r.length;for(let i=0;i<t;i++)r.push(a),n.blueprint.push(a),n.data.push(null);return h}function kC(n,r){return n[d_]?n[xS][Ul]=r:n[d_]=r,n[xS]=r,r}function pi(n=1){Zk($o(),li(),vh()+n,!1)}function Zk(n,r,t,a){if(!a)if((r[Ln]&3)===3){let i=n.preOrderCheckHooks;i!==null&&Kb(r,i,t)}else{let i=n.preOrderHooks;i!==null&&Qb(r,i,0,t)}Yf(t)}var U0=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(U0||{});function zE(n,r,t,a){let h=ni(null);try{let[i,C,F]=n.inputs[t],V=null;(C&U0.SignalBased)!==0&&(V=r[i][Na]),V!==null&&V.transformFn!==void 0?a=V.transformFn(a):F!==null&&(a=F.call(r,a)),n.setInput!==null?n.setInput(r,V,a,t,i):TA(r,V,i,a)}finally{ni(h)}}function Xk(n,r,t,a,h){let i=vh(),C=a&2;try{Yf(-1),C&&r.length>Os&&Zk(n,r,Os,!1),ir(C?2:0,h),t(a,h)}finally{Yf(i),ir(C?3:1,h)}}function RC(n,r,t){tV(n,r,t),(t.flags&64)===64&&nV(n,r,t)}function Yk(n,r,t=Uc){let a=r.localNames;if(a!==null){let h=r.index+1;for(let i=0;i<a.length;i+=2){let C=a[i+1],F=C===-1?t(r,n):n[C];n[h++]=F}}}function YB(n,r,t,a){let i=a.get(oB,wk)||t===Vc.ShadowDom,C=n.selectRootElement(r,i);return KB(C),C}function KB(n){QB(n)}var QB=()=>null;function JB(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function Kk(n,r,t,a,h,i,C,F){if(!F&&PC(r,n,t,a,h)){rg(r)&&eV(t,r.index);return}if(r.type&3){let V=Uc(r,t);a=JB(a),h=C!=null?C(h,r.value||"",a):h,i.setProperty(V,a,h)}else r.type&12}function eV(n,r){let t=Bc(r,n);t[Ln]&16||(t[Ln]|=64)}function tV(n,r,t){let a=t.directiveStart,h=t.directiveEnd;rg(t)&&XB(r,t,n.data[a+t.componentOffset]),n.firstCreatePass||f0(t,r);let i=t.initialInputs;for(let C=a;C<h;C++){let F=n.data[C],V=h_(r,n,C,t);if(C_(V,r),i!==null&&sV(r,C-a,V,F,t,i),_h(F)){let K=Bc(t.index,r);K[ls]=h_(r,n,C,t)}}}function nV(n,r,t){let a=t.directiveStart,h=t.directiveEnd,i=t.index,C=yz();try{Yf(i);for(let F=a;F<h;F++){let V=n.data[F],K=r[F];_E(F),(V.hostBindings!==null||V.hostVars!==0||V.hostAttrs!==null)&&iV(V,K)}}finally{Yf(-1),_E(C)}}function iV(n,r){n.hostBindings!==null&&n.hostBindings(1,r)}function Qk(n,r){let t=n.directiveRegistry,a=null;if(t)for(let h=0;h<t.length;h++){let i=t[h];Uk(r,i.selectors,!1)&&(a??=[],_h(i)?a.unshift(i):a.push(i))}return a}function rV(n,r,t,a,h,i){let C=Uc(n,r);oV(r[Yr],C,i,n.value,t,a,h)}function oV(n,r,t,a,h,i,C){if(i==null)n.removeAttribute(r,h,t);else{let F=C==null?Zm(i):C(i,a||"",h);n.setAttribute(r,h,F,t)}}function sV(n,r,t,a,h,i){let C=i[r];if(C!==null)for(let F=0;F<C.length;F+=2){let V=C[F],K=C[F+1];zE(a,t,V,K)}}function Jk(n,r){let t=n[u_],a=t?t.get(Ls,null):null;a&&a.handleError(r)}function PC(n,r,t,a,h){let i=n.inputs?.[a],C=n.hostDirectiveInputs?.[a],F=!1;if(C)for(let V=0;V<C.length;V+=2){let K=C[V],oe=C[V+1],Ee=r.data[K];zE(Ee,t[K],oe,h),F=!0}if(i)for(let V of i){let K=t[V],oe=r.data[V];zE(oe,K,a,h),F=!0}return F}function aV(n,r){let t=Bc(r,n),a=t[Qn];lV(a,t);let h=t[Ju];h!==null&&t[c_]===null&&(t[c_]=Dk(h,t[u_])),ir(18),OC(a,t,t[ls]),ir(19,t[ls])}function lV(n,r){for(let t=r.length;t<n.blueprint.length;t++)r.push(n.blueprint[t])}function OC(n,r,t){fC(r);try{let a=n.viewQuery;a!==null&&SE(1,a,t);let h=n.template;h!==null&&Xk(n,r,h,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),r[Xu]?.finishViewCreation(n),n.staticContentQueries&&Tk(n,r),n.staticViewQueries&&SE(2,n.viewQuery,t);let i=n.components;i!==null&&cV(r,i)}catch(a){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),a}finally{r[Ln]&=-5,pC()}}function cV(n,r){for(let t=0;t<r.length;t++)aV(n,r[t])}function LC(n,r,t,a){let h=ni(null);try{let i=r.tView,F=n[Ln]&4096?4096:16,V=AC(n,i,t,F,null,r,null,null,a?.injector??null,a?.embeddedViewInjector??null,a?.dehydratedView??null),K=n[r.index];V[Wf]=K;let oe=n[Xu];return oe!==null&&(V[Xu]=oe.createEmbeddedView(i)),OC(i,V,t),V}finally{ni(h)}}function v0(n,r){return!r||r.firstChild===null||mk(n)}var uV;function FC(n,r){return uV(n,r)}var Ku=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Ku||{});function NC(n){return(n.flags&32)===32}function Gm(n,r,t,a,h){if(a!=null){let i,C=!1;ed(a)?i=a:ph(a)&&(C=!0,a=a[Ju]);let F=zc(a);n===0&&t!==null?h==null?Hk(r,t,F):_0(r,t,F,h||null,!0):n===1&&t!==null?_0(r,t,F,h||null,!0):n===2?HB(r,F,C):n===3&&r.destroyNode(F),i!=null&&bV(r,n,i,t,h)}}function dV(n,r){eR(n,r),r[Ju]=null,r[zs]=null}function hV(n,r,t,a,h,i){a[Ju]=h,a[zs]=r,$0(n,a,t,1,h,i)}function eR(n,r){r[Zu].changeDetectionScheduler?.notify(9),$0(n,r,r[Yr],2,null,null)}function fV(n){let r=n[d_];if(!r)return nE(n[Qn],n);for(;r;){let t=null;if(ph(r))t=r[d_];else{let a=r[Ps];a&&(t=a)}if(!t){for(;r&&!r[Ul]&&r!==n;)ph(r)&&nE(r[Qn],r),r=r[jo];r===null&&(r=n),ph(r)&&nE(r[Qn],r),t=r&&r[Ul]}r=t}}function zC(n,r){let t=n[Qm],a=t.indexOf(r);t.splice(a,1)}function BC(n,r){if(b_(r))return;let t=r[Yr];t.destroyNode&&$0(n,r,t,3,null,null),fV(r)}function nE(n,r){if(b_(r))return;let t=ni(null);try{r[Ln]&=-129,r[Ln]|=256,r[Ba]&&Xy(r[Ba]),mV(n,r),pV(n,r),r[Qn].type===1&&r[Yr].destroy();let a=r[Wf];if(a!==null&&ed(r[jo])){a!==r[jo]&&zC(a,r);let h=r[Xu];h!==null&&h.detachView(n)}TE(r)}finally{ni(t)}}function pV(n,r){let t=n.cleanup,a=r[s0];if(t!==null)for(let C=0;C<t.length-1;C+=2)if(typeof t[C]=="string"){let F=t[C+3];F>=0?a[F]():a[-F].unsubscribe(),C+=2}else{let F=a[t[C+1]];t[C].call(F)}a!==null&&(r[s0]=null);let h=r[fh];if(h!==null){r[fh]=null;for(let C=0;C<h.length;C++){let F=h[C];F()}}let i=r[qf];if(i!==null){r[qf]=null;for(let C of i)C.destroy()}}function mV(n,r){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let a=0;a<t.length;a+=2){let h=r[t[a]];if(!(h instanceof Kf)){let i=t[a+1];if(Array.isArray(i))for(let C=0;C<i.length;C+=2){let F=h[i[C]],V=i[C+1];ir(4,F,V);try{V.call(F)}finally{ir(5,F,V)}}else{ir(4,h,i);try{i.call(h)}finally{ir(5,h,i)}}}}}function tR(n,r,t){return gV(n,r.parent,t)}function gV(n,r,t){let a=r;for(;a!==null&&a.type&168;)r=a,a=r.parent;if(a===null)return t[Ju];if(rg(a)){let{encapsulation:h}=n.data[a.directiveStart+a.componentOffset];if(h===Vc.None||h===Vc.Emulated)return null}return Uc(a,t)}function nR(n,r,t){return _V(n,r,t)}function yV(n,r,t){return n.type&40?Uc(n,t):null}var _V=yV,jS;function VC(n,r,t,a){let h=tR(n,a,r),i=r[Yr],C=a.parent||r[zs],F=nR(C,a,r);if(h!=null)if(Array.isArray(t))for(let V=0;V<t.length;V++)VS(i,h,t[V],F,!1);else VS(i,h,t,F,!1);jS!==void 0&&jS(i,a,r,t,h)}function o_(n,r){if(r!==null){let t=r.type;if(t&3)return Uc(r,n);if(t&4)return BE(-1,n[r.index]);if(t&8){let a=r.child;if(a!==null)return o_(n,a);{let h=n[r.index];return ed(h)?BE(-1,h):zc(h)}}else{if(t&128)return o_(n,r.next);if(t&32)return FC(r,n)()||zc(n[r.index]);{let a=iR(n,r);if(a!==null){if(Array.isArray(a))return a[0];let h=Xf(n[Va]);return o_(h,a)}else return o_(n,r.next)}}}return null}function iR(n,r){if(r!==null){let a=n[Va][zs],h=r.projection;return a.projection[h]}return null}function BE(n,r){let t=Ps+n+1;if(t<r.length){let a=r[t],h=a[Qn].firstChild;if(h!==null)return o_(a,h)}return r[Zf]}function jC(n,r,t,a,h,i,C){for(;t!=null;){if(t.type===128){t=t.next;continue}let F=a[t.index],V=t.type;if(C&&r===0&&(F&&C_(zc(F),a),t.flags|=2),!NC(t))if(V&8)jC(n,r,t.child,a,h,i,!1),Gm(r,n,h,F,i);else if(V&32){let K=FC(t,a),oe;for(;oe=K();)Gm(r,n,h,oe,i);Gm(r,n,h,F,i)}else V&16?rR(n,r,a,t,h,i):Gm(r,n,h,F,i);t=C?t.projectionNext:t.next}}function $0(n,r,t,a,h,i){jC(t,a,n.firstChild,r,h,i,!1)}function vV(n,r,t){let a=r[Yr],h=tR(n,t,r),i=t.parent||r[zs],C=nR(i,t,r);rR(a,0,r,t,h,C)}function rR(n,r,t,a,h,i){let C=t[Va],V=C[zs].projection[a.projection];if(Array.isArray(V))for(let K=0;K<V.length;K++){let oe=V[K];Gm(r,n,h,oe,i)}else{let K=V,oe=C[jo];mk(a)&&(K.flags|=128),jC(n,r,K,oe,h,i,!0)}}function bV(n,r,t,a,h){let i=t[Zf],C=zc(t);i!==C&&Gm(r,n,a,i,h);for(let F=Ps;F<t.length;F++){let V=t[F];$0(V[Qn],V,n,r,a,i)}}function xV(n,r,t,a,h){if(r)h?n.addClass(t,a):n.removeClass(t,a);else{let i=a.indexOf("-")===-1?void 0:Ku.DashCase;h==null?n.removeStyle(t,a,i):(typeof h=="string"&&h.endsWith("!important")&&(h=h.slice(0,-10),i|=Ku.Important),n.setStyle(t,a,h,i))}}function b0(n,r,t,a,h=!1){for(;t!==null;){if(t.type===128){t=h?t.projectionNext:t.next;continue}let i=r[t.index];i!==null&&a.push(zc(i)),ed(i)&&wV(i,a);let C=t.type;if(C&8)b0(n,r,t.child,a);else if(C&32){let F=FC(t,r),V;for(;V=F();)a.push(V)}else if(C&16){let F=iR(r,t);if(Array.isArray(F))a.push(...F);else{let V=Xf(r[Va]);b0(V[Qn],V,F,a,!0)}}t=h?t.projectionNext:t.next}return a}function wV(n,r){for(let t=Ps;t<n.length;t++){let a=n[t],h=a[Qn].firstChild;h!==null&&b0(a[Qn],a,h,r)}n[Zf]!==n[Ju]&&r.push(n[Zf])}function oR(n){if(n[Wm]!==null){for(let r of n[Wm])r.impl.addSequence(r);n[Wm].length=0}}var sR=[];function EV(n){return n[Ba]??CV(n)}function CV(n){let r=sR.pop()??Object.create(TV);return r.lView=n,r}function DV(n){n.lView[Ba]!==n&&(n.lView=null,sR.push(n))}var TV=vn(ht({},Im),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{og(n.lView)},consumerOnSignalRead(){this.lView[Ba]=this}});function MV(n){let r=n[Ba]??Object.create(IV);return r.lView=n,r}var IV=vn(ht({},Im),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let r=Xf(n.lView);for(;r&&!aR(r[Qn]);)r=Xf(r);r&&PA(r)},consumerOnSignalRead(){this.lView[Ba]=this}});function aR(n){return n.type!==2}function lR(n){if(n[qf]===null)return;let r=!0;for(;r;){let t=!1;for(let a of n[qf])a.dirty&&(t=!0,a.zone===null||Zone.current===a.zone?a.run():a.zone.run(()=>a.run()));r=t&&!!(n[Ln]&8192)}}var SV=100;function cR(n,r=!0,t=0){let h=n[Zu].rendererFactory,i=!1;i||h.begin?.();try{AV(n,t)}catch(C){throw r&&Jk(n,C),C}finally{i||h.end?.()}}function AV(n,r){let t=UA();try{u0(!0),VE(n,r);let a=0;for(;z0(n);){if(a===SV)throw new Wt(103,!1);a++,VE(n,1)}}finally{u0(t)}}function kV(n,r,t,a){if(b_(r))return;let h=r[Ln],i=!1,C=!1;fC(r);let F=!0,V=null,K=null;i||(aR(n)?(K=EV(r),V=Zy(K)):SI()===null?(F=!1,K=MV(r),V=Zy(K)):r[Ba]&&(Xy(r[Ba]),r[Ba]=null));try{RA(r),pz(n.bindingStartIndex),t!==null&&Xk(n,r,t,2,a);let oe=(h&3)===3;if(!i)if(oe){let Ne=n.preOrderCheckHooks;Ne!==null&&Kb(r,Ne,null)}else{let Ne=n.preOrderHooks;Ne!==null&&Qb(r,Ne,0,null),J1(r,0)}if(C||RV(r),lR(r),uR(r,0),n.contentQueries!==null&&Tk(n,r),!i)if(oe){let Ne=n.contentCheckHooks;Ne!==null&&Kb(r,Ne)}else{let Ne=n.contentHooks;Ne!==null&&Qb(r,Ne,1),J1(r,1)}OV(n,r);let Ee=n.components;Ee!==null&&hR(r,Ee,0);let Ye=n.viewQuery;if(Ye!==null&&SE(2,Ye,a),!i)if(oe){let Ne=n.viewCheckHooks;Ne!==null&&Kb(r,Ne)}else{let Ne=n.viewHooks;Ne!==null&&Qb(r,Ne,2),J1(r,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),r[Q1]){for(let Ne of r[Q1])Ne();r[Q1]=null}i||(oR(r),r[Ln]&=-73)}catch(oe){throw i||og(r),oe}finally{K!==null&&(fb(K,V),F&&DV(K)),pC()}}function uR(n,r){for(let t=_k(n);t!==null;t=vk(t))for(let a=Ps;a<t.length;a++){let h=t[a];dR(h,r)}}function RV(n){for(let r=_k(n);r!==null;r=vk(r)){if(!(r[Ln]&2))continue;let t=r[Qm];for(let a=0;a<t.length;a++){let h=t[a];PA(h)}}}function PV(n,r,t){ir(18);let a=Bc(r,n);dR(a,t),ir(19,a[ls])}function dR(n,r){cC(n)&&VE(n,r)}function VE(n,r){let a=n[Qn],h=n[Ln],i=n[Ba],C=!!(r===0&&h&16);if(C||=!!(h&64&&r===0),C||=!!(h&1024),C||=!!(i?.dirty&&pb(i)),C||=!1,i&&(i.dirty=!1),n[Ln]&=-9217,C)kV(a,n,a.template,n[ls]);else if(h&8192){lR(n),uR(n,1);let F=a.components;F!==null&&hR(n,F,1),oR(n)}}function hR(n,r,t){for(let a=0;a<r.length;a++)PV(n,r[a],t)}function OV(n,r){let t=n.hostBindingOpCodes;if(t!==null)try{for(let a=0;a<t.length;a++){let h=t[a];if(h<0)Yf(~h);else{let i=h,C=t[++a],F=t[++a];gz(C,i);let V=r[i];ir(24,V),F(2,V),ir(25,V)}}}finally{Yf(-1)}}function UC(n,r){let t=UA()?64:1088;for(n[Zu].changeDetectionScheduler?.notify(r);n;){n[Ln]|=t;let a=Xf(n);if(l0(n)&&!a)return n;n=a}return null}function fR(n,r,t,a){return[n,!0,0,r,null,a,null,t,null,null]}function LV(n,r){let t=Ps+r;if(t<n.length)return n[t]}function $C(n,r,t,a=!0){let h=r[Qn];if(NV(h,r,n,t),a){let C=BE(t,n),F=r[Yr],V=F.parentNode(n[Zf]);V!==null&&hV(h,n[zs],F,r,V,C)}let i=r[c_];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function FV(n,r){let t=x0(n,r);return t!==void 0&&BC(t[Qn],t),t}function x0(n,r){if(n.length<=Ps)return;let t=Ps+r,a=n[t];if(a){let h=a[Wf];h!==null&&h!==n&&zC(h,a),r>0&&(n[t-1][Ul]=a[Ul]);let i=r0(n,Ps+r);dV(a[Qn],a);let C=i[Xu];C!==null&&C.detachView(i[Qn]),a[jo]=null,a[Ul]=null,a[Ln]&=-129}return a}function NV(n,r,t,a){let h=Ps+a,i=t.length;a>0&&(t[h-1][Ul]=r),a<i-Ps?(r[Ul]=t[h],pA(t,Ps+a,r)):(t.push(r),r[Ul]=null),r[jo]=t;let C=r[Wf];C!==null&&t!==C&&pR(C,r);let F=r[Xu];F!==null&&F.insertView(n),gE(r),r[Ln]|=128}function pR(n,r){let t=n[Qm],a=r[jo];if(ph(a))n[Ln]|=2;else{let h=a[jo][Va];r[Va]!==h&&(n[Ln]|=2)}t===null?n[Qm]=[r]:t.push(r)}var p_=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let r=this._lView,t=r[Qn];return b0(t,r,t.firstChild,[])}constructor(r,t,a=!0){this._lView=r,this._cdRefInjectingView=t,this.notifyErrorHandler=a}get context(){return this._lView[ls]}set context(r){this._lView[ls]=r}get destroyed(){return b_(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let r=this._lView[jo];if(ed(r)){let t=r[a0],a=t?t.indexOf(this):-1;a>-1&&(x0(r,a),r0(t,a))}this._attachedToViewContainer=!1}BC(this._lView[Qn],this._lView)}onDestroy(r){OA(this._lView,r)}markForCheck(){UC(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ln]&=-129}reattach(){gE(this._lView),this._lView[Ln]|=128}detectChanges(){this._lView[Ln]|=1024,cR(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Wt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let r=l0(this._lView),t=this._lView[Wf];t!==null&&!r&&zC(t,this._lView),eR(this._lView[Qn],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new Wt(902,!1);this._appRef=r;let t=l0(this._lView),a=this._lView[Wf];a!==null&&!t&&pR(a,this._lView),gE(this._lView)}};var jc=(()=>{class n{static __NG_ELEMENT_ID__=VV}return n})(),zV=jc,BV=class extends zV{_declarationLView;_declarationTContainer;elementRef;constructor(r,t,a){super(),this._declarationLView=r,this._declarationTContainer=t,this.elementRef=a}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(r,t){return this.createEmbeddedViewImpl(r,t)}createEmbeddedViewImpl(r,t,a){let h=LC(this._declarationLView,this._declarationTContainer,r,{embeddedViewInjector:t,dehydratedView:a});return new p_(h)}};function VV(){return HC(ca(),li())}function HC(n,r){return n.type&4?new BV(r,n,lg(n,r)):null}function H0(n,r,t,a,h){let i=n.data[r];if(i===null)i=jV(n,r,t,a,h),mz()&&(i.flags|=32);else if(i.type&64){i.type=t,i.value=a,i.attrs=h;let C=dz();i.injectorIndex=C===null?-1:C.injectorIndex}return x_(i,!0),i}function jV(n,r,t,a,h){let i=BA(),C=VA(),F=C?i:i&&i.parent,V=n.data[r]=$V(n,F,t,r,a,h);return UV(n,V,i,C),V}function UV(n,r,t,a){n.firstChild===null&&(n.firstChild=r),t!==null&&(a?t.child==null&&r.parent!==null&&(t.child=r):t.next===null&&(t.next=r,r.prev=t))}function $V(n,r,t,a,h,i){let C=r?r.injectorIndex:-1,F=0;return zA()&&(F|=128),{type:t,index:a,insertBeforeIndex:null,injectorIndex:C,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:F,providerIndexes:0,value:h,attrs:i,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var eY=new RegExp(`^(\\d+)*(${rB}|${iB})*(.*)`);var HV=()=>null;function w0(n,r){return HV(n,r)}var GV=class{},mR=class{},jE=class{resolveComponentFactory(r){throw Error(`No component factory found for ${Rs(r)}.`)}},G0=class{static NULL=new jE},Uo=class{},hg=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>WV()}return n})();function WV(){let n=li(),r=ca(),t=Bc(r.index,n);return(ph(t)?t:n)[Yr]}var qV=(()=>{class n{static \u0275prov=Ct({token:n,providedIn:"root",factory:()=>null})}return n})();function US(n,r,t){let a=t?n.styles:null,h=t?n.classes:null,i=0;if(r!==null)for(let C=0;C<r.length;C++){let F=r[C];if(typeof F=="number")i=F;else if(i==1)h=lE(h,F);else if(i==2){let V=F,K=r[++C];a=lE(a,V+": "+K+";")}}t?n.styles=a:n.stylesWithoutHost=a,t?n.classes=h:n.classesWithoutHost=h}function yr(n,r=Kn.Default){let t=li();if(t===null)return kt(n,r);let a=ca();return sk(a,t,as(n),r)}function gR(){let n="invalid";throw new Error(n)}function yR(n,r,t,a,h){let i=a===null?null:{"":-1},C=h(n,t);if(C!==null){let F,V=null,K=null,oe=XV(C);oe===null?F=C:[F,V,K]=oe,QV(n,r,t,F,i,V,K)}i!==null&&a!==null&&ZV(t,a,i)}function ZV(n,r,t){let a=n.localNames=[];for(let h=0;h<r.length;h+=2){let i=t[r[h+1]];if(i==null)throw new Wt(-301,!1);a.push(r[h],i)}}function XV(n){let r=null,t=!1;for(let C=0;C<n.length;C++){let F=n[C];if(C===0&&_h(F)&&(r=F),F.findHostDirectiveDefs!==null){t=!0;break}}if(!t)return null;let a=null,h=null,i=null;for(let C of n)C.findHostDirectiveDefs!==null&&(a??=[],h??=new Map,i??=new Map,YV(C,a,i,h)),C===r&&(a??=[],a.push(C));return a!==null?(a.push(...r===null?n:n.slice(1)),[a,h,i]):null}function YV(n,r,t,a){let h=r.length;n.findHostDirectiveDefs(n,r,a),t.set(n,[h,r.length-1])}function KV(n,r,t){r.componentOffset=t,(n.components??=[]).push(r.index)}function QV(n,r,t,a,h,i,C){let F=a.length,V=!1;for(let Ye=0;Ye<F;Ye++){let Ne=a[Ye];!V&&_h(Ne)&&(V=!0,KV(n,t,Ye)),xE(f0(t,r),n,Ne.type)}rj(t,n.data.length,F);for(let Ye=0;Ye<F;Ye++){let Ne=a[Ye];Ne.providersResolver&&Ne.providersResolver(Ne)}let K=!1,oe=!1,Ee=qk(n,r,F,null);F>0&&(t.directiveToIndex=new Map);for(let Ye=0;Ye<F;Ye++){let Ne=a[Ye];if(t.mergedAttrs=_C(t.mergedAttrs,Ne.hostAttrs),ej(n,t,r,Ee,Ne),ij(Ee,Ne,h),C!==null&&C.has(Ne)){let[bt,Ut]=C.get(Ne);t.directiveToIndex.set(Ne.type,[Ee,bt+t.directiveStart,Ut+t.directiveStart])}else(i===null||!i.has(Ne))&&t.directiveToIndex.set(Ne.type,Ee);Ne.contentQueries!==null&&(t.flags|=4),(Ne.hostBindings!==null||Ne.hostAttrs!==null||Ne.hostVars!==0)&&(t.flags|=64);let ct=Ne.type.prototype;!K&&(ct.ngOnChanges||ct.ngOnInit||ct.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),K=!0),!oe&&(ct.ngOnChanges||ct.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),oe=!0),Ee++}JV(n,t,i)}function JV(n,r,t){for(let a=r.directiveStart;a<r.directiveEnd;a++){let h=n.data[a];if(t===null||!t.has(h))$S(0,r,h,a),$S(1,r,h,a),GS(r,a,!1);else{let i=t.get(h);HS(0,r,i,a),HS(1,r,i,a),GS(r,a,!0)}}}function $S(n,r,t,a){let h=n===0?t.inputs:t.outputs;for(let i in h)if(h.hasOwnProperty(i)){let C;n===0?C=r.inputs??={}:C=r.outputs??={},C[i]??=[],C[i].push(a),_R(r,i)}}function HS(n,r,t,a){let h=n===0?t.inputs:t.outputs;for(let i in h)if(h.hasOwnProperty(i)){let C=h[i],F;n===0?F=r.hostDirectiveInputs??={}:F=r.hostDirectiveOutputs??={},F[C]??=[],F[C].push(a,i),_R(r,C)}}function _R(n,r){r==="class"?n.flags|=8:r==="style"&&(n.flags|=16)}function GS(n,r,t){let{attrs:a,inputs:h,hostDirectiveInputs:i}=n;if(a===null||!t&&h===null||t&&i===null||IC(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let C=null,F=0;for(;F<a.length;){let V=a[F];if(V===0){F+=4;continue}else if(V===5){F+=2;continue}else if(typeof V=="number")break;if(!t&&h.hasOwnProperty(V)){let K=h[V];for(let oe of K)if(oe===r){C??=[],C.push(V,a[F+1]);break}}else if(t&&i.hasOwnProperty(V)){let K=i[V];for(let oe=0;oe<K.length;oe+=2)if(K[oe]===r){C??=[],C.push(K[oe+1],a[F+1]);break}}F+=2}n.initialInputs??=[],n.initialInputs.push(C)}function ej(n,r,t,a,h){n.data[a]=h;let i=h.factory||(h.factory=Xm(h.type,!0)),C=new Kf(i,_h(h),yr);n.blueprint[a]=C,t[a]=C,tj(n,r,a,qk(n,t,h.hostVars,ua),h)}function tj(n,r,t,a,h){let i=h.hostBindings;if(i){let C=n.hostBindingOpCodes;C===null&&(C=n.hostBindingOpCodes=[]);let F=~r.index;nj(C)!=F&&C.push(F),C.push(t,a,i)}}function nj(n){let r=n.length;for(;r>0;){let t=n[--r];if(typeof t=="number"&&t<0)return t}return 0}function ij(n,r,t){if(t){if(r.exportAs)for(let a=0;a<r.exportAs.length;a++)t[r.exportAs[a]]=n;_h(r)&&(t[""]=n)}}function rj(n,r,t){n.flags|=1,n.directiveStart=r,n.directiveEnd=r+t,n.providerIndexes=r}function vR(n,r,t,a,h,i,C,F){let V=r.consts,K=c0(V,C),oe=H0(r,n,2,a,K);return i&&yR(r,t,oe,c0(V,F),h),oe.mergedAttrs=_C(oe.mergedAttrs,oe.attrs),oe.attrs!==null&&US(oe,oe.attrs,!1),oe.mergedAttrs!==null&&US(oe,oe.mergedAttrs,!0),r.queries!==null&&r.queries.elementStart(r,oe),oe}function bR(n,r){KA(n,r),DA(r)&&n.queries.elementEnd(r)}var E0=class extends G0{ngModule;constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){let t=mh(r);return new Jf(t,this.ngModule)}};function oj(n){return Object.keys(n).map(r=>{let[t,a,h]=n[r],i={propName:t,templateName:r,isSignal:(a&U0.SignalBased)!==0};return h&&(i.transform=h),i})}function sj(n){return Object.keys(n).map(r=>({propName:n[r],templateName:r}))}function aj(n,r,t){let a=r instanceof Nr?r:r?.injector;return a&&n.getStandaloneInjector!==null&&(a=n.getStandaloneInjector(a)||a),a?new vE(t,a):t}function lj(n){let r=n.get(Uo,null);if(r===null)throw new Wt(407,!1);let t=n.get(qV,null),a=n.get(Qf,null);return{rendererFactory:r,sanitizer:t,changeDetectionScheduler:a}}function cj(n,r){let t=(n.selectors[0][0]||"div").toLowerCase();return $k(r,t,t==="svg"?AA:t==="math"?JN:null)}var Jf=class extends mR{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=oj(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=sj(this.componentDef.outputs),this.cachedOutputs}constructor(r,t){super(),this.componentDef=r,this.ngModule=t,this.componentType=r.type,this.selector=VB(r.selectors),this.ngContentSelectors=r.ngContentSelectors??[],this.isBoundToModule=!!t}create(r,t,a,h){ir(22);let i=ni(null);try{let C=this.componentDef,F=a?["ng-version","19.2.2"]:jB(this.componentDef.selectors[0]),V=SC(0,null,null,1,0,null,null,null,null,[F],null),K=aj(C,h||this.ngModule,r),oe=lj(K),Ee=oe.rendererFactory.createRenderer(null,C),Ye=a?YB(Ee,a,C.encapsulation,K):cj(C,Ee),Ne=AC(null,V,null,512|Wk(C),null,null,oe,Ee,K,null,Dk(Ye,K,!0));Ne[Os]=Ye,fC(Ne);let ct=null;try{let bt=vR(Os,V,Ne,"#host",()=>[this.componentDef],!0,0);Ye&&(Gk(Ee,Ye,bt),C_(Ye,Ne)),RC(V,Ne,bt),Mk(V,bt,Ne),bR(V,bt),t!==void 0&&uj(bt,this.ngContentSelectors,t),ct=Bc(bt.index,Ne),Ne[ls]=ct[ls],OC(V,Ne,null)}catch(bt){throw ct!==null&&TE(ct),TE(Ne),bt}finally{ir(23),pC()}return new UE(this.componentType,Ne)}finally{ni(i)}}},UE=class extends GV{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(r,t){super(),this._rootLView=t,this._tNode=lC(t[Qn],Os),this.location=lg(this._tNode,t),this.instance=Bc(this._tNode.index,t)[ls],this.hostView=this.changeDetectorRef=new p_(t,void 0,!1),this.componentType=r}setInput(r,t){let a=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),t))return;let h=this._rootLView,i=PC(a,h[Qn],h,r,t);this.previousInputValues.set(r,t);let C=Bc(a.index,h);UC(C,1)}get injector(){return new Hf(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}};function uj(n,r,t){let a=n.projection=[];for(let h=0;h<r.length;h++){let i=t[h];a.push(i!=null&&i.length?Array.from(i):null)}}var Ua=(()=>{class n{static __NG_ELEMENT_ID__=dj}return n})();function dj(){let n=ca();return wR(n,li())}var hj=Ua,xR=class extends hj{_lContainer;_hostTNode;_hostLView;constructor(r,t,a){super(),this._lContainer=r,this._hostTNode=t,this._hostLView=a}get element(){return lg(this._hostTNode,this._hostLView)}get injector(){return new Hf(this._hostTNode,this._hostLView)}get parentInjector(){let r=vC(this._hostTNode,this._hostLView);if(ek(r)){let t=h0(r,this._hostLView),a=d0(r),h=t[Qn].data[a+8];return new Hf(h,t)}else return new Hf(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){let t=WS(this._lContainer);return t!==null&&t[r]||null}get length(){return this._lContainer.length-Ps}createEmbeddedView(r,t,a){let h,i;typeof a=="number"?h=a:a!=null&&(h=a.index,i=a.injector);let C=w0(this._lContainer,r.ssrId),F=r.createEmbeddedViewImpl(t||{},i,C);return this.insertImpl(F,h,v0(this._hostTNode,C)),F}createComponent(r,t,a,h,i){let C=r&&!XN(r),F;if(C)F=t;else{let ct=t||{};F=ct.index,a=ct.injector,h=ct.projectableNodes,i=ct.environmentInjector||ct.ngModuleRef}let V=C?r:new Jf(mh(r)),K=a||this.parentInjector;if(!i&&V.ngModule==null){let bt=(C?K:this.parentInjector).get(Nr,null);bt&&(i=bt)}let oe=mh(V.componentType??{}),Ee=w0(this._lContainer,oe?.id??null),Ye=Ee?.firstChild??null,Ne=V.create(K,h,Ye,i);return this.insertImpl(Ne.hostView,F,v0(this._hostTNode,Ee)),Ne}insert(r,t){return this.insertImpl(r,t,!0)}insertImpl(r,t,a){let h=r._lView;if(nz(h)){let F=this.indexOf(r);if(F!==-1)this.detach(F);else{let V=h[jo],K=new xR(V,V[zs],V[jo]);K.detach(K.indexOf(r))}}let i=this._adjustIndex(t),C=this._lContainer;return $C(C,h,i,a),r.attachToViewContainerRef(),pA(iE(C),i,r),r}move(r,t){return this.insert(r,t)}indexOf(r){let t=WS(this._lContainer);return t!==null?t.indexOf(r):-1}remove(r){let t=this._adjustIndex(r,-1),a=x0(this._lContainer,t);a&&(r0(iE(this._lContainer),t),BC(a[Qn],a))}detach(r){let t=this._adjustIndex(r,-1),a=x0(this._lContainer,t);return a&&r0(iE(this._lContainer),t)!=null?new p_(a):null}_adjustIndex(r,t=0){return r??this.length+t}};function WS(n){return n[a0]}function iE(n){return n[a0]||(n[a0]=[])}function wR(n,r){let t,a=r[n.index];return ed(a)?t=a:(t=fR(a,r,null,n),r[n.index]=t,kC(r,t)),pj(t,r,n,a),new xR(t,n,r)}function fj(n,r){let t=n[Yr],a=t.createComment(""),h=Uc(r,n),i=t.parentNode(h);return _0(t,i,a,t.nextSibling(h),!1),a}var pj=yj,mj=()=>!1;function gj(n,r,t){return mj(n,r,t)}function yj(n,r,t,a){if(n[Zf])return;let h;t.type&8?h=zc(a):h=fj(r,t),n[Zf]=h}var $E=class n{queryList;matches=null;constructor(r){this.queryList=r}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},HE=class n{queries;constructor(r=[]){this.queries=r}createEmbeddedView(r){let t=r.queries;if(t!==null){let a=r.contentQueries!==null?r.contentQueries[0]:t.length,h=[];for(let i=0;i<a;i++){let C=t.getByIndex(i),F=this.queries[C.indexInDeclarationView];h.push(F.clone())}return new n(h)}return null}insertView(r){this.dirtyQueriesWithMatches(r)}detachView(r){this.dirtyQueriesWithMatches(r)}finishViewCreation(r){this.dirtyQueriesWithMatches(r)}dirtyQueriesWithMatches(r){for(let t=0;t<this.queries.length;t++)GC(r,t).matches!==null&&this.queries[t].setDirty()}},GE=class{flags;read;predicate;constructor(r,t,a=null){this.flags=t,this.read=a,typeof r=="string"?this.predicate=Dj(r):this.predicate=r}},WE=class n{queries;constructor(r=[]){this.queries=r}elementStart(r,t){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(r,t)}elementEnd(r){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(r)}embeddedTView(r){let t=null;for(let a=0;a<this.length;a++){let h=t!==null?t.length:0,i=this.getByIndex(a).embeddedTView(r,h);i&&(i.indexInDeclarationView=a,t!==null?t.push(i):t=[i])}return t!==null?new n(t):null}template(r,t){for(let a=0;a<this.queries.length;a++)this.queries[a].template(r,t)}getByIndex(r){return this.queries[r]}get length(){return this.queries.length}track(r){this.queries.push(r)}},qE=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(r,t=-1){this.metadata=r,this._declarationNodeIndex=t}elementStart(r,t){this.isApplyingToNode(t)&&this.matchTNode(r,t)}elementEnd(r){this._declarationNodeIndex===r.index&&(this._appliesToNextNode=!1)}template(r,t){this.elementStart(r,t)}embeddedTView(r,t){return this.isApplyingToNode(r)?(this.crossesNgTemplate=!0,this.addMatch(-r.index,t),new n(this.metadata)):null}isApplyingToNode(r){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,a=r.parent;for(;a!==null&&a.type&8&&a.index!==t;)a=a.parent;return t===(a!==null?a.index:-1)}return this._appliesToNextNode}matchTNode(r,t){let a=this.metadata.predicate;if(Array.isArray(a))for(let h=0;h<a.length;h++){let i=a[h];this.matchTNodeWithReadOption(r,t,_j(t,i)),this.matchTNodeWithReadOption(r,t,Jb(t,r,i,!1,!1))}else a===jc?t.type&4&&this.matchTNodeWithReadOption(r,t,-1):this.matchTNodeWithReadOption(r,t,Jb(t,r,a,!1,!1))}matchTNodeWithReadOption(r,t,a){if(a!==null){let h=this.metadata.read;if(h!==null)if(h===Bi||h===Ua||h===jc&&t.type&4)this.addMatch(t.index,-2);else{let i=Jb(t,r,h,!1,!1);i!==null&&this.addMatch(t.index,i)}else this.addMatch(t.index,a)}}addMatch(r,t){this.matches===null?this.matches=[r,t]:this.matches.push(r,t)}};function _j(n,r){let t=n.localNames;if(t!==null){for(let a=0;a<t.length;a+=2)if(t[a]===r)return t[a+1]}return null}function vj(n,r){return n.type&11?lg(n,r):n.type&4?HC(n,r):null}function bj(n,r,t,a){return t===-1?vj(r,n):t===-2?xj(n,r,a):h_(n,n[Qn],t,r)}function xj(n,r,t){if(t===Bi)return lg(r,n);if(t===jc)return HC(r,n);if(t===Ua)return wR(r,n)}function ER(n,r,t,a){let h=r[Xu].queries[a];if(h.matches===null){let i=n.data,C=t.matches,F=[];for(let V=0;C!==null&&V<C.length;V+=2){let K=C[V];if(K<0)F.push(null);else{let oe=i[K];F.push(bj(r,oe,C[V+1],t.metadata.read))}}h.matches=F}return h.matches}function ZE(n,r,t,a){let h=n.queries.getByIndex(t),i=h.matches;if(i!==null){let C=ER(n,r,h,t);for(let F=0;F<i.length;F+=2){let V=i[F];if(V>0)a.push(C[F/2]);else{let K=i[F+1],oe=r[-V];for(let Ee=Ps;Ee<oe.length;Ee++){let Ye=oe[Ee];Ye[Wf]===Ye[jo]&&ZE(Ye[Qn],Ye,K,a)}if(oe[Qm]!==null){let Ee=oe[Qm];for(let Ye=0;Ye<Ee.length;Ye++){let Ne=Ee[Ye];ZE(Ne[Qn],Ne,K,a)}}}}}return a}function wj(n,r){return n[Xu].queries[r].queryList}function Ej(n,r,t){let a=new y0((t&4)===4);return oz(n,r,a,a.destroy),(r[Xu]??=new HE).queries.push(new $E(a))-1}function Cj(n,r,t){let a=$o();return a.firstCreatePass&&(Tj(a,new GE(n,r,t),-1),(r&2)===2&&(a.staticViewQueries=!0)),Ej(a,li(),r)}function Dj(n){return n.split(",").map(r=>r.trim())}function Tj(n,r,t){n.queries===null&&(n.queries=new WE),n.queries.track(new qE(r,t))}function GC(n,r){return n.queries.getByIndex(r)}function Mj(n,r){let t=n[Qn],a=GC(t,r);return a.crossesNgTemplate?ZE(t,n,r,[]):ER(t,n,a,r)}function Ij(n){let r=[],t=new Map;function a(h){let i=t.get(h);if(!i){let C=n(h);t.set(h,i=C.then(Rj))}return i}return C0.forEach((h,i)=>{let C=[];h.templateUrl&&C.push(a(h.templateUrl).then(K=>{h.template=K}));let F=typeof h.styles=="string"?[h.styles]:h.styles||[];if(h.styles=F,h.styleUrl&&h.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(h.styleUrls?.length){let K=h.styles.length,oe=h.styleUrls;h.styleUrls.forEach((Ee,Ye)=>{F.push(""),C.push(a(Ee).then(Ne=>{F[K+Ye]=Ne,oe.splice(oe.indexOf(Ee),1),oe.length==0&&(h.styleUrls=void 0)}))})}else h.styleUrl&&C.push(a(h.styleUrl).then(K=>{F.push(K),h.styleUrl=void 0}));let V=Promise.all(C).then(()=>Pj(i));r.push(V)}),Aj(),Promise.all(r).then(()=>{})}var C0=new Map,Sj=new Set;function Aj(){let n=C0;return C0=new Map,n}function kj(){return C0.size===0}function Rj(n){return typeof n=="string"?n:n.text()}function Pj(n){Sj.delete(n)}var gh=class{},WC=class{};var D0=class extends gh{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new E0(this);constructor(r,t,a,h=!0){super(),this.ngModuleType=r,this._parent=t;let i=yA(r);this._bootstrapComponents=Vk(i.bootstrap),this._r3Injector=ck(r,t,[{provide:gh,useValue:this},{provide:G0,useValue:this.componentFactoryResolver},...a],Rs(r),new Set(["environment"])),h&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}},T0=class extends WC{moduleType;constructor(r){super(),this.moduleType=r}create(r){return new D0(this.moduleType,r,[])}};function Oj(n,r,t){return new D0(n,r,t,!1)}var XE=class extends gh{injector;componentFactoryResolver=new E0(this);instance=null;constructor(r){super();let t=new l_([...r.providers,{provide:gh,useValue:this},{provide:G0,useValue:this.componentFactoryResolver}],r.parent||F0(),r.debugName,new Set(["environment"]));this.injector=t,r.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}};function W0(n,r,t=null){return new XE({providers:n,parent:r,debugName:t,runEnvironmentInitializers:!0}).injector}var Lj=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let a=_A(!1,t.type),h=a.length>0?W0([a],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,h)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ct({token:n,providedIn:"environment",factory:()=>new n(kt(Nr))})}return n})();function Jn(n){return y_(()=>{let r=CR(n),t=vn(ht({},r),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===gk.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&n.dependencies||null,getStandaloneInjector:r.standalone?h=>h.get(Lj).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Vc.Emulated,styles:n.styles||la,_:null,schemas:n.schemas||null,tView:null,id:""});r.standalone&&dg("NgStandalone"),DR(t);let a=n.dependencies;return t.directiveDefs=qS(a,!1),t.pipeDefs=qS(a,!0),t.id=Vj(t),t})}function Fj(n){return mh(n)||FN(n)}function Nj(n){return n!==null}function tn(n){return y_(()=>({type:n.type,bootstrap:n.bootstrap||la,declarations:n.declarations||la,imports:n.imports||la,exports:n.exports||la,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function zj(n,r){if(n==null)return Ym;let t={};for(let a in n)if(n.hasOwnProperty(a)){let h=n[a],i,C,F,V;Array.isArray(h)?(F=h[0],i=h[1],C=h[2]??i,V=h[3]||null):(i=h,C=h,F=U0.None,V=null),t[i]=[a,F,V],r[i]=C}return t}function Bj(n){if(n==null)return Ym;let r={};for(let t in n)n.hasOwnProperty(t)&&(r[n[t]]=t);return r}function _r(n){return y_(()=>{let r=CR(n);return DR(r),r})}function CR(n){let r={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:r,inputConfig:n.inputs||Ym,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||la,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:zj(n.inputs,r),outputs:Bj(n.outputs),debugInfo:null}}function DR(n){n.features?.forEach(r=>r(n))}function qS(n,r){if(!n)return null;let t=r?NN:Fj;return()=>(typeof n=="function"?n():n).map(a=>t(a)).filter(Nj)}function Vj(n){let r=0,t=typeof n.consts=="function"?"":n.consts,a=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,t,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let i of a.join("|"))r=Math.imul(31,r)+i.charCodeAt(0)<<0;return r+=2147483648,"c"+r}function qC(n,r,t){return n[r]=t}function jj(n,r){return n[r]}function Qu(n,r,t){let a=n[r];return Object.is(a,t)?!1:(n[r]=t,!0)}function M0(n,r,t,a){let h=Qu(n,r,t);return Qu(n,r+1,a)||h}function Uj(n,r,t,a,h,i){let C=M0(n,r,t,a);return M0(n,r+2,h,i)||C}function $j(n,r,t,a,h,i,C,F,V){let K=r.consts,oe=H0(r,n,4,C||null,F||null);NA()&&yR(r,t,oe,c0(K,V),Qk),oe.mergedAttrs=_C(oe.mergedAttrs,oe.attrs),KA(r,oe);let Ee=oe.tView=SC(2,oe,a,h,i,r.directiveRegistry,r.pipeRegistry,null,r.schemas,K,null);return r.queries!==null&&(r.queries.template(r,oe),Ee.queries=r.queries.embeddedTView(oe)),oe}function TR(n,r,t,a,h,i,C,F,V,K){let oe=t+Os,Ee=r.firstCreatePass?$j(oe,r,n,a,h,i,C,F,V):r.data[oe];x_(Ee,!1);let Ye=Hj(r,n,Ee,t);gC()&&VC(r,n,Ye,Ee),C_(Ye,n);let Ne=fR(Ye,n,Ye,Ee);return n[oe]=Ne,kC(n,Ne),gj(Ne,Ee,n),aC(Ee)&&RC(r,n,Ee),V!=null&&Yk(n,Ee,K),Ee}function da(n,r,t,a,h,i,C,F){let V=li(),K=$o(),oe=c0(K.consts,i);return TR(V,K,n,r,t,a,h,oe,C,F),da}var Hj=Gj;function Gj(n,r,t,a){return yC(!0),r[Yr].createComment("")}var ZC=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var XC=new pt(""),M_=new pt(""),q0=(()=>{class n{_ngZone;registry;_isZoneStable=!0;_callbacks=[];taskTrackingZone=null;constructor(t,a,h){this._ngZone=t,this.registry=a,YC||(Wj(h),h.addToWindow(a)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{bn.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>a.updateCb&&a.updateCb(t)?(clearTimeout(a.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,a,h){let i=-1;a&&a>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(C=>C.timeoutId!==i),t()},a)),this._callbacks.push({doneCb:t,timeoutId:i,updateCb:h})}whenStable(t,a,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,a,h),this._runCallbacksIfReady()}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,a,h){return[]}static \u0275fac=function(a){return new(a||n)(kt(bn),kt(Z0),kt(M_))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),Z0=(()=>{class n{_applications=new Map;registerApplication(t,a){this._applications.set(t,a)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,a=!0){return YC?.findTestabilityInTree(this,t,a)??null}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();function Wj(n){YC=n}var YC,MR=(()=>{class n{static \u0275prov=Ct({token:n,providedIn:"root",factory:()=>new YE})}return n})(),YE=class{queuedEffectCount=0;queues=new Map;schedule(r){this.enqueue(r)}remove(r){let t=r.zone,a=this.queues.get(t);a.has(r)&&(a.delete(r),this.queuedEffectCount--)}enqueue(r){let t=r.zone;this.queues.has(t)||this.queues.set(t,new Set);let a=this.queues.get(t);a.has(r)||(this.queuedEffectCount++,a.add(r))}flush(){for(;this.queuedEffectCount>0;)for(let[r,t]of this.queues)r===null?this.flushQueue(t):r.run(()=>this.flushQueue(t))}flushQueue(r){for(let t of r)r.delete(t),this.queuedEffectCount--,t.run()}};function fg(n){return!!n&&typeof n.then=="function"}function IR(n){return!!n&&typeof n.subscribe=="function"}var X0=new pt("");var SR=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,a)=>{this.resolve=t,this.reject=a});appInits=Re(X0,{optional:!0})??[];injector=Re(ci);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let h of this.appInits){let i=Ns(this.injector,h);if(fg(i))t.push(i);else if(IR(i)){let C=new Promise((F,V)=>{i.subscribe({complete:F,error:V})});t.push(C)}}let a=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{a()}).catch(h=>{this.reject(h)}),t.length===0&&a(),this.initialized=!0}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Y0=new pt("");function qj(){BI(()=>{throw new Wt(600,!1)})}function Zj(n){return n.isBoundToModule}var Xj=10;function AR(n,r){return Array.isArray(r)?r.reduce(AR,n):ht(ht({},n),r)}var Fs=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Re(Wz);afterRenderManager=Re(Ek);zonelessEnabled=Re(xC);rootEffectScheduler=Re(MR);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new jn;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=Re(td).hasPendingTasks.pipe(ln(t=>!t));constructor(){Re(ug,{optional:!0})}whenStable(){let t;return new Promise(a=>{t=this.isStable.subscribe({next:h=>{h&&a()}})}).finally(()=>{t.unsubscribe()})}_injector=Re(Nr);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,a){ir(10);let h=t instanceof mR;if(!this._injector.get(SR).done){let Ye="";throw new Wt(405,Ye)}let C;h?C=t:C=this._injector.get(G0).resolveComponentFactory(t),this.componentTypes.push(C.componentType);let F=Zj(C)?void 0:this._injector.get(gh),V=a||C.selector,K=C.create(ci.NULL,[],V,F),oe=K.location.nativeElement,Ee=K.injector.get(XC,null);return Ee?.registerApplication(oe),K.onDestroy(()=>{this.detachView(K.hostView),e0(this.components,K),Ee?.unregisterApplication(oe)}),this._loadComponent(K),ir(11,K),K}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){ir(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(DC.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new Wt(101,!1);let t=ni(null);try{this._runningTick=!0,this.synchronize()}catch(a){this.internalErrorHandler(a)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,ni(t),this.afterTick.next(),ir(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Uo,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<Xj;)ir(14),this.synchronizeOnce(),ir(15)}synchronizeOnce(){if(this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let t=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:a,notifyErrorHandler:h}of this.allViews)Yj(a,h,t,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>z0(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let a=t;this._views.push(a),a.attachToAppRef(this)}detachView(t){let a=t;e0(this._views,a),a.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Y0,[]).forEach(h=>h(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>e0(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Wt(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function e0(n,r){let t=n.indexOf(r);t>-1&&n.splice(t,1)}function Yj(n,r,t,a){if(!t&&!z0(n))return;cR(n,r,t&&!a?0:1)}function Ho(n,r,t,a){let h=li(),i=w_();if(Qu(h,i,r)){let C=$o(),F=mC();rV(F,h,n,r,t,a)}return Ho}function Kj(n,r,t,a){return Qu(n,w_(),t)?r+Zm(t)+a:ua}function Qj(n,r,t,a,h,i){let C=fz(),F=M0(n,C,t,h);return dC(2),F?r+Zm(t)+a+Zm(h)+i:ua}function Zb(n,r){return n<<17|r<<2}function ep(n){return n>>17&32767}function Jj(n){return(n&2)==2}function e3(n,r){return n&131071|r<<17}function KE(n){return n|2}function eg(n){return(n&131068)>>2}function rE(n,r){return n&-131069|r<<2}function t3(n){return(n&1)===1}function QE(n){return n|1}function n3(n,r,t,a,h,i){let C=i?r.classBindings:r.styleBindings,F=ep(C),V=eg(C);n[a]=t;let K=!1,oe;if(Array.isArray(t)){let Ee=t;oe=Ee[1],(oe===null||__(Ee,oe)>0)&&(K=!0)}else oe=t;if(h)if(V!==0){let Ye=ep(n[F+1]);n[a+1]=Zb(Ye,F),Ye!==0&&(n[Ye+1]=rE(n[Ye+1],a)),n[F+1]=e3(n[F+1],a)}else n[a+1]=Zb(F,0),F!==0&&(n[F+1]=rE(n[F+1],a)),F=a;else n[a+1]=Zb(V,0),F===0?F=a:n[V+1]=rE(n[V+1],a),V=a;K&&(n[a+1]=KE(n[a+1])),ZS(n,oe,a,!0),ZS(n,oe,a,!1),i3(r,oe,n,a,i),C=Zb(F,V),i?r.classBindings=C:r.styleBindings=C}function i3(n,r,t,a,h){let i=h?n.residualClasses:n.residualStyles;i!=null&&typeof r=="string"&&__(i,r)>=0&&(t[a+1]=QE(t[a+1]))}function ZS(n,r,t,a){let h=n[t+1],i=r===null,C=a?ep(h):eg(h),F=!1;for(;C!==0&&(F===!1||i);){let V=n[C],K=n[C+1];r3(V,r)&&(F=!0,n[C+1]=a?QE(K):KE(K)),C=a?ep(K):eg(K)}F&&(n[t+1]=a?KE(h):QE(h))}function r3(n,r){return n===null||r==null||(Array.isArray(n)?n[1]:n)===r?!0:Array.isArray(n)&&typeof r=="string"?__(n,r)>=0:!1}var oo={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function kR(n){return n.substring(oo.key,oo.keyEnd)}function o3(n){return n.substring(oo.value,oo.valueEnd)}function s3(n){return OR(n),RR(n,tg(n,0,oo.textEnd))}function RR(n,r){let t=oo.textEnd;return t===r?-1:(r=oo.keyEnd=l3(n,oo.key=r,t),tg(n,r,t))}function a3(n){return OR(n),PR(n,tg(n,0,oo.textEnd))}function PR(n,r){let t=oo.textEnd,a=oo.key=tg(n,r,t);return t===a?-1:(a=oo.keyEnd=c3(n,a,t),a=XS(n,a,t,58),a=oo.value=tg(n,a,t),a=oo.valueEnd=u3(n,a,t),XS(n,a,t,59))}function OR(n){oo.key=0,oo.keyEnd=0,oo.value=0,oo.valueEnd=0,oo.textEnd=n.length}function tg(n,r,t){for(;r<t&&n.charCodeAt(r)<=32;)r++;return r}function l3(n,r,t){for(;r<t&&n.charCodeAt(r)>32;)r++;return r}function c3(n,r,t){let a;for(;r<t&&((a=n.charCodeAt(r))===45||a===95||(a&-33)>=65&&(a&-33)<=90||a>=48&&a<=57);)r++;return r}function XS(n,r,t,a){return r=tg(n,r,t),r<t&&r++,r}function u3(n,r,t){let a=-1,h=-1,i=-1,C=r,F=C;for(;C<t;){let V=n.charCodeAt(C++);if(V===59)return F;V===34||V===39?F=C=YS(n,V,C,t):r===C-4&&i===85&&h===82&&a===76&&V===40?F=C=YS(n,41,C,t):V>32&&(F=C),i=h,h=a,a=V&-33}return F}function YS(n,r,t,a){let h=-1,i=t;for(;i<a;){let C=n.charCodeAt(i++);if(C==r&&h!==92)return i;C==92&&h===92?h=0:h=C}throw new Error}function Xi(n,r,t){let a=li(),h=w_();if(Qu(a,h,r)){let i=$o(),C=mC();Kk(i,C,a,n,r,a[Yr],t,!1)}return Xi}function JE(n,r,t,a,h){PC(r,n,t,h?"class":"style",a)}function zr(n,r){return f3(n,r,null,!0),zr}function LR(n){FR(BR,d3,n,!1)}function d3(n,r){for(let t=a3(r);t>=0;t=PR(r,t))BR(n,kR(r),o3(r))}function ip(n){FR(v3,h3,n,!0)}function h3(n,r){for(let t=s3(r);t>=0;t=RR(r,t))O0(n,kR(r),!0)}function f3(n,r,t,a){let h=li(),i=$o(),C=dC(2);if(i.firstUpdatePass&&zR(i,n,C,a),r!==ua&&Qu(h,C,r)){let F=i.data[vh()];VR(i,F,h,h[Yr],n,h[C+1]=x3(r,t),a,C)}}function FR(n,r,t,a){let h=$o(),i=dC(2);h.firstUpdatePass&&zR(h,null,i,a);let C=li();if(t!==ua&&Qu(C,i,t)){let F=h.data[vh()];if(jR(F,a)&&!NR(h,i)){let V=a?F.classesWithoutHost:F.stylesWithoutHost;V!==null&&(t=lE(V,t||"")),JE(h,F,C,t,a)}else b3(h,F,C,C[Yr],C[i+1],C[i+1]=_3(n,r,t),a,i)}}function NR(n,r){return r>=n.expandoStartIndex}function zR(n,r,t,a){let h=n.data;if(h[t+1]===null){let i=h[vh()],C=NR(n,t);jR(i,a)&&r===null&&!C&&(r=!1),r=p3(h,i,r,a),n3(h,i,r,t,C,a)}}function p3(n,r,t,a){let h=_z(n),i=a?r.residualClasses:r.residualStyles;if(h===null)(a?r.classBindings:r.styleBindings)===0&&(t=oE(null,n,r,t,a),t=m_(t,r.attrs,a),i=null);else{let C=r.directiveStylingLast;if(C===-1||n[C]!==h)if(t=oE(h,n,r,t,a),i===null){let V=m3(n,r,a);V!==void 0&&Array.isArray(V)&&(V=oE(null,n,r,V[1],a),V=m_(V,r.attrs,a),g3(n,r,a,V))}else i=y3(n,r,a)}return i!==void 0&&(a?r.residualClasses=i:r.residualStyles=i),t}function m3(n,r,t){let a=t?r.classBindings:r.styleBindings;if(eg(a)!==0)return n[ep(a)]}function g3(n,r,t,a){let h=t?r.classBindings:r.styleBindings;n[ep(h)]=a}function y3(n,r,t){let a,h=r.directiveEnd;for(let i=1+r.directiveStylingLast;i<h;i++){let C=n[i].hostAttrs;a=m_(a,C,t)}return m_(a,r.attrs,t)}function oE(n,r,t,a,h){let i=null,C=t.directiveEnd,F=t.directiveStylingLast;for(F===-1?F=t.directiveStart:F++;F<C&&(i=r[F],a=m_(a,i.hostAttrs,h),i!==n);)F++;return n!==null&&(t.directiveStylingLast=F),a}function m_(n,r,t){let a=t?1:2,h=-1;if(r!==null)for(let i=0;i<r.length;i++){let C=r[i];typeof C=="number"?h=C:h===a&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),O0(n,C,t?!0:r[++i]))}return n===void 0?null:n}function _3(n,r,t){if(t==null||t==="")return la;let a=[],h=Hl(t);if(Array.isArray(h))for(let i=0;i<h.length;i++)n(a,h[i],!0);else if(typeof h=="object")for(let i in h)h.hasOwnProperty(i)&&n(a,i,h[i]);else typeof h=="string"&&r(a,h);return a}function BR(n,r,t){O0(n,r,Hl(t))}function v3(n,r,t){let a=String(r);a!==""&&!a.includes(" ")&&O0(n,a,t)}function b3(n,r,t,a,h,i,C,F){h===ua&&(h=la);let V=0,K=0,oe=0<h.length?h[0]:null,Ee=0<i.length?i[0]:null;for(;oe!==null||Ee!==null;){let Ye=V<h.length?h[V+1]:void 0,Ne=K<i.length?i[K+1]:void 0,ct=null,bt;oe===Ee?(V+=2,K+=2,Ye!==Ne&&(ct=Ee,bt=Ne)):Ee===null||oe!==null&&oe<Ee?(V+=2,ct=oe):(K+=2,ct=Ee,bt=Ne),ct!==null&&VR(n,r,t,a,ct,bt,C,F),oe=V<h.length?h[V]:null,Ee=K<i.length?i[K]:null}}function VR(n,r,t,a,h,i,C,F){if(!(r.type&3))return;let V=n.data,K=V[F+1],oe=t3(K)?KS(V,r,t,h,eg(K),C):void 0;if(!I0(oe)){I0(i)||Jj(K)&&(i=KS(V,null,t,h,F,C));let Ee=kA(vh(),t);xV(a,C,Ee,h,i)}}function KS(n,r,t,a,h,i){let C=r===null,F;for(;h>0;){let V=n[h],K=Array.isArray(V),oe=K?V[1]:V,Ee=oe===null,Ye=t[h+1];Ye===ua&&(Ye=Ee?la:void 0);let Ne=Ee?Y1(Ye,a):oe===a?Ye:void 0;if(K&&!I0(Ne)&&(Ne=Y1(V,a)),I0(Ne)&&(F=Ne,C))return F;let ct=n[h+1];h=C?ep(ct):eg(ct)}if(r!==null){let V=i?r.residualClasses:r.residualStyles;V!=null&&(F=Y1(V,a))}return F}function I0(n){return n!==void 0}function x3(n,r){return n==null||n===""||(typeof r=="string"?n=n+r:typeof n=="object"&&(n=Rs(Hl(n)))),n}function jR(n,r){return(n.flags&(r?8:16))!==0}function pg(n,r){dg("NgControlFlow");let t=li(),a=w_(),h=t[a]!==ua?t[a]:-1,i=h!==-1?QS(t,Os+h):void 0,C=0;if(Qu(t,a,n)){let F=ni(null);try{if(i!==void 0&&FV(i,C),n!==-1){let V=Os+n,K=QS(t,V),oe=w3(t[Qn],V),Ee=w0(K,oe.tView.ssrId),Ye=LC(t,oe,r,{dehydratedView:Ee});$C(K,Ye,C,v0(oe,Ee))}}finally{ni(F)}}else if(i!==void 0){let F=LV(i,C);F!==void 0&&(F[ls]=r)}}function QS(n,r){return n[r]}function w3(n,r){return lC(n,r)}function Fn(n,r,t,a){let h=li(),i=$o(),C=Os+n,F=h[Yr],V=i.firstCreatePass?vR(C,i,h,r,Qk,NA(),t,a):i.data[C],K=E3(i,h,V,F,r,n);h[C]=K;let oe=aC(V);return x_(V,!0),Gk(F,K,V),!NC(V)&&gC()&&VC(i,h,K,V),(sz()===0||oe)&&C_(K,h),az(),oe&&(RC(i,h,V),Mk(i,V,h)),a!==null&&Yk(h,V),Fn}function Wn(){let n=ca();VA()?jA():(n=n.parent,x_(n,!1));let r=n;cz(r)&&uz(),lz();let t=$o();return t.firstCreatePass&&bR(t,r),r.classesWithoutHost!=null&&Cz(r)&&JE(t,r,li(),r.classesWithoutHost,!0),r.stylesWithoutHost!=null&&Dz(r)&&JE(t,r,li(),r.stylesWithoutHost,!1),Wn}function rr(n,r,t,a){return Fn(n,r,t,a),Wn(),rr}var E3=(n,r,t,a,h,i)=>(yC(!0),$k(a,h,xz()));function I_(){return li()}function mg(n,r,t){let a=li(),h=w_();if(Qu(a,h,r)){let i=$o(),C=mC();Kk(i,C,a,n,r,a[Yr],t,!0)}return mg}var S0="en-US";var C3=S0;function D3(n){typeof n=="string"&&(C3=n.toLowerCase().replace(/_/g,"-"))}var T3=(n,r,t)=>{};function Tr(n,r,t,a){let h=li(),i=$o(),C=ca();return I3(i,h,h[Yr],C,n,r,a),Tr}function M3(n,r,t,a){let h=n.cleanup;if(h!=null)for(let i=0;i<h.length-1;i+=2){let C=h[i];if(C===t&&h[i+1]===a){let F=r[s0],V=h[i+2];return F.length>V?F[V]:null}typeof C=="string"&&(i+=2)}return null}function I3(n,r,t,a,h,i,C){let F=aC(a),K=n.firstCreatePass?FA(n):null,oe=r[ls],Ee=LA(r),Ye=!0;if(a.type&3||C){let Ne=Uc(a,r),ct=C?C(Ne):Ne,bt=Ee.length,Ut=C?yi=>C(zc(yi[a.index])):a.index,Qt=null;if(!C&&F&&(Qt=M3(n,r,h,a.index)),Qt!==null){let yi=Qt.__ngLastListenerFn__||Qt;yi.__ngNextListenerFn__=i,Qt.__ngLastListenerFn__=i,Ye=!1}else{i=tA(a,r,oe,i),T3(ct,h,i);let yi=t.listen(ct,h,i);Ee.push(i,yi),K&&K.push(h,Ut,bt,bt+1)}}else i=tA(a,r,oe,i);if(Ye){let Ne=a.outputs?.[h],ct=a.hostDirectiveOutputs?.[h];if(ct&&ct.length)for(let bt=0;bt<ct.length;bt+=2){let Ut=ct[bt],Qt=ct[bt+1];JS(a,n,r,Ut,Qt,h,i,Ee,K)}if(Ne&&Ne.length)for(let bt of Ne)JS(a,n,r,bt,h,h,i,Ee,K)}}function JS(n,r,t,a,h,i,C,F,V){let K=t[a],Ee=r.data[a].outputs[h],Ne=K[Ee].subscribe(C),ct=F.length;F.push(C,Ne),V&&V.push(i,n.index,ct,-(ct+1))}function eA(n,r,t,a){let h=ni(null);try{return ir(6,r,t),t(a)!==!1}catch(i){return Jk(n,i),!1}finally{ir(7,r,t),ni(h)}}function tA(n,r,t,a){return function h(i){if(i===Function)return a;let C=rg(n)?Bc(n.index,r):r;UC(C,5);let F=eA(r,t,a,i),V=h.__ngNextListenerFn__;for(;V;)F=eA(r,t,V,i)&&F,V=V.__ngNextListenerFn__;return F}}function Gc(n=1){return bz(n)}function S3(n,r){let t=null,a=LB(n);for(let h=0;h<r.length;h++){let i=r[h];if(i==="*"){t=h;continue}if(a===null?Uk(n,i,!0):zB(a,i))return h}return t}function ha(n){let r=li()[Va][zs];if(!r.projection){let t=n?n.length:1,a=r.projection=PN(t,null),h=a.slice(),i=r.child;for(;i!==null;){if(i.type!==128){let C=n?S3(i,n):0;C!==null&&(h[C]?h[C].projectionNext=i:a[C]=i,h[C]=i)}i=i.next}}}function fa(n,r=0,t,a,h,i){let C=li(),F=$o(),V=a?n+1:null;V!==null&&TR(C,F,V,a,h,i,null,t);let K=H0(F,Os+n,16,null,t||null);K.projection===null&&(K.projection=r),jA();let Ee=!C[c_]||zA();C[Va][zs].projection[K.projection]===null&&V!==null?A3(C,F,V):Ee&&!NC(K)&&vV(F,C,K)}function A3(n,r,t){let a=Os+t,h=r.data[a],i=n[a],C=w0(i,h.tView.ssrId),F=LC(n,h,void 0,{dehydratedView:C});$C(i,F,0,v0(h,C))}function Wc(n,r,t){Cj(n,r,t)}function Gl(n){let r=li(),t=$o(),a=$A();hC(a+1);let h=GC(t,a);if(n.dirty&&tz(r)===((h.metadata.flags&2)===2)){if(h.matches===null)n.reset([]);else{let i=Mj(r,a);n.reset(i,Xz),n.notifyOnChanges()}return!0}return!1}function Wl(){return wj(li(),$A())}function KC(n){let r=hz();return ez(r,Os+n)}function so(n,r=""){let t=li(),a=$o(),h=n+Os,i=a.firstCreatePass?H0(a,h,1,r,null):a.data[h],C=k3(a,t,i,r,n);t[h]=C,gC()&&VC(a,t,C,i),x_(i,!1)}var k3=(n,r,t,a,h)=>(yC(!0),UB(r[Yr],a));function gg(n){return $a("",n,""),gg}function $a(n,r,t){let a=li(),h=Kj(a,n,r,t);return h!==ua&&UR(a,vh(),h),$a}function QC(n,r,t,a,h){let i=li(),C=Qj(i,n,r,t,a,h);return C!==ua&&UR(i,vh(),C),QC}function UR(n,r,t){let a=kA(r,n);$B(n[Yr],a,t)}function R3(n,r,t){let a=$o();if(a.firstCreatePass){let h=_h(n);eC(t,a.data,a.blueprint,h,!0),eC(r,a.data,a.blueprint,h,!1)}}function eC(n,r,t,a,h){if(n=as(n),Array.isArray(n))for(let i=0;i<n.length;i++)eC(n[i],r,t,a,h);else{let i=$o(),C=li(),F=ca(),V=Km(n)?n:as(n.provide),K=xA(n),oe=F.providerIndexes&1048575,Ee=F.directiveStart,Ye=F.providerIndexes>>20;if(Km(n)||!n.multi){let Ne=new Kf(K,h,yr),ct=aE(V,r,h?oe:oe+Ye,Ee);ct===-1?(xE(f0(F,C),i,V),sE(i,n,r.length),r.push(V),F.directiveStart++,F.directiveEnd++,h&&(F.providerIndexes+=1048576),t.push(Ne),C.push(Ne)):(t[ct]=Ne,C[ct]=Ne)}else{let Ne=aE(V,r,oe+Ye,Ee),ct=aE(V,r,oe,oe+Ye),bt=Ne>=0&&t[Ne],Ut=ct>=0&&t[ct];if(h&&!Ut||!h&&!bt){xE(f0(F,C),i,V);let Qt=L3(h?O3:P3,t.length,h,a,K);!h&&Ut&&(t[ct].providerFactory=Qt),sE(i,n,r.length,0),r.push(V),F.directiveStart++,F.directiveEnd++,h&&(F.providerIndexes+=1048576),t.push(Qt),C.push(Qt)}else{let Qt=$R(t[h?ct:Ne],K,!h&&a);sE(i,n,Ne>-1?Ne:ct,Qt)}!h&&a&&Ut&&t[ct].componentProviders++}}}function sE(n,r,t,a){let h=Km(r),i=UN(r);if(h||i){let V=(i?as(r.useClass):r).prototype.ngOnDestroy;if(V){let K=n.destroyHooks||(n.destroyHooks=[]);if(!h&&r.multi){let oe=K.indexOf(t);oe===-1?K.push(t,[a,V]):K[oe+1].push(a,V)}else K.push(t,V)}}}function $R(n,r,t){return t&&n.componentProviders++,n.multi.push(r)-1}function aE(n,r,t,a){for(let h=t;h<a;h++)if(r[h]===n)return h;return-1}function P3(n,r,t,a){return tC(this.multi,[])}function O3(n,r,t,a){let h=this.multi,i;if(this.providerFactory){let C=this.providerFactory.componentProviders,F=h_(t,t[Qn],this.providerFactory.index,a);i=F.slice(0,C),tC(h,i);for(let V=C;V<F.length;V++)i.push(F[V])}else i=[],tC(h,i);return i}function tC(n,r){for(let t=0;t<n.length;t++){let a=n[t];r.push(a())}return r}function L3(n,r,t,a,h){let i=new Kf(n,t,yr);return i.multi=[],i.index=r,i.componentProviders=0,$R(i,h,a&&!t),i}function pa(n,r=[]){return t=>{t.providersResolver=(a,h)=>R3(a,h?h(n):n,r)}}function JC(n,r,t){let a=uC()+n,h=li();return h[a]===ua?qC(h,a,t?r.call(t):r()):jj(h,a)}function eD(n,r,t,a,h){return F3(li(),uC(),n,r,t,a,h)}function HR(n,r,t,a,h,i,C){return N3(li(),uC(),n,r,t,a,h,i,C)}function GR(n,r){let t=n[r];return t===ua?void 0:t}function F3(n,r,t,a,h,i,C){let F=r+t;return M0(n,F,h,i)?qC(n,F+2,C?a.call(C,h,i):a(h,i)):GR(n,F+2)}function N3(n,r,t,a,h,i,C,F,V){let K=r+t;return Uj(n,K,h,i,C,F)?qC(n,K+4,V?a.call(V,h,i,C,F):a(h,i,C,F)):GR(n,K+4)}var Xb=null;function z3(n){Xb!==null&&(n.defaultEncapsulation!==Xb.defaultEncapsulation||n.preserveWhitespaces!==Xb.preserveWhitespaces)||(Xb=n)}var yh=class{full;major;minor;patch;constructor(r){this.full=r;let t=r.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}},tD=new yh("19.2.2"),nC=class{ngModuleFactory;componentFactories;constructor(r,t){this.ngModuleFactory=r,this.componentFactories=t}},K0=(()=>{class n{compileModuleSync(t){return new T0(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let a=this.compileModuleSync(t),h=yA(t),i=Vk(h.declarations).reduce((C,F)=>{let V=mh(F);return V&&C.push(new Jf(V)),C},[]);return new nC(a,i)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),B3=new pt("");function V3(n,r,t){let a=new T0(t);return Promise.resolve(a)}function nA(n){for(let r=n.length-1;r>=0;r--)if(n[r]!==void 0)return n[r]}var j3=(()=>{class n{zone=Re(bn);changeDetectionScheduler=Re(Qf);applicationRef=Re(Fs);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function U3({ngZoneFactory:n,ignoreChangesOutsideZone:r,scheduleInRootZone:t}){return n??=()=>new bn(vn(ht({},WR()),{scheduleInRootZone:t})),[{provide:bn,useFactory:n},{provide:Gf,multi:!0,useFactory:()=>{let a=Re(j3,{optional:!0});return()=>a.initialize()}},{provide:Gf,multi:!0,useFactory:()=>{let a=Re($3);return()=>{a.initialize()}}},r===!0?{provide:dk,useValue:!0}:[],{provide:hk,useValue:t??uk}]}function WR(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var $3=(()=>{class n{subscription=new Pi;initialized=!1;zone=Re(bn);pendingTasks=Re(td);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{bn.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{bn.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var H3=(()=>{class n{appRef=Re(Fs);taskService=Re(td);ngZone=Re(bn);zonelessEnabled=Re(xC);tracing=Re(ug,{optional:!0});disableScheduling=Re(dk,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Pi;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(m0):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Re(hk,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof g0||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let a=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,a=!0;break}case 12:{this.appRef.dirtyFlags|=16,a=!0;break}case 13:{this.appRef.dirtyFlags|=2,a=!0;break}case 11:{a=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(a))return;let h=this.useMicrotaskScheduler?SS:fk;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>h(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>h(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(m0+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(a){throw this.taskService.remove(t),a}finally{this.cleanup()}this.useMicrotaskScheduler=!0,SS(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function G3(){return typeof $localize<"u"&&$localize.locale||S0}var Q0=new pt("",{providedIn:"root",factory:()=>Re(Q0,Kn.Optional|Kn.SkipSelf)||G3()});var A0=new pt(""),W3=new pt("");function i_(n){return!n.moduleRef}function q3(n){let r=i_(n)?n.r3Injector:n.moduleRef.injector,t=r.get(bn);return t.run(()=>{i_(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let a=r.get(Ls,null),h;if(t.runOutsideAngular(()=>{h=t.onError.subscribe({next:i=>{a.handleError(i)}})}),i_(n)){let i=()=>r.destroy(),C=n.platformInjector.get(A0);C.add(i),r.onDestroy(()=>{h.unsubscribe(),C.delete(i)})}else{let i=()=>n.moduleRef.destroy(),C=n.platformInjector.get(A0);C.add(i),n.moduleRef.onDestroy(()=>{e0(n.allPlatformModules,n.moduleRef),h.unsubscribe(),C.delete(i)})}return X3(a,t,()=>{let i=r.get(SR);return i.runInitializers(),i.donePromise.then(()=>{let C=r.get(Q0,S0);if(D3(C||S0),!r.get(W3,!0))return i_(n)?r.get(Fs):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(i_(n)){let V=r.get(Fs);return n.rootComponent!==void 0&&V.bootstrap(n.rootComponent),V}else return Z3(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}function Z3(n,r){let t=n.injector.get(Fs);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(a=>t.bootstrap(a));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(t);else throw new Wt(-403,!1);r.push(n)}function X3(n,r,t){try{let a=t();return fg(a)?a.catch(h=>{throw r.runOutsideAngular(()=>n.handleError(h)),h}):a}catch(a){throw r.runOutsideAngular(()=>n.handleError(a)),a}}var qR=(()=>{class n{_injector;_modules=[];_destroyListeners=[];_destroyed=!1;constructor(t){this._injector=t}bootstrapModuleFactory(t,a){let h=a?.scheduleInRootZone,i=()=>Gz(a?.ngZone,vn(ht({},WR({eventCoalescing:a?.ngZoneEventCoalescing,runCoalescing:a?.ngZoneRunCoalescing})),{scheduleInRootZone:h})),C=a?.ignoreChangesOutsideZone,F=[U3({ngZoneFactory:i,ignoreChangesOutsideZone:C}),{provide:Qf,useExisting:H3}],V=Oj(t.moduleType,this.injector,F);return q3({moduleRef:V,allPlatformModules:this._modules,platformInjector:this.injector})}bootstrapModule(t,a=[]){let h=AR({},a);return V3(this.injector,h,t).then(i=>this.bootstrapModuleFactory(i,h))}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Wt(404,!1);this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());let t=this._injector.get(A0,null);t&&(t.forEach(a=>a()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static \u0275fac=function(a){return new(a||n)(kt(ci))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})(),a_=null,ZR=new pt("");function Y3(n){if(a_&&!a_.get(ZR,!1))throw new Wt(400,!1);qj(),a_=n;let r=n.get(qR);return J3(n),r}function nD(n,r,t=[]){let a=`Platform: ${r}`,h=new pt(a);return(i=[])=>{let C=XR();if(!C||C.injector.get(ZR,!1)){let F=[...t,...i,{provide:h,useValue:!0}];n?n(F):Y3(K3(F,a))}return Q3(h)}}function K3(n=[],r){return ci.create({name:r,providers:[{provide:L0,useValue:"platform"},{provide:A0,useValue:new Set([()=>a_=null])},...n]})}function Q3(n){let r=XR();if(!r)throw new Wt(401,!1);return r}function XR(){return a_?.get(qR)??null}function J3(n){let r=n.get(CC,null);Ns(n,()=>{r?.forEach(t=>t())})}function iD(){return!1}var ma=(()=>{class n{static __NG_ELEMENT_ID__=eU}return n})();function eU(n){return tU(ca(),li(),(n&16)===16)}function tU(n,r,t){if(rg(n)&&!t){let a=Bc(n.index,r);return new p_(a,a)}else if(n.type&175){let a=r[Va];return new p_(a,r)}return null}var YR=nD(null,"core",[]),KR=(()=>{class n{constructor(t){}static \u0275fac=function(a){return new(a||n)(kt(Fs))};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})();function Go(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function rD(n,r=NaN){return!isNaN(parseFloat(n))&&!isNaN(Number(n))?Number(n):r}function rp(n){let r=ni(null);try{return n()}finally{ni(r)}}function yg(n,r){let t=FI(n);return r?.equal&&(t[Na].equal=r.equal),t}var iC=class{[Na];constructor(r){this[Na]=r}destroy(){this[Na].destroy()}};function S_(n,r){!r?.injector&&ng(S_);let t=r?.injector??Re(ci),a=r?.manualCleanup!==!0?t.get($c):null,h,i=t.get(TC,null,{optional:!0}),C=t.get(Qf);return i!==null&&!r?.forceRoot?(h=rU(i.view,C,n),a instanceof p0&&a._lView===i.view&&(a=null)):h=oU(n,t.get(MR),C),h.injector=t,a!==null&&(h.onDestroyFn=a.onDestroy(()=>h.destroy())),new iC(h)}var QR=vn(ht({},Im),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:f_,run(){if(this.dirty=!1,this.hasRun&&!pb(this))return;this.hasRun=!0;let n=a=>(this.cleanupFns??=[]).push(a),r=Zy(this),t=u0(!1);try{this.maybeCleanup(),this.fn(n)}finally{u0(t),fb(this,r)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),nU=vn(ht({},QR),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){Xy(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),iU=vn(ht({},QR),{consumerMarkedDirty(){this.view[Ln]|=8192,og(this.view),this.notifier.notify(13)},destroy(){Xy(this),this.onDestroyFn(),this.maybeCleanup(),this.view[qf]?.delete(this)}});function rU(n,r,t){let a=Object.create(iU);return a.view=n,a.zone=typeof Zone<"u"?Zone.current:null,a.notifier=r,a.fn=t,n[qf]??=new Set,n[qf].add(a),a.consumerMarkedDirty(a),a}function oU(n,r,t){let a=Object.create(nU);return a.fn=n,a.scheduler=r,a.notifier=t,a.zone=typeof Zone<"u"?Zone.current:null,a.scheduler.schedule(a),a.notifier.notify(12),a}function J0(n,r){let t=mh(n),a=r.elementInjector||F0();return new Jf(t).create(a,r.projectableNodes,r.hostElement,r.environmentInjector)}function JR(n){let r=mh(n);if(!r)return null;let t=new Jf(r);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return r.standalone},get isSignal(){return r.signals}}}var rP=null;function op(){return rP}function oP(n){rP??=n}var ex=class{};var oi=new pt(""),lD=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>Re(lU),providedIn:"platform"})}return n})(),sP=new pt(""),lU=(()=>{class n extends lD{_location;_history;_doc=Re(oi);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return op().getBaseHref(this._doc)}onPopState(t){let a=op().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",t,!1),()=>a.removeEventListener("popstate",t)}onHashChange(t){let a=op().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",t,!1),()=>a.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,a,h){this._history.pushState(t,a,h)}replaceState(t,a,h){this._history.replaceState(t,a,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function cD(n,r){return n?r?n.endsWith("/")?r.startsWith("/")?n+r.slice(1):n+r:r.startsWith("/")?n+r:`${n}/${r}`:n:r}function eP(n){let r=n.search(/#|\?|$/);return n[r-1]==="/"?n.slice(0,r-1)+n.slice(r):n}function rd(n){return n&&n[0]!=="?"?`?${n}`:n}var sp=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>Re(uD),providedIn:"root"})}return n})(),aP=new pt(""),uD=(()=>{class n extends sp{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,a){super(),this._platformLocation=t,this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??Re(oi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return cD(this._baseHref,t)}path(t=!1){let a=this._platformLocation.pathname+rd(this._platformLocation.search),h=this._platformLocation.hash;return h&&t?`${a}${h}`:a}pushState(t,a,h,i){let C=this.prepareExternalUrl(h+rd(i));this._platformLocation.pushState(t,a,C)}replaceState(t,a,h,i){let C=this.prepareExternalUrl(h+rd(i));this._platformLocation.replaceState(t,a,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(a){return new(a||n)(kt(lD),kt(aP,8))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),lP=(()=>{class n extends sp{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(t,a){super(),this._platformLocation=t,a!=null&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let a=this._platformLocation.hash??"#";return a.length>0?a.substring(1):a}prepareExternalUrl(t){let a=cD(this._baseHref,t);return a.length>0?"#"+a:a}pushState(t,a,h,i){let C=this.prepareExternalUrl(h+rd(i))||this._platformLocation.pathname;this._platformLocation.pushState(t,a,C)}replaceState(t,a,h,i){let C=this.prepareExternalUrl(h+rd(i))||this._platformLocation.pathname;this._platformLocation.replaceState(t,a,C)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(a){return new(a||n)(kt(lD),kt(aP,8))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),xh=(()=>{class n{_subject=new jn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let a=this._locationStrategy.getBaseHref();this._basePath=dU(eP(tP(a))),this._locationStrategy.onPopState(h=>{this._subject.next({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,a=""){return this.path()==this.normalize(t+rd(a))}normalize(t){return n.stripTrailingSlash(uU(this._basePath,tP(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,a="",h=null){this._locationStrategy.pushState(h,"",t,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+rd(a)),h)}replaceState(t,a="",h=null){this._locationStrategy.replaceState(h,"",t,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+rd(a)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}),()=>{let a=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(a,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",a){this._urlChangeListeners.forEach(h=>h(t,a))}subscribe(t,a,h){return this._subject.subscribe({next:t,error:a??void 0,complete:h??void 0})}static normalizeQueryParams=rd;static joinWithSlash=cD;static stripTrailingSlash=eP;static \u0275fac=function(a){return new(a||n)(kt(sp))};static \u0275prov=Ct({token:n,factory:()=>cU(),providedIn:"root"})}return n})();function cU(){return new xh(kt(sp))}function uU(n,r){if(!n||!r.startsWith(n))return r;let t=r.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:r}function tP(n){return n.replace(/\/index.html$/,"")}function dU(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}function tx(n,r){r=encodeURIComponent(r);for(let t of n.split(";")){let a=t.indexOf("="),[h,i]=a==-1?[t,""]:[t.slice(0,a),t.slice(a+1)];if(h.trim()===r)return decodeURIComponent(i)}return null}var oD=/\s+/,nP=[],nx=(()=>{class n{_ngEl;_renderer;initialClasses=nP;rawClass;stateMap=new Map;constructor(t,a){this._ngEl=t,this._renderer=a}set klass(t){this.initialClasses=t!=null?t.trim().split(oD):nP}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(oD):t}ngDoCheck(){for(let a of this.initialClasses)this._updateState(a,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let a of t)this._updateState(a,!0);else if(t!=null)for(let a of Object.keys(t))this._updateState(a,!!t[a]);this._applyStateDiff()}_updateState(t,a){let h=this.stateMap.get(t);h!==void 0?(h.enabled!==a&&(h.changed=!0,h.enabled=a),h.touched=!0):this.stateMap.set(t,{enabled:a,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let a=t[0],h=t[1];h.changed?(this._toggleClass(a,h.enabled),h.changed=!1):h.touched||(h.enabled&&this._toggleClass(a,!1),this.stateMap.delete(a)),h.touched=!1}}_toggleClass(t,a){t=t.trim(),t.length>0&&t.split(oD).forEach(h=>{a?this._renderer.addClass(this._ngEl.nativeElement,h):this._renderer.removeClass(this._ngEl.nativeElement,h)})}static \u0275fac=function(a){return new(a||n)(yr(Bi),yr(hg))};static \u0275dir=_r({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();var ix=(()=>{class n{_viewContainer;_context=new sD;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,a){this._viewContainer=t,this._thenTemplateRef=a}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){iP(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){iP(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,a){return!0}static \u0275fac=function(a){return new(a||n)(yr(Ua),yr(jc))};static \u0275dir=_r({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),sD=class{$implicit=null;ngIf=null};function iP(n,r){if(n&&!n.createEmbeddedView)throw new Wt(2020,!1)}var vg=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})(),dD="browser",hU="server";function cP(n){return n===dD}function hD(n){return n===hU}var uP=(()=>{class n{static \u0275prov=Ct({token:n,providedIn:"root",factory:()=>new aD(Re(oi),window)})}return n})(),aD=class{document;window;offset=()=>[0,0];constructor(r,t){this.document=r,this.window=t}setOffset(r){Array.isArray(r)?this.offset=()=>r:this.offset=r}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(r){this.window.scrollTo(r[0],r[1])}scrollToAnchor(r){let t=fU(this.document,r);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(r){this.window.history.scrollRestoration=r}scrollToElement(r){let t=r.getBoundingClientRect(),a=t.left+this.window.pageXOffset,h=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(a-i[0],h-i[1])}};function fU(n,r){let t=n.getElementById(r)||n.getElementsByName(r)[0];if(t)return t;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let a=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),h=a.currentNode;for(;h;){let i=h.shadowRoot;if(i){let C=i.getElementById(r)||i.querySelector(`[name="${r}"]`);if(C)return C}h=a.nextNode()}}return null}var _g=class{};var k_=class{},ox=class{},ap=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(r){r?typeof r=="string"?this.lazyInit=()=>{this.headers=new Map,r.split(`
`).forEach(t=>{let a=t.indexOf(":");if(a>0){let h=t.slice(0,a),i=t.slice(a+1).trim();this.addHeaderEntry(h,i)}})}:typeof Headers<"u"&&r instanceof Headers?(this.headers=new Map,r.forEach((t,a)=>{this.addHeaderEntry(a,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(r).forEach(([t,a])=>{this.setHeaderEntries(t,a)})}:this.headers=new Map}has(r){return this.init(),this.headers.has(r.toLowerCase())}get(r){this.init();let t=this.headers.get(r.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(r){return this.init(),this.headers.get(r.toLowerCase())||null}append(r,t){return this.clone({name:r,value:t,op:"a"})}set(r,t){return this.clone({name:r,value:t,op:"s"})}delete(r,t){return this.clone({name:r,value:t,op:"d"})}maybeSetNormalizedName(r,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,r)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(r=>this.applyUpdate(r)),this.lazyUpdate=null))}copyFrom(r){r.init(),Array.from(r.headers.keys()).forEach(t=>{this.headers.set(t,r.headers.get(t)),this.normalizedNames.set(t,r.normalizedNames.get(t))})}clone(r){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([r]),t}applyUpdate(r){let t=r.name.toLowerCase();switch(r.op){case"a":case"s":let a=r.value;if(typeof a=="string"&&(a=[a]),a.length===0)return;this.maybeSetNormalizedName(r.name,t);let h=(r.op==="a"?this.headers.get(t):void 0)||[];h.push(...a),this.headers.set(t,h);break;case"d":let i=r.value;if(!i)this.headers.delete(t),this.normalizedNames.delete(t);else{let C=this.headers.get(t);if(!C)return;C=C.filter(F=>i.indexOf(F)===-1),C.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,C)}break}}addHeaderEntry(r,t){let a=r.toLowerCase();this.maybeSetNormalizedName(r,a),this.headers.has(a)?this.headers.get(a).push(t):this.headers.set(a,[t])}setHeaderEntries(r,t){let a=(Array.isArray(t)?t:[t]).map(i=>i.toString()),h=r.toLowerCase();this.headers.set(h,a),this.maybeSetNormalizedName(r,h)}forEach(r){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>r(this.normalizedNames.get(t),this.headers.get(t)))}};var mD=class{encodeKey(r){return dP(r)}encodeValue(r){return dP(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}};function pU(n,r){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(h=>{let i=h.indexOf("="),[C,F]=i==-1?[r.decodeKey(h),""]:[r.decodeKey(h.slice(0,i)),r.decodeValue(h.slice(i+1))],V=t.get(C)||[];V.push(F),t.set(C,V)}),t}var mU=/%(\d[a-f0-9])/gi,gU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function dP(n){return encodeURIComponent(n).replace(mU,(r,t)=>gU[t]??r)}function rx(n){return`${n}`}var wh=class n{map;encoder;updates=null;cloneFrom=null;constructor(r={}){if(this.encoder=r.encoder||new mD,r.fromString){if(r.fromObject)throw new Wt(2805,!1);this.map=pU(r.fromString,this.encoder)}else r.fromObject?(this.map=new Map,Object.keys(r.fromObject).forEach(t=>{let a=r.fromObject[t],h=Array.isArray(a)?a.map(rx):[rx(a)];this.map.set(t,h)})):this.map=null}has(r){return this.init(),this.map.has(r)}get(r){this.init();let t=this.map.get(r);return t?t[0]:null}getAll(r){return this.init(),this.map.get(r)||null}keys(){return this.init(),Array.from(this.map.keys())}append(r,t){return this.clone({param:r,value:t,op:"a"})}appendAll(r){let t=[];return Object.keys(r).forEach(a=>{let h=r[a];Array.isArray(h)?h.forEach(i=>{t.push({param:a,value:i,op:"a"})}):t.push({param:a,value:h,op:"a"})}),this.clone(t)}set(r,t){return this.clone({param:r,value:t,op:"s"})}delete(r,t){return this.clone({param:r,value:t,op:"d"})}toString(){return this.init(),this.keys().map(r=>{let t=this.encoder.encodeKey(r);return this.map.get(r).map(a=>t+"="+this.encoder.encodeValue(a)).join("&")}).filter(r=>r!=="").join("&")}clone(r){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(r),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(r=>this.map.set(r,this.cloneFrom.map.get(r))),this.updates.forEach(r=>{switch(r.op){case"a":case"s":let t=(r.op==="a"?this.map.get(r.param):void 0)||[];t.push(rx(r.value)),this.map.set(r.param,t);break;case"d":if(r.value!==void 0){let a=this.map.get(r.param)||[],h=a.indexOf(rx(r.value));h!==-1&&a.splice(h,1),a.length>0?this.map.set(r.param,a):this.map.delete(r.param)}else{this.map.delete(r.param);break}}}),this.cloneFrom=this.updates=null)}};var gD=class{map=new Map;set(r,t){return this.map.set(r,t),this}get(r){return this.map.has(r)||this.map.set(r,r.defaultValue()),this.map.get(r)}delete(r){return this.map.delete(r),this}has(r){return this.map.has(r)}keys(){return this.map.keys()}};function yU(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function hP(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function fP(n){return typeof Blob<"u"&&n instanceof Blob}function pP(n){return typeof FormData<"u"&&n instanceof FormData}function _U(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var mP="Content-Type",gP="Accept",bP="X-Request-URL",xP="text/plain",wP="application/json",vU=`${wP}, ${xP}, */*`,A_=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(r,t,a,h){this.url=t,this.method=r.toUpperCase();let i;if(yU(this.method)||h?(this.body=a!==void 0?a:null,i=h):i=a,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new ap,this.context??=new gD,!this.params)this.params=new wh,this.urlWithParams=t;else{let C=this.params.toString();if(C.length===0)this.urlWithParams=t;else{let F=t.indexOf("?"),V=F===-1?"?":F<t.length-1?"&":"";this.urlWithParams=t+V+C}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||hP(this.body)||fP(this.body)||pP(this.body)||_U(this.body)?this.body:this.body instanceof wh?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||pP(this.body)?null:fP(this.body)?this.body.type||null:hP(this.body)?null:typeof this.body=="string"?xP:this.body instanceof wh?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?wP:null}clone(r={}){let t=r.method||this.method,a=r.url||this.url,h=r.responseType||this.responseType,i=r.transferCache??this.transferCache,C=r.body!==void 0?r.body:this.body,F=r.withCredentials??this.withCredentials,V=r.reportProgress??this.reportProgress,K=r.headers||this.headers,oe=r.params||this.params,Ee=r.context??this.context;return r.setHeaders!==void 0&&(K=Object.keys(r.setHeaders).reduce((Ye,Ne)=>Ye.set(Ne,r.setHeaders[Ne]),K)),r.setParams&&(oe=Object.keys(r.setParams).reduce((Ye,Ne)=>Ye.set(Ne,r.setParams[Ne]),oe)),new n(t,a,C,{params:oe,headers:K,context:Ee,reportProgress:V,responseType:h,withCredentials:F,transferCache:i})}},bg=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(bg||{}),R_=class{headers;status;statusText;url;ok;type;constructor(r,t=200,a="OK"){this.headers=r.headers||new ap,this.status=r.status!==void 0?r.status:t,this.statusText=r.statusText||a,this.url=r.url||null,this.ok=this.status>=200&&this.status<300}},yD=class n extends R_{constructor(r={}){super(r)}type=bg.ResponseHeader;clone(r={}){return new n({headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},sx=class n extends R_{body;constructor(r={}){super(r),this.body=r.body!==void 0?r.body:null}type=bg.Response;clone(r={}){return new n({body:r.body!==void 0?r.body:this.body,headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},ax=class extends R_{name="HttpErrorResponse";message;error;ok=!1;constructor(r){super(r,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${r.url||"(unknown url)"}`:this.message=`Http failure response for ${r.url||"(unknown url)"}: ${r.status} ${r.statusText}`,this.error=r.error||null}},bU=200,xU=204;function pD(n,r){return{body:r,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var P_=(()=>{class n{handler;constructor(t){this.handler=t}request(t,a,h={}){let i;if(t instanceof A_)i=t;else{let V;h.headers instanceof ap?V=h.headers:V=new ap(h.headers);let K;h.params&&(h.params instanceof wh?K=h.params:K=new wh({fromObject:h.params})),i=new A_(t,a,h.body!==void 0?h.body:null,{headers:V,context:h.context,params:K,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials,transferCache:h.transferCache})}let C=nn(i).pipe(qu(V=>this.handler.handle(V)));if(t instanceof A_||h.observe==="events")return C;let F=C.pipe(Pr(V=>V instanceof sx));switch(h.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return F.pipe(ln(V=>{if(V.body!==null&&!(V.body instanceof ArrayBuffer))throw new Wt(2806,!1);return V.body}));case"blob":return F.pipe(ln(V=>{if(V.body!==null&&!(V.body instanceof Blob))throw new Wt(2807,!1);return V.body}));case"text":return F.pipe(ln(V=>{if(V.body!==null&&typeof V.body!="string")throw new Wt(2808,!1);return V.body}));case"json":default:return F.pipe(ln(V=>V.body))}case"response":return F;default:throw new Wt(2809,!1)}}delete(t,a={}){return this.request("DELETE",t,a)}get(t,a={}){return this.request("GET",t,a)}head(t,a={}){return this.request("HEAD",t,a)}jsonp(t,a){return this.request("JSONP",t,{params:new wh().append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,a={}){return this.request("OPTIONS",t,a)}patch(t,a,h={}){return this.request("PATCH",t,pD(h,a))}post(t,a,h={}){return this.request("POST",t,pD(h,a))}put(t,a,h={}){return this.request("PUT",t,pD(h,a))}static \u0275fac=function(a){return new(a||n)(kt(k_))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})();var wU=new pt("");function EP(n,r){return r(n)}function EU(n,r){return(t,a)=>r.intercept(t,{handle:h=>n(h,a)})}function CU(n,r,t){return(a,h)=>Ns(t,()=>r(a,i=>n(i,h)))}var DU=new pt(""),_D=new pt(""),TU=new pt(""),CP=new pt("",{providedIn:"root",factory:()=>!0});function MU(){let n=null;return(r,t)=>{n===null&&(n=(Re(DU,{optional:!0})??[]).reduceRight(EU,EP));let a=Re(td);if(Re(CP)){let i=a.add();return n(r,t).pipe(Fc(()=>a.remove(i)))}else return n(r,t)}}var yP=(()=>{class n extends k_{backend;injector;chain=null;pendingTasks=Re(td);contributeToStability=Re(CP);constructor(t,a){super(),this.backend=t,this.injector=a}handle(t){if(this.chain===null){let a=Array.from(new Set([...this.injector.get(_D),...this.injector.get(TU,[])]));this.chain=a.reduceRight((h,i)=>CU(h,i,this.injector),EP)}if(this.contributeToStability){let a=this.pendingTasks.add();return this.chain(t,h=>this.backend.handle(h)).pipe(Fc(()=>this.pendingTasks.remove(a)))}else return this.chain(t,a=>this.backend.handle(a))}static \u0275fac=function(a){return new(a||n)(kt(ox),kt(Nr))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})();var IU=/^\)\]\}',?\n/,SU=RegExp(`^${bP}:`,"m");function AU(n){return"responseURL"in n&&n.responseURL?n.responseURL:SU.test(n.getAllResponseHeaders())?n.getResponseHeader(bP):null}var _P=(()=>{class n{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new Wt(-2800,!1);let a=this.xhrFactory;return(a.\u0275loadImpl?ur(a.\u0275loadImpl()):nn(null)).pipe(Vo(()=>new Vn(i=>{let C=a.build();if(C.open(t.method,t.urlWithParams),t.withCredentials&&(C.withCredentials=!0),t.headers.forEach((bt,Ut)=>C.setRequestHeader(bt,Ut.join(","))),t.headers.has(gP)||C.setRequestHeader(gP,vU),!t.headers.has(mP)){let bt=t.detectContentTypeHeader();bt!==null&&C.setRequestHeader(mP,bt)}if(t.responseType){let bt=t.responseType.toLowerCase();C.responseType=bt!=="json"?bt:"text"}let F=t.serializeBody(),V=null,K=()=>{if(V!==null)return V;let bt=C.statusText||"OK",Ut=new ap(C.getAllResponseHeaders()),Qt=AU(C)||t.url;return V=new yD({headers:Ut,status:C.status,statusText:bt,url:Qt}),V},oe=()=>{let{headers:bt,status:Ut,statusText:Qt,url:yi}=K(),Un=null;Ut!==xU&&(Un=typeof C.response>"u"?C.responseText:C.response),Ut===0&&(Ut=Un?bU:0);let Io=Ut>=200&&Ut<300;if(t.responseType==="json"&&typeof Un=="string"){let lt=Un;Un=Un.replace(IU,"");try{Un=Un!==""?JSON.parse(Un):null}catch(mo){Un=lt,Io&&(Io=!1,Un={error:mo,text:Un})}}Io?(i.next(new sx({body:Un,headers:bt,status:Ut,statusText:Qt,url:yi||void 0})),i.complete()):i.error(new ax({error:Un,headers:bt,status:Ut,statusText:Qt,url:yi||void 0}))},Ee=bt=>{let{url:Ut}=K(),Qt=new ax({error:bt,status:C.status||0,statusText:C.statusText||"Unknown Error",url:Ut||void 0});i.error(Qt)},Ye=!1,Ne=bt=>{Ye||(i.next(K()),Ye=!0);let Ut={type:bg.DownloadProgress,loaded:bt.loaded};bt.lengthComputable&&(Ut.total=bt.total),t.responseType==="text"&&C.responseText&&(Ut.partialText=C.responseText),i.next(Ut)},ct=bt=>{let Ut={type:bg.UploadProgress,loaded:bt.loaded};bt.lengthComputable&&(Ut.total=bt.total),i.next(Ut)};return C.addEventListener("load",oe),C.addEventListener("error",Ee),C.addEventListener("timeout",Ee),C.addEventListener("abort",Ee),t.reportProgress&&(C.addEventListener("progress",Ne),F!==null&&C.upload&&C.upload.addEventListener("progress",ct)),C.send(F),i.next({type:bg.Sent}),()=>{C.removeEventListener("error",Ee),C.removeEventListener("abort",Ee),C.removeEventListener("load",oe),C.removeEventListener("timeout",Ee),t.reportProgress&&(C.removeEventListener("progress",Ne),F!==null&&C.upload&&C.upload.removeEventListener("progress",ct)),C.readyState!==C.DONE&&C.abort()}})))}static \u0275fac=function(a){return new(a||n)(kt(_g))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),DP=new pt(""),kU="XSRF-TOKEN",RU=new pt("",{providedIn:"root",factory:()=>kU}),PU="X-XSRF-TOKEN",OU=new pt("",{providedIn:"root",factory:()=>PU}),lx=class{},LU=(()=>{class n{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,a,h){this.doc=t,this.platform=a,this.cookieName=h}getToken(){if(this.platform==="server")return null;let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=tx(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(a){return new(a||n)(kt(oi),kt(nd),kt(RU))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})();function FU(n,r){let t=n.url.toLowerCase();if(!Re(DP)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return r(n);let a=Re(lx).getToken(),h=Re(OU);return a!=null&&!n.headers.has(h)&&(n=n.clone({headers:n.headers.set(h,a)})),r(n)}var TP=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(TP||{});function NU(n,r){return{\u0275kind:n,\u0275providers:r}}function zU(...n){let r=[P_,_P,yP,{provide:k_,useExisting:yP},{provide:ox,useFactory:()=>Re(wU,{optional:!0})??Re(_P)},{provide:_D,useValue:FU,multi:!0},{provide:DP,useValue:!0},{provide:lx,useClass:LU}];for(let t of n)r.push(...t.\u0275providers);return v_(r)}var vP=new pt("");function BU(){return NU(TP.LegacyInterceptors,[{provide:vP,useFactory:MU},{provide:_D,useExisting:vP,multi:!0}])}var MP=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({providers:[zU(BU())]})}return n})();var bD=class extends ex{supportsDOMEvents=!0},xD=class n extends bD{static makeCurrent(){oP(new n)}onAndCancel(r,t,a,h){return r.addEventListener(t,a,h),()=>{r.removeEventListener(t,a,h)}}dispatchEvent(r,t){r.dispatchEvent(t)}remove(r){r.remove()}createElement(r,t){return t=t||this.getDefaultDocument(),t.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,t){return t==="window"?window:t==="document"?r:t==="body"?r.body:null}getBaseHref(r){let t=VU();return t==null?null:jU(t)}resetBaseElement(){O_=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return tx(document.cookie,r)}},O_=null;function VU(){return O_=O_||document.querySelector("base"),O_?O_.getAttribute("href"):null}function jU(n){return new URL(n,document.baseURI).pathname}var wD=class{addToWindow(r){$l.getAngularTestability=(a,h=!0)=>{let i=r.findTestabilityInTree(a,h);if(i==null)throw new Wt(5103,!1);return i},$l.getAllAngularTestabilities=()=>r.getAllTestabilities(),$l.getAllAngularRootElements=()=>r.getAllRootElements();let t=a=>{let h=$l.getAllAngularTestabilities(),i=h.length,C=function(){i--,i==0&&a()};h.forEach(F=>{F.whenStable(C)})};$l.frameworkStabilizers||($l.frameworkStabilizers=[]),$l.frameworkStabilizers.push(t)}findTestabilityInTree(r,t,a){if(t==null)return null;let h=r.getTestability(t);return h??(a?op().isShadowRoot(t)?this.findTestabilityInTree(r,t.host,!0):this.findTestabilityInTree(r,t.parentElement,!0):null)}},UU=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),ED=new pt(""),LP=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,a){this._zone=a,t.forEach(h=>{h.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,a,h,i){return this._findPluginFor(a).addEventListener(t,a,h,i)}getZone(){return this._zone}_findPluginFor(t){let a=this._eventNameToPlugin.get(t);if(a)return a;if(a=this._plugins.find(i=>i.supports(t)),!a)throw new Wt(5101,!1);return this._eventNameToPlugin.set(t,a),a}static \u0275fac=function(a){return new(a||n)(kt(ED),kt(bn))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),ux=class{_doc;constructor(r){this._doc=r}manager},cx="ng-app-id";function SP(n){for(let r of n)r.remove()}function AP(n,r){let t=r.createElement("style");return t.textContent=n,t}function $U(n,r,t,a){let h=n.head?.querySelectorAll(`style[${cx}="${r}"],link[${cx}="${r}"]`);if(h)for(let i of h)i.removeAttribute(cx),i instanceof HTMLLinkElement?a.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&t.set(i.textContent,{usage:0,elements:[i]})}function CD(n,r){let t=r.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}var FP=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(t,a,h,i={}){this.doc=t,this.appId=a,this.nonce=h,this.isServer=hD(i),$U(t,a,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,a){for(let h of t)this.addUsage(h,this.inline,AP);a?.forEach(h=>this.addUsage(h,this.external,CD))}removeStyles(t,a){for(let h of t)this.removeUsage(h,this.inline);a?.forEach(h=>this.removeUsage(h,this.external))}addUsage(t,a,h){let i=a.get(t);i?i.usage++:a.set(t,{usage:1,elements:[...this.hosts].map(C=>this.addElement(C,h(t,this.doc)))})}removeUsage(t,a){let h=a.get(t);h&&(h.usage--,h.usage<=0&&(SP(h.elements),a.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])SP(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[a,{elements:h}]of this.inline)h.push(this.addElement(t,AP(a,this.doc)));for(let[a,{elements:h}]of this.external)h.push(this.addElement(t,CD(a,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,a){return this.nonce&&a.setAttribute("nonce",this.nonce),this.isServer&&a.setAttribute(cx,this.appId),t.appendChild(a)}static \u0275fac=function(a){return new(a||n)(kt(oi),kt(cg),kt(D_,8),kt(nd))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),vD={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},TD=/%COMP%/g;var NP="%COMP%",HU=`_nghost-${NP}`,GU=`_ngcontent-${NP}`,WU=!0,qU=new pt("",{providedIn:"root",factory:()=>WU});function ZU(n){return GU.replace(TD,n)}function XU(n){return HU.replace(TD,n)}function zP(n,r){return r.map(t=>t.replace(TD,n))}var kP=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,a,h,i,C,F,V,K=null,oe=null){this.eventManager=t,this.sharedStylesHost=a,this.appId=h,this.removeStylesOnCompDestroy=i,this.doc=C,this.platformId=F,this.ngZone=V,this.nonce=K,this.tracingService=oe,this.platformIsServer=hD(F),this.defaultRenderer=new L_(t,C,V,this.platformIsServer,this.tracingService)}createRenderer(t,a){if(!t||!a)return this.defaultRenderer;this.platformIsServer&&a.encapsulation===Vc.ShadowDom&&(a=vn(ht({},a),{encapsulation:Vc.Emulated}));let h=this.getOrCreateRenderer(t,a);return h instanceof dx?h.applyToHost(t):h instanceof F_&&h.applyStyles(),h}getOrCreateRenderer(t,a){let h=this.rendererByCompId,i=h.get(a.id);if(!i){let C=this.doc,F=this.ngZone,V=this.eventManager,K=this.sharedStylesHost,oe=this.removeStylesOnCompDestroy,Ee=this.platformIsServer,Ye=this.tracingService;switch(a.encapsulation){case Vc.Emulated:i=new dx(V,K,a,this.appId,oe,C,F,Ee,Ye);break;case Vc.ShadowDom:return new DD(V,K,t,a,C,F,this.nonce,Ee,Ye);default:i=new F_(V,K,a,oe,C,F,Ee,Ye);break}h.set(a.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(a){return new(a||n)(kt(LP),kt(FP),kt(cg),kt(qU),kt(oi),kt(nd),kt(bn),kt(D_),kt(ug,8))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),L_=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(r,t,a,h,i){this.eventManager=r,this.doc=t,this.ngZone=a,this.platformIsServer=h,this.tracingService=i}destroy(){}destroyNode=null;createElement(r,t){return t?this.doc.createElementNS(vD[t]||t,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,t){(RP(r)?r.content:r).appendChild(t)}insertBefore(r,t,a){r&&(RP(r)?r.content:r).insertBefore(t,a)}removeChild(r,t){t.remove()}selectRootElement(r,t){let a=typeof r=="string"?this.doc.querySelector(r):r;if(!a)throw new Wt(-5104,!1);return t||(a.textContent=""),a}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,t,a,h){if(h){t=h+":"+t;let i=vD[h];i?r.setAttributeNS(i,t,a):r.setAttribute(t,a)}else r.setAttribute(t,a)}removeAttribute(r,t,a){if(a){let h=vD[a];h?r.removeAttributeNS(h,t):r.removeAttribute(`${a}:${t}`)}else r.removeAttribute(t)}addClass(r,t){r.classList.add(t)}removeClass(r,t){r.classList.remove(t)}setStyle(r,t,a,h){h&(Ku.DashCase|Ku.Important)?r.style.setProperty(t,a,h&Ku.Important?"important":""):r.style[t]=a}removeStyle(r,t,a){a&Ku.DashCase?r.style.removeProperty(t):r.style[t]=""}setProperty(r,t,a){r!=null&&(r[t]=a)}setValue(r,t){r.nodeValue=t}listen(r,t,a,h){if(typeof r=="string"&&(r=op().getGlobalEventTarget(this.doc,r),!r))throw new Wt(5102,!1);let i=this.decoratePreventDefault(a);return this.tracingService?.wrapEventListener&&(i=this.tracingService.wrapEventListener(r,t,i)),this.eventManager.addEventListener(r,t,i,h)}decoratePreventDefault(r){return t=>{if(t==="__ngUnwrap__")return r;(this.platformIsServer?this.ngZone.runGuarded(()=>r(t)):r(t))===!1&&t.preventDefault()}}};function RP(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var DD=class extends L_{sharedStylesHost;hostEl;shadowRoot;constructor(r,t,a,h,i,C,F,V,K){super(r,i,C,V,K),this.sharedStylesHost=t,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let oe=h.styles;oe=zP(h.id,oe);for(let Ye of oe){let Ne=document.createElement("style");F&&Ne.setAttribute("nonce",F),Ne.textContent=Ye,this.shadowRoot.appendChild(Ne)}let Ee=h.getExternalStyles?.();if(Ee)for(let Ye of Ee){let Ne=CD(Ye,i);F&&Ne.setAttribute("nonce",F),this.shadowRoot.appendChild(Ne)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,t){return super.appendChild(this.nodeOrShadowRoot(r),t)}insertBefore(r,t,a){return super.insertBefore(this.nodeOrShadowRoot(r),t,a)}removeChild(r,t){return super.removeChild(null,t)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},F_=class extends L_{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(r,t,a,h,i,C,F,V,K){super(r,i,C,F,V),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=h;let oe=a.styles;this.styles=K?zP(K,oe):oe,this.styleUrls=a.getExternalStyles?.(K)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},dx=class extends F_{contentAttr;hostAttr;constructor(r,t,a,h,i,C,F,V,K){let oe=h+"-"+a.id;super(r,t,a,i,C,F,V,K,oe),this.contentAttr=ZU(oe),this.hostAttr=XU(oe)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,t){let a=super.createElement(r,t);return super.setAttribute(a,this.contentAttr,""),a}},YU=(()=>{class n extends ux{constructor(t){super(t)}supports(t){return!0}addEventListener(t,a,h,i){return t.addEventListener(a,h,i),()=>this.removeEventListener(t,a,h,i)}removeEventListener(t,a,h,i){return t.removeEventListener(a,h,i)}static \u0275fac=function(a){return new(a||n)(kt(oi))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})(),PP=["alt","control","meta","shift"],KU={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},QU={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},JU=(()=>{class n extends ux{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,a,h,i){let C=n.parseEventName(a),F=n.eventCallback(C.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>op().onAndCancel(t,C.domEventName,F,i))}static parseEventName(t){let a=t.toLowerCase().split("."),h=a.shift();if(a.length===0||!(h==="keydown"||h==="keyup"))return null;let i=n._normalizeKey(a.pop()),C="",F=a.indexOf("code");if(F>-1&&(a.splice(F,1),C="code."),PP.forEach(K=>{let oe=a.indexOf(K);oe>-1&&(a.splice(oe,1),C+=K+".")}),C+=i,a.length!=0||i.length===0)return null;let V={};return V.domEventName=h,V.fullKey=C,V}static matchEventFullKeyCode(t,a){let h=KU[t.key]||t.key,i="";return a.indexOf("code.")>-1&&(h=t.code,i="code."),h==null||!h?!1:(h=h.toLowerCase(),h===" "?h="space":h==="."&&(h="dot"),PP.forEach(C=>{if(C!==h){let F=QU[C];F(t)&&(i+=C+".")}}),i+=h,i===a)}static eventCallback(t,a,h){return i=>{n.matchEventFullKeyCode(i,t)&&h.runGuarded(()=>a(i))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(a){return new(a||n)(kt(oi))};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})();function e5(){xD.makeCurrent()}function t5(){return new Ls}function n5(){return xk(document),document}var i5=[{provide:nd,useValue:dD},{provide:CC,useValue:e5,multi:!0},{provide:oi,useFactory:n5,deps:[]}],BP=nD(YR,"browser",i5);var r5=[{provide:M_,useClass:wD,deps:[]},{provide:XC,useClass:q0,deps:[bn,Z0,M_]},{provide:q0,useClass:q0,deps:[bn,Z0,M_]}],o5=[{provide:L0,useValue:"root"},{provide:Ls,useFactory:t5,deps:[]},{provide:ED,useClass:YU,multi:!0,deps:[oi]},{provide:ED,useClass:JU,multi:!0,deps:[oi]},kP,FP,LP,{provide:Uo,useExisting:kP},{provide:_g,useClass:UU,deps:[]},[]],VP=(()=>{class n{constructor(){}static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({providers:[...o5,...r5],imports:[vg,KR]})}return n})();var jP=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(a){return new(a||n)(kt(oi))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var MD=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:function(a){let h=null;return a?h=new(a||n):h=kt(s5),h},providedIn:"root"})}return n})(),s5=(()=>{class n extends MD{_doc;constructor(t){super(),this._doc=t}sanitize(t,a){if(a==null)return null;switch(t){case ds.NONE:return a;case ds.HTML:return np(a,"HTML")?Hl(a):zk(this._doc,String(a)).toString();case ds.STYLE:return np(a,"Style")?Hl(a):a;case ds.SCRIPT:if(np(a,"Script"))return Hl(a);throw new Wt(5200,!1);case ds.URL:return np(a,"URL")?Hl(a):j0(String(a));case ds.RESOURCE_URL:if(np(a,"ResourceURL"))return Hl(a);throw new Wt(5201,!1);default:throw new Wt(5202,!1)}}bypassSecurityTrustHtml(t){return Ik(t)}bypassSecurityTrustStyle(t){return Sk(t)}bypassSecurityTrustScript(t){return Ak(t)}bypassSecurityTrustUrl(t){return kk(t)}bypassSecurityTrustResourceUrl(t){return Rk(t)}static \u0275fac=function(a){return new(a||n)(kt(oi))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var qn="primary",Y_=Symbol("RouteTitle"),PD=class{params;constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let t=this.params[r];return Array.isArray(t)?t[0]:t}return null}getAll(r){if(this.has(r)){let t=this.params[r];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Tg(n){return new PD(n)}function a5(n,r,t){let a=t.path.split("/");if(a.length>n.length||t.pathMatch==="full"&&(r.hasChildren()||a.length<n.length))return null;let h={};for(let i=0;i<a.length;i++){let C=a[i],F=n[i];if(C[0]===":")h[C.substring(1)]=F;else if(C!==F.path)return null}return{consumed:n.slice(0,a.length),posParams:h}}function l5(n,r){if(n.length!==r.length)return!1;for(let t=0;t<n.length;++t)if(!qc(n[t],r[t]))return!1;return!0}function qc(n,r){let t=n?OD(n):void 0,a=r?OD(r):void 0;if(!t||!a||t.length!=a.length)return!1;let h;for(let i=0;i<t.length;i++)if(h=t[i],!QP(n[h],r[h]))return!1;return!0}function OD(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function QP(n,r){if(Array.isArray(n)&&Array.isArray(r)){if(n.length!==r.length)return!1;let t=[...n].sort(),a=[...r].sort();return t.every((h,i)=>a[i]===h)}else return n===r}function JP(n){return n.length>0?n[n.length-1]:null}function Ch(n){return Jy(n)?n:fg(n)?ur(Promise.resolve(n)):nn(n)}var c5={exact:tO,subset:nO},eO={exact:u5,subset:d5,ignored:()=>!0};function UP(n,r,t){return c5[t.paths](n.root,r.root,t.matrixParams)&&eO[t.queryParams](n.queryParams,r.queryParams)&&!(t.fragment==="exact"&&n.fragment!==r.fragment)}function u5(n,r){return qc(n,r)}function tO(n,r,t){if(!cp(n.segments,r.segments)||!px(n.segments,r.segments,t)||n.numberOfChildren!==r.numberOfChildren)return!1;for(let a in r.children)if(!n.children[a]||!tO(n.children[a],r.children[a],t))return!1;return!0}function d5(n,r){return Object.keys(r).length<=Object.keys(n).length&&Object.keys(r).every(t=>QP(n[t],r[t]))}function nO(n,r,t){return iO(n,r,r.segments,t)}function iO(n,r,t,a){if(n.segments.length>t.length){let h=n.segments.slice(0,t.length);return!(!cp(h,t)||r.hasChildren()||!px(h,t,a))}else if(n.segments.length===t.length){if(!cp(n.segments,t)||!px(n.segments,t,a))return!1;for(let h in r.children)if(!n.children[h]||!nO(n.children[h],r.children[h],a))return!1;return!0}else{let h=t.slice(0,n.segments.length),i=t.slice(n.segments.length);return!cp(n.segments,h)||!px(n.segments,h,a)||!n.children[qn]?!1:iO(n.children[qn],r,i,a)}}function px(n,r,t){return r.every((a,h)=>eO[t](n[h].parameters,a.parameters))}var sd=class{root;queryParams;fragment;_queryParamMap;constructor(r=new Li([],{}),t={},a=null){this.root=r,this.queryParams=t,this.fragment=a}get queryParamMap(){return this._queryParamMap??=Tg(this.queryParams),this._queryParamMap}toString(){return p5.serialize(this)}},Li=class{segments;children;parent=null;constructor(r,t){this.segments=r,this.children=t,Object.values(t).forEach(a=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return mx(this)}},lp=class{path;parameters;_parameterMap;constructor(r,t){this.path=r,this.parameters=t}get parameterMap(){return this._parameterMap??=Tg(this.parameters),this._parameterMap}toString(){return oO(this)}};function h5(n,r){return cp(n,r)&&n.every((t,a)=>qc(t.parameters,r[a].parameters))}function cp(n,r){return n.length!==r.length?!1:n.every((t,a)=>t.path===r[a].path)}function f5(n,r){let t=[];return Object.entries(n.children).forEach(([a,h])=>{a===qn&&(t=t.concat(r(h,a)))}),Object.entries(n.children).forEach(([a,h])=>{a!==qn&&(t=t.concat(r(h,a)))}),t}var K_=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>new Mg,providedIn:"root"})}return n})(),Mg=class{parse(r){let t=new FD(r);return new sd(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(r){let t=`/${N_(r.root,!0)}`,a=y5(r.queryParams),h=typeof r.fragment=="string"?`#${m5(r.fragment)}`:"";return`${t}${a}${h}`}},p5=new Mg;function mx(n){return n.segments.map(r=>oO(r)).join("/")}function N_(n,r){if(!n.hasChildren())return mx(n);if(r){let t=n.children[qn]?N_(n.children[qn],!1):"",a=[];return Object.entries(n.children).forEach(([h,i])=>{h!==qn&&a.push(`${h}:${N_(i,!1)}`)}),a.length>0?`${t}(${a.join("//")})`:t}else{let t=f5(n,(a,h)=>h===qn?[N_(n.children[qn],!1)]:[`${h}:${N_(a,!1)}`]);return Object.keys(n.children).length===1&&n.children[qn]!=null?`${mx(n)}/${t[0]}`:`${mx(n)}/(${t.join("//")})`}}function rO(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function hx(n){return rO(n).replace(/%3B/gi,";")}function m5(n){return encodeURI(n)}function LD(n){return rO(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function gx(n){return decodeURIComponent(n)}function $P(n){return gx(n.replace(/\+/g,"%20"))}function oO(n){return`${LD(n.path)}${g5(n.parameters)}`}function g5(n){return Object.entries(n).map(([r,t])=>`;${LD(r)}=${LD(t)}`).join("")}function y5(n){let r=Object.entries(n).map(([t,a])=>Array.isArray(a)?a.map(h=>`${hx(t)}=${hx(h)}`).join("&"):`${hx(t)}=${hx(a)}`).filter(t=>t);return r.length?`?${r.join("&")}`:""}var _5=/^[^\/()?;#]+/;function SD(n){let r=n.match(_5);return r?r[0]:""}var v5=/^[^\/()?;=#]+/;function b5(n){let r=n.match(v5);return r?r[0]:""}var x5=/^[^=?&#]+/;function w5(n){let r=n.match(x5);return r?r[0]:""}var E5=/^[^&#]+/;function C5(n){let r=n.match(E5);return r?r[0]:""}var FD=class{url;remaining;constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Li([],{}):new Li([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(r.length>0||Object.keys(t).length>0)&&(a[qn]=new Li(r,t)),a}parseSegment(){let r=SD(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new Wt(4009,!1);return this.capture(r),new lp(gx(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let t=b5(this.remaining);if(!t)return;this.capture(t);let a="";if(this.consumeOptional("=")){let h=SD(this.remaining);h&&(a=h,this.capture(a))}r[gx(t)]=gx(a)}parseQueryParam(r){let t=w5(this.remaining);if(!t)return;this.capture(t);let a="";if(this.consumeOptional("=")){let C=C5(this.remaining);C&&(a=C,this.capture(a))}let h=$P(t),i=$P(a);if(r.hasOwnProperty(h)){let C=r[h];Array.isArray(C)||(C=[C],r[h]=C),C.push(i)}else r[h]=i}parseParens(r){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let a=SD(this.remaining),h=this.remaining[a.length];if(h!=="/"&&h!==")"&&h!==";")throw new Wt(4010,!1);let i;a.indexOf(":")>-1?(i=a.slice(0,a.indexOf(":")),this.capture(i),this.capture(":")):r&&(i=qn);let C=this.parseChildren();t[i]=Object.keys(C).length===1?C[qn]:new Li([],C),this.consumeOptional("//")}return t}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new Wt(4011,!1)}};function sO(n){return n.segments.length>0?new Li([],{[qn]:n}):n}function aO(n){let r={};for(let[a,h]of Object.entries(n.children)){let i=aO(h);if(a===qn&&i.segments.length===0&&i.hasChildren())for(let[C,F]of Object.entries(i.children))r[C]=F;else(i.segments.length>0||i.hasChildren())&&(r[a]=i)}let t=new Li(n.segments,r);return D5(t)}function D5(n){if(n.numberOfChildren===1&&n.children[qn]){let r=n.children[qn];return new Li(n.segments.concat(r.segments),r.children)}return n}function U_(n){return n instanceof sd}function T5(n,r,t=null,a=null){let h=lO(n);return cO(h,r,t,a)}function lO(n){let r;function t(i){let C={};for(let V of i.children){let K=t(V);C[V.outlet]=K}let F=new Li(i.url,C);return i===n&&(r=F),F}let a=t(n.root),h=sO(a);return r??h}function cO(n,r,t,a){let h=n;for(;h.parent;)h=h.parent;if(r.length===0)return AD(h,h,h,t,a);let i=M5(r);if(i.toRoot())return AD(h,h,new Li([],{}),t,a);let C=I5(i,h,n),F=C.processChildren?B_(C.segmentGroup,C.index,i.commands):dO(C.segmentGroup,C.index,i.commands);return AD(h,C.segmentGroup,F,t,a)}function yx(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function $_(n){return typeof n=="object"&&n!=null&&n.outlets}function AD(n,r,t,a,h){let i={};a&&Object.entries(a).forEach(([V,K])=>{i[V]=Array.isArray(K)?K.map(oe=>`${oe}`):`${K}`});let C;n===r?C=t:C=uO(n,r,t);let F=sO(aO(C));return new sd(F,i,h)}function uO(n,r,t){let a={};return Object.entries(n.children).forEach(([h,i])=>{i===r?a[h]=t:a[h]=uO(i,r,t)}),new Li(n.segments,a)}var _x=class{isAbsolute;numberOfDoubleDots;commands;constructor(r,t,a){if(this.isAbsolute=r,this.numberOfDoubleDots=t,this.commands=a,r&&a.length>0&&yx(a[0]))throw new Wt(4003,!1);let h=a.find($_);if(h&&h!==JP(a))throw new Wt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function M5(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new _x(!0,0,n);let r=0,t=!1,a=n.reduce((h,i,C)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let F={};return Object.entries(i.outlets).forEach(([V,K])=>{F[V]=typeof K=="string"?K.split("/"):K}),[...h,{outlets:F}]}if(i.segmentPath)return[...h,i.segmentPath]}return typeof i!="string"?[...h,i]:C===0?(i.split("/").forEach((F,V)=>{V==0&&F==="."||(V==0&&F===""?t=!0:F===".."?r++:F!=""&&h.push(F))}),h):[...h,i]},[]);return new _x(t,r,a)}var Eg=class{segmentGroup;processChildren;index;constructor(r,t,a){this.segmentGroup=r,this.processChildren=t,this.index=a}};function I5(n,r,t){if(n.isAbsolute)return new Eg(r,!0,0);if(!t)return new Eg(r,!1,NaN);if(t.parent===null)return new Eg(t,!0,0);let a=yx(n.commands[0])?0:1,h=t.segments.length-1+a;return S5(t,h,n.numberOfDoubleDots)}function S5(n,r,t){let a=n,h=r,i=t;for(;i>h;){if(i-=h,a=a.parent,!a)throw new Wt(4005,!1);h=a.segments.length}return new Eg(a,!1,h-i)}function A5(n){return $_(n[0])?n[0].outlets:{[qn]:n}}function dO(n,r,t){if(n??=new Li([],{}),n.segments.length===0&&n.hasChildren())return B_(n,r,t);let a=k5(n,r,t),h=t.slice(a.commandIndex);if(a.match&&a.pathIndex<n.segments.length){let i=new Li(n.segments.slice(0,a.pathIndex),{});return i.children[qn]=new Li(n.segments.slice(a.pathIndex),n.children),B_(i,0,h)}else return a.match&&h.length===0?new Li(n.segments,{}):a.match&&!n.hasChildren()?ND(n,r,t):a.match?B_(n,0,h):ND(n,r,t)}function B_(n,r,t){if(t.length===0)return new Li(n.segments,{});{let a=A5(t),h={};if(Object.keys(a).some(i=>i!==qn)&&n.children[qn]&&n.numberOfChildren===1&&n.children[qn].segments.length===0){let i=B_(n.children[qn],r,t);return new Li(n.segments,i.children)}return Object.entries(a).forEach(([i,C])=>{typeof C=="string"&&(C=[C]),C!==null&&(h[i]=dO(n.children[i],r,C))}),Object.entries(n.children).forEach(([i,C])=>{a[i]===void 0&&(h[i]=C)}),new Li(n.segments,h)}}function k5(n,r,t){let a=0,h=r,i={match:!1,pathIndex:0,commandIndex:0};for(;h<n.segments.length;){if(a>=t.length)return i;let C=n.segments[h],F=t[a];if($_(F))break;let V=`${F}`,K=a<t.length-1?t[a+1]:null;if(h>0&&V===void 0)break;if(V&&K&&typeof K=="object"&&K.outlets===void 0){if(!GP(V,K,C))return i;a+=2}else{if(!GP(V,{},C))return i;a++}h++}return{match:!0,pathIndex:h,commandIndex:a}}function ND(n,r,t){let a=n.segments.slice(0,r),h=0;for(;h<t.length;){let i=t[h];if($_(i)){let V=R5(i.outlets);return new Li(a,V)}if(h===0&&yx(t[0])){let V=n.segments[r];a.push(new lp(V.path,HP(t[0]))),h++;continue}let C=$_(i)?i.outlets[qn]:`${i}`,F=h<t.length-1?t[h+1]:null;C&&F&&yx(F)?(a.push(new lp(C,HP(F))),h+=2):(a.push(new lp(C,{})),h++)}return new Li(a,{})}function R5(n){let r={};return Object.entries(n).forEach(([t,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(r[t]=ND(new Li([],{}),0,a))}),r}function HP(n){let r={};return Object.entries(n).forEach(([t,a])=>r[t]=`${a}`),r}function GP(n,r,t){return n==t.path&&qc(r,t.parameters)}var V_="imperative",fo=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(fo||{}),Ha=class{id;url;constructor(r,t){this.id=r,this.url=t}},Ig=class extends Ha{type=fo.NavigationStart;navigationTrigger;restoredState;constructor(r,t,a="imperative",h=null){super(r,t),this.navigationTrigger=a,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ad=class extends Ha{urlAfterRedirects;type=fo.NavigationEnd;constructor(r,t,a){super(r,t),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ya=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(ya||{}),vx=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(vx||{}),od=class extends Ha{reason;code;type=fo.NavigationCancel;constructor(r,t,a,h){super(r,t),this.reason=a,this.code=h}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Eh=class extends Ha{reason;code;type=fo.NavigationSkipped;constructor(r,t,a,h){super(r,t),this.reason=a,this.code=h}},H_=class extends Ha{error;target;type=fo.NavigationError;constructor(r,t,a,h){super(r,t),this.error=a,this.target=h}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},bx=class extends Ha{urlAfterRedirects;state;type=fo.RoutesRecognized;constructor(r,t,a,h){super(r,t),this.urlAfterRedirects=a,this.state=h}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},zD=class extends Ha{urlAfterRedirects;state;type=fo.GuardsCheckStart;constructor(r,t,a,h){super(r,t),this.urlAfterRedirects=a,this.state=h}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},BD=class extends Ha{urlAfterRedirects;state;shouldActivate;type=fo.GuardsCheckEnd;constructor(r,t,a,h,i){super(r,t),this.urlAfterRedirects=a,this.state=h,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},VD=class extends Ha{urlAfterRedirects;state;type=fo.ResolveStart;constructor(r,t,a,h){super(r,t),this.urlAfterRedirects=a,this.state=h}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},jD=class extends Ha{urlAfterRedirects;state;type=fo.ResolveEnd;constructor(r,t,a,h){super(r,t),this.urlAfterRedirects=a,this.state=h}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},UD=class{route;type=fo.RouteConfigLoadStart;constructor(r){this.route=r}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},$D=class{route;type=fo.RouteConfigLoadEnd;constructor(r){this.route=r}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},HD=class{snapshot;type=fo.ChildActivationStart;constructor(r){this.snapshot=r}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},GD=class{snapshot;type=fo.ChildActivationEnd;constructor(r){this.snapshot=r}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},WD=class{snapshot;type=fo.ActivationStart;constructor(r){this.snapshot=r}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},qD=class{snapshot;type=fo.ActivationEnd;constructor(r){this.snapshot=r}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},xx=class{routerEvent;position;anchor;type=fo.Scroll;constructor(r,t,a){this.routerEvent=r,this.position=t,this.anchor=a}toString(){let r=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${r}')`}},G_=class{},Sg=class{url;navigationBehaviorOptions;constructor(r,t){this.url=r,this.navigationBehaviorOptions=t}};function P5(n,r){return n.providers&&!n._injector&&(n._injector=W0(n.providers,r,`Route: ${n.path}`)),n._injector??r}function ql(n){return n.outlet||qn}function O5(n,r){let t=n.filter(a=>ql(a)===r);return t.push(...n.filter(a=>ql(a)!==r)),t}function Q_(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let r=n.parent;r;r=r.parent){let t=r.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var ZD=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Q_(this.route?.snapshot)??this.rootInjector}constructor(r){this.rootInjector=r,this.children=new J_(this.rootInjector)}},J_=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,a){let h=this.getOrCreateContext(t);h.outlet=a,this.contexts.set(t,h)}onChildOutletDestroyed(t){let a=this.getContext(t);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let a=this.getContext(t);return a||(a=new ZD(this.rootInjector),this.contexts.set(t,a)),a}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(a){return new(a||n)(kt(Nr))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),wx=class{_root;constructor(r){this._root=r}get root(){return this._root.value}parent(r){let t=this.pathFromRoot(r);return t.length>1?t[t.length-2]:null}children(r){let t=XD(r,this._root);return t?t.children.map(a=>a.value):[]}firstChild(r){let t=XD(r,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(r){let t=YD(r,this._root);return t.length<2?[]:t[t.length-2].children.map(h=>h.value).filter(h=>h!==r)}pathFromRoot(r){return YD(r,this._root).map(t=>t.value)}};function XD(n,r){if(n===r.value)return r;for(let t of r.children){let a=XD(n,t);if(a)return a}return null}function YD(n,r){if(n===r.value)return[r];for(let t of r.children){let a=YD(n,t);if(a.length)return a.unshift(r),a}return[]}var ga=class{value;children;constructor(r,t){this.value=r,this.children=t}toString(){return`TreeNode(${this.value})`}};function wg(n){let r={};return n&&n.children.forEach(t=>r[t.value.outlet]=t),r}var Ex=class extends wx{snapshot;constructor(r,t){super(r),this.snapshot=t,oT(this,r)}toString(){return this.snapshot.toString()}};function hO(n){let r=L5(n),t=new Dr([new lp("",{})]),a=new Dr({}),h=new Dr({}),i=new Dr({}),C=new Dr(""),F=new Ag(t,a,i,C,h,qn,n,r.root);return F.snapshot=r.root,new Ex(new ga(F,[]),r)}function L5(n){let r={},t={},a={},h="",i=new Cg([],r,a,h,t,qn,n,null,{});return new Dx("",new ga(i,[]))}var Ag=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(r,t,a,h,i,C,F,V){this.urlSubject=r,this.paramsSubject=t,this.queryParamsSubject=a,this.fragmentSubject=h,this.dataSubject=i,this.outlet=C,this.component=F,this._futureSnapshot=V,this.title=this.dataSubject?.pipe(ln(K=>K[Y_]))??nn(void 0),this.url=r,this.params=t,this.queryParams=a,this.fragment=h,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ln(r=>Tg(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ln(r=>Tg(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Cx(n,r,t="emptyOnly"){let a,{routeConfig:h}=n;return r!==null&&(t==="always"||h?.path===""||!r.component&&!r.routeConfig?.loadComponent)?a={params:ht(ht({},r.params),n.params),data:ht(ht({},r.data),n.data),resolve:ht(ht(ht(ht({},n.data),r.data),h?.data),n._resolvedData)}:a={params:ht({},n.params),data:ht({},n.data),resolve:ht(ht({},n.data),n._resolvedData??{})},h&&pO(h)&&(a.resolve[Y_]=h.title),a}var Cg=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Y_]}constructor(r,t,a,h,i,C,F,V,K){this.url=r,this.params=t,this.queryParams=a,this.fragment=h,this.data=i,this.outlet=C,this.component=F,this.routeConfig=V,this._resolve=K}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Tg(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Tg(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(a=>a.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${t}')`}},Dx=class extends wx{url;constructor(r,t){super(t),this.url=r,oT(this,t)}toString(){return fO(this._root)}};function oT(n,r){r.value._routerState=n,r.children.forEach(t=>oT(n,t))}function fO(n){let r=n.children.length>0?` { ${n.children.map(fO).join(", ")} } `:"";return`${n.value}${r}`}function kD(n){if(n.snapshot){let r=n.snapshot,t=n._futureSnapshot;n.snapshot=t,qc(r.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),r.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),qc(r.params,t.params)||n.paramsSubject.next(t.params),l5(r.url,t.url)||n.urlSubject.next(t.url),qc(r.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function KD(n,r){let t=qc(n.params,r.params)&&h5(n.url,r.url),a=!n.parent!=!r.parent;return t&&!a&&(!n.parent||KD(n.parent,r.parent))}function pO(n){return typeof n.title=="string"||n.title===null}var F5=new pt(""),sT=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=qn;activateEvents=new Tt;deactivateEvents=new Tt;attachEvents=new Tt;detachEvents=new Tt;routerOutletData=E_(void 0);parentContexts=Re(J_);location=Re(Ua);changeDetector=Re(ma);inputBinder=Re(Ax,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:a,previousValue:h}=t.name;if(a)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Wt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Wt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Wt(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,a){this.activated=t,this._activatedRoute=a,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,a){if(this.isActivated)throw new Wt(4013,!1);this._activatedRoute=t;let h=this.location,C=t.snapshot.component,F=this.parentContexts.getOrCreateContext(this.name).children,V=new QD(t,F,h.injector,this.routerOutletData);this.activated=h.createComponent(C,{index:h.length,injector:V,environmentInjector:a}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(a){return new(a||n)};static \u0275dir=_r({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[cs]})}return n})(),QD=class n{route;childContexts;parent;outletData;__ngOutletInjector(r){return new n(this.route,this.childContexts,r,this.outletData)}constructor(r,t,a,h){this.route=r,this.childContexts=t,this.parent=a,this.outletData=h}get(r,t){return r===Ag?this.route:r===J_?this.childContexts:r===F5?this.outletData:this.parent.get(r,t)}},Ax=new pt(""),WP=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){let{activatedRoute:a}=t,h=jf([a.queryParams,a.params,a.data]).pipe(Vo(([i,C,F],V)=>(F=ht(ht(ht({},i),C),F),V===0?nn(F):Promise.resolve(F)))).subscribe(i=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==a||a.component===null){this.unsubscribeFromRouteData(t);return}let C=JR(a.component);if(!C){this.unsubscribeFromRouteData(t);return}for(let{templateName:F}of C.inputs)t.activatedComponentRef.setInput(F,i[F])});this.outletDataSubscriptions.set(t,h)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})();function N5(n,r,t){let a=W_(n,r._root,t?t._root:void 0);return new Ex(a,r)}function W_(n,r,t){if(t&&n.shouldReuseRoute(r.value,t.value.snapshot)){let a=t.value;a._futureSnapshot=r.value;let h=z5(n,r,t);return new ga(a,h)}else{if(n.shouldAttach(r.value)){let i=n.retrieve(r.value);if(i!==null){let C=i.route;return C.value._futureSnapshot=r.value,C.children=r.children.map(F=>W_(n,F)),C}}let a=B5(r.value),h=r.children.map(i=>W_(n,i));return new ga(a,h)}}function z5(n,r,t){return r.children.map(a=>{for(let h of t.children)if(n.shouldReuseRoute(a.value,h.value.snapshot))return W_(n,a,h);return W_(n,a)})}function B5(n){return new Ag(new Dr(n.url),new Dr(n.params),new Dr(n.queryParams),new Dr(n.fragment),new Dr(n.data),n.outlet,n.component,n)}var q_=class{redirectTo;navigationBehaviorOptions;constructor(r,t){this.redirectTo=r,this.navigationBehaviorOptions=t}},mO="ngNavigationCancelingError";function Tx(n,r){let{redirectTo:t,navigationBehaviorOptions:a}=U_(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,h=gO(!1,ya.Redirect);return h.url=t,h.navigationBehaviorOptions=a,h}function gO(n,r){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[mO]=!0,t.cancellationCode=r,t}function V5(n){return yO(n)&&U_(n.url)}function yO(n){return!!n&&n[mO]}var j5=(n,r,t,a)=>ln(h=>(new JD(r,h.targetRouterState,h.currentRouterState,t,a).activate(n),h)),JD=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(r,t,a,h,i){this.routeReuseStrategy=r,this.futureState=t,this.currState=a,this.forwardEvent=h,this.inputBindingEnabled=i}activate(r){let t=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,a,r),kD(this.futureState.root),this.activateChildRoutes(t,a,r)}deactivateChildRoutes(r,t,a){let h=wg(t);r.children.forEach(i=>{let C=i.value.outlet;this.deactivateRoutes(i,h[C],a),delete h[C]}),Object.values(h).forEach(i=>{this.deactivateRouteAndItsChildren(i,a)})}deactivateRoutes(r,t,a){let h=r.value,i=t?t.value:null;if(h===i)if(h.component){let C=a.getContext(h.outlet);C&&this.deactivateChildRoutes(r,t,C.children)}else this.deactivateChildRoutes(r,t,a);else i&&this.deactivateRouteAndItsChildren(t,a)}deactivateRouteAndItsChildren(r,t){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,t):this.deactivateRouteAndOutlet(r,t)}detachAndStoreRouteSubtree(r,t){let a=t.getContext(r.value.outlet),h=a&&r.value.component?a.children:t,i=wg(r);for(let C of Object.values(i))this.deactivateRouteAndItsChildren(C,h);if(a&&a.outlet){let C=a.outlet.detach(),F=a.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:C,route:r,contexts:F})}}deactivateRouteAndOutlet(r,t){let a=t.getContext(r.value.outlet),h=a&&r.value.component?a.children:t,i=wg(r);for(let C of Object.values(i))this.deactivateRouteAndItsChildren(C,h);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.route=null)}activateChildRoutes(r,t,a){let h=wg(t);r.children.forEach(i=>{this.activateRoutes(i,h[i.value.outlet],a),this.forwardEvent(new qD(i.value.snapshot))}),r.children.length&&this.forwardEvent(new GD(r.value.snapshot))}activateRoutes(r,t,a){let h=r.value,i=t?t.value:null;if(kD(h),h===i)if(h.component){let C=a.getOrCreateContext(h.outlet);this.activateChildRoutes(r,t,C.children)}else this.activateChildRoutes(r,t,a);else if(h.component){let C=a.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){let F=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),C.children.onOutletReAttached(F.contexts),C.attachRef=F.componentRef,C.route=F.route.value,C.outlet&&C.outlet.attach(F.componentRef,F.route.value),kD(F.route.value),this.activateChildRoutes(r,null,C.children)}else C.attachRef=null,C.route=h,C.outlet&&C.outlet.activateWith(h,C.injector),this.activateChildRoutes(r,null,C.children)}else this.activateChildRoutes(r,null,a)}},Mx=class{path;route;constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},Dg=class{component;route;constructor(r,t){this.component=r,this.route=t}};function U5(n,r,t){let a=n._root,h=r?r._root:null;return z_(a,h,t,[a.value])}function $5(n){let r=n.routeConfig?n.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:n,guards:r}}function Pg(n,r){let t=Symbol(),a=r.get(n,t);return a===t?typeof n=="function"&&!aA(n)?n:r.get(n):a}function z_(n,r,t,a,h={canDeactivateChecks:[],canActivateChecks:[]}){let i=wg(r);return n.children.forEach(C=>{H5(C,i[C.value.outlet],t,a.concat([C.value]),h),delete i[C.value.outlet]}),Object.entries(i).forEach(([C,F])=>j_(F,t.getContext(C),h)),h}function H5(n,r,t,a,h={canDeactivateChecks:[],canActivateChecks:[]}){let i=n.value,C=r?r.value:null,F=t?t.getContext(n.value.outlet):null;if(C&&i.routeConfig===C.routeConfig){let V=G5(C,i,i.routeConfig.runGuardsAndResolvers);V?h.canActivateChecks.push(new Mx(a)):(i.data=C.data,i._resolvedData=C._resolvedData),i.component?z_(n,r,F?F.children:null,a,h):z_(n,r,t,a,h),V&&F&&F.outlet&&F.outlet.isActivated&&h.canDeactivateChecks.push(new Dg(F.outlet.component,C))}else C&&j_(r,F,h),h.canActivateChecks.push(new Mx(a)),i.component?z_(n,null,F?F.children:null,a,h):z_(n,null,t,a,h);return h}function G5(n,r,t){if(typeof t=="function")return t(n,r);switch(t){case"pathParamsChange":return!cp(n.url,r.url);case"pathParamsOrQueryParamsChange":return!cp(n.url,r.url)||!qc(n.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!KD(n,r)||!qc(n.queryParams,r.queryParams);case"paramsChange":default:return!KD(n,r)}}function j_(n,r,t){let a=wg(n),h=n.value;Object.entries(a).forEach(([i,C])=>{h.component?r?j_(C,r.children.getContext(i),t):j_(C,null,t):j_(C,r,t)}),h.component?r&&r.outlet&&r.outlet.isActivated?t.canDeactivateChecks.push(new Dg(r.outlet.component,h)):t.canDeactivateChecks.push(new Dg(null,h)):t.canDeactivateChecks.push(new Dg(null,h))}function ev(n){return typeof n=="function"}function W5(n){return typeof n=="boolean"}function q5(n){return n&&ev(n.canLoad)}function Z5(n){return n&&ev(n.canActivate)}function X5(n){return n&&ev(n.canActivateChild)}function Y5(n){return n&&ev(n.canDeactivate)}function K5(n){return n&&ev(n.canMatch)}function _O(n){return n instanceof Bl||n?.name==="EmptyError"}var fx=Symbol("INITIAL_VALUE");function kg(){return Vo(n=>jf(n.map(r=>r.pipe(ss(1),Uf(fx)))).pipe(ln(r=>{for(let t of r)if(t!==!0){if(t===fx)return fx;if(t===!1||Q5(t))return t}return!0}),Pr(r=>r!==fx),ss(1)))}function Q5(n){return U_(n)||n instanceof q_}function J5(n,r){return Xr(t=>{let{targetSnapshot:a,currentSnapshot:h,guards:{canActivateChecks:i,canDeactivateChecks:C}}=t;return C.length===0&&i.length===0?nn(vn(ht({},t),{guardsResult:!0})):e4(C,a,h,n).pipe(Xr(F=>F&&W5(F)?t4(a,i,n,r):nn(F)),ln(F=>vn(ht({},t),{guardsResult:F})))})}function e4(n,r,t,a){return ur(n).pipe(Xr(h=>s4(h.component,h.route,t,r,a)),Vl(h=>h!==!0,!0))}function t4(n,r,t,a){return ur(r).pipe(qu(h=>dh(i4(h.route.parent,a),n4(h.route,a),o4(n,h.path,t),r4(n,h.route,t))),Vl(h=>h!==!0,!0))}function n4(n,r){return n!==null&&r&&r(new WD(n)),nn(!0)}function i4(n,r){return n!==null&&r&&r(new HD(n)),nn(!0)}function r4(n,r,t){let a=r.routeConfig?r.routeConfig.canActivate:null;if(!a||a.length===0)return nn(!0);let h=a.map(i=>jb(()=>{let C=Q_(r)??t,F=Pg(i,C),V=Z5(F)?F.canActivate(r,n):Ns(C,()=>F(r,n));return Ch(V).pipe(Vl())}));return nn(h).pipe(kg())}function o4(n,r,t){let a=r[r.length-1],i=r.slice(0,r.length-1).reverse().map(C=>$5(C)).filter(C=>C!==null).map(C=>jb(()=>{let F=C.guards.map(V=>{let K=Q_(C.node)??t,oe=Pg(V,K),Ee=X5(oe)?oe.canActivateChild(a,n):Ns(K,()=>oe(a,n));return Ch(Ee).pipe(Vl())});return nn(F).pipe(kg())}));return nn(i).pipe(kg())}function s4(n,r,t,a,h){let i=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!i||i.length===0)return nn(!0);let C=i.map(F=>{let V=Q_(r)??h,K=Pg(F,V),oe=Y5(K)?K.canDeactivate(n,r,t,a):Ns(V,()=>K(n,r,t,a));return Ch(oe).pipe(Vl())});return nn(C).pipe(kg())}function a4(n,r,t,a){let h=r.canLoad;if(h===void 0||h.length===0)return nn(!0);let i=h.map(C=>{let F=Pg(C,n),V=q5(F)?F.canLoad(r,t):Ns(n,()=>F(r,t));return Ch(V)});return nn(i).pipe(kg(),vO(a))}function vO(n){return F1(gr(r=>{if(typeof r!="boolean")throw Tx(n,r)}),ln(r=>r===!0))}function l4(n,r,t,a){let h=r.canMatch;if(!h||h.length===0)return nn(!0);let i=h.map(C=>{let F=Pg(C,n),V=K5(F)?F.canMatch(r,t):Ns(n,()=>F(r,t));return Ch(V)});return nn(i).pipe(kg(),vO(a))}var Z_=class{segmentGroup;constructor(r){this.segmentGroup=r||null}},X_=class extends Error{urlTree;constructor(r){super(),this.urlTree=r}};function xg(n){return ch(new Z_(n))}function c4(n){return ch(new Wt(4e3,!1))}function u4(n){return ch(gO(!1,ya.GuardRejected))}var eT=class{urlSerializer;urlTree;constructor(r,t){this.urlSerializer=r,this.urlTree=t}lineralizeSegments(r,t){let a=[],h=t.root;for(;;){if(a=a.concat(h.segments),h.numberOfChildren===0)return nn(a);if(h.numberOfChildren>1||!h.children[qn])return c4(`${r.redirectTo}`);h=h.children[qn]}}applyRedirectCommands(r,t,a,h,i){if(typeof t!="string"){let F=t,{queryParams:V,fragment:K,routeConfig:oe,url:Ee,outlet:Ye,params:Ne,data:ct,title:bt}=h,Ut=Ns(i,()=>F({params:Ne,data:ct,queryParams:V,fragment:K,routeConfig:oe,url:Ee,outlet:Ye,title:bt}));if(Ut instanceof sd)throw new X_(Ut);t=Ut}let C=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),r,a);if(t[0]==="/")throw new X_(C);return C}applyRedirectCreateUrlTree(r,t,a,h){let i=this.createSegmentGroup(r,t.root,a,h);return new sd(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(r,t){let a={};return Object.entries(r).forEach(([h,i])=>{if(typeof i=="string"&&i[0]===":"){let F=i.substring(1);a[h]=t[F]}else a[h]=i}),a}createSegmentGroup(r,t,a,h){let i=this.createSegments(r,t.segments,a,h),C={};return Object.entries(t.children).forEach(([F,V])=>{C[F]=this.createSegmentGroup(r,V,a,h)}),new Li(i,C)}createSegments(r,t,a,h){return t.map(i=>i.path[0]===":"?this.findPosParam(r,i,h):this.findOrReturn(i,a))}findPosParam(r,t,a){let h=a[t.path.substring(1)];if(!h)throw new Wt(4001,!1);return h}findOrReturn(r,t){let a=0;for(let h of t){if(h.path===r.path)return t.splice(a),h;a++}return r}},tT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function d4(n,r,t,a,h){let i=bO(n,r,t);return i.matched?(a=P5(r,a),l4(a,r,t,h).pipe(ln(C=>C===!0?i:ht({},tT)))):nn(i)}function bO(n,r,t){if(r.path==="**")return h4(t);if(r.path==="")return r.pathMatch==="full"&&(n.hasChildren()||t.length>0)?ht({},tT):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let h=(r.matcher||a5)(t,n,r);if(!h)return ht({},tT);let i={};Object.entries(h.posParams??{}).forEach(([F,V])=>{i[F]=V.path});let C=h.consumed.length>0?ht(ht({},i),h.consumed[h.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:h.consumed,remainingSegments:t.slice(h.consumed.length),parameters:C,positionalParamSegments:h.posParams??{}}}function h4(n){return{matched:!0,parameters:n.length>0?JP(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function qP(n,r,t,a){return t.length>0&&m4(n,t,a)?{segmentGroup:new Li(r,p4(a,new Li(t,n.children))),slicedSegments:[]}:t.length===0&&g4(n,t,a)?{segmentGroup:new Li(n.segments,f4(n,t,a,n.children)),slicedSegments:t}:{segmentGroup:new Li(n.segments,n.children),slicedSegments:t}}function f4(n,r,t,a){let h={};for(let i of t)if(kx(n,r,i)&&!a[ql(i)]){let C=new Li([],{});h[ql(i)]=C}return ht(ht({},a),h)}function p4(n,r){let t={};t[qn]=r;for(let a of n)if(a.path===""&&ql(a)!==qn){let h=new Li([],{});t[ql(a)]=h}return t}function m4(n,r,t){return t.some(a=>kx(n,r,a)&&ql(a)!==qn)}function g4(n,r,t){return t.some(a=>kx(n,r,a))}function kx(n,r,t){return(n.hasChildren()||r.length>0)&&t.pathMatch==="full"?!1:t.path===""}function y4(n,r,t){return r.length===0&&!n.children[t]}var nT=class{};function _4(n,r,t,a,h,i,C="emptyOnly"){return new iT(n,r,t,a,h,C,i).recognize()}var v4=31,iT=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(r,t,a,h,i,C,F){this.injector=r,this.configLoader=t,this.rootComponentType=a,this.config=h,this.urlTree=i,this.paramsInheritanceStrategy=C,this.urlSerializer=F,this.applyRedirects=new eT(this.urlSerializer,this.urlTree)}noMatchError(r){return new Wt(4002,`'${r.segmentGroup}'`)}recognize(){let r=qP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(ln(({children:t,rootSnapshot:a})=>{let h=new ga(a,t),i=new Dx("",h),C=T5(a,[],this.urlTree.queryParams,this.urlTree.fragment);return C.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(C),{state:i,tree:C}}))}match(r){let t=new Cg([],Object.freeze({}),Object.freeze(ht({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),qn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,r,qn,t).pipe(ln(a=>({children:a,rootSnapshot:t})),Lc(a=>{if(a instanceof X_)return this.urlTree=a.urlTree,this.match(a.urlTree.root);throw a instanceof Z_?this.noMatchError(a):a}))}processSegmentGroup(r,t,a,h,i){return a.segments.length===0&&a.hasChildren()?this.processChildren(r,t,a,i):this.processSegment(r,t,a,a.segments,h,!0,i).pipe(ln(C=>C instanceof ga?[C]:[]))}processChildren(r,t,a,h){let i=[];for(let C of Object.keys(a.children))C==="primary"?i.unshift(C):i.push(C);return ur(i).pipe(qu(C=>{let F=a.children[C],V=O5(t,C);return this.processSegmentGroup(r,V,F,C,h)}),t_((C,F)=>(C.push(...F),C)),hh(null),G1(),Xr(C=>{if(C===null)return xg(a);let F=xO(C);return b4(F),nn(F)}))}processSegment(r,t,a,h,i,C,F){return ur(t).pipe(qu(V=>this.processSegmentAgainstRoute(V._injector??r,t,V,a,h,i,C,F).pipe(Lc(K=>{if(K instanceof Z_)return nn(null);throw K}))),Vl(V=>!!V),Lc(V=>{if(_O(V))return y4(a,h,i)?nn(new nT):xg(a);throw V}))}processSegmentAgainstRoute(r,t,a,h,i,C,F,V){return ql(a)!==C&&(C===qn||!kx(h,i,a))?xg(h):a.redirectTo===void 0?this.matchSegmentAgainstRoute(r,h,a,i,C,V):this.allowRedirects&&F?this.expandSegmentAgainstRouteUsingRedirect(r,h,t,a,i,C,V):xg(h)}expandSegmentAgainstRouteUsingRedirect(r,t,a,h,i,C,F){let{matched:V,parameters:K,consumedSegments:oe,positionalParamSegments:Ee,remainingSegments:Ye}=bO(t,h,i);if(!V)return xg(t);typeof h.redirectTo=="string"&&h.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>v4&&(this.allowRedirects=!1));let Ne=new Cg(i,K,Object.freeze(ht({},this.urlTree.queryParams)),this.urlTree.fragment,ZP(h),ql(h),h.component??h._loadedComponent??null,h,XP(h)),ct=Cx(Ne,F,this.paramsInheritanceStrategy);Ne.params=Object.freeze(ct.params),Ne.data=Object.freeze(ct.data);let bt=this.applyRedirects.applyRedirectCommands(oe,h.redirectTo,Ee,Ne,r);return this.applyRedirects.lineralizeSegments(h,bt).pipe(Xr(Ut=>this.processSegment(r,a,t,Ut.concat(Ye),C,!1,F)))}matchSegmentAgainstRoute(r,t,a,h,i,C){let F=d4(t,a,h,r,this.urlSerializer);return a.path==="**"&&(t.children={}),F.pipe(Vo(V=>V.matched?(r=a._injector??r,this.getChildConfig(r,a,h).pipe(Vo(({routes:K})=>{let oe=a._loadedInjector??r,{parameters:Ee,consumedSegments:Ye,remainingSegments:Ne}=V,ct=new Cg(Ye,Ee,Object.freeze(ht({},this.urlTree.queryParams)),this.urlTree.fragment,ZP(a),ql(a),a.component??a._loadedComponent??null,a,XP(a)),bt=Cx(ct,C,this.paramsInheritanceStrategy);ct.params=Object.freeze(bt.params),ct.data=Object.freeze(bt.data);let{segmentGroup:Ut,slicedSegments:Qt}=qP(t,Ye,Ne,K);if(Qt.length===0&&Ut.hasChildren())return this.processChildren(oe,K,Ut,ct).pipe(ln(Un=>new ga(ct,Un)));if(K.length===0&&Qt.length===0)return nn(new ga(ct,[]));let yi=ql(a)===i;return this.processSegment(oe,K,Ut,Qt,yi?qn:i,!0,ct).pipe(ln(Un=>new ga(ct,Un instanceof ga?[Un]:[])))}))):xg(t)))}getChildConfig(r,t,a){return t.children?nn({routes:t.children,injector:r}):t.loadChildren?t._loadedRoutes!==void 0?nn({routes:t._loadedRoutes,injector:t._loadedInjector}):a4(r,t,a,this.urlSerializer).pipe(Xr(h=>h?this.configLoader.loadChildren(r,t).pipe(gr(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):u4(t))):nn({routes:[],injector:r})}};function b4(n){n.sort((r,t)=>r.value.outlet===qn?-1:t.value.outlet===qn?1:r.value.outlet.localeCompare(t.value.outlet))}function x4(n){let r=n.value.routeConfig;return r&&r.path===""}function xO(n){let r=[],t=new Set;for(let a of n){if(!x4(a)){r.push(a);continue}let h=r.find(i=>a.value.routeConfig===i.value.routeConfig);h!==void 0?(h.children.push(...a.children),t.add(h)):r.push(a)}for(let a of t){let h=xO(a.children);r.push(new ga(a.value,h))}return r.filter(a=>!t.has(a))}function ZP(n){return n.data||{}}function XP(n){return n.resolve||{}}function w4(n,r,t,a,h,i){return Xr(C=>_4(n,r,t,a,C.extractedUrl,h,i).pipe(ln(({state:F,tree:V})=>vn(ht({},C),{targetSnapshot:F,urlAfterRedirects:V}))))}function E4(n,r){return Xr(t=>{let{targetSnapshot:a,guards:{canActivateChecks:h}}=t;if(!h.length)return nn(t);let i=new Set(h.map(V=>V.route)),C=new Set;for(let V of i)if(!C.has(V))for(let K of wO(V))C.add(K);let F=0;return ur(C).pipe(qu(V=>i.has(V)?C4(V,a,n,r):(V.data=Cx(V,V.parent,n).resolve,nn(void 0))),gr(()=>F++),jm(1),Xr(V=>F===C.size?nn(t):Bo))})}function wO(n){let r=n.children.map(t=>wO(t)).flat();return[n,...r]}function C4(n,r,t,a){let h=n.routeConfig,i=n._resolve;return h?.title!==void 0&&!pO(h)&&(i[Y_]=h.title),D4(i,n,r,a).pipe(ln(C=>(n._resolvedData=C,n.data=Cx(n,n.parent,t).resolve,null)))}function D4(n,r,t,a){let h=OD(n);if(h.length===0)return nn({});let i={};return ur(h).pipe(Xr(C=>T4(n[C],r,t,a).pipe(Vl(),gr(F=>{if(F instanceof q_)throw Tx(new Mg,F);i[C]=F}))),jm(1),ln(()=>i),Lc(C=>_O(C)?Bo:ch(C)))}function T4(n,r,t,a){let h=Q_(r)??a,i=Pg(n,h),C=i.resolve?i.resolve(r,t):Ns(h,()=>i(r,t));return Ch(C)}function RD(n){return Vo(r=>{let t=n(r);return t?ur(t).pipe(ln(()=>r)):nn(r)})}var EO=(()=>{class n{buildTitle(t){let a,h=t.root;for(;h!==void 0;)a=this.getResolvedTitleForRoute(h)??a,h=h.children.find(i=>i.outlet===qn);return a}getResolvedTitleForRoute(t){return t.data[Y_]}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>Re(M4),providedIn:"root"})}return n})(),M4=(()=>{class n extends EO{title;constructor(t){super(),this.title=t}updateTitle(t){let a=this.buildTitle(t);a!==void 0&&this.title.setTitle(a)}static \u0275fac=function(a){return new(a||n)(kt(jP))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),tv=new pt("",{providedIn:"root",factory:()=>({})}),I4=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(a,h){a&1&&rr(0,"router-outlet")},dependencies:[sT],encapsulation:2})}return n})();function aT(n){let r=n.children&&n.children.map(aT),t=r?vn(ht({},n),{children:r}):ht({},n);return!t.component&&!t.loadComponent&&(r||t.loadChildren)&&t.outlet&&t.outlet!==qn&&(t.component=I4),t}var Ix=new pt(""),lT=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Re(K0);loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return nn(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let a=Ch(t.loadComponent()).pipe(ln(CO),gr(i=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=i}),Fc(()=>{this.componentLoaders.delete(t)})),h=new Om(a,()=>new jn).pipe(Pm());return this.componentLoaders.set(t,h),h}loadChildren(t,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return nn({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);let i=S4(a,this.compiler,t,this.onLoadEndListener).pipe(Fc(()=>{this.childrenLoaders.delete(a)})),C=new Om(i,()=>new jn).pipe(Pm());return this.childrenLoaders.set(a,C),C}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function S4(n,r,t,a){return Ch(n.loadChildren()).pipe(ln(CO),Xr(h=>h instanceof WC||Array.isArray(h)?nn(h):ur(r.compileModuleAsync(h))),ln(h=>{a&&a(n);let i,C,F=!1;return Array.isArray(h)?(C=h,F=!0):(i=h.create(t).injector,C=i.get(Ix,[],{optional:!0,self:!0}).flat()),{routes:C.map(aT),injector:i}}))}function A4(n){return n&&typeof n=="object"&&"default"in n}function CO(n){return A4(n)?n.default:n}var cT=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>Re(k4),providedIn:"root"})}return n})(),k4=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,a){return t}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),DO=new pt(""),TO=new pt("");function R4(n,r,t){let a=n.get(TO),h=n.get(oi);return n.get(bn).runOutsideAngular(()=>{if(!h.startViewTransition||a.skipNextTransition)return a.skipNextTransition=!1,new Promise(K=>setTimeout(K));let i,C=new Promise(K=>{i=K}),F=h.startViewTransition(()=>(i(),P4(n))),{onViewTransitionCreated:V}=a;return V&&Ns(n,()=>V({transition:F,from:r,to:t})),C})}function P4(n){return new Promise(r=>{Hc({read:()=>setTimeout(r)},{injector:n})})}var MO=new pt(""),uT=(()=>{class n{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new jn;transitionAbortSubject=new jn;configLoader=Re(lT);environmentInjector=Re(Nr);destroyRef=Re($c);urlSerializer=Re(K_);rootContexts=Re(J_);location=Re(xh);inputBindingEnabled=Re(Ax,{optional:!0})!==null;titleStrategy=Re(EO);options=Re(tv,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Re(cT);createViewTransition=Re(DO,{optional:!0});navigationErrorHandler=Re(MO,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>nn(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=h=>this.events.next(new UD(h)),a=h=>this.events.next(new $D(h));this.configLoader.onLoadEndListener=a,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let a=++this.navigationId;this.transitions?.next(vn(ht(ht({},this.transitions.value),t),{id:a}))}setupNavigations(t,a,h){return this.transitions=new Dr({id:0,currentUrlTree:a,currentRawUrl:a,extractedUrl:this.urlHandlingStrategy.extract(a),urlAfterRedirects:this.urlHandlingStrategy.extract(a),rawUrl:a,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:V_,restoredState:null,currentSnapshot:h.snapshot,targetSnapshot:null,currentRouterState:h,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Pr(i=>i.id!==0),ln(i=>vn(ht({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),Vo(i=>{let C=!1,F=!1;return nn(i).pipe(Vo(V=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",ya.SupersededByNewNavigation),Bo;this.currentTransition=i,this.currentNavigation={id:V.id,initialUrl:V.rawUrl,extractedUrl:V.extractedUrl,targetBrowserUrl:typeof V.extras.browserUrl=="string"?this.urlSerializer.parse(V.extras.browserUrl):V.extras.browserUrl,trigger:V.source,extras:V.extras,previousNavigation:this.lastSuccessfulNavigation?vn(ht({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let K=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),oe=V.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!K&&oe!=="reload"){let Ee="";return this.events.next(new Eh(V.id,this.urlSerializer.serialize(V.rawUrl),Ee,vx.IgnoredSameUrlNavigation)),V.resolve(!1),Bo}if(this.urlHandlingStrategy.shouldProcessUrl(V.rawUrl))return nn(V).pipe(Vo(Ee=>{let Ye=this.transitions?.getValue();return this.events.next(new Ig(Ee.id,this.urlSerializer.serialize(Ee.extractedUrl),Ee.source,Ee.restoredState)),Ye!==this.transitions?.getValue()?Bo:Promise.resolve(Ee)}),w4(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),gr(Ee=>{i.targetSnapshot=Ee.targetSnapshot,i.urlAfterRedirects=Ee.urlAfterRedirects,this.currentNavigation=vn(ht({},this.currentNavigation),{finalUrl:Ee.urlAfterRedirects});let Ye=new bx(Ee.id,this.urlSerializer.serialize(Ee.extractedUrl),this.urlSerializer.serialize(Ee.urlAfterRedirects),Ee.targetSnapshot);this.events.next(Ye)}));if(K&&this.urlHandlingStrategy.shouldProcessUrl(V.currentRawUrl)){let{id:Ee,extractedUrl:Ye,source:Ne,restoredState:ct,extras:bt}=V,Ut=new Ig(Ee,this.urlSerializer.serialize(Ye),Ne,ct);this.events.next(Ut);let Qt=hO(this.rootComponentType).snapshot;return this.currentTransition=i=vn(ht({},V),{targetSnapshot:Qt,urlAfterRedirects:Ye,extras:vn(ht({},bt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Ye,nn(i)}else{let Ee="";return this.events.next(new Eh(V.id,this.urlSerializer.serialize(V.extractedUrl),Ee,vx.IgnoredByUrlHandlingStrategy)),V.resolve(!1),Bo}}),gr(V=>{let K=new zD(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects),V.targetSnapshot);this.events.next(K)}),ln(V=>(this.currentTransition=i=vn(ht({},V),{guards:U5(V.targetSnapshot,V.currentSnapshot,this.rootContexts)}),i)),J5(this.environmentInjector,V=>this.events.next(V)),gr(V=>{if(i.guardsResult=V.guardsResult,V.guardsResult&&typeof V.guardsResult!="boolean")throw Tx(this.urlSerializer,V.guardsResult);let K=new BD(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects),V.targetSnapshot,!!V.guardsResult);this.events.next(K)}),Pr(V=>V.guardsResult?!0:(this.cancelNavigationTransition(V,"",ya.GuardRejected),!1)),RD(V=>{if(V.guards.canActivateChecks.length)return nn(V).pipe(gr(K=>{let oe=new VD(K.id,this.urlSerializer.serialize(K.extractedUrl),this.urlSerializer.serialize(K.urlAfterRedirects),K.targetSnapshot);this.events.next(oe)}),Vo(K=>{let oe=!1;return nn(K).pipe(E4(this.paramsInheritanceStrategy,this.environmentInjector),gr({next:()=>oe=!0,complete:()=>{oe||this.cancelNavigationTransition(K,"",ya.NoDataFromResolver)}}))}),gr(K=>{let oe=new jD(K.id,this.urlSerializer.serialize(K.extractedUrl),this.urlSerializer.serialize(K.urlAfterRedirects),K.targetSnapshot);this.events.next(oe)}))}),RD(V=>{let K=oe=>{let Ee=[];oe.routeConfig?.loadComponent&&!oe.routeConfig._loadedComponent&&Ee.push(this.configLoader.loadComponent(oe.routeConfig).pipe(gr(Ye=>{oe.component=Ye}),ln(()=>{})));for(let Ye of oe.children)Ee.push(...K(Ye));return Ee};return jf(K(V.targetSnapshot.root)).pipe(hh(null),ss(1))}),RD(()=>this.afterPreactivation()),Vo(()=>{let{currentSnapshot:V,targetSnapshot:K}=i,oe=this.createViewTransition?.(this.environmentInjector,V.root,K.root);return oe?ur(oe).pipe(ln(()=>i)):nn(i)}),ln(V=>{let K=N5(t.routeReuseStrategy,V.targetSnapshot,V.currentRouterState);return this.currentTransition=i=vn(ht({},V),{targetRouterState:K}),this.currentNavigation.targetRouterState=K,i}),gr(()=>{this.events.next(new G_)}),j5(this.rootContexts,t.routeReuseStrategy,V=>this.events.next(V),this.inputBindingEnabled),ss(1),gr({next:V=>{C=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ad(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects))),this.titleStrategy?.updateTitle(V.targetRouterState.snapshot),V.resolve(!0)},complete:()=>{C=!0}}),ro(this.transitionAbortSubject.pipe(gr(V=>{throw V}))),Fc(()=>{!C&&!F&&this.cancelNavigationTransition(i,"",ya.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),Lc(V=>{if(this.destroyed)return i.resolve(!1),Bo;if(F=!0,yO(V))this.events.next(new od(i.id,this.urlSerializer.serialize(i.extractedUrl),V.message,V.cancellationCode)),V5(V)?this.events.next(new Sg(V.url,V.navigationBehaviorOptions)):i.resolve(!1);else{let K=new H_(i.id,this.urlSerializer.serialize(i.extractedUrl),V,i.targetSnapshot??void 0);try{let oe=Ns(this.environmentInjector,()=>this.navigationErrorHandler?.(K));if(oe instanceof q_){let{message:Ee,cancellationCode:Ye}=Tx(this.urlSerializer,oe);this.events.next(new od(i.id,this.urlSerializer.serialize(i.extractedUrl),Ee,Ye)),this.events.next(new Sg(oe.redirectTo,oe.navigationBehaviorOptions))}else throw this.events.next(K),V}catch(oe){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(oe)}}return Bo}))}))}cancelNavigationTransition(t,a,h){let i=new od(t.id,this.urlSerializer.serialize(t.extractedUrl),a,h);this.events.next(i),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),a=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==a?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function O4(n){return n!==V_}var L4=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>Re(F4),providedIn:"root"})}return n})(),rT=class{shouldDetach(r){return!1}store(r,t){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,t){return r.routeConfig===t.routeConfig}},F4=(()=>{class n extends rT{static \u0275fac=(()=>{let t;return function(h){return(t||(t=ja(n)))(h||n)}})();static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),IO=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:()=>Re(N4),providedIn:"root"})}return n})(),N4=(()=>{class n extends IO{location=Re(xh);urlSerializer=Re(K_);options=Re(tv,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=Re(cT);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new sd;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=hO(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(a=>{a.type==="popstate"&&t(a.url,a.state)})}handleRouterEvent(t,a){if(t instanceof Ig)this.stateMemento=this.createStateMemento();else if(t instanceof Eh)this.rawUrlTree=a.initialUrl;else if(t instanceof bx){if(this.urlUpdateStrategy==="eager"&&!a.extras.skipLocationChange){let h=this.urlHandlingStrategy.merge(a.finalUrl,a.initialUrl);this.setBrowserUrl(a.targetBrowserUrl??h,a)}}else t instanceof G_?(this.currentUrlTree=a.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(a.finalUrl,a.initialUrl),this.routerState=a.targetRouterState,this.urlUpdateStrategy==="deferred"&&!a.extras.skipLocationChange&&this.setBrowserUrl(a.targetBrowserUrl??this.rawUrlTree,a)):t instanceof od&&(t.code===ya.GuardRejected||t.code===ya.NoDataFromResolver)?this.restoreHistory(a):t instanceof H_?this.restoreHistory(a,!0):t instanceof ad&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,a){let h=t instanceof sd?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(h)||a.extras.replaceUrl){let i=this.browserPageId,C=ht(ht({},a.extras.state),this.generateNgRouterState(a.id,i));this.location.replaceState(h,"",C)}else{let i=ht(ht({},a.extras.state),this.generateNgRouterState(a.id,this.browserPageId+1));this.location.go(h,"",i)}}restoreHistory(t,a=!1){if(this.canceledNavigationResolution==="computed"){let h=this.browserPageId,i=this.currentPageId-h;i!==0?this.location.historyGo(i):this.currentUrlTree===t.finalUrl&&i===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(a&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,a){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:a}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(h){return(t||(t=ja(n)))(h||n)}})();static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function SO(n,r){n.events.pipe(Pr(t=>t instanceof ad||t instanceof od||t instanceof H_||t instanceof Eh),ln(t=>t instanceof ad||t instanceof Eh?0:(t instanceof od?t.code===ya.Redirect||t.code===ya.SupersededByNewNavigation:!1)?2:1),Pr(t=>t!==2),ss(1)).subscribe(()=>{r()})}var z4={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},B4={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Rg=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Re(ZC);stateManager=Re(IO);options=Re(tv,{optional:!0})||{};pendingTasks=Re(td);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Re(uT);urlSerializer=Re(K_);location=Re(xh);urlHandlingStrategy=Re(cT);_events=new jn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Re(L4);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Re(Ix,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Re(Ax,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Pi;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(a=>{try{let h=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(h!==null&&i!==null){if(this.stateManager.handleRouterEvent(a,i),a instanceof od&&a.code!==ya.Redirect&&a.code!==ya.SupersededByNewNavigation)this.navigated=!0;else if(a instanceof ad)this.navigated=!0;else if(a instanceof Sg){let C=a.navigationBehaviorOptions,F=this.urlHandlingStrategy.merge(a.url,h.currentRawUrl),V=ht({browserUrl:h.extras.browserUrl,info:h.extras.info,skipLocationChange:h.extras.skipLocationChange,replaceUrl:h.extras.replaceUrl||this.urlUpdateStrategy==="eager"||O4(h.source)},C);this.scheduleNavigation(F,V_,null,V,{resolve:h.resolve,reject:h.reject,promise:h.promise})}}j4(a)&&this._events.next(a)}catch(h){this.navigationTransitions.transitionAbortSubject.next(h)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),V_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,a)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",a)},0)})}navigateToSyncWithBrowser(t,a,h){let i={replaceUrl:!0},C=h?.navigationId?h:null;if(h){let V=ht({},h);delete V.navigationId,delete V.\u0275routerPageId,Object.keys(V).length!==0&&(i.state=V)}let F=this.parseUrl(t);this.scheduleNavigation(F,a,C,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(aT),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,a={}){let{relativeTo:h,queryParams:i,fragment:C,queryParamsHandling:F,preserveFragment:V}=a,K=V?this.currentUrlTree.fragment:C,oe=null;switch(F??this.options.defaultQueryParamsHandling){case"merge":oe=ht(ht({},this.currentUrlTree.queryParams),i);break;case"preserve":oe=this.currentUrlTree.queryParams;break;default:oe=i||null}oe!==null&&(oe=this.removeEmptyProps(oe));let Ee;try{let Ye=h?h.snapshot:this.routerState.snapshot.root;Ee=lO(Ye)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),Ee=this.currentUrlTree.root}return cO(Ee,t,oe,K??null)}navigateByUrl(t,a={skipLocationChange:!1}){let h=U_(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(i,V_,null,a)}navigate(t,a={skipLocationChange:!1}){return V4(t),this.navigateByUrl(this.createUrlTree(t,a),a)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,a){let h;if(a===!0?h=ht({},z4):a===!1?h=ht({},B4):h=a,U_(t))return UP(this.currentUrlTree,t,h);let i=this.parseUrl(t);return UP(this.currentUrlTree,i,h)}removeEmptyProps(t){return Object.entries(t).reduce((a,[h,i])=>(i!=null&&(a[h]=i),a),{})}scheduleNavigation(t,a,h,i,C){if(this.disposed)return Promise.resolve(!1);let F,V,K;C?(F=C.resolve,V=C.reject,K=C.promise):K=new Promise((Ee,Ye)=>{F=Ee,V=Ye});let oe=this.pendingTasks.add();return SO(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(oe))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:i,resolve:F,reject:V,promise:K,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),K.catch(Ee=>Promise.reject(Ee))}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function V4(n){for(let r=0;r<n.length;r++)if(n[r]==null)throw new Wt(4008,!1)}function j4(n){return!(n instanceof G_)&&!(n instanceof Sg)}var Sx=class{};var U4=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(t,a,h,i,C){this.router=t,this.injector=h,this.preloadingStrategy=i,this.loader=C}setUpPreloading(){this.subscription=this.router.events.pipe(Pr(t=>t instanceof ad),qu(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,a){let h=[];for(let i of a){i.providers&&!i._injector&&(i._injector=W0(i.providers,t,`Route: ${i.path}`));let C=i._injector??t,F=i._loadedInjector??C;(i.loadChildren&&!i._loadedRoutes&&i.canLoad===void 0||i.loadComponent&&!i._loadedComponent)&&h.push(this.preloadConfig(C,i)),(i.children||i._loadedRoutes)&&h.push(this.processRoutes(F,i.children??i._loadedRoutes))}return ur(h).pipe(uh())}preloadConfig(t,a){return this.preloadingStrategy.preload(a,()=>{let h;a.loadChildren&&a.canLoad===void 0?h=this.loader.loadChildren(t,a):h=nn(null);let i=h.pipe(Xr(C=>C===null?nn(void 0):(a._loadedRoutes=C.routes,a._loadedInjector=C.injector,this.processRoutes(C.injector??t,C.routes))));if(a.loadComponent&&!a._loadedComponent){let C=this.loader.loadComponent(a);return ur([i,C]).pipe(uh())}else return i})}static \u0275fac=function(a){return new(a||n)(kt(Rg),kt(K0),kt(Nr),kt(Sx),kt(lT))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),AO=new pt(""),$4=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(t,a,h,i,C={}){this.urlSerializer=t,this.transitions=a,this.viewportScroller=h,this.zone=i,this.options=C,C.scrollPositionRestoration||="disabled",C.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Ig?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof ad?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Eh&&t.code===vx.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof xx&&(t.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(t.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,a){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new xx(t,this.lastSource==="popstate"?this.store[this.restoredId]:null,a))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(a){gR()};static \u0275prov=Ct({token:n,factory:n.\u0275fac})}return n})();function H4(n){return n.routerState.root}function nv(n,r){return{\u0275kind:n,\u0275providers:r}}function G4(){let n=Re(ci);return r=>{let t=n.get(Fs);if(r!==t.components[0])return;let a=n.get(Rg),h=n.get(kO);n.get(dT)===1&&a.initialNavigation(),n.get(RO,null,Kn.Optional)?.setUpPreloading(),n.get(AO,null,Kn.Optional)?.init(),a.resetRootComponentType(t.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}var kO=new pt("",{factory:()=>new jn}),dT=new pt("",{providedIn:"root",factory:()=>1});function W4(){return nv(2,[{provide:dT,useValue:0},{provide:X0,multi:!0,deps:[ci],useFactory:r=>{let t=r.get(sP,Promise.resolve());return()=>t.then(()=>new Promise(a=>{let h=r.get(Rg),i=r.get(kO);SO(h,()=>{a(!0)}),r.get(uT).afterPreactivation=()=>(a(!0),i.closed?nn(void 0):i),h.initialNavigation()}))}}])}function q4(){return nv(3,[{provide:X0,multi:!0,useFactory:()=>{let r=Re(Rg);return()=>{r.setUpLocationChangeListener()}}},{provide:dT,useValue:2}])}var RO=new pt("");function Z4(n){return nv(0,[{provide:RO,useExisting:U4},{provide:Sx,useExisting:n}])}function X4(){return nv(8,[WP,{provide:Ax,useExisting:WP}])}function Y4(n){let r=[{provide:DO,useValue:R4},{provide:TO,useValue:ht({skipNextTransition:!!n?.skipInitialTransition},n)}];return nv(9,r)}var K4=[xh,{provide:K_,useClass:Mg},Rg,J_,{provide:Ag,useFactory:H4,deps:[Rg]},lT,[]],hT=(()=>{class n{constructor(){}static forRoot(t,a){return{ngModule:n,providers:[K4,[],{provide:Ix,multi:!0,useValue:t},[],a?.errorHandler?{provide:MO,useValue:a.errorHandler}:[],{provide:tv,useValue:a||{}},a?.useHash?J4():e$(),Q4(),a?.preloadingStrategy?Z4(a.preloadingStrategy).\u0275providers:[],a?.initialNavigation?t$(a):[],a?.bindToComponentInputs?X4().\u0275providers:[],a?.enableViewTransitions?Y4().\u0275providers:[],n$()]}}static forChild(t){return{ngModule:n,providers:[{provide:Ix,multi:!0,useValue:t}]}}static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})();function Q4(){return{provide:AO,useFactory:()=>{let n=Re(uP),r=Re(bn),t=Re(tv),a=Re(uT),h=Re(K_);return t.scrollOffset&&n.setOffset(t.scrollOffset),new $4(h,a,n,r,t)}}}function J4(){return{provide:sp,useClass:lP}}function e$(){return{provide:sp,useClass:uD}}function t$(n){return[n.initialNavigation==="disabled"?q4().\u0275providers:[],n.initialNavigation==="enabledBlocking"?W4().\u0275providers:[]]}var YP=new pt("");function n$(){return[{provide:YP,useFactory:G4},{provide:Y0,multi:!0,useExisting:YP}]}var Rx=class n{title="weather-app";static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Jn({type:n,selectors:[["app-root"]],standalone:!1,decls:1,vars:0,template:function(t,a){t&1&&rr(0,"router-outlet")},dependencies:[sT],encapsulation:2})};var Og={production:!1,api_key:"180aff8985c4d1be039fb47bf05ae0a3",location_api:"https://api.openweathermap.org/geo/1.0/",city_wise_search:"https://api.openweathermap.org/data/2.5/weather",forecast_api:"https://api.openweathermap.org/data/2.5/forecast",weather_api:"https://api.openweathermap.org/data/2.5/"};var Lg=class n{constructor(){}getDetailsViaCityName(r,t,a){return`${a?Og.forecast_api:Og.city_wise_search}?q=${r}&appid=${Og.api_key}&units=${t?"metric":"imperial"}`}getDetailsViaLatLong(r,t,a){return Og.weather_api+"weather?lat="+r+"&lon="+t+"&appid="+Og.api_key+`&units=${a?"metric":"imperial"}`}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})};var Fg=class n{constructor(r){this.http=r}get(r,t){return this.http.get(r,t)}static \u0275fac=function(t){return new(t||n)(kt(P_))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})};var Zc=TI(OO(),1);var s$=["content"],a$=["*"],l$=["container"];var LO=new pt("MapboxApiKey"),mT=(()=>{class n{constructor(t,a){this.zone=t,this.MAPBOX_API_KEY=a,this.mapCreated=new Lm,this.mapLoaded=new Lm,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new Pi,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(t){this.zone.onStable.pipe(Vl()).subscribe(()=>{t.customMapboxApiUrl&&(Zc.default.baseApiUrl=t.customMapboxApiUrl),this.createMap(vn(ht({},t.mapOptions),{accessToken:t.accessToken||this.MAPBOX_API_KEY||""})),this.hookEvents(t.mapEvents),this.mapEvents=t.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete(),t.mapEvents.mapCreate.observed&&this.zone.run(()=>{t.mapEvents.mapCreate.emit(this.mapInstance)})})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateProjection(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setProjection(t)})}updateMinZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(t)})}updateMaxZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(t)})}updateMinPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(t)})}updateMaxPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(t)})}updateRenderWorldCopies(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(t)})}updateScrollZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(t)})}updateMaxBounds(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(t)})}changeCanvasCursor(t){let a=this.mapInstance.getCanvasContainer();a.style.cursor=t}queryRenderedFeatures(t,a){return this.mapInstance.queryRenderedFeatures(t,a)}panTo(t,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(t,a)})}move(t,a,h,i,C,F){return this.zone.runOutsideAngular(()=>{this.mapInstance[t](vn(ht({},a),{zoom:h??this.mapInstance.getZoom(),center:i??this.mapInstance.getCenter(),bearing:C??this.mapInstance.getBearing(),pitch:F??this.mapInstance.getPitch()}))})}addLayer(t,a,h){this.zone.runOutsideAngular(()=>{Object.keys(t.layerOptions).forEach(i=>{let C=i;t.layerOptions[C]===void 0&&delete t.layerOptions[C]}),this.mapInstance.addLayer(t.layerOptions,h),a&&((t.layerEvents.layerClick.observed||t.layerEvents.click.observed)&&this.mapInstance.on("click",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerClick.emit(i),t.layerEvents.click.emit(i)})}),(t.layerEvents.layerDblClick.observed||t.layerEvents.dblClick.observed)&&this.mapInstance.on("dblclick",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerDblClick.emit(i),t.layerEvents.dblClick.emit(i)})}),(t.layerEvents.layerMouseDown.observed||t.layerEvents.mouseDown.observed)&&this.mapInstance.on("mousedown",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseDown.emit(i),t.layerEvents.mouseDown.emit(i)})}),(t.layerEvents.layerMouseUp.observed||t.layerEvents.mouseUp.observed)&&this.mapInstance.on("mouseup",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseUp.emit(i),t.layerEvents.mouseUp.emit(i)})}),(t.layerEvents.layerMouseEnter.observed||t.layerEvents.mouseEnter.observed)&&this.mapInstance.on("mouseenter",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseEnter.emit(i),t.layerEvents.mouseEnter.emit(i)})}),(t.layerEvents.layerMouseLeave.observed||t.layerEvents.mouseLeave.observed)&&this.mapInstance.on("mouseleave",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseLeave.emit(i),t.layerEvents.mouseLeave.emit(i)})}),(t.layerEvents.layerMouseMove.observed||t.layerEvents.mouseMove.observed)&&this.mapInstance.on("mousemove",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseMove.emit(i),t.layerEvents.mouseMove.emit(i)})}),(t.layerEvents.layerMouseOver.observed||t.layerEvents.mouseOver.observed)&&this.mapInstance.on("mouseover",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseOver.emit(i),t.layerEvents.mouseOver.emit(i)})}),(t.layerEvents.layerMouseOut.observed||t.layerEvents.mouseOut.observed)&&this.mapInstance.on("mouseout",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerMouseOut.emit(i),t.layerEvents.mouseOut.emit(i)})}),(t.layerEvents.layerContextMenu.observed||t.layerEvents.contextMenu.observed)&&this.mapInstance.on("contextmenu",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerContextMenu.emit(i),t.layerEvents.contextMenu.emit(i)})}),(t.layerEvents.layerTouchStart.observed||t.layerEvents.touchStart.observed)&&this.mapInstance.on("touchstart",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerTouchStart.emit(i),t.layerEvents.touchStart.emit(i)})}),(t.layerEvents.layerTouchEnd.observed||t.layerEvents.touchEnd.observed)&&this.mapInstance.on("touchend",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerTouchEnd.emit(i),t.layerEvents.touchEnd.emit(i)})}),(t.layerEvents.layerTouchCancel.observed||t.layerEvents.touchCancel.observed)&&this.mapInstance.on("touchcancel",t.layerOptions.id,i=>{this.zone.run(()=>{t.layerEvents.layerTouchCancel.emit(i),t.layerEvents.touchCancel.emit(i)})}))})}removeLayer(t){this.zone.runOutsideAngular(()=>{this.mapInstance.getLayer(t)!=null&&this.mapInstance.removeLayer(t)})}addMarker(t){let a={offset:t.markersOptions.offset,anchor:t.markersOptions.anchor,draggable:!!t.markersOptions.draggable,rotationAlignment:t.markersOptions.rotationAlignment,pitchAlignment:t.markersOptions.pitchAlignment,clickTolerance:t.markersOptions.clickTolerance};t.markersOptions.element.childNodes.length>0&&(a.element=t.markersOptions.element);let h=new Zc.default.Marker(a);(t.markersEvents.markerDragStart.observed||t.markersEvents.dragStart.observed)&&h.on("dragstart",C=>{if(C){let{target:F}=C;this.zone.run(()=>{t.markersEvents.markerDragStart.emit(F),t.markersEvents.dragStart.emit(F)})}}),(t.markersEvents.markerDrag.observed||t.markersEvents.drag.observed)&&h.on("drag",C=>{if(C){let{target:F}=C;this.zone.run(()=>{t.markersEvents.markerDrag.emit(F),t.markersEvents.drag.emit(F)})}}),(t.markersEvents.markerDragEnd.observed||t.markersEvents.dragEnd.observed)&&h.on("dragend",C=>{if(C){let{target:F}=C;this.zone.run(()=>{t.markersEvents.markerDragEnd.emit(F),t.markersEvents.dragEnd.emit(F)})}});let i=t.markersOptions.feature?t.markersOptions.feature.geometry.coordinates:t.markersOptions.lngLat;return h.setLngLat(i),this.zone.runOutsideAngular(()=>(h.addTo(this.mapInstance),h))}removeMarker(t){this.markersToRemove.push(t)}createPopup(t,a){return this.zone.runOutsideAngular(()=>{Object.keys(t.popupOptions).forEach(i=>t.popupOptions[i]===void 0&&delete t.popupOptions[i]);let h=new Zc.default.Popup(t.popupOptions);return h.setDOMContent(a),(t.popupEvents.popupClose.observed||t.popupEvents.close.observed)&&h.on("close",()=>{this.zone.run(()=>{t.popupEvents.popupClose.emit(),t.popupEvents.close.emit()})}),(t.popupEvents.popupOpen.observed||t.popupEvents.open.observed)&&h.on("open",()=>{this.zone.run(()=>{t.popupEvents.popupOpen.emit(),t.popupEvents.open.emit()})}),h})}addPopupToMap(t,a,h=!1){return this.zone.runOutsideAngular(()=>{h&&t._listeners&&delete t._listeners.open,t.setLngLat(a),t.addTo(this.mapInstance)})}addPopupToMarker(t,a){return this.zone.runOutsideAngular(()=>{t.setPopup(a)})}removePopupFromMap(t,a=!1){a&&t._listeners&&delete t._listeners.close,this.popupsToRemove.push(t)}removePopupFromMarker(t){return this.zone.runOutsideAngular(()=>{t.setPopup(void 0)})}addControl(t,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(t,a)})}removeControl(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(t)})}loadAndAddImage(t,a,h){return Mm(this,null,function*(){return this.zone.runOutsideAngular(()=>new Promise((i,C)=>{this.mapInstance.loadImage(a,(F,V)=>{if(F){C(F);return}this.addImage(t,V,h),i()})}))})}addImage(t,a,h){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(t,a,h)})}removeImage(t){this.imageIdsToRemove.push(t)}addSource(t,a){return this.zone.runOutsideAngular(()=>{Object.keys(a).forEach(h=>a[h]===void 0&&delete a[h]),this.mapInstance.addSource(t,a)})}getSource(t){return this.mapInstance.getSource(t)}removeSource(t){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(t).forEach(a=>this.mapInstance.removeLayer(a.id)),this.mapInstance.removeSource(t)})}setAllLayerPaintProperty(t,a){return this.zone.runOutsideAngular(()=>{Object.keys(a).forEach(h=>{this.mapInstance.setPaintProperty(t,h,a[h])})})}setAllLayerLayoutProperty(t,a){return this.zone.runOutsideAngular(()=>{Object.keys(a).forEach(h=>{this.mapInstance.setLayoutProperty(t,h,a[h])})})}setLayerFilter(t,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(t,a)})}setLayerBefore(t,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(t,a)})}setLayerZoomRange(t,a,h){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(t,a||0,h||20)})}fitBounds(t,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(t,a)})}fitScreenCoordinates(t,a,h){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(t[0],t[1],a,h)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(t){bn.assertNotInAngularZone(),Object.keys(t).forEach(h=>{let i=h;t[i]===void 0&&delete t[i]}),this.mapInstance=new Zc.default.Map(t),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(t.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(let t of this.markersToRemove)t.remove();this.markersToRemove=[]}removePopups(){for(let t of this.popupsToRemove)t.remove();this.popupsToRemove=[]}removeImages(){for(let t of this.imageIdsToRemove)this.mapInstance.removeImage(t);this.imageIdsToRemove=[]}findLayersBySourceId(t){let a=this.mapInstance.getStyle().layers;return a==null?[]:a.filter(h=>"source"in h?h.source===t:!1)}hookEvents(t){this.mapInstance.on("load",a=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{t.mapLoad.emit(a),t.load.emit(a.target)})}),(t.mapResize.observed||t.resize.observed)&&this.mapInstance.on("resize",a=>this.zone.run(()=>{t.mapResize.emit(a),t.resize.emit(a)})),(t.mapRemove.observed||t.remove.observed)&&this.mapInstance.on("remove",a=>this.zone.run(()=>{t.mapRemove.emit(a),t.remove.emit(a)})),(t.mapMouseDown.observed||t.mouseDown.observed)&&this.mapInstance.on("mousedown",a=>this.zone.run(()=>{t.mapMouseDown.emit(a),t.mouseDown.emit(a)})),(t.mapMouseUp.observed||t.mouseUp.observed)&&this.mapInstance.on("mouseup",a=>this.zone.run(()=>{t.mapMouseUp.emit(a),t.mouseUp.emit(a)})),(t.mapMouseMove.observed||t.mouseMove.observed)&&this.mapInstance.on("mousemove",a=>this.zone.run(()=>{t.mapMouseMove.emit(a),t.mouseMove.emit(a)})),(t.mapClick.observed||t.click.observed)&&this.mapInstance.on("click",a=>this.zone.run(()=>{t.mapClick.emit(a),t.click.emit(a)})),(t.mapDblClick.observed||t.dblClick.observed)&&this.mapInstance.on("dblclick",a=>this.zone.run(()=>{t.mapDblClick.emit(a),t.dblClick.emit(a)})),(t.mapMouseOver.observed||t.mouseOver.observed)&&this.mapInstance.on("mouseover",a=>this.zone.run(()=>{t.mapMouseOver.emit(a),t.mouseOver.emit(a)})),(t.mapMouseOut.observed||t.mouseOut.observed)&&this.mapInstance.on("mouseout",a=>this.zone.run(()=>{t.mapMouseOut.emit(a),t.mouseOut.emit(a)})),(t.mapContextMenu.observed||t.contextMenu.observed)&&this.mapInstance.on("contextmenu",a=>this.zone.run(()=>{t.mapContextMenu.emit(a),t.contextMenu.emit(a)})),(t.mapTouchStart.observed||t.touchStart.observed)&&this.mapInstance.on("touchstart",a=>this.zone.run(()=>{t.mapTouchStart.emit(a),t.touchStart.emit(a)})),(t.mapTouchEnd.observed||t.touchEnd.observed)&&this.mapInstance.on("touchend",a=>this.zone.run(()=>{t.mapTouchEnd.emit(a),t.touchEnd.emit(a)})),(t.mapTouchMove.observed||t.touchMove.observed)&&this.mapInstance.on("touchmove",a=>this.zone.run(()=>{t.mapTouchMove.emit(a),t.touchMove.emit(a)})),(t.mapTouchCancel.observed||t.touchCancel.observed)&&this.mapInstance.on("touchcancel",a=>this.zone.run(()=>{t.mapTouchCancel.emit(a),t.touchCancel.emit(a)})),(t.mapWheel.observed||t.wheel.observed)&&this.mapInstance.on("wheel",a=>this.zone.run(()=>{t.mapWheel.emit(a),t.wheel.emit(a)})),t.moveStart.observed&&this.mapInstance.on("movestart",a=>this.zone.run(()=>t.moveStart.emit(a))),t.move.observed&&this.mapInstance.on("move",a=>this.zone.run(()=>t.move.emit(a))),t.moveEnd.observed&&this.mapInstance.on("moveend",a=>this.zone.run(()=>t.moveEnd.emit(a))),(t.mapDragStart.observed||t.dragStart.observed)&&this.mapInstance.on("dragstart",a=>this.zone.run(()=>{t.mapDragStart.emit(a),t.dragStart.emit(a)})),(t.mapDrag.observed||t.drag.observed)&&this.mapInstance.on("drag",a=>this.zone.run(()=>{t.mapDrag.emit(a),t.drag.emit(a)})),(t.mapDragEnd.observed||t.dragEnd.observed)&&this.mapInstance.on("dragend",a=>this.zone.run(()=>{t.mapDragEnd.emit(a),t.dragEnd.emit(a)})),t.zoomStart.observed&&this.mapInstance.on("zoomstart",a=>this.zone.run(()=>t.zoomStart.emit(a))),t.zoomEvt.observed&&this.mapInstance.on("zoom",a=>this.zone.run(()=>t.zoomEvt.emit(a))),t.zoomEnd.observed&&this.mapInstance.on("zoomend",a=>this.zone.run(()=>t.zoomEnd.emit(a))),t.rotateStart.observed&&this.mapInstance.on("rotatestart",a=>this.zone.run(()=>t.rotateStart.emit(a))),t.rotate.observed&&this.mapInstance.on("rotate",a=>this.zone.run(()=>t.rotate.emit(a))),t.rotateEnd.observed&&this.mapInstance.on("rotateend",a=>this.zone.run(()=>t.rotateEnd.emit(a))),t.pitchStart.observed&&this.mapInstance.on("pitchstart",a=>this.zone.run(()=>t.pitchStart.emit(a))),t.pitchEvt.observed&&this.mapInstance.on("pitch",a=>this.zone.run(()=>t.pitchEvt.emit(a))),t.pitchEnd.observed&&this.mapInstance.on("pitchend",a=>this.zone.run(()=>t.pitchEnd.emit(a))),t.boxZoomStart.observed&&this.mapInstance.on("boxzoomstart",a=>this.zone.run(()=>t.boxZoomStart.emit(a))),t.boxZoomEnd.observed&&this.mapInstance.on("boxzoomend",a=>this.zone.run(()=>t.boxZoomEnd.emit(a))),t.boxZoomCancel.observed&&this.mapInstance.on("boxzoomcancel",a=>this.zone.run(()=>t.boxZoomCancel.emit(a))),t.webGlContextLost.observed&&this.mapInstance.on("webglcontextlost",a=>this.zone.run(()=>t.webGlContextLost.emit(a))),t.webGlContextRestored.observed&&this.mapInstance.on("webglcontextrestored",a=>this.zone.run(()=>t.webGlContextRestored.emit(a))),t.render.observed&&this.mapInstance.on("render",a=>this.zone.run(()=>t.render.emit(a))),(t.mapError.observed||t.error.observed)&&this.mapInstance.on("error",a=>this.zone.run(()=>{t.mapError.emit(a),t.error.emit(a)})),t.data.observed&&this.mapInstance.on("data",a=>this.zone.run(()=>t.data.emit(a))),t.styleData.observed&&this.mapInstance.on("styledata",a=>this.zone.run(()=>t.styleData.emit(a))),t.sourceData.observed&&this.mapInstance.on("sourcedata",a=>this.zone.run(()=>t.sourceData.emit(a))),t.dataLoading.observed&&this.mapInstance.on("dataloading",a=>this.zone.run(()=>t.dataLoading.emit(a))),t.styleDataLoading.observed&&this.mapInstance.on("styledataloading",a=>this.zone.run(()=>t.styleDataLoading.emit(a))),t.sourceDataLoading.observed&&this.mapInstance.on("sourcedataloading",a=>this.zone.run(()=>t.sourceDataLoading.emit(a))),t.styleImageMissing.observed&&this.mapInstance.on("styleimagemissing",a=>this.zone.run(()=>t.styleImageMissing.emit(a))),t.idle.observed&&this.mapInstance.on("idle",a=>this.zone.run(()=>t.idle.emit(a)))}assign(t,a,h){if(typeof a=="string"&&(a=a.split(".")),a.length>1){let i=a.shift();this.assign(t[i]=Object.prototype.toString.call(t[i])==="[object Object]"?t[i]:{},a,h)}else t[a[0]]=h}static{this.\u0275fac=function(a){return new(a||n)(kt(bn),kt(LO,8))}}static{this.\u0275prov=Ct({token:n,factory:n.\u0275fac})}}return n})();var FO=(n,r,t)=>{console.warn(`[ngx-mapbox-gl]: ${n}: ${r} is deprecated, please use ${t} instead.`)};var NO=(()=>{class n{get mapInstance(){return this.mapService.mapInstance}constructor(t){this.mapService=t,this.movingMethod="flyTo",this.mapResize=new Tt,this.mapRemove=new Tt,this.mapMouseDown=new Tt,this.mapMouseUp=new Tt,this.mapMouseMove=new Tt,this.mapClick=new Tt,this.mapDblClick=new Tt,this.mapMouseOver=new Tt,this.mapMouseOut=new Tt,this.mapContextMenu=new Tt,this.mapTouchStart=new Tt,this.mapTouchEnd=new Tt,this.mapTouchMove=new Tt,this.mapTouchCancel=new Tt,this.mapWheel=new Tt,this.moveStart=new Tt,this.move=new Tt,this.moveEnd=new Tt,this.mapDragStart=new Tt,this.mapDrag=new Tt,this.mapDragEnd=new Tt,this.zoomStart=new Tt,this.zoomEvt=new Tt,this.zoomEnd=new Tt,this.rotateStart=new Tt,this.rotate=new Tt,this.rotateEnd=new Tt,this.pitchStart=new Tt,this.pitchEvt=new Tt,this.pitchEnd=new Tt,this.boxZoomStart=new Tt,this.boxZoomEnd=new Tt,this.boxZoomCancel=new Tt,this.webGlContextLost=new Tt,this.webGlContextRestored=new Tt,this.mapLoad=new Tt,this.mapCreate=new Tt,this.idle=new Tt,this.render=new Tt,this.mapError=new Tt,this.data=new Tt,this.styleData=new Tt,this.sourceData=new Tt,this.dataLoading=new Tt,this.styleDataLoading=new Tt,this.sourceDataLoading=new Tt,this.styleImageMissing=new Tt,this.resize=new Tt,this.remove=new Tt,this.mouseDown=new Tt,this.mouseUp=new Tt,this.mouseMove=new Tt,this.click=new Tt,this.dblClick=new Tt,this.mouseOver=new Tt,this.mouseOut=new Tt,this.contextMenu=new Tt,this.touchStart=new Tt,this.touchEnd=new Tt,this.touchMove=new Tt,this.touchCancel=new Tt,this.wheel=new Tt,this.dragStart=new Tt,this.drag=new Tt,this.dragEnd=new Tt,this.load=new Tt,this.error=new Tt}ngAfterViewInit(){this.warnDeprecatedOutputs(),this.mapService.setup({accessToken:this.accessToken,customMapboxApiUrl:this.customMapboxApiUrl,mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale,cooperativeGestures:this.cooperativeGestures,projection:this.projection},mapEvents:this}),this.cursorStyle&&this.mapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.mapService.destroyMap()}ngOnChanges(t){return Mm(this,null,function*(){yield $1(this.mapService.mapCreated$),t.cursorStyle&&!t.cursorStyle.isFirstChange()&&this.mapService.changeCanvasCursor(t.cursorStyle.currentValue),t.projection&&!t.projection.isFirstChange()&&this.mapService.updateProjection(t.projection.currentValue),t.minZoom&&!t.minZoom.isFirstChange()&&this.mapService.updateMinZoom(t.minZoom.currentValue),t.maxZoom&&!t.maxZoom.isFirstChange()&&this.mapService.updateMaxZoom(t.maxZoom.currentValue),t.minPitch&&!t.minPitch.isFirstChange()&&this.mapService.updateMinPitch(t.minPitch.currentValue),t.maxPitch&&!t.maxPitch.isFirstChange()&&this.mapService.updateMaxPitch(t.maxPitch.currentValue),t.renderWorldCopies&&!t.renderWorldCopies.isFirstChange()&&this.mapService.updateRenderWorldCopies(t.renderWorldCopies.currentValue),t.scrollZoom&&!t.scrollZoom.isFirstChange()&&this.mapService.updateScrollZoom(t.scrollZoom.currentValue),t.dragRotate&&!t.dragRotate.isFirstChange()&&this.mapService.updateDragRotate(t.dragRotate.currentValue),t.touchPitch&&!t.touchPitch.isFirstChange()&&this.mapService.updateTouchPitch(t.touchPitch.currentValue),t.touchZoomRotate&&!t.touchZoomRotate.isFirstChange()&&this.mapService.updateTouchZoomRotate(t.touchZoomRotate.currentValue),t.doubleClickZoom&&!t.doubleClickZoom.isFirstChange()&&this.mapService.updateDoubleClickZoom(t.doubleClickZoom.currentValue),t.keyboard&&!t.keyboard.isFirstChange()&&this.mapService.updateKeyboard(t.keyboard.currentValue),t.dragPan&&!t.dragPan.isFirstChange()&&this.mapService.updateDragPan(t.dragPan.currentValue),t.boxZoom&&!t.boxZoom.isFirstChange()&&this.mapService.updateBoxZoom(t.boxZoom.currentValue),t.style&&!t.style.isFirstChange()&&this.mapService.updateStyle(t.style.currentValue),t.maxBounds&&!t.maxBounds.isFirstChange()&&this.mapService.updateMaxBounds(t.maxBounds.currentValue),t.fitBounds&&t.fitBounds.currentValue&&!t.fitBounds.isFirstChange()&&this.mapService.fitBounds(t.fitBounds.currentValue,this.fitBoundsOptions),t.fitScreenCoordinates&&t.fitScreenCoordinates.currentValue&&((this.center||this.zoom||this.pitch||this.fitBounds)&&t.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),this.mapService.fitScreenCoordinates(t.fitScreenCoordinates.currentValue,this.bearing?this.bearing[0]:0,this.movingOptions)),this.centerWithPanTo&&t.center&&!t.center.isFirstChange()&&!t.zoom&&!t.bearing&&!t.pitch?this.mapService.panTo(this.center,this.panToOptions):(t.center&&!t.center.isFirstChange()||t.zoom&&!t.zoom.isFirstChange()||t.bearing&&!t.bearing.isFirstChange()&&!t.fitScreenCoordinates||t.pitch&&!t.pitch.isFirstChange())&&this.mapService.move(this.movingMethod,this.movingOptions,t.zoom&&this.zoom?this.zoom[0]:void 0,t.center?this.center:void 0,t.bearing&&this.bearing?this.bearing[0]:void 0,t.pitch&&this.pitch?this.pitch[0]:void 0)})}warnDeprecatedOutputs(){let t=FO.bind(void 0,n.name);this.resize.observed&&t("resize","mapResize"),this.remove.observed&&t("remove","mapRemove"),this.mouseDown.observed&&t("mouseDown","mapMouseDown"),this.mouseUp.observed&&t("mouseUp","mapMouseUp"),this.mouseMove.observed&&t("mouseMove","mapMouseMove"),this.click.observed&&t("click","mapClick"),this.dblClick.observed&&t("dblClick","mapDblClick"),this.mouseOver.observed&&t("mouseOver","mapMouseOver"),this.mouseOut.observed&&t("mouseOut","mapMouseOut"),this.contextMenu.observed&&t("contextMenu","mapContextMenu"),this.touchStart.observed&&t("touchStart","mapTouchStart"),this.touchEnd.observed&&t("touchEnd","mapTouchEnd"),this.touchMove.observed&&t("touchMove","mapTouchMove"),this.touchCancel.observed&&t("touchCancel","mapTouchCancel"),this.wheel.observed&&t("wheel","mapWheel"),this.dragStart.observed&&t("dragStart","mapDragStart"),this.drag.observed&&t("drag","mapDrag"),this.dragEnd.observed&&t("dragEnd","mapDragEnd"),this.load.observed&&t("load","mapLoad"),this.error.observed&&t("error","mapError")}static{this.\u0275fac=function(a){return new(a||n)(yr(mT))}}static{this.\u0275cmp=Jn({type:n,selectors:[["mgl-map"]],viewQuery:function(a,h){if(a&1&&Wc(l$,7),a&2){let i;Gl(i=Wl())&&(h.mapContainer=i.first)}},inputs:{accessToken:"accessToken",collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",cooperativeGestures:"cooperativeGestures",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",projection:"projection",movingMethod:"movingMethod",movingOptions:"movingOptions",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",mapCreate:"mapCreate",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing",resize:"resize",remove:"remove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseMove:"mouseMove",click:"click",dblClick:"dblClick",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchMove:"touchMove",touchCancel:"touchCancel",wheel:"wheel",dragStart:"dragStart",drag:"drag",dragEnd:"dragEnd",load:"load",error:"error"},standalone:!1,features:[pa([mT]),cs],decls:2,vars:0,consts:[["container",""]],template:function(a,h){a&1&&rr(0,"div",null,0)},styles:["[_nghost-%COMP%]{display:block}div[_ngcontent-%COMP%]{height:100%;width:100%}"],changeDetection:0})}}return n})(),zO=(()=>{class n{constructor(t){this.mapService=t,this.markerDragStart=new Tt,this.markerDragEnd=new Tt,this.markerDrag=new Tt,this.dragStart=new Tt,this.dragEnd=new Tt,this.drag=new Tt}ngOnInit(){if(this.warnDeprecatedOutputs(),this.feature&&this.lngLat)throw new Error("feature and lngLat input are mutually exclusive")}ngOnChanges(t){t.lngLat&&!t.lngLat.isFirstChange()&&this.markerInstance.setLngLat(this.lngLat),t.feature&&!t.feature.isFirstChange()&&this.markerInstance.setLngLat(this.feature.geometry.coordinates),t.draggable&&!t.draggable.isFirstChange()&&this.markerInstance.setDraggable(!!this.draggable),t.popupShown&&!t.popupShown.isFirstChange()&&(t.popupShown.currentValue?this.markerInstance.getPopup().addTo(this.mapService.mapInstance):this.markerInstance.getPopup().remove()),t.pitchAlignment&&!t.pitchAlignment.isFirstChange()&&this.markerInstance.setPitchAlignment(t.pitchAlignment.currentValue),t.rotationAlignment&&!t.rotationAlignment.isFirstChange()&&this.markerInstance.setRotationAlignment(t.rotationAlignment.currentValue)}ngAfterViewInit(){this.mapService.mapCreated$.subscribe(()=>{this.markerInstance=this.mapService.addMarker({markersOptions:{offset:this.offset,anchor:this.anchor,pitchAlignment:this.pitchAlignment,rotationAlignment:this.rotationAlignment,draggable:!!this.draggable,element:this.content.nativeElement,feature:this.feature,lngLat:this.lngLat,clickTolerance:this.clickTolerance},markersEvents:{markerDragStart:this.markerDragStart,markerDrag:this.markerDrag,markerDragEnd:this.markerDragEnd,dragStart:this.markerDragStart,drag:this.markerDrag,dragEnd:this.markerDragEnd}})})}ngOnDestroy(){this.mapService.removeMarker(this.markerInstance),this.markerInstance=void 0}togglePopup(){this.markerInstance.togglePopup()}updateCoordinates(t){this.markerInstance.setLngLat(t)}warnDeprecatedOutputs(){let t=FO.bind(void 0,n.name);this.markerDragStart.observed&&t("dragStart","markerDragStart"),this.markerDragEnd.observed&&t("dragEnd","markerDragEnd"),this.markerDrag.observed&&t("drag","markerDrag")}static{this.\u0275fac=function(a){return new(a||n)(yr(mT))}}static{this.\u0275cmp=Jn({type:n,selectors:[["mgl-marker"]],viewQuery:function(a,h){if(a&1&&Wc(s$,7),a&2){let i;Gl(i=Wl())&&(h.content=i.first)}},inputs:{offset:"offset",anchor:"anchor",clickTolerance:"clickTolerance",feature:"feature",lngLat:"lngLat",draggable:"draggable",popupShown:"popupShown",className:"className",pitchAlignment:"pitchAlignment",rotationAlignment:"rotationAlignment"},outputs:{markerDragStart:"markerDragStart",markerDragEnd:"markerDragEnd",markerDrag:"markerDrag",dragStart:"dragStart",dragEnd:"dragEnd",drag:"drag"},standalone:!1,features:[cs],ngContentSelectors:a$,decls:3,vars:2,consts:[["content",""]],template:function(a,h){a&1&&(ha(),Fn(0,"div",null,0),fa(2),Wn()),a&2&&ip(h.className)},encapsulation:2,changeDetection:0})}}return n})();var BO=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:LO,useValue:t.accessToken}]}}static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=tn({type:n})}static{this.\u0275inj=en({imports:[vg]})}}return n})();function gT(n,r){let t=!r?.manualCleanup;t&&!r?.injector&&ng(gT);let a=t?r?.injector?.get($c)??Re($c):null,h=u$(r?.equal),i;r?.requireSync?i=us({kind:0},{equal:h}):i=us({kind:1,value:r?.initialValue},{equal:h});let C=n.subscribe({next:F=>i.set({kind:1,value:F}),error:F=>{if(r?.rejectErrors)throw F;i.set({kind:2,error:F})}});if(r?.requireSync&&i().kind===0)throw new Wt(601,!1);return a?.onDestroy(C.unsubscribe.bind(C)),yg(()=>{let F=i();switch(F.kind){case 1:return F.value;case 2:throw F.error;case 0:throw new Wt(601,!1)}},{equal:r?.equal})}function u$(n=Object.is){return(r,t)=>r.kind===1&&t.kind===1&&n(r.value,t.value)}var bT={};function CT(n,r){if(bT[n]=(bT[n]||0)+1,typeof r=="function")return yT(n,(...a)=>vn(ht({},r(...a)),{type:n}));switch(r?r._as:"empty"){case"empty":return yT(n,()=>({type:n}));case"props":return yT(n,a=>vn(ht({},a),{type:n}));default:throw new Error("Unexpected config.")}}function DT(){return{_as:"props",_p:void 0}}function yT(n,r){return Object.defineProperty(r,"type",{value:n,writable:!1})}function d$(n,r){if(n==null)throw new Error(`${r} must be defined.`)}var t2="@ngrx/store/init",Ng=(()=>{class n extends Dr{constructor(){super({type:t2})}next(t){if(typeof t=="function")throw new TypeError(`
        Dispatch expected an object, instead it received a function.
        If you're using the createAction function, make sure to invoke the function
        before dispatching the action. For example, someAction should be someAction().`);if(typeof t>"u")throw new TypeError("Actions must be objects");if(typeof t.type>"u")throw new TypeError("Actions must have a type property");super.next(t)}complete(){}ngOnDestroy(){super.complete()}static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275prov=Ct({token:n,factory:n.\u0275fac})}}return n})(),h$=[Ng],n2=new pt("@ngrx/store Internal Root Guard"),VO=new pt("@ngrx/store Internal Initial State"),TT=new pt("@ngrx/store Initial State"),i2=new pt("@ngrx/store Reducer Factory"),jO=new pt("@ngrx/store Internal Reducer Factory Provider"),r2=new pt("@ngrx/store Initial Reducers"),_T=new pt("@ngrx/store Internal Initial Reducers"),UO=new pt("@ngrx/store Store Features"),$O=new pt("@ngrx/store Internal Store Reducers"),vT=new pt("@ngrx/store Internal Feature Reducers"),HO=new pt("@ngrx/store Internal Feature Configs"),o2=new pt("@ngrx/store Internal Store Features"),GO=new pt("@ngrx/store Internal Feature Reducers Token"),s2=new pt("@ngrx/store Feature Reducers"),WO=new pt("@ngrx/store User Provided Meta Reducers"),Ox=new pt("@ngrx/store Meta Reducers"),qO=new pt("@ngrx/store Internal Resolved Meta Reducers"),ZO=new pt("@ngrx/store User Runtime Checks Config"),XO=new pt("@ngrx/store Internal User Runtime Checks Config"),iv=new pt("@ngrx/store Internal Runtime Checks"),MT=new pt("@ngrx/store Check if Action types are unique"),hQ=new pt("@ngrx/store Root Store Provider"),fQ=new pt("@ngrx/store Feature State Provider");function IT(n,r={}){let t=Object.keys(n),a={};for(let i=0;i<t.length;i++){let C=t[i];typeof n[C]=="function"&&(a[C]=n[C])}let h=Object.keys(a);return function(C,F){C=C===void 0?r:C;let V=!1,K={};for(let oe=0;oe<h.length;oe++){let Ee=h[oe],Ye=a[Ee],Ne=C[Ee],ct=Ye(Ne,F);K[Ee]=ct,V=V||ct!==Ne}return V?K:C}}function f$(n,r){return Object.keys(n).filter(t=>t!==r).reduce((t,a)=>Object.assign(t,{[a]:n[a]}),{})}function a2(...n){return function(r){if(n.length===0)return r;let t=n[n.length-1];return n.slice(0,-1).reduceRight((h,i)=>i(h),t(r))}}function l2(n,r){return Array.isArray(r)&&r.length>0&&(n=a2.apply(null,[...r,n])),(t,a)=>{let h=n(t);return(i,C)=>(i=i===void 0?a:i,h(i,C))}}function p$(n){let r=Array.isArray(n)&&n.length>0?a2(...n):t=>t;return(t,a)=>(t=r(t),(h,i)=>(h=h===void 0?a:h,t(h,i)))}var rv=class extends Vn{},Lx=class extends Ng{},m$="@ngrx/store/update-reducers",Fx=(()=>{class n extends Dr{get currentReducers(){return this.reducers}constructor(t,a,h,i){super(i(h,a)),this.dispatcher=t,this.initialState=a,this.reducers=h,this.reducerFactory=i}addFeature(t){this.addFeatures([t])}addFeatures(t){let a=t.reduce((h,{reducers:i,reducerFactory:C,metaReducers:F,initialState:V,key:K})=>{let oe=typeof i=="function"?p$(F)(i,V):l2(C,F)(i,V);return h[K]=oe,h},{});this.addReducers(a)}removeFeature(t){this.removeFeatures([t])}removeFeatures(t){this.removeReducers(t.map(a=>a.key))}addReducer(t,a){this.addReducers({[t]:a})}addReducers(t){this.reducers=ht(ht({},this.reducers),t),this.updateReducers(Object.keys(t))}removeReducer(t){this.removeReducers([t])}removeReducers(t){t.forEach(a=>{this.reducers=f$(this.reducers,a)}),this.updateReducers(t)}updateReducers(t){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:m$,features:t})}ngOnDestroy(){this.complete()}static{this.\u0275fac=function(a){return new(a||n)(kt(Lx),kt(TT),kt(r2),kt(i2))}}static{this.\u0275prov=Ct({token:n,factory:n.\u0275fac})}}return n})(),g$=[Fx,{provide:rv,useExisting:Fx},{provide:Lx,useExisting:Ng}],ST=(()=>{class n extends jn{ngOnDestroy(){this.complete()}static{this.\u0275fac=(()=>{let t;return function(h){return(t||(t=ja(n)))(h||n)}})()}static{this.\u0275prov=Ct({token:n,factory:n.\u0275fac})}}return n})(),y$=[ST],Nx=class extends Vn{},YO=(()=>{class n extends Dr{static{this.INIT=t2}constructor(t,a,h,i){super(i);let F=t.pipe(Vf(j1)).pipe(X1(a)),V={state:i},K=F.pipe(t_(_$,V));this.stateSubscription=K.subscribe(({state:oe,action:Ee})=>{this.next(oe),h.next(Ee)}),this.state=gT(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}static{this.\u0275fac=function(a){return new(a||n)(kt(Ng),kt(rv),kt(ST),kt(TT))}}static{this.\u0275prov=Ct({token:n,factory:n.\u0275fac})}}return n})();function _$(n={state:void 0},[r,t]){let{state:a}=n;return{state:t(a,r),action:r}}var v$=[YO,{provide:Nx,useExisting:YO}],ld=(()=>{class n extends Vn{constructor(t,a,h,i){super(),this.actionsObserver=a,this.reducerManager=h,this.injector=i,this.source=t,this.state=t.state}select(t,...a){return Dh.call(null,t,...a)(this)}selectSignal(t,a){return yg(()=>t(this.state()),a)}lift(t){let a=new n(this,this.actionsObserver,this.reducerManager);return a.operator=t,a}dispatch(t,a){if(typeof t=="function")return this.processDispatchFn(t,a);this.actionsObserver.next(t)}next(t){this.actionsObserver.next(t)}error(t){this.actionsObserver.error(t)}complete(){this.actionsObserver.complete()}addReducer(t,a){this.reducerManager.addReducer(t,a)}removeReducer(t){this.reducerManager.removeReducer(t)}processDispatchFn(t,a){d$(this.injector,"Store Injector");let h=a?.injector??x$()??this.injector;return S_(()=>{let i=t();rp(()=>this.dispatch(i))},{injector:h})}static{this.\u0275fac=function(a){return new(a||n)(kt(Nx),kt(Ng),kt(Fx),kt(ci))}}static{this.\u0275prov=Ct({token:n,factory:n.\u0275fac})}}return n})(),b$=[ld];function Dh(n,r,...t){return function(h){let i;if(typeof n=="string"){let C=[r,...t].filter(Boolean);i=h.pipe(W1(n,...C))}else if(typeof n=="function")i=h.pipe(ln(C=>n(C,r)));else throw new TypeError(`Unexpected type '${typeof n}' in select operator, expected 'string' or 'function'`);return i.pipe(Vm())}}function x$(){try{return Re(ci)}catch{return}}var AT="https://ngrx.io/guide/store/configuration/runtime-checks";function KO(n){return n===void 0}function QO(n){return n===null}function c2(n){return Array.isArray(n)}function w$(n){return typeof n=="string"}function E$(n){return typeof n=="boolean"}function C$(n){return typeof n=="number"}function u2(n){return typeof n=="object"&&n!==null}function D$(n){return u2(n)&&!c2(n)}function T$(n){if(!D$(n))return!1;let r=Object.getPrototypeOf(n);return r===Object.prototype||r===null}function xT(n){return typeof n=="function"}function M$(n){return xT(n)&&n.hasOwnProperty("\u0275cmp")}function I$(n,r){return Object.prototype.hasOwnProperty.call(n,r)}var S$=!1;function A$(){return S$}function JO(n,r){return n===r}function k$(n,r,t){for(let a=0;a<n.length;a++)if(!t(n[a],r[a]))return!0;return!1}function d2(n,r=JO,t=JO){let a=null,h=null,i;function C(){a=null,h=null}function F(oe=void 0){i={result:oe}}function V(){i=void 0}function K(){if(i!==void 0)return i.result;if(!a)return h=n.apply(null,arguments),a=arguments,h;if(!k$(arguments,a,r))return h;let oe=n.apply(null,arguments);return a=arguments,t(h,oe)?h:(h=oe,oe)}return{memoized:K,reset:C,setResult:F,clearResult:V}}function zg(...n){return P$(d2)(...n)}function R$(n,r,t,a){if(t===void 0){let i=r.map(C=>C(n));return a.memoized.apply(null,i)}let h=r.map(i=>i(n,t));return a.memoized.apply(null,[...h,t])}function P$(n,r={stateFn:R$}){return function(...t){let a=t;if(Array.isArray(a[0])){let[oe,...Ee]=a;a=[...oe,...Ee]}else a.length===1&&O$(a[0])&&(a=L$(a[0]));let h=a.slice(0,a.length-1),i=a[a.length-1],C=h.filter(oe=>oe.release&&typeof oe.release=="function"),F=n(function(...oe){return i.apply(null,oe)}),V=d2(function(oe,Ee){return r.stateFn.apply(null,[oe,h,Ee,F])});function K(){V.reset(),F.reset(),C.forEach(oe=>oe.release())}return Object.assign(V.memoized,{release:K,projector:F.memoized,setResult:V.setResult,clearResult:V.clearResult})}}function h2(n){return zg(r=>{let t=r[n];return!A$()&&iD()&&!(n in r)&&console.warn(`@ngrx/store: The feature name "${n}" does not exist in the state, therefore createFeatureSelector cannot access it.  Be sure it is imported in a loaded module using StoreModule.forRoot('${n}', ...) or StoreModule.forFeature('${n}', ...).  If the default state is intended to be undefined, as is the case with router state, this development-only warning message can be ignored.`),t},r=>r)}function O$(n){return!!n&&typeof n=="object"&&Object.values(n).every(r=>typeof r=="function")}function L$(n){let r=Object.values(n),t=Object.keys(n),a=(...h)=>t.reduce((i,C,F)=>vn(ht({},i),{[C]:h[F]}),{});return[...r,a]}function F$(n){return n instanceof pt?Re(n):n}function N$(n,r){return r.map((t,a)=>{if(n[a]instanceof pt){let h=Re(n[a]);return{key:t.key,reducerFactory:h.reducerFactory?h.reducerFactory:IT,metaReducers:h.metaReducers?h.metaReducers:[],initialState:h.initialState}}return t})}function z$(n){return n.map(r=>r instanceof pt?Re(r):r)}function f2(n){return typeof n=="function"?n():n}function B$(n,r){return n.concat(r)}function V$(){if(Re(ld,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function j$(n,r){return function(t,a){let h=r.action(a)?wT(a):a,i=n(t,h);return r.state()?wT(i):i}}function wT(n){Object.freeze(n);let r=xT(n);return Object.getOwnPropertyNames(n).forEach(t=>{if(!t.startsWith("\u0275")&&I$(n,t)&&(!r||t!=="caller"&&t!=="callee"&&t!=="arguments")){let a=n[t];(u2(a)||xT(a))&&!Object.isFrozen(a)&&wT(a)}}),n}function U$(n,r){return function(t,a){if(r.action(a)){let i=ET(a);e2(i,"action")}let h=n(t,a);if(r.state()){let i=ET(h);e2(i,"state")}return h}}function ET(n,r=[]){return(KO(n)||QO(n))&&r.length===0?{path:["root"],value:n}:Object.keys(n).reduce((a,h)=>{if(a)return a;let i=n[h];return M$(i)?a:KO(i)||QO(i)||C$(i)||E$(i)||w$(i)||c2(i)?!1:T$(i)?ET(i,[...r,h]):{path:[...r,h],value:i}},!1)}function e2(n,r){if(n===!1)return;let t=n.path.join("."),a=new Error(`Detected unserializable ${r} at "${t}". ${AT}#strict${r}serializability`);throw a.value=n.value,a.unserializablePath=t,a}function $$(n,r){return function(t,a){if(r.action(a)&&!bn.isInAngularZone())throw new Error(`Action '${a.type}' running outside NgZone. ${AT}#strictactionwithinngzone`);return n(t,a)}}function H$(n){return iD()?ht({strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1},n):{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function G$({strictActionSerializability:n,strictStateSerializability:r}){return t=>n||r?U$(t,{action:a=>n&&!kT(a),state:()=>r}):t}function W$({strictActionImmutability:n,strictStateImmutability:r}){return t=>n||r?j$(t,{action:a=>n&&!kT(a),state:()=>r}):t}function kT(n){return n.type.startsWith("@ngrx")}function q$({strictActionWithinNgZone:n}){return r=>n?$$(r,{action:t=>n&&!kT(t)}):r}function Z$(n){return[{provide:XO,useValue:n},{provide:ZO,useFactory:X$,deps:[XO]},{provide:iv,deps:[ZO],useFactory:H$},{provide:Ox,multi:!0,deps:[iv],useFactory:W$},{provide:Ox,multi:!0,deps:[iv],useFactory:G$},{provide:Ox,multi:!0,deps:[iv],useFactory:q$}]}function p2(){return[{provide:MT,multi:!0,deps:[iv],useFactory:Y$}]}function X$(n){return n}function Y$(n){if(!n.strictActionTypeUniqueness)return;let r=Object.entries(bT).filter(([,t])=>t>1).map(([t])=>t);if(r.length)throw new Error(`Action types are registered more than once, ${r.map(t=>`"${t}"`).join(", ")}. ${AT}#strictactiontypeuniqueness`)}function K$(n={},r={}){return[{provide:n2,useFactory:V$},{provide:VO,useValue:r.initialState},{provide:TT,useFactory:f2,deps:[VO]},{provide:_T,useValue:n},{provide:$O,useExisting:n instanceof pt?n:_T},{provide:r2,deps:[_T,[new P0($O)]],useFactory:F$},{provide:WO,useValue:r.metaReducers?r.metaReducers:[]},{provide:qO,deps:[Ox,WO],useFactory:B$},{provide:jO,useValue:r.reducerFactory?r.reducerFactory:IT},{provide:i2,deps:[jO,qO],useFactory:l2},h$,g$,y$,v$,b$,Z$(r.runtimeChecks),p2()]}function Q$(n,r,t={}){return[{provide:HO,multi:!0,useValue:n instanceof Object?{}:t},{provide:UO,multi:!0,useValue:{key:n instanceof Object?n.name:n,reducerFactory:!(t instanceof pt)&&t.reducerFactory?t.reducerFactory:IT,metaReducers:!(t instanceof pt)&&t.metaReducers?t.metaReducers:[],initialState:!(t instanceof pt)&&t.initialState?t.initialState:void 0}},{provide:o2,deps:[HO,UO],useFactory:N$},{provide:vT,multi:!0,useValue:n instanceof Object?n.reducer:r},{provide:GO,multi:!0,useExisting:r instanceof pt?r:vT},{provide:s2,multi:!0,deps:[vT,[new P0(GO)]],useFactory:z$},p2()]}var m2=(()=>{class n{constructor(t,a,h,i,C,F){}static{this.\u0275fac=function(a){return new(a||n)(kt(Ng),kt(rv),kt(ST),kt(ld),kt(n2,8),kt(MT,8))}}static{this.\u0275mod=tn({type:n})}static{this.\u0275inj=en({})}}return n})(),J$=(()=>{class n{constructor(t,a,h,i,C){this.features=t,this.featureReducers=a,this.reducerManager=h;let F=t.map((V,K)=>{let Ee=a.shift()[K];return vn(ht({},V),{reducers:Ee,initialState:f2(V.initialState)})});h.addFeatures(F)}ngOnDestroy(){this.reducerManager.removeFeatures(this.features)}static{this.\u0275fac=function(a){return new(a||n)(kt(o2),kt(s2),kt(Fx),kt(m2),kt(MT,8))}}static{this.\u0275mod=tn({type:n})}static{this.\u0275inj=en({})}}return n})(),g2=(()=>{class n{static forRoot(t,a){return{ngModule:m2,providers:[...K$(t,a)]}}static forFeature(t,a,h={}){return{ngModule:J$,providers:[...Q$(t,a,h)]}}static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=tn({type:n})}static{this.\u0275inj=en({})}}return n})();function RT(...n){let r=n.pop(),t=n.map(a=>a.type);return{reducer:r,types:t}}function y2(n,...r){let t=new Map;for(let a of r)for(let h of a.types){let i=t.get(h);if(i){let C=(F,V)=>a.reducer(i(F,V),V);t.set(h,C)}else t.set(h,a.reducer)}return function(a=n,h){let i=t.get(h.type);return i?i(a,h):a}}var Bg=CT("[Location] Update Coordinates",DT()),ov=CT("[Location] Update Location Name",DT());var zx=h2("location"),_2=zg(zx,n=>n.latitude),v2=zg(zx,n=>n.longitude),yQ=zg(zx,n=>({latitude:n.latitude,longitude:n.longitude})),Bx=zg(zx,n=>n.locationName);var b2=new pt("");var x2=new pt("");var eH={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},kQ=vn(ht({},eH),{"[class.ng-submitted]":"isSubmitted"});var tH=new pt("",{providedIn:"root",factory:()=>w2}),w2="always";var nH=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})();var E2=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:tH,useValue:t.callSetDisabledState??w2}]}}static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[nH]})}return n})();function C2(n,...r){return r.length?r.some(t=>n[t]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}var FT;try{FT=typeof Intl<"u"&&Intl.v8BreakIterator}catch{FT=!1}var po=(()=>{class n{_platformId=Re(nd);isBrowser=this._platformId?cP(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||FT)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var sv;function iH(){if(sv==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>sv=!0}))}finally{sv=sv||!1}return sv}function dp(n){return iH()?n:!!n.capture}var up;function NT(){if(up==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return up=!1,up;if("scrollBehavior"in document.documentElement.style)up=!0;else{let n=Element.prototype.scrollTo;n?up=!/\{\s*\[native code\]\s*\}/.test(n.toString()):up=!1}}return up}var LT;function rH(){if(LT==null){let n=typeof document<"u"?document.head:null;LT=!!(n&&(n.createShadowRoot||n.attachShadow))}return LT}function D2(n){if(rH()){let r=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&r instanceof ShadowRoot)return r}return null}function Zl(n){return n.composedPath?n.composedPath()[0]:n.target}function zT(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Xc(n,r,t,a,h){let i=parseInt(tD.major),C=parseInt(tD.minor);return i>19||i===19&&C>0||i===0&&C===0?n.listen(r,t,a,h):(r.addEventListener(t,a,h),()=>{r.removeEventListener(t,a,h)})}function Vg(n){return n!=null&&`${n}`!="false"}function jx(n,r=0){return oH(n)?Number(n):arguments.length===2?r:0}function oH(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function jg(n){return Array.isArray(n)?n:[n]}function Br(n){return n==null?"":typeof n=="string"?n:`${n}px`}function cd(n){return n instanceof Bi?n.nativeElement:n}var T2=new Set,hp,sH=(()=>{class n{_platform=Re(po);_nonce=Re(D_,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):lH}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&aH(t,this._nonce),this._matchMedia(t)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function aH(n,r){if(!T2.has(n))try{hp||(hp=document.createElement("style"),r&&hp.setAttribute("nonce",r),hp.setAttribute("type","text/css"),document.head.appendChild(hp)),hp.sheet&&(hp.sheet.insertRule(`@media ${n} {body{ }}`,0),T2.add(n))}catch(t){console.error(t)}}function lH(n){return{matches:n==="all"||n==="",media:n,addListener:()=>{},removeListener:()=>{}}}var I2=(()=>{class n{_mediaMatcher=Re(sH);_zone=Re(bn);_queries=new Map;_destroySubject=new jn;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return M2(jg(t)).some(h=>this._registerQuery(h).mql.matches)}observe(t){let h=M2(jg(t)).map(C=>this._registerQuery(C).observable),i=jf(h);return i=dh(i.pipe(ss(1)),i.pipe(n_(1),e_(0))),i.pipe(ln(C=>{let F={matches:!1,breakpoints:{}};return C.forEach(({matches:V,query:K})=>{F.matches=F.matches||V,F.breakpoints[K]=V}),F}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);let a=this._mediaMatcher.matchMedia(t),i={observable:new Vn(C=>{let F=V=>this._zone.run(()=>C.next(V));return a.addListener(F),()=>{a.removeListener(F)}}).pipe(Uf(a),ln(({matches:C})=>({query:t,matches:C})),ro(this._destroySubject)),mql:a};return this._queries.set(t,i),i}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function M2(n){return n.map(r=>r.split(",")).reduce((r,t)=>r.concat(t)).map(r=>r.trim())}var Ux=new WeakMap,ud=(()=>{class n{_appRef;_injector=Re(ci);_environmentInjector=Re(Nr);load(t){let a=this._appRef=this._appRef||this._injector.get(Fs),h=Ux.get(a);h||(h={loaders:new Set,refs:[]},Ux.set(a,h),a.onDestroy(()=>{Ux.get(a)?.refs.forEach(i=>i.destroy()),Ux.delete(a)})),h.loaders.has(t)||(h.loaders.add(t),h.refs.push(J0(t,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),BT=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["ng-component"]],exportAs:["cdkVisuallyHidden"],decls:0,vars:0,template:function(a,h){},styles:[".cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl] .cdk-visually-hidden{left:auto;right:0}"],encapsulation:2,changeDetection:0})}return n})();var cH=(()=>{class n{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var $x=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({providers:[cH]})}return n})();var R2=" ";function dH(n,r,t){let a=qx(n,r);t=t.trim(),!a.some(h=>h.trim()===t)&&(a.push(t),n.setAttribute(r,a.join(R2)))}function hH(n,r,t){let a=qx(n,r);t=t.trim();let h=a.filter(i=>i!==t);h.length?n.setAttribute(r,h.join(R2)):n.removeAttribute(r)}function qx(n,r){return n.getAttribute(r)?.match(/\S+/g)??[]}var P2="cdk-describedby-message",Hx="cdk-describedby-host",HT=0,O2=(()=>{class n{_platform=Re(po);_document=Re(oi);_messageRegistry=new Map;_messagesContainer=null;_id=`${HT++}`;constructor(){Re(ud).load(BT),this._id=Re(cg)+"-"+HT++}describe(t,a,h){if(!this._canBeDescribed(t,a))return;let i=VT(a,h);typeof a!="string"?(S2(a,this._id),this._messageRegistry.set(i,{messageElement:a,referenceCount:0})):this._messageRegistry.has(i)||this._createMessageElement(a,h),this._isElementDescribedByMessage(t,i)||this._addMessageReference(t,i)}removeDescription(t,a,h){if(!a||!this._isElementNode(t))return;let i=VT(a,h);if(this._isElementDescribedByMessage(t,i)&&this._removeMessageReference(t,i),typeof a=="string"){let C=this._messageRegistry.get(i);C&&C.referenceCount===0&&this._deleteMessageElement(i)}this._messagesContainer?.childNodes.length===0&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){let t=this._document.querySelectorAll(`[${Hx}="${this._id}"]`);for(let a=0;a<t.length;a++)this._removeCdkDescribedByReferenceIds(t[a]),t[a].removeAttribute(Hx);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,a){let h=this._document.createElement("div");S2(h,this._id),h.textContent=t,a&&h.setAttribute("role",a),this._createMessagesContainer(),this._messagesContainer.appendChild(h),this._messageRegistry.set(VT(t,a),{messageElement:h,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;let t="cdk-describedby-message-container",a=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let i=0;i<a.length;i++)a[i].remove();let h=this._document.createElement("div");h.style.visibility="hidden",h.classList.add(t),h.classList.add("cdk-visually-hidden"),this._platform.isBrowser||h.setAttribute("platform","server"),this._document.body.appendChild(h),this._messagesContainer=h}_removeCdkDescribedByReferenceIds(t){let a=qx(t,"aria-describedby").filter(h=>h.indexOf(P2)!=0);t.setAttribute("aria-describedby",a.join(" "))}_addMessageReference(t,a){let h=this._messageRegistry.get(a);dH(t,"aria-describedby",h.messageElement.id),t.setAttribute(Hx,this._id),h.referenceCount++}_removeMessageReference(t,a){let h=this._messageRegistry.get(a);h.referenceCount--,hH(t,"aria-describedby",h.messageElement.id),t.removeAttribute(Hx)}_isElementDescribedByMessage(t,a){let h=qx(t,"aria-describedby"),i=this._messageRegistry.get(a),C=i&&i.messageElement.id;return!!C&&h.indexOf(C)!=-1}_canBeDescribed(t,a){if(!this._isElementNode(t))return!1;if(a&&typeof a=="object")return!0;let h=a==null?"":`${a}`.trim(),i=t.getAttribute("aria-label");return h?!i||i.trim()!==h:!1}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function VT(n,r){return typeof n=="string"?`${r||""}/${n}`:n}function S2(n,r){n.id||(n.id=`${P2}-${r}-${HT++}`)}function GT(n){return n.buttons===0||n.detail===0}function WT(n){let r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!r&&r.identifier===-1&&(r.radiusX==null||r.radiusX===1)&&(r.radiusY==null||r.radiusY===1)}var fH=new pt("cdk-input-modality-detector-options"),pH={ignoreKeys:[18,17,224,91,16]},L2=650,jT={passive:!0,capture:!0},mH=(()=>{class n{_platform=Re(po);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new Dr(null);_options;_lastTouchMs=0;_onKeydown=t=>{this._options?.ignoreKeys?.some(a=>a===t.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Zl(t))};_onMousedown=t=>{Date.now()-this._lastTouchMs<L2||(this._modality.next(GT(t)?"keyboard":"mouse"),this._mostRecentTarget=Zl(t))};_onTouchstart=t=>{if(WT(t)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Zl(t)};constructor(){let t=Re(bn),a=Re(oi),h=Re(fH,{optional:!0});if(this._options=ht(ht({},pH),h),this.modalityDetected=this._modality.pipe(n_(1)),this.modalityChanged=this.modalityDetected.pipe(Vm()),this._platform.isBrowser){let i=Re(Uo).createRenderer(null,null);this._listenerCleanups=t.runOutsideAngular(()=>[Xc(i,a,"keydown",this._onKeydown,jT),Xc(i,a,"mousedown",this._onMousedown,jT),Xc(i,a,"touchstart",this._onTouchstart,jT)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(t=>t())}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Wx=function(n){return n[n.IMMEDIATE=0]="IMMEDIATE",n[n.EVENTUAL=1]="EVENTUAL",n}(Wx||{}),gH=new pt("cdk-focus-monitor-default-options"),Gx=dp({passive:!0,capture:!0}),Zx=(()=>{class n{_ngZone=Re(bn);_platform=Re(po);_inputModalityDetector=Re(mH);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=Re(oi,{optional:!0});_stopInputModalityDetector=new jn;constructor(){let t=Re(gH,{optional:!0});this._detectionMode=t?.detectionMode||Wx.IMMEDIATE}_rootNodeFocusAndBlurListener=t=>{let a=Zl(t);for(let h=a;h;h=h.parentElement)t.type==="focus"?this._onFocus(t,h):this._onBlur(t,h)};monitor(t,a=!1){let h=cd(t);if(!this._platform.isBrowser||h.nodeType!==1)return nn();let i=D2(h)||this._getDocument(),C=this._elementInfo.get(h);if(C)return a&&(C.checkChildren=!0),C.subject;let F={checkChildren:a,subject:new jn,rootNode:i};return this._elementInfo.set(h,F),this._registerGlobalListeners(F),F.subject}stopMonitoring(t){let a=cd(t),h=this._elementInfo.get(a);h&&(h.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(h))}focusVia(t,a,h){let i=cd(t),C=this._getDocument().activeElement;i===C?this._getClosestElementsInfo(i).forEach(([F,V])=>this._originChanged(F,a,V)):(this._setOrigin(a),typeof i.focus=="function"&&i.focus(h))}ngOnDestroy(){this._elementInfo.forEach((t,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return this._detectionMode===Wx.EVENTUAL||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,a){t.classList.toggle("cdk-focused",!!a),t.classList.toggle("cdk-touch-focused",a==="touch"),t.classList.toggle("cdk-keyboard-focused",a==="keyboard"),t.classList.toggle("cdk-mouse-focused",a==="mouse"),t.classList.toggle("cdk-program-focused",a==="program")}_setOrigin(t,a=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=t,this._originFromTouchInteraction=t==="touch"&&a,this._detectionMode===Wx.IMMEDIATE){clearTimeout(this._originTimeoutId);let h=this._originFromTouchInteraction?L2:1;this._originTimeoutId=setTimeout(()=>this._origin=null,h)}})}_onFocus(t,a){let h=this._elementInfo.get(a),i=Zl(t);!h||!h.checkChildren&&a!==i||this._originChanged(a,this._getFocusOrigin(i),h)}_onBlur(t,a){let h=this._elementInfo.get(a);!h||h.checkChildren&&t.relatedTarget instanceof Node&&a.contains(t.relatedTarget)||(this._setClasses(a),this._emitOrigin(h,null))}_emitOrigin(t,a){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(a))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;let a=t.rootNode,h=this._rootNodeFocusListenerCount.get(a)||0;h||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,Gx),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,Gx)}),this._rootNodeFocusListenerCount.set(a,h+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ro(this._stopInputModalityDetector)).subscribe(i=>{this._setOrigin(i,!0)}))}_removeGlobalListeners(t){let a=t.rootNode;if(this._rootNodeFocusListenerCount.has(a)){let h=this._rootNodeFocusListenerCount.get(a);h>1?this._rootNodeFocusListenerCount.set(a,h-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Gx),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Gx),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,a,h){this._setClasses(t,a),this._emitOrigin(h,a),this._lastFocusOrigin=a}_getClosestElementsInfo(t){let a=[];return this._elementInfo.forEach((h,i)=>{(i===t||h.checkChildren&&i.contains(t))&&a.push([i,h])}),a}_isLastInteractionFromInputLabel(t){let{_mostRecentTarget:a,mostRecentModality:h}=this._inputModalityDetector;if(h!=="mouse"||!a||a===t||t.nodeName!=="INPUT"&&t.nodeName!=="TEXTAREA"||t.disabled)return!1;let i=t.labels;if(i){for(let C=0;C<i.length;C++)if(i[C].contains(a))return!0}return!1}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var fp=function(n){return n[n.NONE=0]="NONE",n[n.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",n[n.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",n}(fp||{}),A2="cdk-high-contrast-black-on-white",k2="cdk-high-contrast-white-on-black",UT="cdk-high-contrast-active",qT=(()=>{class n{_platform=Re(po);_hasCheckedHighContrastMode;_document=Re(oi);_breakpointSubscription;constructor(){this._breakpointSubscription=Re(I2).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return fp.NONE;let t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);let a=this._document.defaultView||window,h=a&&a.getComputedStyle?a.getComputedStyle(t):null,i=(h&&h.backgroundColor||"").replace(/ /g,"");switch(t.remove(),i){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return fp.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return fp.BLACK_ON_WHITE}return fp.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let t=this._document.body.classList;t.remove(UT,A2,k2),this._hasCheckedHighContrastMode=!0;let a=this.getHighContrastMode();a===fp.BLACK_ON_WHITE?t.add(UT,A2):a===fp.WHITE_ON_BLACK&&t.add(UT,k2)}}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),F2=(()=>{class n{constructor(){Re(qT)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[$x]})}return n})(),$T={},av=(()=>{class n{_appId=Re(cg);getId(t){return this._appId!=="ng"&&(t+=this._appId),$T.hasOwnProperty(t)||($T[t]=0),`${t}${$T[t]++}`}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var yH=new pt("cdk-dir-doc",{providedIn:"root",factory:_H});function _H(){return Re(oi)}var vH=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function bH(n){let r=n?.toLowerCase()||"";return r==="auto"&&typeof navigator<"u"&&navigator?.language?vH.test(navigator.language)?"rtl":"ltr":r==="rtl"?"rtl":"ltr"}var lv=(()=>{class n{value="ltr";change=new Tt;constructor(){let t=Re(yH,{optional:!0});if(t){let a=t.body?t.body.dir:null,h=t.documentElement?t.documentElement.dir:null;this.value=bH(a||h||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Th=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})();var xH=["mat-internal-form-field",""],wH=["*"];var or=(()=>{class n{constructor(){Re(qT)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[Th,Th]})}return n})();var KT=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["structural-styles"]],decls:0,vars:0,template:function(a,h){},styles:['.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}'],encapsulation:2,changeDetection:0})}return n})();var Ga=function(n){return n[n.FADING_IN=0]="FADING_IN",n[n.VISIBLE=1]="VISIBLE",n[n.FADING_OUT=2]="FADING_OUT",n[n.HIDDEN=3]="HIDDEN",n}(Ga||{}),ZT=class{_renderer;element;config;_animationForciblyDisabledThroughCss;state=Ga.HIDDEN;constructor(r,t,a,h=!1){this._renderer=r,this.element=t,this.config=a,this._animationForciblyDisabledThroughCss=h}fadeOut(){this._renderer.fadeOutRipple(this)}},N2=dp({passive:!0,capture:!0}),XT=class{_events=new Map;addHandler(r,t,a,h){let i=this._events.get(t);if(i){let C=i.get(a);C?C.add(h):i.set(a,new Set([h]))}else this._events.set(t,new Map([[a,new Set([h])]])),r.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,N2)})}removeHandler(r,t,a){let h=this._events.get(r);if(!h)return;let i=h.get(t);i&&(i.delete(a),i.size===0&&h.delete(t),h.size===0&&(this._events.delete(r),document.removeEventListener(r,this._delegateEventHandler,N2)))}_delegateEventHandler=r=>{let t=Zl(r);t&&this._events.get(r.type)?.forEach((a,h)=>{(h===t||h.contains(t))&&a.forEach(i=>i.handleEvent(r))})}},z2={enterDuration:225,exitDuration:150},EH=800,B2=dp({passive:!0,capture:!0}),V2=["mousedown","touchstart"],j2=["mouseup","mouseleave","touchend","touchcancel"],CH=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(a,h){},styles:[".mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}"],encapsulation:2,changeDetection:0})}return n})(),YT=class n{_target;_ngZone;_platform;_containerElement;_triggerElement;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect;static _eventManager=new XT;constructor(r,t,a,h,i){this._target=r,this._ngZone=t,this._platform=h,h.isBrowser&&(this._containerElement=cd(a)),i&&i.get(ud).load(CH)}fadeInRipple(r,t,a={}){let h=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=ht(ht({},z2),a.animation);a.centered&&(r=h.left+h.width/2,t=h.top+h.height/2);let C=a.radius||DH(r,t,h),F=r-h.left,V=t-h.top,K=i.enterDuration,oe=document.createElement("div");oe.classList.add("mat-ripple-element"),oe.style.left=`${F-C}px`,oe.style.top=`${V-C}px`,oe.style.height=`${C*2}px`,oe.style.width=`${C*2}px`,a.color!=null&&(oe.style.backgroundColor=a.color),oe.style.transitionDuration=`${K}ms`,this._containerElement.appendChild(oe);let Ee=window.getComputedStyle(oe),Ye=Ee.transitionProperty,Ne=Ee.transitionDuration,ct=Ye==="none"||Ne==="0s"||Ne==="0s, 0s"||h.width===0&&h.height===0,bt=new ZT(this,oe,a,ct);oe.style.transform="scale3d(1, 1, 1)",bt.state=Ga.FADING_IN,a.persistent||(this._mostRecentTransientRipple=bt);let Ut=null;return!ct&&(K||i.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Qt=()=>{Ut&&(Ut.fallbackTimer=null),clearTimeout(Un),this._finishRippleTransition(bt)},yi=()=>this._destroyRipple(bt),Un=setTimeout(yi,K+100);oe.addEventListener("transitionend",Qt),oe.addEventListener("transitioncancel",yi),Ut={onTransitionEnd:Qt,onTransitionCancel:yi,fallbackTimer:Un}}),this._activeRipples.set(bt,Ut),(ct||!K)&&this._finishRippleTransition(bt),bt}fadeOutRipple(r){if(r.state===Ga.FADING_OUT||r.state===Ga.HIDDEN)return;let t=r.element,a=ht(ht({},z2),r.config.animation);t.style.transitionDuration=`${a.exitDuration}ms`,t.style.opacity="0",r.state=Ga.FADING_OUT,(r._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(r)}fadeOutAll(){this._getActiveRipples().forEach(r=>r.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(r=>{r.config.persistent||r.fadeOut()})}setupTriggerEvents(r){let t=cd(r);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,V2.forEach(a=>{n._eventManager.addHandler(this._ngZone,a,t,this)}))}handleEvent(r){r.type==="mousedown"?this._onMousedown(r):r.type==="touchstart"?this._onTouchStart(r):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{j2.forEach(t=>{this._triggerElement.addEventListener(t,this,B2)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(r){r.state===Ga.FADING_IN?this._startFadeOutTransition(r):r.state===Ga.FADING_OUT&&this._destroyRipple(r)}_startFadeOutTransition(r){let t=r===this._mostRecentTransientRipple,{persistent:a}=r.config;r.state=Ga.VISIBLE,!a&&(!t||!this._isPointerDown)&&r.fadeOut()}_destroyRipple(r){let t=this._activeRipples.get(r)??null;this._activeRipples.delete(r),this._activeRipples.size||(this._containerRect=null),r===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),r.state=Ga.HIDDEN,t!==null&&(r.element.removeEventListener("transitionend",t.onTransitionEnd),r.element.removeEventListener("transitioncancel",t.onTransitionCancel),t.fallbackTimer!==null&&clearTimeout(t.fallbackTimer)),r.element.remove()}_onMousedown(r){let t=GT(r),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+EH;!this._target.rippleDisabled&&!t&&!a&&(this._isPointerDown=!0,this.fadeInRipple(r.clientX,r.clientY,this._target.rippleConfig))}_onTouchStart(r){if(!this._target.rippleDisabled&&!WT(r)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let t=r.changedTouches;if(t)for(let a=0;a<t.length;a++)this.fadeInRipple(t[a].clientX,t[a].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(r=>{let t=r.state===Ga.VISIBLE||r.config.terminateOnPointerUp&&r.state===Ga.FADING_IN;!r.config.persistent&&t&&r.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let r=this._triggerElement;r&&(V2.forEach(t=>n._eventManager.removeHandler(t,r,this)),this._pointerUpEventsRegistered&&(j2.forEach(t=>r.removeEventListener(t,this,B2)),this._pointerUpEventsRegistered=!1))}};function DH(n,r,t){let a=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),h=Math.max(Math.abs(r-t.top),Math.abs(r-t.bottom));return Math.sqrt(a*a+h*h)}var TH=new pt("mat-ripple-global-options"),U2=(()=>{class n{_elementRef=Re(Bi);_animationMode=Re(bh,{optional:!0});color;unbounded;centered;radius=0;animation;get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}_disabled=!1;get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}_trigger;_rippleRenderer;_globalOptions;_isInitialized=!1;constructor(){let t=Re(bn),a=Re(po),h=Re(TH,{optional:!0}),i=Re(ci);this._globalOptions=h||{},this._rippleRenderer=new YT(this,t,this._elementRef,a,i)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:ht(ht(ht({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,a=0,h){return typeof t=="number"?this._rippleRenderer.fadeInRipple(t,a,ht(ht({},this.rippleConfig),h)):this._rippleRenderer.fadeInRipple(0,0,ht(ht({},this.rippleConfig),t))}static \u0275fac=function(a){return new(a||n)};static \u0275dir=_r({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(a,h){a&2&&zr("mat-ripple-unbounded",h.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return n})(),$2=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,or]})}return n})();var H2=(()=>{class n{labelPosition;static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(a,h){a&2&&zr("mdc-form-field--align-end",h.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},attrs:xH,ngContentSelectors:wH,decls:1,vars:0,template:function(a,h){a&1&&(ha(),fa(0))},styles:[".mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}"],encapsulation:2,changeDetection:0})}return n})();var MH=["switch"],IH=["*"];function SH(n,r){n&1&&(Fn(0,"span",10),XA(),Fn(1,"svg",12),rr(2,"path",13),Wn(),Fn(3,"svg",14),rr(4,"path",15),Wn()())}var AH=new pt("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),kH={provide:b2,useExisting:tp(()=>Yx),multi:!0},Xx=class{source;checked;constructor(r,t){this.source=r,this.checked=t}},Yx=(()=>{class n{_elementRef=Re(Bi);_focusMonitor=Re(Zx);_changeDetectorRef=Re(ma);defaults=Re(AH);_onChange=t=>{};_onTouched=()=>{};_validatorOnChange=()=>{};_uniqueId;_checked=!1;_createChangeEvent(t){return new Xx(this,t)}_labelId;get buttonId(){return`${this.id||this._uniqueId}-button`}_switchElement;focus(){this._switchElement.nativeElement.focus()}_noopAnimations;_focused;name=null;id;labelPosition="after";ariaLabel=null;ariaLabelledby=null;ariaDescribedby;required;color;disabled=!1;disableRipple=!1;tabIndex=0;get checked(){return this._checked}set checked(t){this._checked=t,this._changeDetectorRef.markForCheck()}hideIcon;disabledInteractive;change=new Tt;toggleChange=new Tt;get inputId(){return`${this.id||this._uniqueId}-input`}constructor(){Re(ud).load(KT);let t=Re(new Jm("tabindex"),{optional:!0}),a=this.defaults,h=Re(bh,{optional:!0});this.tabIndex=t==null?0:parseInt(t)||0,this.color=a.color||"accent",this._noopAnimations=h==="NoopAnimations",this.id=this._uniqueId=Re(av).getId("mat-mdc-slide-toggle-"),this.hideIcon=a.hideIcon??!1,this.disabledInteractive=a.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{t==="keyboard"||t==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(t){t.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}validate(t){return this.required&&t.value!==!0?{required:!0}:null}registerOnValidatorChange(t){this._validatorOnChange=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new Xx(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["mat-slide-toggle"]],viewQuery:function(a,h){if(a&1&&Wc(MH,5),a&2){let i;Gl(i=Wl())&&(h._switchElement=i.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(a,h){a&2&&(mg("id",h.id),Ho("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),ip(h.color?"mat-"+h.color:""),zr("mat-mdc-slide-toggle-focused",h._focused)("mat-mdc-slide-toggle-checked",h.checked)("_mat-animation-noopable",h._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",Go],color:"color",disabled:[2,"disabled","disabled",Go],disableRipple:[2,"disableRipple","disableRipple",Go],tabIndex:[2,"tabIndex","tabIndex",t=>t==null?0:rD(t)],checked:[2,"checked","checked",Go],hideIcon:[2,"hideIcon","hideIcon",Go],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Go]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[pa([kH,{provide:x2,useExisting:n,multi:!0}]),cs],ngContentSelectors:IH,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(a,h){if(a&1){let i=I_();ha(),Fn(0,"div",1)(1,"button",2,0),Tr("click",function(){return sg(i),ag(h._handleClick())}),rr(3,"span",3),Fn(4,"span",4)(5,"span",5)(6,"span",6),rr(7,"span",7),Wn(),Fn(8,"span",8),rr(9,"span",9),Wn(),da(10,SH,5,0,"span",10),Wn()()(),Fn(11,"label",11),Tr("click",function(F){return sg(i),ag(F.stopPropagation())}),fa(12),Wn()()}if(a&2){let i=KC(2);Xi("labelPosition",h.labelPosition),pi(),zr("mdc-switch--selected",h.checked)("mdc-switch--unselected",!h.checked)("mdc-switch--checked",h.checked)("mdc-switch--disabled",h.disabled)("mat-mdc-slide-toggle-disabled-interactive",h.disabledInteractive),Xi("tabIndex",h.disabled&&!h.disabledInteractive?-1:h.tabIndex)("disabled",h.disabled&&!h.disabledInteractive),Ho("id",h.buttonId)("name",h.name)("aria-label",h.ariaLabel)("aria-labelledby",h._getAriaLabelledBy())("aria-describedby",h.ariaDescribedby)("aria-required",h.required||null)("aria-checked",h.checked)("aria-disabled",h.disabled&&h.disabledInteractive?"true":null),pi(8),Xi("matRippleTrigger",i)("matRippleDisabled",h.disableRipple||h.disabled)("matRippleCentered",!0),pi(),pg(h.hideIcon?-1:10),pi(),Xi("for",h.buttonId),Ho("id",h._labelId)}},dependencies:[U2,H2],styles:['.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width, 52px)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height, 32px);border-radius:var(--mdc-switch-track-shape, var(--mat-sys-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity, 0.12)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width, 2px);border-color:var(--mat-switch-track-outline-color, var(--mat-sys-outline))}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width, 2px);border-color:var(--mat-switch-selected-track-outline-color, transparent)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width, 2px);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-sys-on-surface))}@media(forced-colors: active){.mdc-switch__track{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-sys-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-sys-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-sys-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-sys-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity, 1);transition:var(--mat-switch-visible-track-transition, opacity 75ms)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity, 0);transition:var(--mat-switch-hidden-track-transition, opacity 75ms)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-sys-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-sys-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-sys-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-sys-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size, 16px);height:var(--mat-switch-unselected-handle-size, 16px);margin:var(--mat-switch-unselected-handle-horizontal-margin, 0 8px)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin, 0 4px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size, 24px);height:var(--mat-switch-selected-handle-size, 24px);margin:var(--mat-switch-selected-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin, 0 24px)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size, 24px);height:var(--mat-switch-with-icon-handle-size, 24px)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size, 28px);height:var(--mat-switch-pressed-handle-size, 28px)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin, 0 22px)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin, 0 2px)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity, 1)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity, 0.38)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media(forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-sys-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-sys-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-sys-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-sys-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-sys-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-sys-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-sys-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size, 40px);height:var(--mdc-switch-state-layer-size, 40px)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-sys-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-sys-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-sys-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1;transform:translateZ(0)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity, 0.38)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity, 0.38)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size, 16px);height:var(--mdc-switch-unselected-icon-size, 16px);fill:var(--mdc-switch-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-sys-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size, 16px);height:var(--mdc-switch-selected-icon-size, 16px);fill:var(--mdc-switch-selected-icon-color, var(--mat-sys-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-sys-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-sys-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-sys-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-sys-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}'],encapsulation:2,changeDetection:0})}return n})();var G2=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[Yx,or,or]})}return n})();var PH=["*"],Kx;function OH(){if(Kx===void 0&&(Kx=null,typeof window<"u")){let n=window;n.trustedTypes!==void 0&&(Kx=n.trustedTypes.createPolicy("angular#components",{createHTML:r=>r}))}return Kx}function cv(n){return OH()?.createHTML(n)||n}function W2(n){return Error(`Unable to find icon with the name "${n}"`)}function LH(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function q2(n){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function Z2(n){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}var dd=class{url;svgText;options;svgElement;constructor(r,t,a){this.url=r,this.svgText=t,this.options=a}},FH=(()=>{class n{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(t,a,h,i){this._httpClient=t,this._sanitizer=a,this._errorHandler=i,this._document=h}addSvgIcon(t,a,h){return this.addSvgIconInNamespace("",t,a,h)}addSvgIconLiteral(t,a,h){return this.addSvgIconLiteralInNamespace("",t,a,h)}addSvgIconInNamespace(t,a,h,i){return this._addSvgIconConfig(t,a,new dd(h,null,i))}addSvgIconResolver(t){return this._resolvers.push(t),this}addSvgIconLiteralInNamespace(t,a,h,i){let C=this._sanitizer.sanitize(ds.HTML,h);if(!C)throw Z2(h);let F=cv(C);return this._addSvgIconConfig(t,a,new dd("",F,i))}addSvgIconSet(t,a){return this.addSvgIconSetInNamespace("",t,a)}addSvgIconSetLiteral(t,a){return this.addSvgIconSetLiteralInNamespace("",t,a)}addSvgIconSetInNamespace(t,a,h){return this._addSvgIconSetConfig(t,new dd(a,null,h))}addSvgIconSetLiteralInNamespace(t,a,h){let i=this._sanitizer.sanitize(ds.HTML,a);if(!i)throw Z2(a);let C=cv(i);return this._addSvgIconSetConfig(t,new dd("",C,h))}registerFontClassAlias(t,a=t){return this._fontCssClassesByAlias.set(t,a),this}classNameForFontAlias(t){return this._fontCssClassesByAlias.get(t)||t}setDefaultFontSetClass(...t){return this._defaultFontSetClass=t,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(t){let a=this._sanitizer.sanitize(ds.RESOURCE_URL,t);if(!a)throw q2(t);let h=this._cachedIconsByUrl.get(a);return h?nn(Qx(h)):this._loadSvgIconFromConfig(new dd(t,null)).pipe(gr(i=>this._cachedIconsByUrl.set(a,i)),ln(i=>Qx(i)))}getNamedSvgIcon(t,a=""){let h=X2(a,t),i=this._svgIconConfigs.get(h);if(i)return this._getSvgFromConfig(i);if(i=this._getIconConfigFromResolvers(a,t),i)return this._svgIconConfigs.set(h,i),this._getSvgFromConfig(i);let C=this._iconSetConfigs.get(a);return C?this._getSvgFromIconSetConfigs(t,C):ch(W2(h))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(t){return t.svgText?nn(Qx(this._svgElementFromConfig(t))):this._loadSvgIconFromConfig(t).pipe(ln(a=>Qx(a)))}_getSvgFromIconSetConfigs(t,a){let h=this._extractIconWithNameFromAnySet(t,a);if(h)return nn(h);let i=a.filter(C=>!C.svgText).map(C=>this._loadSvgIconSetFromConfig(C).pipe(Lc(F=>{let K=`Loading icon set URL: ${this._sanitizer.sanitize(ds.RESOURCE_URL,C.url)} failed: ${F.message}`;return this._errorHandler.handleError(new Error(K)),nn(null)})));return H1(i).pipe(ln(()=>{let C=this._extractIconWithNameFromAnySet(t,a);if(!C)throw W2(t);return C}))}_extractIconWithNameFromAnySet(t,a){for(let h=a.length-1;h>=0;h--){let i=a[h];if(i.svgText&&i.svgText.toString().indexOf(t)>-1){let C=this._svgElementFromConfig(i),F=this._extractSvgIconFromSet(C,t,i.options);if(F)return F}}return null}_loadSvgIconFromConfig(t){return this._fetchIcon(t).pipe(gr(a=>t.svgText=a),ln(()=>this._svgElementFromConfig(t)))}_loadSvgIconSetFromConfig(t){return t.svgText?nn(null):this._fetchIcon(t).pipe(gr(a=>t.svgText=a))}_extractSvgIconFromSet(t,a,h){let i=t.querySelector(`[id="${a}"]`);if(!i)return null;let C=i.cloneNode(!0);if(C.removeAttribute("id"),C.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(C,h);if(C.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(C),h);let F=this._svgElementFromString(cv("<svg></svg>"));return F.appendChild(C),this._setSvgAttributes(F,h)}_svgElementFromString(t){let a=this._document.createElement("DIV");a.innerHTML=t;let h=a.querySelector("svg");if(!h)throw Error("<svg> tag not found");return h}_toSvgElement(t){let a=this._svgElementFromString(cv("<svg></svg>")),h=t.attributes;for(let i=0;i<h.length;i++){let{name:C,value:F}=h[i];C!=="id"&&a.setAttribute(C,F)}for(let i=0;i<t.childNodes.length;i++)t.childNodes[i].nodeType===this._document.ELEMENT_NODE&&a.appendChild(t.childNodes[i].cloneNode(!0));return a}_setSvgAttributes(t,a){return t.setAttribute("fit",""),t.setAttribute("height","100%"),t.setAttribute("width","100%"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.setAttribute("focusable","false"),a&&a.viewBox&&t.setAttribute("viewBox",a.viewBox),t}_fetchIcon(t){let{url:a,options:h}=t,i=h?.withCredentials??!1;if(!this._httpClient)throw LH();if(a==null)throw Error(`Cannot fetch icon from URL "${a}".`);let C=this._sanitizer.sanitize(ds.RESOURCE_URL,a);if(!C)throw q2(a);let F=this._inProgressUrlFetches.get(C);if(F)return F;let V=this._httpClient.get(C,{responseType:"text",withCredentials:i}).pipe(ln(K=>cv(K)),Fc(()=>this._inProgressUrlFetches.delete(C)),Z1());return this._inProgressUrlFetches.set(C,V),V}_addSvgIconConfig(t,a,h){return this._svgIconConfigs.set(X2(t,a),h),this}_addSvgIconSetConfig(t,a){let h=this._iconSetConfigs.get(t);return h?h.push(a):this._iconSetConfigs.set(t,[a]),this}_svgElementFromConfig(t){if(!t.svgElement){let a=this._svgElementFromString(t.svgText);this._setSvgAttributes(a,t.options),t.svgElement=a}return t.svgElement}_getIconConfigFromResolvers(t,a){for(let h=0;h<this._resolvers.length;h++){let i=this._resolvers[h](a,t);if(i)return NH(i)?new dd(i.url,null,i.options):new dd(i,null)}}static \u0275fac=function(a){return new(a||n)(kt(P_,8),kt(MD),kt(oi,8),kt(Ls))};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Qx(n){return n.cloneNode(!0)}function X2(n,r){return n+":"+r}function NH(n){return!!(n.url&&n.options)}var zH=new pt("MAT_ICON_DEFAULT_OPTIONS"),BH=new pt("mat-icon-location",{providedIn:"root",factory:VH});function VH(){let n=Re(oi),r=n?n.location:null;return{getPathname:()=>r?r.pathname+r.search:""}}var Y2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],jH=Y2.map(n=>`[${n}]`).join(", "),UH=/^url\(['"]?#(.*?)['"]?\)$/,K2=(()=>{class n{_elementRef=Re(Bi);_iconRegistry=Re(FH);_location=Re(BH);_errorHandler=Re(Ls);_defaultColor;get color(){return this._color||this._defaultColor}set color(t){this._color=t}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(t){t!==this._svgIcon&&(t?this._updateSvgIcon(t):this._svgIcon&&this._clearSvgElement(),this._svgIcon=t)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(t){let a=this._cleanupFontValue(t);a!==this._fontSet&&(this._fontSet=a,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(t){let a=this._cleanupFontValue(t);a!==this._fontIcon&&(this._fontIcon=a,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Pi.EMPTY;constructor(){let t=Re(new Jm("aria-hidden"),{optional:!0}),a=Re(zH,{optional:!0});a&&(a.color&&(this.color=this._defaultColor=a.color),a.fontSet&&(this.fontSet=a.fontSet)),t||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(t){if(!t)return["",""];let a=t.split(":");switch(a.length){case 1:return["",a[0]];case 2:return a;default:throw Error(`Invalid icon name: "${t}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let t=this._elementsWithExternalReferences;if(t&&t.size){let a=this._location.getPathname();a!==this._previousPath&&(this._previousPath=a,this._prependPathToReferences(a))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(t){this._clearSvgElement();let a=this._location.getPathname();this._previousPath=a,this._cacheChildrenWithExternalReferences(t),this._prependPathToReferences(a),this._elementRef.nativeElement.appendChild(t)}_clearSvgElement(){let t=this._elementRef.nativeElement,a=t.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();a--;){let h=t.childNodes[a];(h.nodeType!==1||h.nodeName.toLowerCase()==="svg")&&h.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let t=this._elementRef.nativeElement,a=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(h=>h.length>0);this._previousFontSetClass.forEach(h=>t.classList.remove(h)),a.forEach(h=>t.classList.add(h)),this._previousFontSetClass=a,this.fontIcon!==this._previousFontIconClass&&!a.includes("mat-ligature-font")&&(this._previousFontIconClass&&t.classList.remove(this._previousFontIconClass),this.fontIcon&&t.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(t){return typeof t=="string"?t.trim().split(" ")[0]:t}_prependPathToReferences(t){let a=this._elementsWithExternalReferences;a&&a.forEach((h,i)=>{h.forEach(C=>{i.setAttribute(C.name,`url('${t}#${C.value}')`)})})}_cacheChildrenWithExternalReferences(t){let a=t.querySelectorAll(jH),h=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let i=0;i<a.length;i++)Y2.forEach(C=>{let F=a[i],V=F.getAttribute(C),K=V?V.match(UH):null;if(K){let oe=h.get(F);oe||(oe=[],h.set(F,oe)),oe.push({name:C,value:K[1]})}})}_updateSvgIcon(t){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),t){let[a,h]=this._splitIconName(t);a&&(this._svgNamespace=a),h&&(this._svgName=h),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(h,a).pipe(ss(1)).subscribe(i=>this._setSvgElement(i),i=>{let C=`Error retrieving icon ${a}:${h}! ${i.message}`;this._errorHandler.handleError(new Error(C))})}}static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(a,h){a&2&&(Ho("data-mat-icon-type",h._usingFontIcon()?"font":"svg")("data-mat-icon-name",h._svgName||h.fontIcon)("data-mat-icon-namespace",h._svgNamespace||h.fontSet)("fontIcon",h._usingFontIcon()?h.fontIcon:null),ip(h.color?"mat-"+h.color:""),zr("mat-icon-inline",h.inline)("mat-icon-no-color",h.color!=="primary"&&h.color!=="accent"&&h.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Go],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],ngContentSelectors:PH,decls:1,vars:0,template:function(a,h){a&1&&(ha(),fa(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return n})(),Q2=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,or]})}return n})();var uv=class{_attachedHost;attach(r){return this._attachedHost=r,r.attach(this)}detach(){let r=this._attachedHost;r!=null&&(this._attachedHost=null,r.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(r){this._attachedHost=r}},dv=class extends uv{component;viewContainerRef;injector;componentFactoryResolver;projectableNodes;constructor(r,t,a,h,i){super(),this.component=r,this.viewContainerRef=t,this.injector=a,this.projectableNodes=i}},Jx=class extends uv{templateRef;viewContainerRef;context;injector;constructor(r,t,a,h){super(),this.templateRef=r,this.viewContainerRef=t,this.context=a,this.injector=h}get origin(){return this.templateRef.elementRef}attach(r,t=this.context){return this.context=t,super.attach(r)}detach(){return this.context=void 0,super.detach()}},QT=class extends uv{element;constructor(r){super(),this.element=r instanceof Bi?r.nativeElement:r}},JT=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(r){if(r instanceof dv)return this._attachedPortal=r,this.attachComponentPortal(r);if(r instanceof Jx)return this._attachedPortal=r,this.attachTemplatePortal(r);if(this.attachDomPortal&&r instanceof QT)return this._attachedPortal=r,this.attachDomPortal(r)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(r){this._disposeFn=r}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var ew=class extends JT{outletElement;_appRef;_defaultInjector;_document;constructor(r,t,a,h,i){super(),this.outletElement=r,this._appRef=a,this._defaultInjector=h,this._document=i}attachComponentPortal(r){let t;if(r.viewContainerRef){let a=r.injector||r.viewContainerRef.injector,h=a.get(gh,null,{optional:!0})||void 0;t=r.viewContainerRef.createComponent(r.component,{index:r.viewContainerRef.length,injector:a,ngModuleRef:h,projectableNodes:r.projectableNodes||void 0}),this.setDisposeFn(()=>t.destroy())}else{let a=this._appRef,h=r.injector||this._defaultInjector||ci.NULL,i=h.get(Nr,a.injector);t=J0(r.component,{elementInjector:h,environmentInjector:i,projectableNodes:r.projectableNodes||void 0}),a.attachView(t.hostView),this.setDisposeFn(()=>{a.viewCount>0&&a.detachView(t.hostView),t.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(t)),this._attachedPortal=r,t}attachTemplatePortal(r){let t=r.viewContainerRef,a=t.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return a.rootNodes.forEach(h=>this.outletElement.appendChild(h)),a.detectChanges(),this.setDisposeFn(()=>{let h=t.indexOf(a);h!==-1&&t.remove(h)}),this._attachedPortal=r,a}attachDomPortal=r=>{let t=r.element;t.parentNode;let a=this._document.createComment("dom-portal");t.parentNode.insertBefore(a,t),this.outletElement.appendChild(t),this._attachedPortal=r,super.setDisposeFn(()=>{a.parentNode&&a.parentNode.replaceChild(t,a)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(r){return r.hostView.rootNodes[0]}};var J2=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})();var HH=20,hv=(()=>{class n{_ngZone=Re(bn);_platform=Re(po);_renderer=Re(Uo).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new jn;_scrolledCount=0;scrollContainers=new Map;register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){let a=this.scrollContainers.get(t);a&&(a.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=HH){return this._platform.isBrowser?new Vn(a=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let h=t>0?this._scrolled.pipe($b(t)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{h.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):nn()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((t,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(t,a){let h=this.getAncestorScrollContainers(t);return this.scrolled(a).pipe(Pr(i=>!i||h.indexOf(i)>-1))}getAncestorScrollContainers(t){let a=[];return this.scrollContainers.forEach((h,i)=>{this._scrollableContainsElement(i,t)&&a.push(i)}),a}_scrollableContainsElement(t,a){let h=cd(a),i=t.getElementRef().nativeElement;do if(h==i)return!0;while(h=h.parentElement);return!1}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var GH=20,nw=(()=>{class n{_platform=Re(po);_listeners;_viewportSize;_change=new jn;_document=Re(oi,{optional:!0});constructor(){let t=Re(bn),a=Re(Uo).createRenderer(null,null);t.runOutsideAngular(()=>{if(this._platform.isBrowser){let h=i=>this._change.next(i);this._listeners=[a.listen("window","resize",h),a.listen("window","orientationchange",h)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(t=>t()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){let t=this.getViewportScrollPosition(),{width:a,height:h}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+h,right:t.left+a,height:h,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let t=this._document,a=this._getWindow(),h=t.documentElement,i=h.getBoundingClientRect(),C=-i.top||t.body.scrollTop||a.scrollY||h.scrollTop||0,F=-i.left||t.body.scrollLeft||a.scrollX||h.scrollLeft||0;return{top:C,left:F}}change(t=GH){return t>0?this._change.pipe($b(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var tw=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})(),eM=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[Th,tw,Th,tw]})}return n})();var eL=NT(),tM=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(r,t){this._viewportRuler=r,this._document=t}attach(){}enable(){if(this._canBeEnabled()){let r=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=r.style.left||"",this._previousHTMLStyles.top=r.style.top||"",r.style.left=Br(-this._previousScrollPosition.left),r.style.top=Br(-this._previousScrollPosition.top),r.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let r=this._document.documentElement,t=this._document.body,a=r.style,h=t.style,i=a.scrollBehavior||"",C=h.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,r.classList.remove("cdk-global-scrollblock"),eL&&(a.scrollBehavior=h.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),eL&&(a.scrollBehavior=i,h.scrollBehavior=C)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let t=this._document.body,a=this._viewportRuler.getViewportSize();return t.scrollHeight>a.height||t.scrollWidth>a.width}};var nM=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(r,t,a,h){this._scrollDispatcher=r,this._ngZone=t,this._viewportRuler=a,this._config=h}attach(r){this._overlayRef,this._overlayRef=r}enable(){if(this._scrollSubscription)return;let r=this._scrollDispatcher.scrolled(0).pipe(Pr(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=r.subscribe(()=>{let t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=r.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}},iw=class{enable(){}disable(){}attach(){}};function iM(n,r){return r.some(t=>{let a=n.bottom<t.top,h=n.top>t.bottom,i=n.right<t.left,C=n.left>t.right;return a||h||i||C})}function tL(n,r){return r.some(t=>{let a=n.top<t.top,h=n.bottom>t.bottom,i=n.left<t.left,C=n.right>t.right;return a||h||i||C})}var rM=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(r,t,a,h){this._scrollDispatcher=r,this._viewportRuler=t,this._ngZone=a,this._config=h}attach(r){this._overlayRef,this._overlayRef=r}enable(){if(!this._scrollSubscription){let r=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(r).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:h}=this._viewportRuler.getViewportSize();iM(t,[{width:a,height:h,bottom:h,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},WH=(()=>{class n{_scrollDispatcher=Re(hv);_viewportRuler=Re(nw);_ngZone=Re(bn);_document=Re(oi);constructor(){}noop=()=>new iw;close=t=>new nM(this._scrollDispatcher,this._ngZone,this._viewportRuler,t);block=()=>new tM(this._viewportRuler,this._document);reposition=t=>new rM(this._scrollDispatcher,this._viewportRuler,this._ngZone,t);static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),oM=class{positionStrategy;scrollStrategy=new iw;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(r){if(r){let t=Object.keys(r);for(let a of t)r[a]!==void 0&&(this[a]=r[a])}}};var sM=class{connectionPair;scrollableViewProperties;constructor(r,t){this.connectionPair=r,this.scrollableViewProperties=t}};var aL=(()=>{class n{_attachedOverlays=[];_document=Re(oi);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){let a=this._attachedOverlays.indexOf(t);a>-1&&this._attachedOverlays.splice(a,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),qH=(()=>{class n extends aL{_ngZone=Re(bn);_renderer=Re(Uo).createRenderer(null,null);_cleanupKeydown;add(t){super.add(t),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=t=>{let a=this._attachedOverlays;for(let h=a.length-1;h>-1;h--)if(a[h]._keydownEvents.observers.length>0){this._ngZone.run(()=>a[h]._keydownEvents.next(t));break}};static \u0275fac=(()=>{let t;return function(h){return(t||(t=ja(n)))(h||n)}})();static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ZH=(()=>{class n extends aL{_platform=Re(po);_ngZone=Re(bn);_renderer=Re(Uo).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(t){if(super.add(t),!this._isAttached){let a=this._document.body,h={capture:!0};this._cleanups=this._ngZone.runOutsideAngular(()=>[Xc(this._renderer,a,"pointerdown",this._pointerDownListener,h),Xc(this._renderer,a,"click",this._clickListener,h),Xc(this._renderer,a,"auxclick",this._clickListener,h),Xc(this._renderer,a,"contextmenu",this._clickListener,h)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(t=>t()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=t=>{this._pointerDownEventTarget=Zl(t)};_clickListener=t=>{let a=Zl(t),h=t.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:a;this._pointerDownEventTarget=null;let i=this._attachedOverlays.slice();for(let C=i.length-1;C>-1;C--){let F=i[C];if(F._outsidePointerEvents.observers.length<1||!F.hasAttached())continue;if(nL(F.overlayElement,a)||nL(F.overlayElement,h))break;let V=F._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>V.next(t)):V.next(t)}};static \u0275fac=(()=>{let t;return function(h){return(t||(t=ja(n)))(h||n)}})();static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function nL(n,r){let t=typeof ShadowRoot<"u"&&ShadowRoot,a=r;for(;a;){if(a===n)return!0;a=t&&a instanceof ShadowRoot?a.host:a.parentNode}return!1}var lL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(a,h){},styles:[".cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}"],encapsulation:2,changeDetection:0})}return n})(),cL=(()=>{class n{_platform=Re(po);_containerElement;_document=Re(oi);_styleLoader=Re(ud);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t="cdk-overlay-container";if(this._platform.isBrowser||zT()){let h=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let i=0;i<h.length;i++)h[i].remove()}let a=this._document.createElement("div");a.classList.add(t),zT()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}_loadStyles(){this._styleLoader.load(lL)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),aM=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(r,t,a,h){this._renderer=t,this._ngZone=a,this.element=r.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=t.listen(this.element,"click",h)}detach(){this._ngZone.runOutsideAngular(()=>{let r=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(r,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),r.style.pointerEvents="none",r.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}},lM=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new jn;_attachments=new jn;_detachments=new jn;_positionStrategy;_scrollStrategy;_locationChanges=Pi.EMPTY;_backdropRef=null;_previousHostParent;_keydownEvents=new jn;_outsidePointerEvents=new jn;_renders=new jn;_afterRenderRef;_afterNextRenderRef;constructor(r,t,a,h,i,C,F,V,K,oe=!1,Ee,Ye){this._portalOutlet=r,this._host=t,this._pane=a,this._config=h,this._ngZone=i,this._keyboardDispatcher=C,this._document=F,this._location=V,this._outsideClickDispatcher=K,this._animationsDisabled=oe,this._injector=Ee,this._renderer=Ye,h.scrollStrategy&&(this._scrollStrategy=h.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=h.positionStrategy,this._afterRenderRef=rp(()=>MC(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(r){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let t=this._portalOutlet.attach(r);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=Hc(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof t?.onDestroy=="function"&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let r=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),r}dispose(){let r=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,r&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(r){r!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=r,this.hasAttached()&&(r.attach(this),this.updatePosition()))}updateSize(r){this._config=ht(ht({},this._config),r),this._updateElementSize()}setDirection(r){this._config=vn(ht({},this._config),{direction:r}),this._updateElementDirection()}addPanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!0)}removePanelClass(r){this._pane&&this._toggleClasses(this._pane,r,!1)}getDirection(){let r=this._config.direction;return r?typeof r=="string"?r:r.value:"ltr"}updateScrollStrategy(r){r!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=r,this.hasAttached()&&(r.attach(this),r.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let r=this._pane.style;r.width=Br(this._config.width),r.height=Br(this._config.height),r.minWidth=Br(this._config.minWidth),r.minHeight=Br(this._config.minHeight),r.maxWidth=Br(this._config.maxWidth),r.maxHeight=Br(this._config.maxHeight)}_togglePointerEvents(r){this._pane.style.pointerEvents=r?"":"none"}_attachBackdrop(){let r="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new aM(this._document,this._renderer,this._ngZone,t=>{this._backdropClick.next(t)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(r))}):this._backdropRef.element.classList.add(r)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(r,t,a){let h=jg(t||[]).filter(i=>!!i);h.length&&(a?r.classList.add(...h):r.classList.remove(...h))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{let r=this._renders.pipe(ro(Ub(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),r.unsubscribe())})})}_disposeScrollStrategy(){let r=this._scrollStrategy;r?.disable(),r?.detach?.()}},iL="cdk-overlay-connected-position-bounding-box",XH=/([A-Za-z%]+)$/,cM=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new jn;_resizeSubscription=Pi.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(r,t,a,h,i){this._viewportRuler=t,this._document=a,this._platform=h,this._overlayContainer=i,this.setOrigin(r)}attach(r){this._overlayRef&&this._overlayRef,this._validatePositions(),r.hostElement.classList.add(iL),this._overlayRef=r,this._boundingBox=r.hostElement,this._pane=r.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let r=this._originRect,t=this._overlayRect,a=this._viewportRect,h=this._containerRect,i=[],C;for(let F of this._preferredPositions){let V=this._getOriginPoint(r,h,F),K=this._getOverlayPoint(V,t,F),oe=this._getOverlayFit(K,t,a,F);if(oe.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(F,V);return}if(this._canFitWithFlexibleDimensions(oe,K,a)){i.push({position:F,origin:V,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(V,F)});continue}(!C||C.overlayFit.visibleArea<oe.visibleArea)&&(C={overlayFit:oe,overlayPoint:K,originPoint:V,position:F,overlayRect:t})}if(i.length){let F=null,V=-1;for(let K of i){let oe=K.boundingBoxRect.width*K.boundingBoxRect.height*(K.position.weight||1);oe>V&&(V=oe,F=K)}this._isPushed=!1,this._applyPosition(F.position,F.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(C.position,C.originPoint);return}this._applyPosition(C.position,C.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&pp(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(iL),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let r=this._lastPosition;if(r){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let t=this._getOriginPoint(this._originRect,this._containerRect,r);this._applyPosition(r,t)}else this.apply()}withScrollableContainers(r){return this._scrollables=r,this}withPositions(r){return this._preferredPositions=r,r.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(r){return this._viewportMargin=r,this}withFlexibleDimensions(r=!0){return this._hasFlexibleDimensions=r,this}withGrowAfterOpen(r=!0){return this._growAfterOpen=r,this}withPush(r=!0){return this._canPush=r,this}withLockedPosition(r=!0){return this._positionLocked=r,this}setOrigin(r){return this._origin=r,this}withDefaultOffsetX(r){return this._offsetX=r,this}withDefaultOffsetY(r){return this._offsetY=r,this}withTransformOriginOn(r){return this._transformOriginSelector=r,this}_getOriginPoint(r,t,a){let h;if(a.originX=="center")h=r.left+r.width/2;else{let C=this._isRtl()?r.right:r.left,F=this._isRtl()?r.left:r.right;h=a.originX=="start"?C:F}t.left<0&&(h-=t.left);let i;return a.originY=="center"?i=r.top+r.height/2:i=a.originY=="top"?r.top:r.bottom,t.top<0&&(i-=t.top),{x:h,y:i}}_getOverlayPoint(r,t,a){let h;a.overlayX=="center"?h=-t.width/2:a.overlayX==="start"?h=this._isRtl()?-t.width:0:h=this._isRtl()?0:-t.width;let i;return a.overlayY=="center"?i=-t.height/2:i=a.overlayY=="top"?0:-t.height,{x:r.x+h,y:r.y+i}}_getOverlayFit(r,t,a,h){let i=oL(t),{x:C,y:F}=r,V=this._getOffset(h,"x"),K=this._getOffset(h,"y");V&&(C+=V),K&&(F+=K);let oe=0-C,Ee=C+i.width-a.width,Ye=0-F,Ne=F+i.height-a.height,ct=this._subtractOverflows(i.width,oe,Ee),bt=this._subtractOverflows(i.height,Ye,Ne),Ut=ct*bt;return{visibleArea:Ut,isCompletelyWithinViewport:i.width*i.height===Ut,fitsInViewportVertically:bt===i.height,fitsInViewportHorizontally:ct==i.width}}_canFitWithFlexibleDimensions(r,t,a){if(this._hasFlexibleDimensions){let h=a.bottom-t.y,i=a.right-t.x,C=rL(this._overlayRef.getConfig().minHeight),F=rL(this._overlayRef.getConfig().minWidth),V=r.fitsInViewportVertically||C!=null&&C<=h,K=r.fitsInViewportHorizontally||F!=null&&F<=i;return V&&K}return!1}_pushOverlayOnScreen(r,t,a){if(this._previousPushAmount&&this._positionLocked)return{x:r.x+this._previousPushAmount.x,y:r.y+this._previousPushAmount.y};let h=oL(t),i=this._viewportRect,C=Math.max(r.x+h.width-i.width,0),F=Math.max(r.y+h.height-i.height,0),V=Math.max(i.top-a.top-r.y,0),K=Math.max(i.left-a.left-r.x,0),oe=0,Ee=0;return h.width<=i.width?oe=K||-C:oe=r.x<this._viewportMargin?i.left-a.left-r.x:0,h.height<=i.height?Ee=V||-F:Ee=r.y<this._viewportMargin?i.top-a.top-r.y:0,this._previousPushAmount={x:oe,y:Ee},{x:r.x+oe,y:r.y+Ee}}_applyPosition(r,t){if(this._setTransformOrigin(r),this._setOverlayElementStyles(t,r),this._setBoundingBoxStyles(t,r),r.panelClass&&this._addPanelClasses(r.panelClass),this._positionChanges.observers.length){let a=this._getScrollVisibility();if(r!==this._lastPosition||!this._lastScrollVisibility||!YH(this._lastScrollVisibility,a)){let h=new sM(r,a);this._positionChanges.next(h)}this._lastScrollVisibility=a}this._lastPosition=r,this._isInitialRender=!1}_setTransformOrigin(r){if(!this._transformOriginSelector)return;let t=this._boundingBox.querySelectorAll(this._transformOriginSelector),a,h=r.overlayY;r.overlayX==="center"?a="center":this._isRtl()?a=r.overlayX==="start"?"right":"left":a=r.overlayX==="start"?"left":"right";for(let i=0;i<t.length;i++)t[i].style.transformOrigin=`${a} ${h}`}_calculateBoundingBoxRect(r,t){let a=this._viewportRect,h=this._isRtl(),i,C,F;if(t.overlayY==="top")C=r.y,i=a.height-C+this._viewportMargin;else if(t.overlayY==="bottom")F=a.height-r.y+this._viewportMargin*2,i=a.height-F+this._viewportMargin;else{let Ne=Math.min(a.bottom-r.y+a.top,r.y),ct=this._lastBoundingBoxSize.height;i=Ne*2,C=r.y-Ne,i>ct&&!this._isInitialRender&&!this._growAfterOpen&&(C=r.y-ct/2)}let V=t.overlayX==="start"&&!h||t.overlayX==="end"&&h,K=t.overlayX==="end"&&!h||t.overlayX==="start"&&h,oe,Ee,Ye;if(K)Ye=a.width-r.x+this._viewportMargin*2,oe=r.x-this._viewportMargin;else if(V)Ee=r.x,oe=a.right-r.x;else{let Ne=Math.min(a.right-r.x+a.left,r.x),ct=this._lastBoundingBoxSize.width;oe=Ne*2,Ee=r.x-Ne,oe>ct&&!this._isInitialRender&&!this._growAfterOpen&&(Ee=r.x-ct/2)}return{top:C,left:Ee,bottom:F,right:Ye,width:oe,height:i}}_setBoundingBoxStyles(r,t){let a=this._calculateBoundingBoxRect(r,t);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));let h={};if(this._hasExactPosition())h.top=h.left="0",h.bottom=h.right=h.maxHeight=h.maxWidth="",h.width=h.height="100%";else{let i=this._overlayRef.getConfig().maxHeight,C=this._overlayRef.getConfig().maxWidth;h.height=Br(a.height),h.top=Br(a.top),h.bottom=Br(a.bottom),h.width=Br(a.width),h.left=Br(a.left),h.right=Br(a.right),t.overlayX==="center"?h.alignItems="center":h.alignItems=t.overlayX==="end"?"flex-end":"flex-start",t.overlayY==="center"?h.justifyContent="center":h.justifyContent=t.overlayY==="bottom"?"flex-end":"flex-start",i&&(h.maxHeight=Br(i)),C&&(h.maxWidth=Br(C))}this._lastBoundingBoxSize=a,pp(this._boundingBox.style,h)}_resetBoundingBoxStyles(){pp(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){pp(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(r,t){let a={},h=this._hasExactPosition(),i=this._hasFlexibleDimensions,C=this._overlayRef.getConfig();if(h){let oe=this._viewportRuler.getViewportScrollPosition();pp(a,this._getExactOverlayY(t,r,oe)),pp(a,this._getExactOverlayX(t,r,oe))}else a.position="static";let F="",V=this._getOffset(t,"x"),K=this._getOffset(t,"y");V&&(F+=`translateX(${V}px) `),K&&(F+=`translateY(${K}px)`),a.transform=F.trim(),C.maxHeight&&(h?a.maxHeight=Br(C.maxHeight):i&&(a.maxHeight="")),C.maxWidth&&(h?a.maxWidth=Br(C.maxWidth):i&&(a.maxWidth="")),pp(this._pane.style,a)}_getExactOverlayY(r,t,a){let h={top:"",bottom:""},i=this._getOverlayPoint(t,this._overlayRect,r);if(this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,a)),r.overlayY==="bottom"){let C=this._document.documentElement.clientHeight;h.bottom=`${C-(i.y+this._overlayRect.height)}px`}else h.top=Br(i.y);return h}_getExactOverlayX(r,t,a){let h={left:"",right:""},i=this._getOverlayPoint(t,this._overlayRect,r);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,a));let C;if(this._isRtl()?C=r.overlayX==="end"?"left":"right":C=r.overlayX==="end"?"right":"left",C==="right"){let F=this._document.documentElement.clientWidth;h.right=`${F-(i.x+this._overlayRect.width)}px`}else h.left=Br(i.x);return h}_getScrollVisibility(){let r=this._getOriginRect(),t=this._pane.getBoundingClientRect(),a=this._scrollables.map(h=>h.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:tL(r,a),isOriginOutsideView:iM(r,a),isOverlayClipped:tL(t,a),isOverlayOutsideView:iM(t,a)}}_subtractOverflows(r,...t){return t.reduce((a,h)=>a-Math.max(h,0),r)}_getNarrowedViewportRect(){let r=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+r-this._viewportMargin,bottom:a.top+t-this._viewportMargin,width:r-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(r,t){return t==="x"?r.offsetX==null?this._offsetX:r.offsetX:r.offsetY==null?this._offsetY:r.offsetY}_validatePositions(){}_addPanelClasses(r){this._pane&&jg(r).forEach(t=>{t!==""&&this._appliedPanelClasses.indexOf(t)===-1&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(r=>{this._pane.classList.remove(r)}),this._appliedPanelClasses=[])}_getOriginRect(){let r=this._origin;if(r instanceof Bi)return r.nativeElement.getBoundingClientRect();if(r instanceof Element)return r.getBoundingClientRect();let t=r.width||0,a=r.height||0;return{top:r.y,bottom:r.y+a,left:r.x,right:r.x+t,height:a,width:t}}};function pp(n,r){for(let t in r)r.hasOwnProperty(t)&&(n[t]=r[t]);return n}function rL(n){if(typeof n!="number"&&n!=null){let[r,t]=n.split(XH);return!t||t==="px"?parseFloat(r):null}return n||null}function oL(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}function YH(n,r){return n===r?!0:n.isOriginClipped===r.isOriginClipped&&n.isOriginOutsideView===r.isOriginOutsideView&&n.isOverlayClipped===r.isOverlayClipped&&n.isOverlayOutsideView===r.isOverlayOutsideView}var sL="cdk-global-overlay-wrapper",uM=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(r){let t=r.getConfig();this._overlayRef=r,this._width&&!t.width&&r.updateSize({width:this._width}),this._height&&!t.height&&r.updateSize({height:this._height}),r.hostElement.classList.add(sL),this._isDisposed=!1}top(r=""){return this._bottomOffset="",this._topOffset=r,this._alignItems="flex-start",this}left(r=""){return this._xOffset=r,this._xPosition="left",this}bottom(r=""){return this._topOffset="",this._bottomOffset=r,this._alignItems="flex-end",this}right(r=""){return this._xOffset=r,this._xPosition="right",this}start(r=""){return this._xOffset=r,this._xPosition="start",this}end(r=""){return this._xOffset=r,this._xPosition="end",this}width(r=""){return this._overlayRef?this._overlayRef.updateSize({width:r}):this._width=r,this}height(r=""){return this._overlayRef?this._overlayRef.updateSize({height:r}):this._height=r,this}centerHorizontally(r=""){return this.left(r),this._xPosition="center",this}centerVertically(r=""){return this.top(r),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let r=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:h,height:i,maxWidth:C,maxHeight:F}=a,V=(h==="100%"||h==="100vw")&&(!C||C==="100%"||C==="100vw"),K=(i==="100%"||i==="100vh")&&(!F||F==="100%"||F==="100vh"),oe=this._xPosition,Ee=this._xOffset,Ye=this._overlayRef.getConfig().direction==="rtl",Ne="",ct="",bt="";V?bt="flex-start":oe==="center"?(bt="center",Ye?ct=Ee:Ne=Ee):Ye?oe==="left"||oe==="end"?(bt="flex-end",Ne=Ee):(oe==="right"||oe==="start")&&(bt="flex-start",ct=Ee):oe==="left"||oe==="start"?(bt="flex-start",Ne=Ee):(oe==="right"||oe==="end")&&(bt="flex-end",ct=Ee),r.position=this._cssPosition,r.marginLeft=V?"0":Ne,r.marginTop=K?"0":this._topOffset,r.marginBottom=this._bottomOffset,r.marginRight=V?"0":ct,t.justifyContent=bt,t.alignItems=K?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let r=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,a=t.style;t.classList.remove(sL),a.justifyContent=a.alignItems=r.marginTop=r.marginBottom=r.marginLeft=r.marginRight=r.position="",this._overlayRef=null,this._isDisposed=!0}},KH=(()=>{class n{_viewportRuler=Re(nw);_document=Re(oi);_platform=Re(po);_overlayContainer=Re(cL);constructor(){}global(){return new uM}flexibleConnectedTo(t){return new cM(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),mp=(()=>{class n{scrollStrategies=Re(WH);_overlayContainer=Re(cL);_positionBuilder=Re(KH);_keyboardDispatcher=Re(qH);_injector=Re(ci);_ngZone=Re(bn);_document=Re(oi);_directionality=Re(lv);_location=Re(xh);_outsideClickDispatcher=Re(ZH);_animationsModuleType=Re(bh,{optional:!0});_idGenerator=Re(av);_renderer=Re(Uo).createRenderer(null,null);_appRef;_styleLoader=Re(ud);constructor(){}create(t){this._styleLoader.load(lL);let a=this._createHostElement(),h=this._createPaneElement(a),i=this._createPortalOutlet(h),C=new oM(t);return C.direction=C.direction||this._directionality.value,new lM(i,a,h,C,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations",this._injector.get(Nr),this._renderer)}position(){return this._positionBuilder}_createPaneElement(t){let a=this._document.createElement("div");return a.id=this._idGenerator.getId("cdk-overlay-"),a.classList.add("cdk-overlay-pane"),t.appendChild(a),a}_createHostElement(){let t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(Fs)),new ew(t,null,this._appRef,this._injector,this._document)}static \u0275fac=function(a){return new(a||n)};static \u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var QH=new pt("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let n=Re(mp);return()=>n.scrollStrategies.reposition()}});function JH(n){return()=>n.scrollStrategies.reposition()}var e6={provide:QH,deps:[mp],useFactory:JH},uL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({providers:[mp,e6],imports:[Th,J2,eM,eM]})}return n})();var n6=["tooltip"],fL=20;var pL=new pt("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let n=Re(mp);return()=>n.scrollStrategies.reposition({scrollThrottle:fL})}});function i6(n){return()=>n.scrollStrategies.reposition({scrollThrottle:fL})}var r6={provide:pL,deps:[mp],useFactory:i6};function o6(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}var s6=new pt("mat-tooltip-default-options",{providedIn:"root",factory:o6});var dL="tooltip-panel",hL=dp({passive:!0}),a6=8,l6=8,c6=24,u6=200,mL=(()=>{class n{_elementRef=Re(Bi);_ngZone=Re(bn);_platform=Re(po);_ariaDescriber=Re(O2);_focusMonitor=Re(Zx);_dir=Re(lv);_injector=Re(ci);_viewContainerRef=Re(Ua);_defaultOptions=Re(s6,{optional:!0});_overlayRef;_tooltipInstance;_portal;_position="below";_positionAtOrigin=!1;_disabled=!1;_tooltipClass;_viewInitialized=!1;_pointerExitEventsInitialized=!1;_tooltipComponent=d6;_viewportMargin=8;_currentPosition;_cssClassPrefix="mat-mdc";_ariaDescriptionPending;_dirSubscribed=!1;get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=Vg(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){let a=Vg(t);this._disabled!==a&&(this._disabled=a,a?this.hide(0):this._setupPointerEnterEventsIfNeeded(),this._syncAriaDescription(this.message))}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=jx(t)}_showDelay;get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=jx(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}_hideDelay;touchGestures="auto";get message(){return this._message}set message(t){let a=this._message;this._message=t!=null?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage()),this._syncAriaDescription(a)}_message="";get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_passiveListeners=[];_touchstartTimeout=null;_destroyed=new jn;_isDestroyed=!1;constructor(){let t=this._defaultOptions;t&&(this._showDelay=t.showDelay,this._hideDelay=t.hideDelay,t.position&&(this.position=t.position),t.positionAtOrigin&&(this.positionAtOrigin=t.positionAtOrigin),t.touchGestures&&(this.touchGestures=t.touchGestures),t.tooltipClass&&(this.tooltipClass=t.tooltipClass)),this._viewportMargin=a6}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(ro(this._destroyed)).subscribe(t=>{t?t==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let t=this._elementRef.nativeElement;this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([a,h])=>{t.removeEventListener(a,h,hL)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._isDestroyed=!0,this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,a){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let h=this._createOverlay(a);this._detach(),this._portal=this._portal||new dv(this._tooltipComponent,this._viewContainerRef);let i=this._tooltipInstance=h.attach(this._portal).instance;i._triggerElement=this._elementRef.nativeElement,i._mouseLeaveHideDelay=this._hideDelay,i.afterHidden().pipe(ro(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),i.show(t)}hide(t=this.hideDelay){let a=this._tooltipInstance;a&&(a.isVisible()?a.hide(t):(a._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){let C=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&C._origin instanceof Bi)return this._overlayRef;this._detach()}let a=this._injector.get(hv).getAncestorScrollContainers(this._elementRef),h=this._injector.get(mp),i=h.position().flexibleConnectedTo(this.positionAtOrigin?t||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(a);return i.positionChanges.pipe(ro(this._destroyed)).subscribe(C=>{this._updateCurrentPositionClass(C.connectionPair),this._tooltipInstance&&C.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=h.create({direction:this._dir,positionStrategy:i,panelClass:`${this._cssClassPrefix}-${dL}`,scrollStrategy:this._injector.get(pL)()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(ro(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(ro(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(ro(this._destroyed)).subscribe(C=>{this._isTooltipVisible()&&C.keyCode===27&&!C2(C)&&(C.preventDefault(),C.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._dirSubscribed||(this._dirSubscribed=!0,this._dir.change.pipe(ro(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){let a=t.getConfig().positionStrategy,h=this._getOrigin(),i=this._getOverlayPosition();a.withPositions([this._addOffset(ht(ht({},h.main),i.main)),this._addOffset(ht(ht({},h.fallback),i.fallback))])}_addOffset(t){let a=l6,h=!this._dir||this._dir.value=="ltr";return t.originY==="top"?t.offsetY=-a:t.originY==="bottom"?t.offsetY=a:t.originX==="start"?t.offsetX=h?-a:a:t.originX==="end"&&(t.offsetX=h?a:-a),t}_getOrigin(){let t=!this._dir||this._dir.value=="ltr",a=this.position,h;a=="above"||a=="below"?h={originX:"center",originY:a=="above"?"top":"bottom"}:a=="before"||a=="left"&&t||a=="right"&&!t?h={originX:"start",originY:"center"}:(a=="after"||a=="right"&&t||a=="left"&&!t)&&(h={originX:"end",originY:"center"});let{x:i,y:C}=this._invertPosition(h.originX,h.originY);return{main:h,fallback:{originX:i,originY:C}}}_getOverlayPosition(){let t=!this._dir||this._dir.value=="ltr",a=this.position,h;a=="above"?h={overlayX:"center",overlayY:"bottom"}:a=="below"?h={overlayX:"center",overlayY:"top"}:a=="before"||a=="left"&&t||a=="right"&&!t?h={overlayX:"end",overlayY:"center"}:(a=="after"||a=="right"&&t||a=="left"&&!t)&&(h={overlayX:"start",overlayY:"center"});let{x:i,y:C}=this._invertPosition(h.overlayX,h.overlayY);return{main:h,fallback:{overlayX:i,overlayY:C}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),Hc(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,a){return this.position==="above"||this.position==="below"?a==="top"?a="bottom":a==="bottom"&&(a="top"):t==="end"?t="start":t==="start"&&(t="end"),{x:t,y:a}}_updateCurrentPositionClass(t){let{overlayY:a,originX:h,originY:i}=t,C;if(a==="center"?this._dir&&this._dir.value==="rtl"?C=h==="end"?"left":"right":C=h==="start"?"left":"right":C=a==="bottom"&&i==="top"?"above":"below",C!==this._currentPosition){let F=this._overlayRef;if(F){let V=`${this._cssClassPrefix}-${dL}-`;F.removePanelClass(V+this._currentPosition),F.addPanelClass(V+C)}this._currentPosition=C}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{this._setupPointerExitEventsIfNeeded();let a;t.x!==void 0&&t.y!==void 0&&(a=t),this.show(void 0,a)}]):this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{let a=t.targetTouches?.[0],h=a?{x:a.clientX,y:a.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),this._touchstartTimeout&&clearTimeout(this._touchstartTimeout);let i=500;this._touchstartTimeout=setTimeout(()=>{this._touchstartTimeout=null,this.show(void 0,h)},this._defaultOptions?.touchLongPressShowDelay??i)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;let t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",a=>{let h=a.relatedTarget;(!h||!this._overlayRef?.overlayElement.contains(h))&&this.hide()}],["wheel",a=>this._wheelListener(a)]);else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let a=()=>{this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions?.touchendHideDelay)};t.push(["touchend",a],["touchcancel",a])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([a,h])=>{this._elementRef.nativeElement.addEventListener(a,h,hL)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){let a=this._injector.get(oi).elementFromPoint(t.clientX,t.clientY),h=this._elementRef.nativeElement;a!==h&&!h.contains(a)&&this.hide()}}_disableNativeGesturesIfNecessary(){let t=this.touchGestures;if(t!=="off"){let a=this._elementRef.nativeElement,h=a.style;(t==="on"||a.nodeName!=="INPUT"&&a.nodeName!=="TEXTAREA")&&(h.userSelect=h.msUserSelect=h.webkitUserSelect=h.MozUserSelect="none"),(t==="on"||!a.draggable)&&(h.webkitUserDrag="none"),h.touchAction="none",h.webkitTapHighlightColor="transparent"}}_syncAriaDescription(t){this._ariaDescriptionPending||(this._ariaDescriptionPending=!0,this._ariaDescriber.removeDescription(this._elementRef.nativeElement,t,"tooltip"),this._isDestroyed||Hc({write:()=>{this._ariaDescriptionPending=!1,this.message&&!this.disabled&&this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")}},{injector:this._injector}))}static \u0275fac=function(a){return new(a||n)};static \u0275dir=_r({type:n,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(a,h){a&2&&zr("mat-mdc-tooltip-disabled",h.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"]})}return n})(),d6=(()=>{class n{_changeDetectorRef=Re(ma);_elementRef=Re(Bi);_isMultiline=!1;message;tooltipClass;_showTimeoutId;_hideTimeoutId;_triggerElement;_mouseLeaveHideDelay;_animationsDisabled;_tooltip;_closeOnInteraction=!1;_isVisible=!1;_onHide=new jn;_showAnimation="mat-mdc-tooltip-show";_hideAnimation="mat-mdc-tooltip-hide";constructor(){let t=Re(bh,{optional:!0});this._animationsDisabled=t==="NoopAnimations"}show(t){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>c6&&t.width>=u6}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){let a=this._tooltip.nativeElement,h=this._showAnimation,i=this._hideAnimation;if(a.classList.remove(t?i:h),a.classList.add(t?h:i),this._isVisible!==t&&(this._isVisible=t,this._changeDetectorRef.markForCheck()),t&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let C=getComputedStyle(a);(C.getPropertyValue("animation-duration")==="0s"||C.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(a.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["mat-tooltip-component"]],viewQuery:function(a,h){if(a&1&&Wc(n6,7),a&2){let i;Gl(i=Wl())&&(h._tooltip=i.first)}},hostAttrs:["aria-hidden","true"],hostBindings:function(a,h){a&1&&Tr("mouseleave",function(C){return h._handleMouseLeave(C)})},decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(a,h){if(a&1){let i=I_();Fn(0,"div",1,0),Tr("animationend",function(F){return sg(i),ag(h._handleAnimationEnd(F))}),Fn(2,"div",2),so(3),Wn()()}a&2&&(zr("mdc-tooltip--multiline",h._isMultiline),Xi("ngClass",h.tooltipClass),pi(3),gg(h.message))},dependencies:[nx],styles:['.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mdc-plain-tooltip-container-color, var(--mat-sys-inverse-surface));color:var(--mdc-plain-tooltip-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mdc-plain-tooltip-container-shape, var(--mat-sys-corner-extra-small));font-family:var(--mdc-plain-tooltip-supporting-text-font, var(--mat-sys-body-small-font));font-size:var(--mdc-plain-tooltip-supporting-text-size, var(--mat-sys-body-small-size));font-weight:var(--mdc-plain-tooltip-supporting-text-weight, var(--mat-sys-body-small-weight));line-height:var(--mdc-plain-tooltip-supporting-text-line-height, var(--mat-sys-body-small-line-height));letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, var(--mat-sys-body-small-tracking))}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel{line-height:normal}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}return n})();var gL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({providers:[r6],imports:[F2,uL,or,or,tw]})}return n})();var rw=class n{constructor(r){this.store=r;this.store.pipe(Dh(Bx)).subscribe(t=>{t&&this.searchedCity.set(t)})}cityNameChanged(r){this.searchedCity.set(r?.target?.value)}isCelsius=us(!0);searchedCity=us("");selectedCity=B0();updateTemperatureType(){this.isCelsius.update(r=>r=!r)}searchCity(){this.selectedCity.emit([this.searchedCity(),this.isCelsius()])}static \u0275fac=function(t){return new(t||n)(yr(ld))};static \u0275cmp=Jn({type:n,selectors:[["app-search-city"]],outputs:{selectedCity:"selectedCity"},standalone:!1,decls:9,vars:2,consts:[[1,"searchContainer"],[1,"d-inline-flex","align-items-center"],["type","text","placeholder","Enter City Name",3,"input","value"],["matTooltip","Search",1,"cursor-pointer",3,"click"],[1,"ms-4","d-inline-flex"],["matTooltip","Change Units","value","isCelsius()",3,"toggleChange"]],template:function(t,a){t&1&&(Fn(0,"div",0)(1,"div",1)(2,"input",2),Tr("input",function(i){return a.cityNameChanged(i)}),Wn(),so(3," \xA0\xA0 "),Fn(4,"mat-icon",3),Tr("click",function(){return a.searchCity()}),so(5,"search"),Wn()(),Fn(6,"div",4)(7,"mat-slide-toggle",5),Tr("toggleChange",function(){return a.updateTemperatureType()}),so(8),Wn()()()),t&2&&(pi(2),Xi("value",a.searchedCity()),pi(6),$a(" ",a.isCelsius()?" Celsius":" Fahrenheit"," "))},dependencies:[Yx,K2,mL],styles:[".example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.example-full-width[_ngcontent-%COMP%]{width:100%}.searchContainer[_ngcontent-%COMP%]{width:565px;display:flex;justify-content:flex-end;align-items:center}  .mdc-label{width:30px}input[type=text][_ngcontent-%COMP%]{padding:15px;margin:10px 0;width:100%;max-width:300px;border:1px solid #ccc;border-radius:5px;font-size:18px;box-shadow:0 5px 15px #0000001a;transition:border-color .3s ease-in-out}input[type=text][_ngcontent-%COMP%]:focus{outline:none;border-color:#2196f3}input[type=text][_ngcontent-%COMP%]::placeholder{color:#aaa}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})};var p6=()=>[12],yL=(n,r)=>[n,r];function m6(n,r){if(n&1&&rr(0,"mgl-marker",1),n&2){let t=Gc();Xi("lngLat",eD(1,yL,t.longitude(),t.latitude()))}}var ow=class n{constructor(r){this.store=r;this.store.pipe(Dh(_2)).subscribe(t=>{t&&this.latitude.set(t)}),this.store.pipe(Dh(v2)).subscribe(t=>{t&&this.longitude.set(t)})}latLongSelected=B0();longitude=us(-74.0066);latitude=us(40.7135);onMapClick(r){let t=r.lngLat;this.latitude.set(t.lat),this.longitude.set(t.lng),this.store.dispatch(Bg({latitude:this.latitude(),longitude:this.longitude()})),this.latLongSelected.emit(t)}static \u0275fac=function(t){return new(t||n)(yr(ld))};static \u0275cmp=Jn({type:n,selectors:[["app-map"]],outputs:{latLongSelected:"latLongSelected"},standalone:!1,decls:2,vars:9,consts:[[3,"mapClick","zoom","center"],[3,"lngLat"]],template:function(t,a){t&1&&(Fn(0,"mgl-map",0),Tr("mapClick",function(i){return a.onMapClick(i)}),da(1,m6,1,4,"mgl-marker",1),Wn()),t&2&&(LR("mapbox://styles/mapbox/streets-v11"),Xi("zoom",JC(5,p6))("center",eD(6,yL,a.longitude(),a.latitude())),pi(),pg(a.longitude()&&a.latitude()?1:-1))},dependencies:[NO,zO],styles:["mgl-map[_ngcontent-%COMP%]{height:100%;width:100%}"]})};var sw=TI(_L());var y6=["*"];var _6=new pt("MAT_CARD_CONFIG"),vL=(()=>{class n{appearance;constructor(){let t=Re(_6,{optional:!0});this.appearance=t?.appearance||"raised"}static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(a,h){a&2&&zr("mat-mdc-card-outlined",h.appearance==="outlined")("mdc-card--outlined",h.appearance==="outlined")},inputs:{appearance:"appearance"},exportAs:["matCard"],ngContentSelectors:y6,decls:1,vars:0,template:function(a,h){a&1&&(ha(),fa(0))},styles:['.mat-mdc-card{display:flex;flex-direction:column;box-sizing:border-box;position:relative;border-style:solid;border-width:0;background-color:var(--mdc-elevated-card-container-color, var(--mat-sys-surface-container-low));border-color:var(--mdc-elevated-card-container-color, var(--mat-sys-surface-container-low));border-radius:var(--mdc-elevated-card-container-shape, var(--mat-sys-corner-medium));box-shadow:var(--mdc-elevated-card-container-elevation, var(--mat-sys-level1))}.mat-mdc-card::after{position:absolute;top:0;left:0;width:100%;height:100%;border:solid 1px rgba(0,0,0,0);content:"";display:block;pointer-events:none;box-sizing:border-box;border-radius:var(--mdc-elevated-card-container-shape, var(--mat-sys-corner-medium))}.mat-mdc-card-outlined{background-color:var(--mdc-outlined-card-container-color, var(--mat-sys-surface));border-radius:var(--mdc-outlined-card-container-shape, var(--mat-sys-corner-medium));border-width:var(--mdc-outlined-card-outline-width, 1px);border-color:var(--mdc-outlined-card-outline-color, var(--mat-sys-outline-variant));box-shadow:var(--mdc-outlined-card-container-elevation, var(--mat-sys-level0))}.mat-mdc-card-outlined::after{border:none}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mat-mdc-card-actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font, var(--mat-sys-title-large-font));line-height:var(--mat-card-title-text-line-height, var(--mat-sys-title-large-line-height));font-size:var(--mat-card-title-text-size, var(--mat-sys-title-large-size));letter-spacing:var(--mat-card-title-text-tracking, var(--mat-sys-title-large-tracking));font-weight:var(--mat-card-title-text-weight, var(--mat-sys-title-large-weight))}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color, var(--mat-sys-on-surface));font-family:var(--mat-card-subtitle-text-font, var(--mat-sys-title-medium-font));line-height:var(--mat-card-subtitle-text-line-height, var(--mat-sys-title-medium-line-height));font-size:var(--mat-card-subtitle-text-size, var(--mat-sys-title-medium-size));letter-spacing:var(--mat-card-subtitle-text-tracking, var(--mat-sys-title-medium-tracking));font-weight:var(--mat-card-subtitle-text-weight, var(--mat-sys-title-medium-weight))}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0})}return n})();var bL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275dir=_r({type:n,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"]})}return n})();var xL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,or]})}return n})();var wL=(()=>{class n{get vertical(){return this._vertical}set vertical(t){this._vertical=Vg(t)}_vertical=!1;get inset(){return this._inset}set inset(t){this._inset=Vg(t)}_inset=!1;static \u0275fac=function(a){return new(a||n)};static \u0275cmp=Jn({type:n,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(a,h){a&2&&(Ho("aria-orientation",h.vertical?"vertical":"horizontal"),zr("mat-divider-vertical",h.vertical)("mat-divider-horizontal",!h.vertical)("mat-divider-inset",h.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(a,h){},styles:[".mat-divider{display:block;margin:0;border-top-style:solid;border-top-color:var(--mat-divider-color, var(--mat-sys-outline));border-top-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-vertical{border-top:0;border-right-style:solid;border-right-color:var(--mat-divider-color, var(--mat-sys-outline));border-right-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}"],encapsulation:2,changeDetection:0})}return n})(),EL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,or]})}return n})();var CL=(()=>{class n{constructor(t,a){this.el=t,this._zone=a,this.updateChange=new Tt(!0),this.chartInstance=new Tt}ngOnChanges(t){let a=t.update?.currentValue;(t.options||a)&&(this.wrappedUpdateOrCreateChart(),a&&this.updateChange.emit(!1))}wrappedUpdateOrCreateChart(){this.runOutsideAngular?this._zone.runOutsideAngular(()=>{this.updateOrCreateChart()}):this.updateOrCreateChart()}updateOrCreateChart(){this.chart?.update?this.chart.update(this.options,!0,this.oneToOne||!1):(this.chart=this.Highcharts[this.constructorType||"chart"](this.el.nativeElement,this.options,this.callbackFunction||null),this.chartInstance.emit(this.chart))}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=null,this.chartInstance.emit(this.chart))}static{this.\u0275fac=function(a){return new(a||n)(yr(Bi),yr(bn))}}static{this.\u0275cmp=Jn({type:n,selectors:[["highcharts-chart"]],inputs:{Highcharts:"Highcharts",constructorType:"constructorType",callbackFunction:"callbackFunction",oneToOne:"oneToOne",runOutsideAngular:"runOutsideAngular",options:"options",update:"update"},outputs:{updateChange:"updateChange",chartInstance:"chartInstance"},standalone:!1,features:[cs],decls:0,vars:0,template:function(a,h){},encapsulation:2})}}return n})(),DL=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=tn({type:n})}static{this.\u0275inj=en({})}}return n})();var w6=(n,r,t,a)=>({blue:n,yellow:r,orange:t,red:a});function E6(n,r){if(n&1&&(Fn(0,"div",5)(1,"div",6)(2,"div"),rr(3,"img",7),Fn(4,"p",8),so(5),Wn(),Fn(6,"p"),so(7),Wn()(),rr(8,"mat-divider",9),Fn(9,"div")(10,"p",10),so(11),Wn(),Fn(12,"p"),so(13),Wn(),Fn(14,"p"),so(15),Wn(),Fn(16,"p"),so(17),Wn(),Fn(18,"p"),so(19),Wn()()()()),n&2){let t,a,h,i=Gc();pi(3),Xi("src",i.iconUrl,Bk),pi(),Xi("ngClass",HR(11,w6,((t=i.currentWeather().main)==null?null:t.temp)<5,5<((t=i.currentWeather().main)==null?null:t.temp)&&((t=i.currentWeather().main)==null?null:t.temp)<15,15<((t=i.currentWeather().main)==null?null:t.temp)&&((t=i.currentWeather().main)==null?null:t.temp)<25,((t=i.currentWeather().main)==null?null:t.temp)>25)),pi(),$a(" ",(a=i.currentWeather().main)==null?null:a.temp,"\xB0C "),pi(2),QC(" ",i.currentWeather().weather[0].main,": ",i.currentWeather().weather[0].description," "),pi(),Xi("vertical",!0),pi(3),$a(" Feels like: ",(h=i.currentWeather())==null||h.main==null?null:h.main.feels_like,"\xB0C "),pi(2),$a("Pressure: ",i.currentWeather().main.pressure," hPa"),pi(2),$a("Humidity: ",i.currentWeather().main.humidity,"%"),pi(2),$a("Wind: ",i.currentWeather().wind.speed," km/h"),pi(2),$a("Clouds: ",i.currentWeather().clouds.all,"%")}}var aw=class n{Highcharts=sw;name="";country="";currentWeather=E_();foreCastList=E_();loaded=!0;iconUrl="https://openweathermap.org/img/wn/50n@2x.png";temperatureData=this.foreCastList()?.list.map(r=>({x:new Date(r.dt_txt).getTime(),y:r.main.temp}));windSpeedData=this.foreCastList()?.list.map(r=>({x:new Date(r.dt_txt).getTime(),y:r.wind.speed}));temperatureChartOptions={chart:{type:"line"},title:{text:"Temperature Forecast"},xAxis:{type:"datetime",title:{text:"Time"},labels:{format:"{value:%Y-%m-%d %H:%M}"}},yAxis:{title:{text:"Temperature (\xB0C)"}},tooltip:{xDateFormat:"%Y-%m-%d %H:%M",valueSuffix:" \xB0C"},series:[{name:"Temperature",data:this.foreCastList()?.list.map(r=>({x:new Date(r.dt_txt).getTime(),y:r.main.temp})),type:"line"}]};windSpeedChartOptions={chart:{type:"line"},title:{text:"Wind Speed Forecast"},xAxis:{type:"datetime",title:{text:"Time"},labels:{format:"{value:%Y-%m-%d %H:%M}"}},yAxis:{title:{text:"Wind Speed (m/s)"}},tooltip:{xDateFormat:"%Y-%m-%d %H:%M",valueSuffix:" m/s"},series:[{name:"Wind Speed",data:this.foreCastList()?.list.map(r=>({x:new Date(r.dt_txt).getTime(),y:r.wind.speed})),type:"line"}]};constructor(){setTimeout(()=>{this.temperatureChartOptions={chart:{type:"line"},title:{text:"Temperature Forecast"},xAxis:{type:"datetime",title:{text:"Time"},labels:{formatter:function(){return sw.dateFormat("%e %b",this.value)}}},yAxis:{title:{text:"Temperature (\xB0C)"}},tooltip:{xDateFormat:"%e %b %Y %H:%M",valueSuffix:" \xB0C"},series:[{name:"Temperature",data:this.foreCastList()?.list.map(r=>({x:new Date(r.dt_txt).getTime(),y:r.main.temp})),type:"line"}]},this.windSpeedChartOptions={chart:{type:"line"},title:{text:"Wind Speed Forecast"},xAxis:{type:"datetime",title:{text:"Time"},labels:{formatter:function(){return sw.dateFormat("%e %b",this.value)}}},yAxis:{title:{text:"Wind Speed (m/s)"}},tooltip:{xDateFormat:"%e %b %Y %H:%M",valueSuffix:" m/s"},series:[{name:"Wind Speed",data:this.foreCastList()?.list.map(r=>({x:new Date(r.dt_txt).getTime(),y:r.wind.speed})),type:"line"}]}},3e3)}ngOnInit(){}convertTimestampToDayMonth(r){let t=new Date(r*1e3),a=t.getDate(),h=["January","February","March","April","May","June","July","August","September","October","November","December"],i=t.getMonth(),C=h[i];return`${a}-${C}`}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Jn({type:n,selectors:[["app-weather-display"]],inputs:{currentWeather:[1,"currentWeather"],foreCastList:[1,"foreCastList"]},standalone:!1,decls:12,vars:5,consts:[[1,"grid-container"],["appearance","outlined",1,"grid-item","weatherDetailsCard"],["class","content",4,"ngIf"],[1,"weather-chart"],[2,"width","100%","height","400px","display","block",3,"Highcharts","options"],[1,"content"],[1,"d-flex","mt-3"],["alt","Current weather icon",3,"src"],[3,"ngClass"],[3,"vertical"],[2,"margin-top","10px"]],template:function(t,a){t&1&&(Fn(0,"div",0)(1,"mat-card",1)(2,"mat-card-content"),da(3,E6,20,16,"div",2),Wn()(),Fn(4,"mat-card",1)(5,"mat-card-content")(6,"div",3),rr(7,"highcharts-chart",4),Wn()()(),Fn(8,"mat-card",1)(9,"mat-card-content")(10,"div",3),rr(11,"highcharts-chart",4),Wn()()()()),t&2&&(pi(3),Xi("ngIf",a.loaded),pi(4),Xi("Highcharts",a.Highcharts)("options",a.temperatureChartOptions),pi(4),Xi("Highcharts",a.Highcharts)("options",a.windSpeedChartOptions))},dependencies:[vL,bL,nx,ix,wL,CL],styles:[".weatherDetailsCard[_ngcontent-%COMP%]{-webkit-box-shadow:-1px 2px 9px -2px rgba(0,0,0,.55);-moz-box-shadow:-1px 2px 9px -2px rgba(0,0,0,.55);box-shadow:-1px 2px 9px -2px #0000008c}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;grid-gap:10px;padding:10px;height:30vh}.blue[_ngcontent-%COMP%]{color:#4169e1}.yellow[_ngcontent-%COMP%]{color:#f4a460}.orange[_ngcontent-%COMP%]{color:#ff8c00}.red[_ngcontent-%COMP%]{color:red}@media only screen and (max-height: 768px),screen and (max-width: 768px){.container[_ngcontent-%COMP%]{justify-content:normal}.main[_ngcontent-%COMP%]{width:100vw;padding-top:2em;padding-bottom:1em}}"]})};function D6(n,r){if(n&1&&(Fn(0,"h6"),so(1," Current weather in "),Fn(2,"b"),so(3),Wn()()),n&2){let t=Gc();pi(3),gg(t.currentCityDetails==null?null:t.currentCityDetails.name)}}function T6(n,r){if(n&1&&rr(0,"app-weather-display",9),n&2){let t=Gc();Xi("currentWeather",t.currentCityDetails)("foreCastList",t.foreCastList)}}var lw=class n{constructor(r,t,a){this.httpService=r;this.weatherService=t;this.store=a;this.store.pipe(Dh(Bx)).subscribe(h=>{h&&this.cityName.set(h)})}get showCardDetails(){return Object.keys(this.currentCityDetails)?.length}cityName=us("");metric=us(!1);currentCityDetails={};foreCastList=[];searchCity(r){this.cityName.set(r[0]),this.metric.set(r[1]);let t=this.weatherService.getDetailsViaCityName(this.cityName(),this.metric());this.httpService.get(t).subscribe(a=>{this.currentCityDetails=a,this.store.dispatch(Bg({latitude:parseFloat(a?.coord?.lat),longitude:parseFloat(a?.coord?.lon)})),this.store.dispatch(ov({locationName:this.cityName()})),this.foreCastDetails()},a=>{console.error("Error",a)})}foreCastDetails(){let r=this.weatherService.getDetailsViaCityName(this.cityName(),this.metric(),!0);this.httpService.get(r).subscribe(t=>{this.foreCastList=t},t=>{console.error("Error",t)})}updateDetailsViaLatLon(r){let t=this.weatherService.getDetailsViaLatLong(r.lat,r.lng,this.metric());this.httpService.get(t).subscribe(a=>{this.currentCityDetails=a,this.foreCastDetails(),this.store.dispatch(ov({locationName:a?.name})),console.log("latLong",a)},a=>{console.error("Error",a)})}static \u0275fac=function(t){return new(t||n)(yr(Fg),yr(Lg),yr(ld))};static \u0275cmp=Jn({type:n,selectors:[["app-weather-dashboard"]],standalone:!1,features:[pa([])],decls:10,vars:2,consts:[[1,"containerBox"],[1,"grid-container"],[1,"element-two-thirds"],[4,"ngIf"],[1,"element-one-third"],[3,"selectedCity"],[1,"mapComponent"],[3,"latLongSelected"],[3,"currentWeather","foreCastList",4,"ngIf"],[3,"currentWeather","foreCastList"]],template:function(t,a){t&1&&(Fn(0,"div",0)(1,"div",1)(2,"div",2),da(3,D6,4,1,"h6",3),Wn(),Fn(4,"div",4)(5,"app-search-city",5),Tr("selectedCity",function(i){return a.searchCity(i)}),Wn()()(),Fn(6,"div",6)(7,"app-map",7),Tr("latLongSelected",function(i){return a.updateDetailsViaLatLon(i)}),Wn()(),Fn(8,"div"),da(9,T6,1,2,"app-weather-display",8),Wn()()),t&2&&(pi(3),Xi("ngIf",a.showCardDetails),pi(6),Xi("ngIf",a.showCardDetails))},dependencies:[ix,rw,ow,aw],styles:[".mapComponent[_ngcontent-%COMP%]{height:35vh;padding:15px;margin-left:15px;margin-right:15px;-webkit-box-shadow:-1px 2px 9px -2px rgba(0,0,0,.55);-moz-box-shadow:-1px 2px 9px -2px rgba(0,0,0,.55);box-shadow:-1px 2px 9px -2px #0000008c}.mainBlock[_ngcontent-%COMP%]{width:95%}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:6fr 4fr;height:10vh;place-items:center}.element-one-third[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}"]})};var M6=[{path:"",component:lw}],cw=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[hT.forRoot(M6),hT]})};var pv=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,$x,or]})}return n})();var TL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({})}return n})();var ML=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,pv,pv,TL,or]})}return n})();var IL=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=tn({type:n});static \u0275inj=en({imports:[or,$2,or]})}return n})();var I6={latitude:12.9762,longitude:77.6033,locationName:"Bengaluru"},S6=y2(I6,RT(Bg,(n,{latitude:r,longitude:t})=>vn(ht({},n),{latitude:r,longitude:t})),RT(ov,(n,{locationName:r})=>vn(ht({},n),{locationName:r})));function SL(n,r){return S6(n,r)}var uw=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=tn({type:n,bootstrap:[Rx]});static \u0275inj=en({providers:[Lg,Fg],imports:[E2,pv,ML,xL,G2,IL,vg,VP,cw,MP,EL,Q2,gL,BO.withConfig({accessToken:"pk.eyJ1Ijoid3lra3NzIiwiYSI6ImNqMjR6aTdmdzAwNHMzMnBvbjBucjlqNm8ifQ.6GjGpofWBVaIuSnhdXQb5w"}),g2.forRoot({location:SL}),DL]})};BP().bootstrapModule(uw).catch(n=>console.error(n));
